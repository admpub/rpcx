
<html>
    <head>
        <title>Coverage Report</title>
        
        <style type="text/css">
            body { background-color: #fff; }
            table {
                margin-left: 10px;
                border-collapse: collapse;
            }
            td { 
                background-color: #fff; 
                padding: 2px;
            }
            table.overview td {
                padding-right: 20px;
            }
            td.percent, td.linecount { text-align: right; }
            div.package, #totalcov { 
                color: #fff;
                background-color: #375eab; 
                font-size: 16px;
                font-weight: bold;
                padding: 10px;
                border-radius: 5px 5px 5px 5px;
            }
            div.package, #totalcov { 
                float: right; 
                right: 10px;
            }
            #totalcov { 
                top: 10px;
                position: relative;
                background-color: #fff;
                color: #000;
                border: 1px solid #375eab;
                clear: both;
            }
            #summaryWrapper {
                position: fixed;
                top: 10px;
                float: right;
                right: 10px;

            }
            span.packageTotal {
                float: right;
                color: #000;
            }
            #doctitle { 
                background-color: #fff; 
                font-size: 24px;
                margin-top: 20px;
                margin-left: 10px;
                color: #375eab;
                font-weight: bold;
            }
            #about {
                margin-left: 18px;
                font-size: 10px;
            }
            table tr:last-child td {
                font-weight: bold;
            }
            .functitle, .funcname { 
                text-align: center; 
                font-size: 20px; 
                font-weight: bold; 
                color: 375eab; 
            }
            .funcname {
                text-align: left;
                margin-top: 20px;
                margin-left: 10px;
                margin-bottom: 20px;
                padding: 2px 5px 5px;
                background-color: #e0ebf5;
            }
            table.listing {
                margin-left: 10px;
            }
            table.listing td {
                padding: 0px;
                font-size: 12px;
                background-color: #eee; 
                vertical-align: top;
                padding-left: 10px;
                border-bottom: 1px solid #fff;
            }
            table.listing td:first-child {
                text-align: right;
                font-weight: bold;
                vertical-align: center;
            }
            table.listing tr.miss td {
                background-color: #FFBBB8;
            }
            table.listing tr:last-child td {
                font-weight: normal;
                color: #000;
            }
            table.listing tr:last-child td:first-child {
                font-weight: bold;
            }
            .info {
                margin-left: 10px;
            }
            .info code {
            }
            pre { margin: 1px; }
            pre.cmd { 
                background-color: #e9e9e9;
                border-radius: 5px 5px 5px 5px;
                padding: 10px;
                margin: 20px;
                line-height: 18px;
                font-size; 14px;
            }
            a { 
                text-decoration: none; 
                color: #375eab;
            }
            a:hover { text-decoration: underline; }
            p { margin-left: 10px; }
        </style>
        
    </head>
    <body>
        <div id="doctitle">Coverage Report</div>
    <div id="about">Generated on 28 Mar 19 10:53 +0800 with <a href="https://github.com/matm/gocov-html">gocov-html</a></div><div class="funcname">Report Overview</div><table class="overview">
<tr id="s_pkg_github.com/smallnest/rpcx/client"><td><code><a href="#pkg_github.com/smallnest/rpcx/client">github.com/smallnest/rpcx/client</a></code></td><td class="percent"><code>19.50%</code></td><td class="linecount"><code>294/1508</code></td></tr>
<tr id="s_pkg_github.com/smallnest/rpcx/protocol"><td><code><a href="#pkg_github.com/smallnest/rpcx/protocol">github.com/smallnest/rpcx/protocol</a></code></td><td class="percent"><code>54.72%</code></td><td class="linecount"><code>116/212</code></td></tr>
<tr id="s_pkg_github.com/smallnest/rpcx/server"><td><code><a href="#pkg_github.com/smallnest/rpcx/server">github.com/smallnest/rpcx/server</a></code></td><td class="percent"><code>22.97%</code></td><td class="linecount"><code>207/901</code></td></tr>
<tr id="s_pkg_github.com/smallnest/rpcx/serverplugin"><td><code><a href="#pkg_github.com/smallnest/rpcx/serverplugin">github.com/smallnest/rpcx/serverplugin</a></code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/333</code></td></tr>
<tr><td><code>Report Total</code></td><td class="percent"><code>20.89%</code></td><td class="linecount"><code>617/2954</code></td></tr>
</table>
<div id="pkg_github.com/smallnest/rpcx/client" class="funcname">Package Overview: github.com/smallnest/rpcx/client <span class="packageTotal">19.50%</span></div><p>This is a coverage report created after analysis of the <code>github.com/smallnest/rpcx/client</code> package. It 
        has been generated with the following command:</p><pre class="cmd">gocov test github.com/smallnest/rpcx/client | gocov-html</pre>        <p>Here are the stats. Please select a function name to view its implementation and see what's left for testing.</p><table class="overview">
<tr id="s_fn_filterByStateAndGroup"><td><code><a href="#fn_filterByStateAndGroup">filterByStateAndGroup(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>6/6</code></td></tr>
<tr id="s_fn_ConsecCircuitBreaker.ready"><td><code><a href="#fn_ConsecCircuitBreaker.ready">ConsecCircuitBreaker.ready(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/circuit_breaker.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>5/5</code></td></tr>
<tr id="s_fn_newRandomSelector"><td><code><a href="#fn_newRandomSelector">newRandomSelector(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>4/4</code></td></tr>
<tr id="s_fn_@906:5"><td><code><a href="#fn_@906:5">@906:5(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>3/3</code></td></tr>
<tr id="s_fn_@42:6"><td><code><a href="#fn_@42:6">@42:6(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/circuit_breaker.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>2/2</code></td></tr>
<tr id="s_fn_ConsecCircuitBreaker.fail"><td><code><a href="#fn_ConsecCircuitBreaker.fail">ConsecCircuitBreaker.fail(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/circuit_breaker.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>2/2</code></td></tr>
<tr id="s_fn_ConsecCircuitBreaker.reset"><td><code><a href="#fn_ConsecCircuitBreaker.reset">ConsecCircuitBreaker.reset(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/circuit_breaker.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>2/2</code></td></tr>
<tr id="s_fn_Client.Call"><td><code><a href="#fn_Client.Call">Client.Call(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_@907:9"><td><code><a href="#fn_@907:9">@907:9(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Peer2PeerDiscovery.WatchService"><td><code><a href="#fn_Peer2PeerDiscovery.WatchService">Peer2PeerDiscovery.WatchService(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/peer2peer_discovery.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Peer2PeerDiscovery.GetServices"><td><code><a href="#fn_Peer2PeerDiscovery.GetServices">Peer2PeerDiscovery.GetServices(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/peer2peer_discovery.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_NewConsecCircuitBreaker"><td><code><a href="#fn_NewConsecCircuitBreaker">NewConsecCircuitBreaker(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/circuit_breaker.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_ConsecCircuitBreaker.success"><td><code><a href="#fn_ConsecCircuitBreaker.success">ConsecCircuitBreaker.success(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/circuit_breaker.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Client.RegisterServerMessageChan"><td><code><a href="#fn_Client.RegisterServerMessageChan">Client.RegisterServerMessageChan(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_NewPeer2PeerDiscovery"><td><code><a href="#fn_NewPeer2PeerDiscovery">NewPeer2PeerDiscovery(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/peer2peer_discovery.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_ConsecCircuitBreaker.Call"><td><code><a href="#fn_ConsecCircuitBreaker.Call">ConsecCircuitBreaker.Call(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/circuit_breaker.go</code></td><td class="percent"><code>87.50%</code></td><td class="linecount"><code>14/16</code></td></tr>
<tr id="s_fn_NewXClient"><td><code><a href="#fn_NewXClient">NewXClient(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>86.67%</code></td><td class="linecount"><code>13/15</code></td></tr>
<tr id="s_fn_xClient.selectClient"><td><code><a href="#fn_xClient.selectClient">xClient.selectClient(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>85.71%</code></td><td class="linecount"><code>6/7</code></td></tr>
<tr id="s_fn_xClient.wrapCall"><td><code><a href="#fn_xClient.wrapCall">xClient.wrapCall(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>85.71%</code></td><td class="linecount"><code>6/7</code></td></tr>
<tr id="s_fn_xClient.Close"><td><code><a href="#fn_xClient.Close">xClient.Close(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>84.62%</code></td><td class="linecount"><code>11/13</code></td></tr>
<tr id="s_fn_Client.Go"><td><code><a href="#fn_Client.Go">Client.Go(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>84.21%</code></td><td class="linecount"><code>16/19</code></td></tr>
<tr id="s_fn_randomSelector.Select"><td><code><a href="#fn_randomSelector.Select">randomSelector.Select(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>80.00%</code></td><td class="linecount"><code>4/5</code></td></tr>
<tr id="s_fn_splitNetworkAndAddress"><td><code><a href="#fn_splitNetworkAndAddress">splitNetworkAndAddress(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>75.00%</code></td><td class="linecount"><code>3/4</code></td></tr>
<tr id="s_fn_xClient.getCachedClient"><td><code><a href="#fn_xClient.getCachedClient">xClient.getCachedClient(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>66.67%</code></td><td class="linecount"><code>20/30</code></td></tr>
<tr id="s_fn_Client.Close"><td><code><a href="#fn_Client.Close">Client.Close(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>66.67%</code></td><td class="linecount"><code>12/18</code></td></tr>
<tr id="s_fn_newDirectConn"><td><code><a href="#fn_newDirectConn">newDirectConn(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/connection.go</code></td><td class="percent"><code>66.67%</code></td><td class="linecount"><code>10/15</code></td></tr>
<tr id="s_fn_Client.Connect"><td><code><a href="#fn_Client.Connect">Client.Connect(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/connection.go</code></td><td class="percent"><code>63.64%</code></td><td class="linecount"><code>14/22</code></td></tr>
<tr id="s_fn_Client.input"><td><code><a href="#fn_Client.input">Client.input(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>56.96%</code></td><td class="linecount"><code>45/79</code></td></tr>
<tr id="s_fn_Client.send"><td><code><a href="#fn_Client.send">Client.send(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>53.12%</code></td><td class="linecount"><code>34/64</code></td></tr>
<tr id="s_fn_Call.done"><td><code><a href="#fn_Call.done">Call.done(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>50.00%</code></td><td class="linecount"><code>1/2</code></td></tr>
<tr id="s_fn_Client.call"><td><code><a href="#fn_Client.call">Client.call(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>45.00%</code></td><td class="linecount"><code>9/20</code></td></tr>
<tr id="s_fn_Client.injectOpenTracingSpan"><td><code><a href="#fn_Client.injectOpenTracingSpan">Client.injectOpenTracingSpan(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>42.86%</code></td><td class="linecount"><code>6/14</code></td></tr>
<tr id="s_fn_pluginContainer.DoClientAfterDecode"><td><code><a href="#fn_pluginContainer.DoClientAfterDecode">pluginContainer.DoClientAfterDecode(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/plugin.go</code></td><td class="percent"><code>42.86%</code></td><td class="linecount"><code>3/7</code></td></tr>
<tr id="s_fn_pluginContainer.DoClientBeforeEncode"><td><code><a href="#fn_pluginContainer.DoClientBeforeEncode">pluginContainer.DoClientBeforeEncode(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/plugin.go</code></td><td class="percent"><code>42.86%</code></td><td class="linecount"><code>3/7</code></td></tr>
<tr id="s_fn_pluginContainer.DoClientConnected"><td><code><a href="#fn_pluginContainer.DoClientConnected">pluginContainer.DoClientConnected(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/plugin.go</code></td><td class="percent"><code>42.86%</code></td><td class="linecount"><code>3/7</code></td></tr>
<tr id="s_fn_pluginContainer.DoClientConnectionClose"><td><code><a href="#fn_pluginContainer.DoClientConnectionClose">pluginContainer.DoClientConnectionClose(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/plugin.go</code></td><td class="percent"><code>42.86%</code></td><td class="linecount"><code>3/7</code></td></tr>
<tr id="s_fn_Client.injectOpenCensusSpan"><td><code><a href="#fn_Client.injectOpenCensusSpan">Client.injectOpenCensusSpan(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>33.33%</code></td><td class="linecount"><code>6/18</code></td></tr>
<tr id="s_fn_pluginContainer.DoPostCall"><td><code><a href="#fn_pluginContainer.DoPostCall">pluginContainer.DoPostCall(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/plugin.go</code></td><td class="percent"><code>33.33%</code></td><td class="linecount"><code>2/6</code></td></tr>
<tr id="s_fn_pluginContainer.DoPreCall"><td><code><a href="#fn_pluginContainer.DoPreCall">pluginContainer.DoPreCall(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/plugin.go</code></td><td class="percent"><code>33.33%</code></td><td class="linecount"><code>2/6</code></td></tr>
<tr id="s_fn_newSelector"><td><code><a href="#fn_newSelector">newSelector(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>25.00%</code></td><td class="linecount"><code>2/8</code></td></tr>
<tr id="s_fn_xClient.Call"><td><code><a href="#fn_xClient.Call">xClient.Call(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>17.28%</code></td><td class="linecount"><code>14/81</code></td></tr>
<tr id="s_fn_Client.SendRaw"><td><code><a href="#fn_Client.SendRaw">Client.SendRaw(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/58</code></td></tr>
<tr id="s_fn_xClient.SendRaw"><td><code><a href="#fn_xClient.SendRaw">xClient.SendRaw(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/51</code></td></tr>
<tr id="s_fn_xClient.Fork"><td><code><a href="#fn_xClient.Fork">xClient.Fork(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/39</code></td></tr>
<tr id="s_fn_xClient.SendFile"><td><code><a href="#fn_xClient.SendFile">xClient.SendFile(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/39</code></td></tr>
<tr id="s_fn_xClient.Broadcast"><td><code><a href="#fn_xClient.Broadcast">xClient.Broadcast(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/37</code></td></tr>
<tr id="s_fn_inprocessClient.Call"><td><code><a href="#fn_inprocessClient.Call">inprocessClient.Call(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/30</code></td></tr>
<tr id="s_fn_xClient.DownloadFile"><td><code><a href="#fn_xClient.DownloadFile">xClient.DownloadFile(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/27</code></td></tr>
<tr id="s_fn_newDirectHTTPConn"><td><code><a href="#fn_newDirectHTTPConn">newDirectHTTPConn(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/connection.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/23</code></td></tr>
<tr id="s_fn_getClosestServer"><td><code><a href="#fn_getClosestServer">getClosestServer(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/geo_utils.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/21</code></td></tr>
<tr id="s_fn_xClient.getCachedClientWithoutLock"><td><code><a href="#fn_xClient.getCachedClientWithoutLock">xClient.getCachedClientWithoutLock(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/18</code></td></tr>
<tr id="s_fn_inprocessClient.Go"><td><code><a href="#fn_inprocessClient.Go">inprocessClient.Go(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/18</code></td></tr>
<tr id="s_fn_convertRes2Raw"><td><code><a href="#fn_convertRes2Raw">convertRes2Raw(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/17</code></td></tr>
<tr id="s_fn_MDNSDiscovery.browse"><td><code><a href="#fn_MDNSDiscovery.browse">MDNSDiscovery.browse(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/mdns_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/16</code></td></tr>
<tr id="s_fn_createGeoServer"><td><code><a href="#fn_createGeoServer">createGeoServer(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/15</code></td></tr>
<tr id="s_fn_nextWeighted"><td><code><a href="#fn_nextWeighted">nextWeighted(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/smooth-weighted-round-robin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/15</code></td></tr>
<tr id="s_fn_NewBidirectionalXClient"><td><code><a href="#fn_NewBidirectionalXClient">NewBidirectionalXClient(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/15</code></td></tr>
<tr id="s_fn_OneClient.SendRaw"><td><code><a href="#fn_OneClient.SendRaw">OneClient.SendRaw(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/15</code></td></tr>
<tr id="s_fn_OneClient.Go"><td><code><a href="#fn_OneClient.Go">OneClient.Go(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/14</code></td></tr>
<tr id="s_fn_geoSelector.Select"><td><code><a href="#fn_geoSelector.Select">geoSelector.Select(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/14</code></td></tr>
<tr id="s_fn_OneClient.Call"><td><code><a href="#fn_OneClient.Call">OneClient.Call(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/14</code></td></tr>
<tr id="s_fn_OneClient.DownloadFile"><td><code><a href="#fn_OneClient.DownloadFile">OneClient.DownloadFile(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/14</code></td></tr>
<tr id="s_fn_OneClient.Fork"><td><code><a href="#fn_OneClient.Fork">OneClient.Fork(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/14</code></td></tr>
<tr id="s_fn_OneClient.SendFile"><td><code><a href="#fn_OneClient.SendFile">OneClient.SendFile(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/14</code></td></tr>
<tr id="s_fn_OneClient.Broadcast"><td><code><a href="#fn_OneClient.Broadcast">OneClient.Broadcast(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/14</code></td></tr>
<tr id="s_fn_OneClient.newXClient"><td><code><a href="#fn_OneClient.newXClient">OneClient.newXClient(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/13</code></td></tr>
<tr id="s_fn_xClient.Go"><td><code><a href="#fn_xClient.Go">xClient.Go(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/13</code></td></tr>
<tr id="s_fn_MDNSDiscovery.watch"><td><code><a href="#fn_MDNSDiscovery.watch">MDNSDiscovery.watch(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/mdns_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/12</code></td></tr>
<tr id="s_fn_OpenTracingPlugin.DoPreCall"><td><code><a href="#fn_OpenTracingPlugin.DoPreCall">OpenTracingPlugin.DoPreCall(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/opentracing.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/11</code></td></tr>
<tr id="s_fn_createWeighted"><td><code><a href="#fn_createWeighted">createWeighted(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/11</code></td></tr>
<tr id="s_fn_OpenCensusPlugin.DoPreCall"><td><code><a href="#fn_OpenCensusPlugin.DoPreCall">OpenCensusPlugin.DoPreCall(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/opencensus.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/11</code></td></tr>
<tr id="s_fn_@716:6"><td><code><a href="#fn_@716:6">@716:6(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/10</code></td></tr>
<tr id="s_fn_urlencode"><td><code><a href="#fn_urlencode">urlencode(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/10</code></td></tr>
<tr id="s_fn_xClient.watch"><td><code><a href="#fn_xClient.watch">xClient.watch(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/10</code></td></tr>
<tr id="s_fn_NewMDNSDiscovery"><td><code><a href="#fn_NewMDNSDiscovery">NewMDNSDiscovery(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/mdns_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/10</code></td></tr>
<tr id="s_fn_consistentHashSelector.UpdateServer"><td><code><a href="#fn_consistentHashSelector.UpdateServer">consistentHashSelector.UpdateServer(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/9</code></td></tr>
<tr id="s_fn_@139:5"><td><code><a href="#fn_@139:5">@139:5(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/mdns_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/9</code></td></tr>
<tr id="s_fn_Client.heartbeat"><td><code><a href="#fn_Client.heartbeat">Client.heartbeat(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/8</code></td></tr>
<tr id="s_fn_Hash"><td><code><a href="#fn_Hash">Hash(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/hash_utils.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/8</code></td></tr>
<tr id="s_fn_xClient.removeClient"><td><code><a href="#fn_xClient.removeClient">xClient.removeClient(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/8</code></td></tr>
<tr id="s_fn_MDNSDiscovery.RemoveWatcher"><td><code><a href="#fn_MDNSDiscovery.RemoveWatcher">MDNSDiscovery.RemoveWatcher(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/mdns_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/8</code></td></tr>
<tr id="s_fn_getDistanceFrom"><td><code><a href="#fn_getDistanceFrom">getDistanceFrom(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/geo_utils.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/8</code></td></tr>
<tr id="s_fn_MultipleServersDiscovery.RemoveWatcher"><td><code><a href="#fn_MultipleServersDiscovery.RemoveWatcher">MultipleServersDiscovery.RemoveWatcher(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/8</code></td></tr>
<tr id="s_fn_OneClient.Close"><td><code><a href="#fn_OneClient.Close">OneClient.Close(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/8</code></td></tr>
<tr id="s_fn_OneClient.ConfigGeoSelector"><td><code><a href="#fn_OneClient.ConfigGeoSelector">OneClient.ConfigGeoSelector(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/7</code></td></tr>
<tr id="s_fn_roundRobinSelector.Select"><td><code><a href="#fn_roundRobinSelector.Select">roundRobinSelector.Select(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/7</code></td></tr>
<tr id="s_fn_pluginContainer.Remove"><td><code><a href="#fn_pluginContainer.Remove">pluginContainer.Remove(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/7</code></td></tr>
<tr id="s_fn_weightedRoundRobinSelector.Select"><td><code><a href="#fn_weightedRoundRobinSelector.Select">weightedRoundRobinSelector.Select(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/7</code></td></tr>
<tr id="s_fn_Client.handleServerRequest"><td><code><a href="#fn_Client.handleServerRequest">Client.handleServerRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_OneClient.SetSelector"><td><code><a href="#fn_OneClient.SetSelector">OneClient.SetSelector(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_OneClient.SetPlugins"><td><code><a href="#fn_OneClient.SetPlugins">OneClient.SetPlugins(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_NewXClientPool"><td><code><a href="#fn_NewXClientPool">NewXClientPool(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient_pool.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_NewOneClientPool"><td><code><a href="#fn_NewOneClientPool">NewOneClientPool(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient_pool.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_OpenCensusPlugin.DoPostCall"><td><code><a href="#fn_OpenCensusPlugin.DoPostCall">OpenCensusPlugin.DoPostCall(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/opencensus.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_consistentHashSelector.Select"><td><code><a href="#fn_consistentHashSelector.Select">consistentHashSelector.Select(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_newConsistentHashSelector"><td><code><a href="#fn_newConsistentHashSelector">newConsistentHashSelector(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_OneClient.Auth"><td><code><a href="#fn_OneClient.Auth">OneClient.Auth(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_NewBidirectionalXClientPool"><td><code><a href="#fn_NewBidirectionalXClientPool">NewBidirectionalXClientPool(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient_pool.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_NewBidirectionalOneClientPool"><td><code><a href="#fn_NewBidirectionalOneClientPool">NewBidirectionalOneClientPool(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient_pool.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_@647:6"><td><code><a href="#fn_@647:6">@647:6(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_OpenTracingPlugin.DoPostCall"><td><code><a href="#fn_OpenTracingPlugin.DoPostCall">OpenTracingPlugin.DoPostCall(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/opentracing.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_@128:8"><td><code><a href="#fn_@128:8">@128:8(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_FailMode.IsAFailMode"><td><code><a href="#fn_FailMode.IsAFailMode">FailMode.IsAFailMode(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/failmode_enumer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_SelectMode.IsASelectMode"><td><code><a href="#fn_SelectMode.IsASelectMode">SelectMode.IsASelectMode(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selectmode_enumer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_genKey"><td><code><a href="#fn_genKey">genKey(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/hash_utils.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_randomSelector.UpdateServer"><td><code><a href="#fn_randomSelector.UpdateServer">randomSelector.UpdateServer(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_roundRobinSelector.UpdateServer"><td><code><a href="#fn_roundRobinSelector.UpdateServer">roundRobinSelector.UpdateServer(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_xClient.SetSelector"><td><code><a href="#fn_xClient.SetSelector">xClient.SetSelector(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_@81:8"><td><code><a href="#fn_@81:8">@81:8(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_inprocessClient.Unregister"><td><code><a href="#fn_inprocessClient.Unregister">inprocessClient.Unregister(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_inprocessClient.Register"><td><code><a href="#fn_inprocessClient.Register">inprocessClient.Register(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_newRoundRobinSelector"><td><code><a href="#fn_newRoundRobinSelector">newRoundRobinSelector(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_@109:9"><td><code><a href="#fn_@109:9">@109:9(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/mdns_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_OneClientPool.Close"><td><code><a href="#fn_OneClientPool.Close">OneClientPool.Close(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient_pool.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_OneClientPool.Get"><td><code><a href="#fn_OneClientPool.Get">OneClientPool.Get(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient_pool.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_XClientPool.Get"><td><code><a href="#fn_XClientPool.Get">XClientPool.Get(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient_pool.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_@689:8"><td><code><a href="#fn_@689:8">@689:8(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_FailMode.String"><td><code><a href="#fn_FailMode.String">FailMode.String(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/failmode_enumer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_FailModeString"><td><code><a href="#fn_FailModeString">FailModeString(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/failmode_enumer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_HashString"><td><code><a href="#fn_HashString">HashString(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/hash_utils.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_SelectModeString"><td><code><a href="#fn_SelectModeString">SelectModeString(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selectmode_enumer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_SelectMode.String"><td><code><a href="#fn_SelectMode.String">SelectMode.String(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selectmode_enumer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_XClientPool.Close"><td><code><a href="#fn_XClientPool.Close">XClientPool.Close(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient_pool.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_newGeoSelector"><td><code><a href="#fn_newGeoSelector">newGeoSelector(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_NewMDNSDiscoveryTemplate"><td><code><a href="#fn_NewMDNSDiscoveryTemplate">NewMDNSDiscoveryTemplate(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/mdns_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_MDNSDiscovery.WatchService"><td><code><a href="#fn_MDNSDiscovery.WatchService">MDNSDiscovery.WatchService(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/mdns_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_MultipleServersDiscovery.WatchService"><td><code><a href="#fn_MultipleServersDiscovery.WatchService">MultipleServersDiscovery.WatchService(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_@62:6"><td><code><a href="#fn_@62:6">@62:6(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_MultipleServersDiscovery.Update"><td><code><a href="#fn_MultipleServersDiscovery.Update">MultipleServersDiscovery.Update(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_newWeightedRoundRobinSelector"><td><code><a href="#fn_newWeightedRoundRobinSelector">newWeightedRoundRobinSelector(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/2</code></td></tr>
<tr id="s_fn_weightedRoundRobinSelector.UpdateServer"><td><code><a href="#fn_weightedRoundRobinSelector.UpdateServer">weightedRoundRobinSelector.UpdateServer(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/2</code></td></tr>
<tr id="s_fn_xClient.ConfigGeoSelector"><td><code><a href="#fn_xClient.ConfigGeoSelector">xClient.ConfigGeoSelector(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/2</code></td></tr>
<tr id="s_fn_geoSelector.UpdateServer"><td><code><a href="#fn_geoSelector.UpdateServer">geoSelector.UpdateServer(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/2</code></td></tr>
<tr id="s_fn_pluginContainer.Add"><td><code><a href="#fn_pluginContainer.Add">pluginContainer.Add(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_MultipleServersDiscovery.Clone"><td><code><a href="#fn_MultipleServersDiscovery.Clone">MultipleServersDiscovery.Clone(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_NewMultipleServersDiscovery"><td><code><a href="#fn_NewMultipleServersDiscovery">NewMultipleServersDiscovery(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_MDNSDiscovery.Close"><td><code><a href="#fn_MDNSDiscovery.Close">MDNSDiscovery.Close(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/mdns_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_@110:13"><td><code><a href="#fn_@110:13">@110:13(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/mdns_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_MultipleServersDiscovery.GetServices"><td><code><a href="#fn_MultipleServersDiscovery.GetServices">MultipleServersDiscovery.GetServices(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_SelectModeValues"><td><code><a href="#fn_SelectModeValues">SelectModeValues(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selectmode_enumer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_Peer2PeerDiscovery.Clone"><td><code><a href="#fn_Peer2PeerDiscovery.Clone">Peer2PeerDiscovery.Clone(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/peer2peer_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_@63:10"><td><code><a href="#fn_@63:10">@63:10(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_MDNSDiscovery.Clone"><td><code><a href="#fn_MDNSDiscovery.Clone">MDNSDiscovery.Clone(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/mdns_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_ConsecCircuitBreaker.Ready"><td><code><a href="#fn_ConsecCircuitBreaker.Ready">ConsecCircuitBreaker.Ready(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/circuit_breaker.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_NewOneClient"><td><code><a href="#fn_NewOneClient">NewOneClient(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_pluginContainer.All"><td><code><a href="#fn_pluginContainer.All">pluginContainer.All(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_ServiceError.Error"><td><code><a href="#fn_ServiceError.Error">ServiceError.Error(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_NewBidirectionalOneClient"><td><code><a href="#fn_NewBidirectionalOneClient">NewBidirectionalOneClient(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/oneclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_Client.IsClosing"><td><code><a href="#fn_Client.IsClosing">Client.IsClosing(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_InprocessDiscovery.WatchService"><td><code><a href="#fn_InprocessDiscovery.WatchService">InprocessDiscovery.WatchService(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_@248:17"><td><code><a href="#fn_@248:17">@248:17(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_InprocessDiscovery.GetServices"><td><code><a href="#fn_InprocessDiscovery.GetServices">InprocessDiscovery.GetServices(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_InprocessDiscovery.Clone"><td><code><a href="#fn_InprocessDiscovery.Clone">InprocessDiscovery.Clone(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_@269:17"><td><code><a href="#fn_@269:17">@269:17(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/selector.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_NewInprocessDiscovery"><td><code><a href="#fn_NewInprocessDiscovery">NewInprocessDiscovery(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_inprocessClient.IsShutdown"><td><code><a href="#fn_inprocessClient.IsShutdown">inprocessClient.IsShutdown(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_inprocessClient.IsClosing"><td><code><a href="#fn_inprocessClient.IsClosing">inprocessClient.IsClosing(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_NewClient"><td><code><a href="#fn_NewClient">NewClient(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_xClient.SetPlugins"><td><code><a href="#fn_xClient.SetPlugins">xClient.SetPlugins(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_NewPluginContainer"><td><code><a href="#fn_NewPluginContainer">NewPluginContainer(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_xClient.Auth"><td><code><a href="#fn_xClient.Auth">xClient.Auth(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/xclient.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_inprocessClient.SendRaw"><td><code><a href="#fn_inprocessClient.SendRaw">inprocessClient.SendRaw(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_inprocessClient.UnregisterServerMessageChan"><td><code><a href="#fn_inprocessClient.UnregisterServerMessageChan">inprocessClient.UnregisterServerMessageChan(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_inprocessClient.RegisterServerMessageChan"><td><code><a href="#fn_inprocessClient.RegisterServerMessageChan">inprocessClient.RegisterServerMessageChan(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_inprocessClient.Connect"><td><code><a href="#fn_inprocessClient.Connect">inprocessClient.Connect(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_toString"><td><code><a href="#fn_toString">toString(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/hash_utils.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_JumpConsistentHash"><td><code><a href="#fn_JumpConsistentHash">JumpConsistentHash(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/hash_utils.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_ConsecCircuitBreaker.Fail"><td><code><a href="#fn_ConsecCircuitBreaker.Fail">ConsecCircuitBreaker.Fail(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/circuit_breaker.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_hsin"><td><code><a href="#fn_hsin">hsin(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/geo_utils.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_FailModeValues"><td><code><a href="#fn_FailModeValues">FailModeValues(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/failmode_enumer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_weightedICMPSelector.Select"><td><code><a href="#fn_weightedICMPSelector.Select">weightedICMPSelector.Select(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/ping_excluded.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_newWeightedICMPSelector"><td><code><a href="#fn_newWeightedICMPSelector">newWeightedICMPSelector(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/ping_excluded.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_newDirectQuicConn"><td><code><a href="#fn_newDirectQuicConn">newDirectQuicConn(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/connection_nonquic.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_newDirectKCPConn"><td><code><a href="#fn_newDirectKCPConn">newDirectKCPConn(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/connection_nonkcp.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_ConsecCircuitBreaker.Success"><td><code><a href="#fn_ConsecCircuitBreaker.Success">ConsecCircuitBreaker.Success(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/circuit_breaker.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_Client.IsShutdown"><td><code><a href="#fn_Client.IsShutdown">Client.IsShutdown(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_inprocessClient.Close"><td><code><a href="#fn_inprocessClient.Close">inprocessClient.Close(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_Client.UnregisterServerMessageChan"><td><code><a href="#fn_Client.UnregisterServerMessageChan">Client.UnregisterServerMessageChan(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/client.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_MDNSDiscovery.GetServices"><td><code><a href="#fn_MDNSDiscovery.GetServices">MDNSDiscovery.GetServices(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/mdns_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_InprocessDiscovery.Close"><td><code><a href="#fn_InprocessDiscovery.Close">InprocessDiscovery.Close(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/0</code></td></tr>
<tr id="s_fn_MultipleServersDiscovery.Close"><td><code><a href="#fn_MultipleServersDiscovery.Close">MultipleServersDiscovery.Close(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/0</code></td></tr>
<tr id="s_fn_weightedICMPSelector.UpdateServer"><td><code><a href="#fn_weightedICMPSelector.UpdateServer">weightedICMPSelector.UpdateServer(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/ping_excluded.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/0</code></td></tr>
<tr id="s_fn_Peer2PeerDiscovery.Close"><td><code><a href="#fn_Peer2PeerDiscovery.Close">Peer2PeerDiscovery.Close(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/peer2peer_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/0</code></td></tr>
<tr id="s_fn_Peer2PeerDiscovery.RemoveWatcher"><td><code><a href="#fn_Peer2PeerDiscovery.RemoveWatcher">Peer2PeerDiscovery.RemoveWatcher(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/peer2peer_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/0</code></td></tr>
<tr id="s_fn_InprocessDiscovery.RemoveWatcher"><td><code><a href="#fn_InprocessDiscovery.RemoveWatcher">InprocessDiscovery.RemoveWatcher(...)</a></code></td><td><code>github.com/smallnest/rpcx/client/inprocess_discovery.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/0</code></td></tr>
<tr><td colspan="2"><code>github.com/smallnest/rpcx/client</code></td><td class="percent"><code>19.50%</code></td><td class="linecount"><code>294/1508</code></td></tr>
</table>

<div class="funcname" id="fn_filterByStateAndGroup">func filterByStateAndGroup</div><div class="info"><a href="#s_fn_filterByStateAndGroup">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>206</td><td><code><pre>func filterByStateAndGroup(group string, servers map[string]string) {</pre></code></td></tr><tr><td>207</td><td><code><pre>        for k, v := range servers {</pre></code></td></tr><tr><td>208</td><td><code><pre>                if values, err := url.ParseQuery(v); err == nil {</pre></code></td></tr><tr><td>209</td><td><code><pre>                        if state := values.Get(&#34;state&#34;); state == &#34;inactive&#34; {</pre></code></td></tr><tr><td>210</td><td><code><pre>                                delete(servers, k)</pre></code></td></tr><tr><td>211</td><td><code><pre>                        }</pre></code></td></tr><tr><td>212</td><td><code><pre>                        if group != &#34;&#34; &amp;&amp; group != values.Get(&#34;group&#34;) {</pre></code></td></tr><tr><td>213</td><td><code><pre>                                delete(servers, k)</pre></code></td></tr><tr><td>214</td><td><code><pre>                        }</pre></code></td></tr><tr><td>215</td><td><code><pre>                }</pre></code></td></tr><tr><td>216</td><td><code><pre>        }</pre></code></td></tr><tr><td>217</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_ConsecCircuitBreaker.ready">func ConsecCircuitBreaker.ready</div><div class="info"><a href="#s_fn_ConsecCircuitBreaker.ready">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/circuit_breaker.go</code>:</p></div><table class="listing">
<tr><td>66</td><td><code><pre>func (cb *ConsecCircuitBreaker) ready() bool {</pre></code></td></tr><tr><td>67</td><td><code><pre>        if time.Since(cb.lastFailureTime) &gt; cb.window {</pre></code></td></tr><tr><td>68</td><td><code><pre>                cb.reset()</pre></code></td></tr><tr><td>69</td><td><code><pre>                return true</pre></code></td></tr><tr><td>70</td><td><code><pre>        }</pre></code></td></tr><tr><td>71</td><td><code><pre></pre></code></td></tr><tr><td>72</td><td><code><pre>        failures := atomic.LoadUint64(&amp;cb.failures)</pre></code></td></tr><tr><td>73</td><td><code><pre>        return failures &lt; cb.failureThreshold</pre></code></td></tr><tr><td>74</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newRandomSelector">func newRandomSelector</div><div class="info"><a href="#s_fn_newRandomSelector">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>47</td><td><code><pre>func newRandomSelector(servers map[string]string) Selector {</pre></code></td></tr><tr><td>48</td><td><code><pre>        var ss = make([]string, 0, len(servers))</pre></code></td></tr><tr><td>49</td><td><code><pre>        for k := range servers {</pre></code></td></tr><tr><td>50</td><td><code><pre>                ss = append(ss, k)</pre></code></td></tr><tr><td>51</td><td><code><pre>        }</pre></code></td></tr><tr><td>52</td><td><code><pre></pre></code></td></tr><tr><td>53</td><td><code><pre>        return &amp;randomSelector{servers: ss}</pre></code></td></tr><tr><td>54</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@906:5">func @906:5</div><div class="info"><a href="#s_fn_@906:5">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>906</td><td><code><pre>func() {</pre></code></td></tr><tr><td>907</td><td><code><pre>                defer func() {</pre></code></td></tr><tr><td>908</td><td><code><pre>                        if r := recover(); r != nil {</pre></code></td></tr><tr><td>909</td><td><code><pre></pre></code></td></tr><tr><td>910</td><td><code><pre>                        }</pre></code></td></tr><tr><td>911</td><td><code><pre>                }()</pre></code></td></tr><tr><td>912</td><td><code><pre></pre></code></td></tr><tr><td>913</td><td><code><pre>                c.discovery.RemoveWatcher(c.ch)</pre></code></td></tr><tr><td>914</td><td><code><pre>                close(c.ch)</pre></code></td></tr><tr><td>915</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_@42:6">func @42:6</div><div class="info"><a href="#s_fn_@42:6">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/circuit_breaker.go</code>:</p></div><table class="listing">
<tr><td>42</td><td><code><pre>func() {</pre></code></td></tr><tr><td>43</td><td><code><pre>                        c &lt;- fn()</pre></code></td></tr><tr><td>44</td><td><code><pre>                        close(c)</pre></code></td></tr><tr><td>45</td><td><code><pre>                }</pre></code></td></tr></table>

<div class="funcname" id="fn_ConsecCircuitBreaker.fail">func ConsecCircuitBreaker.fail</div><div class="info"><a href="#s_fn_ConsecCircuitBreaker.fail">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/circuit_breaker.go</code>:</p></div><table class="listing">
<tr><td>79</td><td><code><pre>func (cb *ConsecCircuitBreaker) fail() {</pre></code></td></tr><tr><td>80</td><td><code><pre>        atomic.AddUint64(&amp;cb.failures, 1)</pre></code></td></tr><tr><td>81</td><td><code><pre>        cb.lastFailureTime = time.Now()</pre></code></td></tr><tr><td>82</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_ConsecCircuitBreaker.reset">func ConsecCircuitBreaker.reset</div><div class="info"><a href="#s_fn_ConsecCircuitBreaker.reset">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/circuit_breaker.go</code>:</p></div><table class="listing">
<tr><td>95</td><td><code><pre>func (cb *ConsecCircuitBreaker) reset() {</pre></code></td></tr><tr><td>96</td><td><code><pre>        atomic.StoreUint64(&amp;cb.failures, 0)</pre></code></td></tr><tr><td>97</td><td><code><pre>        cb.lastFailureTime = time.Now()</pre></code></td></tr><tr><td>98</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.Call">func Client.Call</div><div class="info"><a href="#s_fn_Client.Call">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>294</td><td><code><pre>func (client *Client) Call(ctx context.Context, servicePath, serviceMethod string, args interface{}, reply interface{}) error {</pre></code></td></tr><tr><td>295</td><td><code><pre>        return client.call(ctx, servicePath, serviceMethod, args, reply)</pre></code></td></tr><tr><td>296</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@907:9">func @907:9</div><div class="info"><a href="#s_fn_@907:9">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>907</td><td><code><pre>func() {</pre></code></td></tr><tr><td>908</td><td><code><pre>                        if r := recover(); r != nil {</pre></code></td></tr><tr><td>909</td><td><code><pre></pre></code></td></tr><tr><td>910</td><td><code><pre>                        }</pre></code></td></tr><tr><td>911</td><td><code><pre>                }</pre></code></td></tr></table>

<div class="funcname" id="fn_Peer2PeerDiscovery.WatchService">func Peer2PeerDiscovery.WatchService</div><div class="info"><a href="#s_fn_Peer2PeerDiscovery.WatchService">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/peer2peer_discovery.go</code>:</p></div><table class="listing">
<tr><td>26</td><td><code><pre>func (d Peer2PeerDiscovery) WatchService() chan []*KVPair {</pre></code></td></tr><tr><td>27</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>28</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Peer2PeerDiscovery.GetServices">func Peer2PeerDiscovery.GetServices</div><div class="info"><a href="#s_fn_Peer2PeerDiscovery.GetServices">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/peer2peer_discovery.go</code>:</p></div><table class="listing">
<tr><td>21</td><td><code><pre>func (d Peer2PeerDiscovery) GetServices() []*KVPair {</pre></code></td></tr><tr><td>22</td><td><code><pre>        return []*KVPair{&amp;KVPair{Key: d.server, Value: d.metadata}}</pre></code></td></tr><tr><td>23</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewConsecCircuitBreaker">func NewConsecCircuitBreaker</div><div class="info"><a href="#s_fn_NewConsecCircuitBreaker">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/circuit_breaker.go</code>:</p></div><table class="listing">
<tr><td>23</td><td><code><pre>func NewConsecCircuitBreaker(failureThreshold uint64, window time.Duration) *ConsecCircuitBreaker {</pre></code></td></tr><tr><td>24</td><td><code><pre>        return &amp;ConsecCircuitBreaker{</pre></code></td></tr><tr><td>25</td><td><code><pre>                failureThreshold: failureThreshold,</pre></code></td></tr><tr><td>26</td><td><code><pre>                window:           window,</pre></code></td></tr><tr><td>27</td><td><code><pre>        }</pre></code></td></tr><tr><td>28</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_ConsecCircuitBreaker.success">func ConsecCircuitBreaker.success</div><div class="info"><a href="#s_fn_ConsecCircuitBreaker.success">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/circuit_breaker.go</code>:</p></div><table class="listing">
<tr><td>76</td><td><code><pre>func (cb *ConsecCircuitBreaker) success() {</pre></code></td></tr><tr><td>77</td><td><code><pre>        cb.reset()</pre></code></td></tr><tr><td>78</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.RegisterServerMessageChan">func Client.RegisterServerMessageChan</div><div class="info"><a href="#s_fn_Client.RegisterServerMessageChan">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>182</td><td><code><pre>func (client *Client) RegisterServerMessageChan(ch chan&lt;- *protocol.Message) {</pre></code></td></tr><tr><td>183</td><td><code><pre>        client.ServerMessageChan = ch</pre></code></td></tr><tr><td>184</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewPeer2PeerDiscovery">func NewPeer2PeerDiscovery</div><div class="info"><a href="#s_fn_NewPeer2PeerDiscovery">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/peer2peer_discovery.go</code>:</p></div><table class="listing">
<tr><td>11</td><td><code><pre>func NewPeer2PeerDiscovery(server, metadata string) ServiceDiscovery {</pre></code></td></tr><tr><td>12</td><td><code><pre>        return &amp;Peer2PeerDiscovery{server: server, metadata: metadata}</pre></code></td></tr><tr><td>13</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_ConsecCircuitBreaker.Call">func ConsecCircuitBreaker.Call</div><div class="info"><a href="#s_fn_ConsecCircuitBreaker.Call">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/circuit_breaker.go</code>:</p></div><table class="listing">
<tr><td>31</td><td><code><pre>func (cb *ConsecCircuitBreaker) Call(fn func() error, d time.Duration) error {</pre></code></td></tr><tr><td>32</td><td><code><pre>        var err error</pre></code></td></tr><tr><td>33</td><td><code><pre></pre></code></td></tr><tr><td>34</td><td><code><pre>        if !cb.ready() {</pre></code></td></tr><tr><td>35</td><td><code><pre>                return ErrBreakerOpen</pre></code></td></tr><tr><td>36</td><td><code><pre>        }</pre></code></td></tr><tr><td>37</td><td><code><pre></pre></code></td></tr><tr><td>38</td><td><code><pre>        if d == 0 {</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>                err = fn()</pre></code></td></tr><tr><td>40</td><td><code><pre>        } else {</pre></code></td></tr><tr><td>41</td><td><code><pre>                c := make(chan error, 1)</pre></code></td></tr><tr><td>42</td><td><code><pre>                go func() {</pre></code></td></tr><tr><td>43</td><td><code><pre>                        c &lt;- fn()</pre></code></td></tr><tr><td>44</td><td><code><pre>                        close(c)</pre></code></td></tr><tr><td>45</td><td><code><pre>                }()</pre></code></td></tr><tr><td>46</td><td><code><pre></pre></code></td></tr><tr><td>47</td><td><code><pre>                t := time.NewTimer(d)</pre></code></td></tr><tr><td>48</td><td><code><pre>                select {</pre></code></td></tr><tr><td>49</td><td><code><pre>                case e := &lt;-c:</pre></code></td></tr><tr><td>50</td><td><code><pre>                        err = e</pre></code></td></tr><tr><td>51</td><td><code><pre>                case &lt;-t.C:</pre></code></td></tr><tr class="miss"><td>52</td><td><code><pre>                        err = ErrBreakerTimeout</pre></code></td></tr><tr><td>53</td><td><code><pre>                }</pre></code></td></tr><tr><td>54</td><td><code><pre>                t.Stop()</pre></code></td></tr><tr><td>55</td><td><code><pre>        }</pre></code></td></tr><tr><td>56</td><td><code><pre></pre></code></td></tr><tr><td>57</td><td><code><pre>        if err == nil {</pre></code></td></tr><tr><td>58</td><td><code><pre>                cb.success()</pre></code></td></tr><tr><td>59</td><td><code><pre>        } else {</pre></code></td></tr><tr><td>60</td><td><code><pre>                cb.fail()</pre></code></td></tr><tr><td>61</td><td><code><pre>        }</pre></code></td></tr><tr><td>62</td><td><code><pre></pre></code></td></tr><tr><td>63</td><td><code><pre>        return err</pre></code></td></tr><tr><td>64</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewXClient">func NewXClient</div><div class="info"><a href="#s_fn_NewXClient">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>95</td><td><code><pre>func NewXClient(servicePath string, failMode FailMode, selectMode SelectMode, discovery ServiceDiscovery, option Option) XClient {</pre></code></td></tr><tr><td>96</td><td><code><pre>        client := &amp;xClient{</pre></code></td></tr><tr><td>97</td><td><code><pre>                failMode:     failMode,</pre></code></td></tr><tr><td>98</td><td><code><pre>                selectMode:   selectMode,</pre></code></td></tr><tr><td>99</td><td><code><pre>                discovery:    discovery,</pre></code></td></tr><tr><td>100</td><td><code><pre>                servicePath:  servicePath,</pre></code></td></tr><tr><td>101</td><td><code><pre>                cachedClient: make(map[string]RPCClient),</pre></code></td></tr><tr><td>102</td><td><code><pre>                option:       option,</pre></code></td></tr><tr><td>103</td><td><code><pre>        }</pre></code></td></tr><tr><td>104</td><td><code><pre></pre></code></td></tr><tr><td>105</td><td><code><pre>        servers := make(map[string]string)</pre></code></td></tr><tr><td>106</td><td><code><pre>        pairs := discovery.GetServices()</pre></code></td></tr><tr><td>107</td><td><code><pre>        for _, p := range pairs {</pre></code></td></tr><tr><td>108</td><td><code><pre>                servers[p.Key] = p.Value</pre></code></td></tr><tr><td>109</td><td><code><pre>        }</pre></code></td></tr><tr><td>110</td><td><code><pre>        filterByStateAndGroup(client.option.Group, servers)</pre></code></td></tr><tr><td>111</td><td><code><pre></pre></code></td></tr><tr><td>112</td><td><code><pre>        client.servers = servers</pre></code></td></tr><tr><td>113</td><td><code><pre>        if selectMode != Closest &amp;&amp; selectMode != SelectByUser {</pre></code></td></tr><tr><td>114</td><td><code><pre>                client.selector = newSelector(selectMode, servers)</pre></code></td></tr><tr><td>115</td><td><code><pre>        }</pre></code></td></tr><tr><td>116</td><td><code><pre></pre></code></td></tr><tr><td>117</td><td><code><pre>        client.Plugins = &amp;pluginContainer{}</pre></code></td></tr><tr><td>118</td><td><code><pre></pre></code></td></tr><tr><td>119</td><td><code><pre>        ch := client.discovery.WatchService()</pre></code></td></tr><tr><td>120</td><td><code><pre>        if ch != nil {</pre></code></td></tr><tr class="miss"><td>121</td><td><code><pre>                client.ch = ch</pre></code></td></tr><tr class="miss"><td>122</td><td><code><pre>                go client.watch(ch)</pre></code></td></tr><tr><td>123</td><td><code><pre>        }</pre></code></td></tr><tr><td>124</td><td><code><pre></pre></code></td></tr><tr><td>125</td><td><code><pre>        return client</pre></code></td></tr><tr><td>126</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.selectClient">func xClient.selectClient</div><div class="info"><a href="#s_fn_xClient.selectClient">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>220</td><td><code><pre>func (c *xClient) selectClient(ctx context.Context, servicePath, serviceMethod string, args interface{}) (string, RPCClient, error) {</pre></code></td></tr><tr><td>221</td><td><code><pre>        c.mu.Lock()</pre></code></td></tr><tr><td>222</td><td><code><pre>        k := c.selector.Select(ctx, servicePath, serviceMethod, args)</pre></code></td></tr><tr><td>223</td><td><code><pre>        c.mu.Unlock()</pre></code></td></tr><tr><td>224</td><td><code><pre>        if k == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>225</td><td><code><pre>                return &#34;&#34;, nil, ErrXClientNoServer</pre></code></td></tr><tr><td>226</td><td><code><pre>        }</pre></code></td></tr><tr><td>227</td><td><code><pre>        client, err := c.getCachedClient(k)</pre></code></td></tr><tr><td>228</td><td><code><pre>        return k, client, err</pre></code></td></tr><tr><td>229</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.wrapCall">func xClient.wrapCall</div><div class="info"><a href="#s_fn_xClient.wrapCall">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>595</td><td><code><pre>func (c *xClient) wrapCall(ctx context.Context, client RPCClient, serviceMethod string, args interface{}, reply interface{}) error {</pre></code></td></tr><tr><td>596</td><td><code><pre>        if client == nil {</pre></code></td></tr><tr class="miss"><td>597</td><td><code><pre>                return ErrServerUnavailable</pre></code></td></tr><tr><td>598</td><td><code><pre>        }</pre></code></td></tr><tr><td>599</td><td><code><pre></pre></code></td></tr><tr><td>600</td><td><code><pre>        ctx = share.NewContext(ctx)</pre></code></td></tr><tr><td>601</td><td><code><pre>        c.Plugins.DoPreCall(ctx, c.servicePath, serviceMethod, args)</pre></code></td></tr><tr><td>602</td><td><code><pre>        err := client.Call(ctx, c.servicePath, serviceMethod, args, reply)</pre></code></td></tr><tr><td>603</td><td><code><pre>        c.Plugins.DoPostCall(ctx, c.servicePath, serviceMethod, args, reply, err)</pre></code></td></tr><tr><td>604</td><td><code><pre></pre></code></td></tr><tr><td>605</td><td><code><pre>        return err</pre></code></td></tr><tr><td>606</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.Close">func xClient.Close</div><div class="info"><a href="#s_fn_xClient.Close">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>890</td><td><code><pre>func (c *xClient) Close() error {</pre></code></td></tr><tr><td>891</td><td><code><pre>        c.isShutdown = true</pre></code></td></tr><tr><td>892</td><td><code><pre></pre></code></td></tr><tr><td>893</td><td><code><pre>        var errs []error</pre></code></td></tr><tr><td>894</td><td><code><pre>        c.mu.Lock()</pre></code></td></tr><tr><td>895</td><td><code><pre>        for k, v := range c.cachedClient {</pre></code></td></tr><tr><td>896</td><td><code><pre>                e := v.Close()</pre></code></td></tr><tr><td>897</td><td><code><pre>                if e != nil {</pre></code></td></tr><tr class="miss"><td>898</td><td><code><pre>                        errs = append(errs, e)</pre></code></td></tr><tr><td>899</td><td><code><pre>                }</pre></code></td></tr><tr><td>900</td><td><code><pre></pre></code></td></tr><tr><td>901</td><td><code><pre>                delete(c.cachedClient, k)</pre></code></td></tr><tr><td>902</td><td><code><pre></pre></code></td></tr><tr><td>903</td><td><code><pre>        }</pre></code></td></tr><tr><td>904</td><td><code><pre>        c.mu.Unlock()</pre></code></td></tr><tr><td>905</td><td><code><pre></pre></code></td></tr><tr><td>906</td><td><code><pre>        go func() {</pre></code></td></tr><tr><td>907</td><td><code><pre>                defer func() {</pre></code></td></tr><tr><td>908</td><td><code><pre>                        if r := recover(); r != nil {</pre></code></td></tr><tr><td>909</td><td><code><pre></pre></code></td></tr><tr><td>910</td><td><code><pre>                        }</pre></code></td></tr><tr><td>911</td><td><code><pre>                }()</pre></code></td></tr><tr><td>912</td><td><code><pre></pre></code></td></tr><tr><td>913</td><td><code><pre>                c.discovery.RemoveWatcher(c.ch)</pre></code></td></tr><tr><td>914</td><td><code><pre>                close(c.ch)</pre></code></td></tr><tr><td>915</td><td><code><pre>        }()</pre></code></td></tr><tr><td>916</td><td><code><pre></pre></code></td></tr><tr><td>917</td><td><code><pre>        if len(errs) &gt; 0 {</pre></code></td></tr><tr class="miss"><td>918</td><td><code><pre>                return ex.NewMultiError(errs)</pre></code></td></tr><tr><td>919</td><td><code><pre>        }</pre></code></td></tr><tr><td>920</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>921</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.Go">func Client.Go</div><div class="info"><a href="#s_fn_Client.Go">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>205</td><td><code><pre>func (client *Client) Go(ctx context.Context, servicePath, serviceMethod string, args interface{}, reply interface{}, done chan *Call) *Call {</pre></code></td></tr><tr><td>206</td><td><code><pre>        call := new(Call)</pre></code></td></tr><tr><td>207</td><td><code><pre>        call.ServicePath = servicePath</pre></code></td></tr><tr><td>208</td><td><code><pre>        call.ServiceMethod = serviceMethod</pre></code></td></tr><tr><td>209</td><td><code><pre>        meta := ctx.Value(share.ReqMetaDataKey)</pre></code></td></tr><tr><td>210</td><td><code><pre>        if meta != nil { //copy meta in context to meta in requests</pre></code></td></tr><tr class="miss"><td>211</td><td><code><pre>                call.Metadata = meta.(map[string]string)</pre></code></td></tr><tr><td>212</td><td><code><pre>        }</pre></code></td></tr><tr><td>213</td><td><code><pre></pre></code></td></tr><tr><td>214</td><td><code><pre>        if _, ok := ctx.(*share.Context); !ok {</pre></code></td></tr><tr><td>215</td><td><code><pre>                ctx = share.NewContext(ctx)</pre></code></td></tr><tr><td>216</td><td><code><pre>        }</pre></code></td></tr><tr><td>217</td><td><code><pre></pre></code></td></tr><tr><td>218</td><td><code><pre>        // TODO: should implement as plugin</pre></code></td></tr><tr><td>219</td><td><code><pre>        client.injectOpenTracingSpan(ctx, call)</pre></code></td></tr><tr><td>220</td><td><code><pre>        client.injectOpenCensusSpan(ctx, call)</pre></code></td></tr><tr><td>221</td><td><code><pre></pre></code></td></tr><tr><td>222</td><td><code><pre>        call.Args = args</pre></code></td></tr><tr><td>223</td><td><code><pre>        call.Reply = reply</pre></code></td></tr><tr><td>224</td><td><code><pre>        if done == nil {</pre></code></td></tr><tr class="miss"><td>225</td><td><code><pre>                done = make(chan *Call, 10) // buffered.</pre></code></td></tr><tr><td>226</td><td><code><pre>        } else {</pre></code></td></tr><tr><td>227</td><td><code><pre>                // If caller passes done != nil, it must arrange that</pre></code></td></tr><tr><td>228</td><td><code><pre>                // done has enough buffer for the number of simultaneous</pre></code></td></tr><tr><td>229</td><td><code><pre>                // RPCs that will be using that channel. If the channel</pre></code></td></tr><tr><td>230</td><td><code><pre>                // is totally unbuffered, it&#39;s best not to run at all.</pre></code></td></tr><tr><td>231</td><td><code><pre>                if cap(done) == 0 {</pre></code></td></tr><tr class="miss"><td>232</td><td><code><pre>                        log.Panic(&#34;rpc: done channel is unbuffered&#34;)</pre></code></td></tr><tr><td>233</td><td><code><pre>                }</pre></code></td></tr><tr><td>234</td><td><code><pre>        }</pre></code></td></tr><tr><td>235</td><td><code><pre>        call.Done = done</pre></code></td></tr><tr><td>236</td><td><code><pre>        client.send(ctx, call)</pre></code></td></tr><tr><td>237</td><td><code><pre>        return call</pre></code></td></tr><tr><td>238</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_randomSelector.Select">func randomSelector.Select</div><div class="info"><a href="#s_fn_randomSelector.Select">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>56</td><td><code><pre>func (s randomSelector) Select(ctx context.Context, servicePath, serviceMethod string, args interface{}) string {</pre></code></td></tr><tr><td>57</td><td><code><pre>        ss := s.servers</pre></code></td></tr><tr><td>58</td><td><code><pre>        if len(ss) == 0 {</pre></code></td></tr><tr class="miss"><td>59</td><td><code><pre>                return &#34;&#34;</pre></code></td></tr><tr><td>60</td><td><code><pre>        }</pre></code></td></tr><tr><td>61</td><td><code><pre>        i := fastrand.Uint32n(uint32(len(ss)))</pre></code></td></tr><tr><td>62</td><td><code><pre>        return ss[i]</pre></code></td></tr><tr><td>63</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_splitNetworkAndAddress">func splitNetworkAndAddress</div><div class="info"><a href="#s_fn_splitNetworkAndAddress">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>335</td><td><code><pre>func splitNetworkAndAddress(server string) (string, string) {</pre></code></td></tr><tr><td>336</td><td><code><pre>        ss := strings.SplitN(server, &#34;@&#34;, 2)</pre></code></td></tr><tr><td>337</td><td><code><pre>        if len(ss) == 1 {</pre></code></td></tr><tr class="miss"><td>338</td><td><code><pre>                return &#34;tcp&#34;, server</pre></code></td></tr><tr><td>339</td><td><code><pre>        }</pre></code></td></tr><tr><td>340</td><td><code><pre></pre></code></td></tr><tr><td>341</td><td><code><pre>        return ss[0], ss[1]</pre></code></td></tr><tr><td>342</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.getCachedClient">func xClient.getCachedClient</div><div class="info"><a href="#s_fn_xClient.getCachedClient">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>231</td><td><code><pre>func (c *xClient) getCachedClient(k string) (RPCClient, error) {</pre></code></td></tr><tr><td>232</td><td><code><pre>        // TODO: improve the lock</pre></code></td></tr><tr><td>233</td><td><code><pre>        c.mu.Lock()</pre></code></td></tr><tr><td>234</td><td><code><pre>        defer c.mu.Unlock()</pre></code></td></tr><tr><td>235</td><td><code><pre></pre></code></td></tr><tr><td>236</td><td><code><pre>        breaker, ok := c.breakers.Load(k)</pre></code></td></tr><tr><td>237</td><td><code><pre>        if ok &amp;&amp; !breaker.(Breaker).Ready() {</pre></code></td></tr><tr class="miss"><td>238</td><td><code><pre>                return nil, ErrBreakerOpen</pre></code></td></tr><tr><td>239</td><td><code><pre>        }</pre></code></td></tr><tr><td>240</td><td><code><pre></pre></code></td></tr><tr><td>241</td><td><code><pre>        client := c.cachedClient[k]</pre></code></td></tr><tr><td>242</td><td><code><pre>        if client != nil {</pre></code></td></tr><tr class="miss"><td>243</td><td><code><pre>                if !client.IsClosing() &amp;&amp; !client.IsShutdown() {</pre></code></td></tr><tr class="miss"><td>244</td><td><code><pre>                        return client, nil</pre></code></td></tr><tr><td>245</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>246</td><td><code><pre>                delete(c.cachedClient, k)</pre></code></td></tr><tr class="miss"><td>247</td><td><code><pre>                client.Close()</pre></code></td></tr><tr><td>248</td><td><code><pre>        }</pre></code></td></tr><tr><td>249</td><td><code><pre></pre></code></td></tr><tr><td>250</td><td><code><pre>        client = c.cachedClient[k]</pre></code></td></tr><tr><td>251</td><td><code><pre>        if client == nil || client.IsShutdown() {</pre></code></td></tr><tr><td>252</td><td><code><pre>                network, addr := splitNetworkAndAddress(k)</pre></code></td></tr><tr><td>253</td><td><code><pre>                if network == &#34;inprocess&#34; {</pre></code></td></tr><tr class="miss"><td>254</td><td><code><pre>                        client = InprocessClient</pre></code></td></tr><tr><td>255</td><td><code><pre>                } else {</pre></code></td></tr><tr><td>256</td><td><code><pre>                        client = &amp;Client{</pre></code></td></tr><tr><td>257</td><td><code><pre>                                option:  c.option,</pre></code></td></tr><tr><td>258</td><td><code><pre>                                Plugins: c.Plugins,</pre></code></td></tr><tr><td>259</td><td><code><pre>                        }</pre></code></td></tr><tr><td>260</td><td><code><pre></pre></code></td></tr><tr><td>261</td><td><code><pre>                        var breaker interface{}</pre></code></td></tr><tr><td>262</td><td><code><pre>                        if c.option.GenBreaker != nil {</pre></code></td></tr><tr class="miss"><td>263</td><td><code><pre>                                breaker, _ = c.breakers.LoadOrStore(k, c.option.GenBreaker())</pre></code></td></tr><tr><td>264</td><td><code><pre>                        }</pre></code></td></tr><tr><td>265</td><td><code><pre>                        err := client.Connect(network, addr)</pre></code></td></tr><tr><td>266</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>267</td><td><code><pre>                                if breaker != nil {</pre></code></td></tr><tr class="miss"><td>268</td><td><code><pre>                                        breaker.(Breaker).Fail()</pre></code></td></tr><tr><td>269</td><td><code><pre>                                }</pre></code></td></tr><tr class="miss"><td>270</td><td><code><pre>                                return nil, err</pre></code></td></tr><tr><td>271</td><td><code><pre>                        }</pre></code></td></tr><tr><td>272</td><td><code><pre>                        if c.Plugins != nil {</pre></code></td></tr><tr><td>273</td><td><code><pre>                                c.Plugins.DoClientConnected((client.(*Client)).Conn)</pre></code></td></tr><tr><td>274</td><td><code><pre>                        }</pre></code></td></tr><tr><td>275</td><td><code><pre></pre></code></td></tr><tr><td>276</td><td><code><pre>                }</pre></code></td></tr><tr><td>277</td><td><code><pre></pre></code></td></tr><tr><td>278</td><td><code><pre>                client.RegisterServerMessageChan(c.serverMessageChan)</pre></code></td></tr><tr><td>279</td><td><code><pre></pre></code></td></tr><tr><td>280</td><td><code><pre>                c.cachedClient[k] = client</pre></code></td></tr><tr><td>281</td><td><code><pre>        }</pre></code></td></tr><tr><td>282</td><td><code><pre></pre></code></td></tr><tr><td>283</td><td><code><pre>        return client, nil</pre></code></td></tr><tr><td>284</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.Close">func Client.Close</div><div class="info"><a href="#s_fn_Client.Close">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>723</td><td><code><pre>func (client *Client) Close() error {</pre></code></td></tr><tr><td>724</td><td><code><pre>        client.mutex.Lock()</pre></code></td></tr><tr><td>725</td><td><code><pre></pre></code></td></tr><tr><td>726</td><td><code><pre>        for seq, call := range client.pending {</pre></code></td></tr><tr class="miss"><td>727</td><td><code><pre>                delete(client.pending, seq)</pre></code></td></tr><tr class="miss"><td>728</td><td><code><pre>                if call != nil {</pre></code></td></tr><tr class="miss"><td>729</td><td><code><pre>                        call.Error = ErrShutdown</pre></code></td></tr><tr class="miss"><td>730</td><td><code><pre>                        call.done()</pre></code></td></tr><tr><td>731</td><td><code><pre>                }</pre></code></td></tr><tr><td>732</td><td><code><pre>        }</pre></code></td></tr><tr><td>733</td><td><code><pre></pre></code></td></tr><tr><td>734</td><td><code><pre>        var err error</pre></code></td></tr><tr><td>735</td><td><code><pre>        if !client.pluginClosed {</pre></code></td></tr><tr><td>736</td><td><code><pre>                if client.Plugins != nil {</pre></code></td></tr><tr><td>737</td><td><code><pre>                        client.Plugins.DoClientConnectionClose(client.Conn)</pre></code></td></tr><tr><td>738</td><td><code><pre>                }</pre></code></td></tr><tr><td>739</td><td><code><pre></pre></code></td></tr><tr><td>740</td><td><code><pre>                client.pluginClosed = true</pre></code></td></tr><tr><td>741</td><td><code><pre>                err = client.Conn.Close()</pre></code></td></tr><tr><td>742</td><td><code><pre>        }</pre></code></td></tr><tr><td>743</td><td><code><pre></pre></code></td></tr><tr><td>744</td><td><code><pre>        if client.closing || client.shutdown {</pre></code></td></tr><tr class="miss"><td>745</td><td><code><pre>                client.mutex.Unlock()</pre></code></td></tr><tr class="miss"><td>746</td><td><code><pre>                return ErrShutdown</pre></code></td></tr><tr><td>747</td><td><code><pre>        }</pre></code></td></tr><tr><td>748</td><td><code><pre></pre></code></td></tr><tr><td>749</td><td><code><pre>        client.closing = true</pre></code></td></tr><tr><td>750</td><td><code><pre>        client.mutex.Unlock()</pre></code></td></tr><tr><td>751</td><td><code><pre>        return err</pre></code></td></tr><tr><td>752</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newDirectConn">func newDirectConn</div><div class="info"><a href="#s_fn_newDirectConn">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/connection.go</code>:</p></div><table class="listing">
<tr><td>67</td><td><code><pre>func newDirectConn(c *Client, network, address string) (net.Conn, error) {</pre></code></td></tr><tr><td>68</td><td><code><pre>        var conn net.Conn</pre></code></td></tr><tr><td>69</td><td><code><pre>        var tlsConn *tls.Conn</pre></code></td></tr><tr><td>70</td><td><code><pre>        var err error</pre></code></td></tr><tr><td>71</td><td><code><pre></pre></code></td></tr><tr><td>72</td><td><code><pre>        if c != nil &amp;&amp; c.option.TLSConfig != nil {</pre></code></td></tr><tr class="miss"><td>73</td><td><code><pre>                dialer := &amp;net.Dialer{</pre></code></td></tr><tr><td>74</td><td><code><pre>                        Timeout: c.option.ConnectTimeout,</pre></code></td></tr><tr><td>75</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>                tlsConn, err = tls.DialWithDialer(dialer, network, address, c.option.TLSConfig)</pre></code></td></tr><tr><td>77</td><td><code><pre>                //or conn:= tls.Client(netConn, &amp;config)</pre></code></td></tr><tr class="miss"><td>78</td><td><code><pre>                conn = net.Conn(tlsConn)</pre></code></td></tr><tr><td>79</td><td><code><pre>        } else {</pre></code></td></tr><tr><td>80</td><td><code><pre>                conn, err = net.DialTimeout(network, address, c.option.ConnectTimeout)</pre></code></td></tr><tr><td>81</td><td><code><pre>        }</pre></code></td></tr><tr><td>82</td><td><code><pre></pre></code></td></tr><tr><td>83</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>84</td><td><code><pre>                log.Warnf(&#34;failed to dial server: %v&#34;, err)</pre></code></td></tr><tr class="miss"><td>85</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>86</td><td><code><pre>        }</pre></code></td></tr><tr><td>87</td><td><code><pre></pre></code></td></tr><tr><td>88</td><td><code><pre>        if tc, ok := conn.(*net.TCPConn); ok {</pre></code></td></tr><tr><td>89</td><td><code><pre>                tc.SetKeepAlive(true)</pre></code></td></tr><tr><td>90</td><td><code><pre>                tc.SetKeepAlivePeriod(3 * time.Minute)</pre></code></td></tr><tr><td>91</td><td><code><pre>        }</pre></code></td></tr><tr><td>92</td><td><code><pre></pre></code></td></tr><tr><td>93</td><td><code><pre>        return conn, nil</pre></code></td></tr><tr><td>94</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.Connect">func Client.Connect</div><div class="info"><a href="#s_fn_Client.Connect">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/connection.go</code>:</p></div><table class="listing">
<tr><td>21</td><td><code><pre>func (c *Client) Connect(network, address string) error {</pre></code></td></tr><tr><td>22</td><td><code><pre>        var conn net.Conn</pre></code></td></tr><tr><td>23</td><td><code><pre>        var err error</pre></code></td></tr><tr><td>24</td><td><code><pre></pre></code></td></tr><tr><td>25</td><td><code><pre>        switch network {</pre></code></td></tr><tr><td>26</td><td><code><pre>        case &#34;http&#34;:</pre></code></td></tr><tr class="miss"><td>27</td><td><code><pre>                conn, err = newDirectHTTPConn(c, network, address)</pre></code></td></tr><tr><td>28</td><td><code><pre>        case &#34;kcp&#34;:</pre></code></td></tr><tr class="miss"><td>29</td><td><code><pre>                conn, err = newDirectKCPConn(c, network, address)</pre></code></td></tr><tr><td>30</td><td><code><pre>        case &#34;quic&#34;:</pre></code></td></tr><tr class="miss"><td>31</td><td><code><pre>                conn, err = newDirectQuicConn(c, network, address)</pre></code></td></tr><tr><td>32</td><td><code><pre>        case &#34;unix&#34;:</pre></code></td></tr><tr class="miss"><td>33</td><td><code><pre>                conn, err = newDirectConn(c, network, address)</pre></code></td></tr><tr><td>34</td><td><code><pre>        default:</pre></code></td></tr><tr><td>35</td><td><code><pre>                fn := makeConnMap[network]</pre></code></td></tr><tr><td>36</td><td><code><pre>                if fn != nil {</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>                        conn, err = fn(c, network, address)</pre></code></td></tr><tr><td>38</td><td><code><pre>                } else {</pre></code></td></tr><tr><td>39</td><td><code><pre>                        conn, err = newDirectConn(c, network, address)</pre></code></td></tr><tr><td>40</td><td><code><pre>                }</pre></code></td></tr><tr><td>41</td><td><code><pre>        }</pre></code></td></tr><tr><td>42</td><td><code><pre></pre></code></td></tr><tr><td>43</td><td><code><pre>        if err == nil &amp;&amp; conn != nil {</pre></code></td></tr><tr><td>44</td><td><code><pre>                if c.option.ReadTimeout != 0 {</pre></code></td></tr><tr class="miss"><td>45</td><td><code><pre>                        conn.SetReadDeadline(time.Now().Add(c.option.ReadTimeout))</pre></code></td></tr><tr><td>46</td><td><code><pre>                }</pre></code></td></tr><tr><td>47</td><td><code><pre>                if c.option.WriteTimeout != 0 {</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>                        conn.SetWriteDeadline(time.Now().Add(c.option.WriteTimeout))</pre></code></td></tr><tr><td>49</td><td><code><pre>                }</pre></code></td></tr><tr><td>50</td><td><code><pre></pre></code></td></tr><tr><td>51</td><td><code><pre>                c.Conn = conn</pre></code></td></tr><tr><td>52</td><td><code><pre>                c.r = bufio.NewReaderSize(conn, ReaderBuffsize)</pre></code></td></tr><tr><td>53</td><td><code><pre>                //c.w = bufio.NewWriterSize(conn, WriterBuffsize)</pre></code></td></tr><tr><td>54</td><td><code><pre></pre></code></td></tr><tr><td>55</td><td><code><pre>                // start reading and writing since connected</pre></code></td></tr><tr><td>56</td><td><code><pre>                go c.input()</pre></code></td></tr><tr><td>57</td><td><code><pre></pre></code></td></tr><tr><td>58</td><td><code><pre>                if c.option.Heartbeat &amp;&amp; c.option.HeartbeatInterval &gt; 0 {</pre></code></td></tr><tr class="miss"><td>59</td><td><code><pre>                        go c.heartbeat()</pre></code></td></tr><tr><td>60</td><td><code><pre>                }</pre></code></td></tr><tr><td>61</td><td><code><pre></pre></code></td></tr><tr><td>62</td><td><code><pre>        }</pre></code></td></tr><tr><td>63</td><td><code><pre></pre></code></td></tr><tr><td>64</td><td><code><pre>        return err</pre></code></td></tr><tr><td>65</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.input">func Client.input</div><div class="info"><a href="#s_fn_Client.input">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>560</td><td><code><pre>func (client *Client) input() {</pre></code></td></tr><tr><td>561</td><td><code><pre>        var err error</pre></code></td></tr><tr><td>562</td><td><code><pre>        var res = protocol.NewMessage()</pre></code></td></tr><tr><td>563</td><td><code><pre></pre></code></td></tr><tr><td>564</td><td><code><pre>        for err == nil {</pre></code></td></tr><tr><td>565</td><td><code><pre>                if client.option.ReadTimeout != 0 {</pre></code></td></tr><tr class="miss"><td>566</td><td><code><pre>                        client.Conn.SetReadDeadline(time.Now().Add(client.option.ReadTimeout))</pre></code></td></tr><tr><td>567</td><td><code><pre>                }</pre></code></td></tr><tr><td>568</td><td><code><pre></pre></code></td></tr><tr><td>569</td><td><code><pre>                err = res.Decode(client.r)</pre></code></td></tr><tr><td>570</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr><td>571</td><td><code><pre>                        break</pre></code></td></tr><tr><td>572</td><td><code><pre>                }</pre></code></td></tr><tr><td>573</td><td><code><pre>                if client.Plugins != nil {</pre></code></td></tr><tr><td>574</td><td><code><pre>                        client.Plugins.DoClientAfterDecode(res)</pre></code></td></tr><tr><td>575</td><td><code><pre>                }</pre></code></td></tr><tr><td>576</td><td><code><pre></pre></code></td></tr><tr><td>577</td><td><code><pre>                seq := res.Seq()</pre></code></td></tr><tr><td>578</td><td><code><pre>                var call *Call</pre></code></td></tr><tr><td>579</td><td><code><pre>                isServerMessage := (res.MessageType() == protocol.Request &amp;&amp; !res.IsHeartbeat() &amp;&amp; res.IsOneway())</pre></code></td></tr><tr><td>580</td><td><code><pre>                if !isServerMessage {</pre></code></td></tr><tr><td>581</td><td><code><pre>                        client.mutex.Lock()</pre></code></td></tr><tr><td>582</td><td><code><pre>                        call = client.pending[seq]</pre></code></td></tr><tr><td>583</td><td><code><pre>                        delete(client.pending, seq)</pre></code></td></tr><tr><td>584</td><td><code><pre>                        client.mutex.Unlock()</pre></code></td></tr><tr><td>585</td><td><code><pre>                }</pre></code></td></tr><tr><td>586</td><td><code><pre></pre></code></td></tr><tr><td>587</td><td><code><pre>                switch {</pre></code></td></tr><tr><td>588</td><td><code><pre>                case call == nil:</pre></code></td></tr><tr class="miss"><td>589</td><td><code><pre>                        if isServerMessage {</pre></code></td></tr><tr class="miss"><td>590</td><td><code><pre>                                if client.ServerMessageChan != nil {</pre></code></td></tr><tr class="miss"><td>591</td><td><code><pre>                                        go client.handleServerRequest(res)</pre></code></td></tr><tr class="miss"><td>592</td><td><code><pre>                                        res = protocol.NewMessage()</pre></code></td></tr><tr><td>593</td><td><code><pre>                                }</pre></code></td></tr><tr class="miss"><td>594</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>595</td><td><code><pre>                        }</pre></code></td></tr><tr><td>596</td><td><code><pre>                case res.MessageStatusType() == protocol.Error:</pre></code></td></tr><tr><td>597</td><td><code><pre>                        // We&#39;ve got an error response. Give this to the request</pre></code></td></tr><tr><td>598</td><td><code><pre>                        if len(res.Metadata) &gt; 0 {</pre></code></td></tr><tr><td>599</td><td><code><pre>                                meta := make(map[string]string, len(res.Metadata))</pre></code></td></tr><tr><td>600</td><td><code><pre>                                for k, v := range res.Metadata {</pre></code></td></tr><tr><td>601</td><td><code><pre>                                        meta[k] = v</pre></code></td></tr><tr><td>602</td><td><code><pre>                                }</pre></code></td></tr><tr><td>603</td><td><code><pre>                                call.ResMetadata = meta</pre></code></td></tr><tr><td>604</td><td><code><pre>                                call.Error = ServiceError(meta[protocol.ServiceError])</pre></code></td></tr><tr><td>605</td><td><code><pre>                        }</pre></code></td></tr><tr><td>606</td><td><code><pre></pre></code></td></tr><tr><td>607</td><td><code><pre>                        if call.Raw {</pre></code></td></tr><tr class="miss"><td>608</td><td><code><pre>                                call.Metadata, call.Reply, _ = convertRes2Raw(res)</pre></code></td></tr><tr class="miss"><td>609</td><td><code><pre>                                call.Metadata[XErrorMessage] = call.Error.Error()</pre></code></td></tr><tr><td>610</td><td><code><pre>                        }</pre></code></td></tr><tr><td>611</td><td><code><pre>                        call.done()</pre></code></td></tr><tr><td>612</td><td><code><pre>                default:</pre></code></td></tr><tr><td>613</td><td><code><pre>                        if call.Raw {</pre></code></td></tr><tr class="miss"><td>614</td><td><code><pre>                                call.Metadata, call.Reply, _ = convertRes2Raw(res)</pre></code></td></tr><tr><td>615</td><td><code><pre>                        } else {</pre></code></td></tr><tr><td>616</td><td><code><pre>                                data := res.Payload</pre></code></td></tr><tr><td>617</td><td><code><pre>                                if len(data) &gt; 0 {</pre></code></td></tr><tr><td>618</td><td><code><pre>                                        codec := share.Codecs[res.SerializeType()]</pre></code></td></tr><tr><td>619</td><td><code><pre>                                        if codec == nil {</pre></code></td></tr><tr class="miss"><td>620</td><td><code><pre>                                                call.Error = ServiceError(ErrUnsupportedCodec.Error())</pre></code></td></tr><tr><td>621</td><td><code><pre>                                        } else {</pre></code></td></tr><tr><td>622</td><td><code><pre>                                                err = codec.Decode(data, call.Reply)</pre></code></td></tr><tr><td>623</td><td><code><pre>                                                if err != nil {</pre></code></td></tr><tr class="miss"><td>624</td><td><code><pre>                                                        call.Error = ServiceError(err.Error())</pre></code></td></tr><tr><td>625</td><td><code><pre>                                                }</pre></code></td></tr><tr><td>626</td><td><code><pre>                                        }</pre></code></td></tr><tr><td>627</td><td><code><pre>                                }</pre></code></td></tr><tr><td>628</td><td><code><pre>                                if len(res.Metadata) &gt; 0 {</pre></code></td></tr><tr class="miss"><td>629</td><td><code><pre>                                        meta := make(map[string]string, len(res.Metadata))</pre></code></td></tr><tr class="miss"><td>630</td><td><code><pre>                                        for k, v := range res.Metadata {</pre></code></td></tr><tr class="miss"><td>631</td><td><code><pre>                                                meta[k] = v</pre></code></td></tr><tr><td>632</td><td><code><pre>                                        }</pre></code></td></tr><tr class="miss"><td>633</td><td><code><pre>                                        call.ResMetadata = res.Metadata</pre></code></td></tr><tr><td>634</td><td><code><pre>                                }</pre></code></td></tr><tr><td>635</td><td><code><pre></pre></code></td></tr><tr><td>636</td><td><code><pre>                        }</pre></code></td></tr><tr><td>637</td><td><code><pre></pre></code></td></tr><tr><td>638</td><td><code><pre>                        call.done()</pre></code></td></tr><tr><td>639</td><td><code><pre>                }</pre></code></td></tr><tr><td>640</td><td><code><pre></pre></code></td></tr><tr><td>641</td><td><code><pre>                res.Reset()</pre></code></td></tr><tr><td>642</td><td><code><pre>        }</pre></code></td></tr><tr><td>643</td><td><code><pre>        // Terminate pending calls.</pre></code></td></tr><tr><td>644</td><td><code><pre></pre></code></td></tr><tr><td>645</td><td><code><pre>        if client.ServerMessageChan != nil {</pre></code></td></tr><tr class="miss"><td>646</td><td><code><pre>                req := protocol.NewMessage()</pre></code></td></tr><tr class="miss"><td>647</td><td><code><pre>                req.SetMessageType(protocol.Request)</pre></code></td></tr><tr class="miss"><td>648</td><td><code><pre>                req.SetMessageStatusType(protocol.Error)</pre></code></td></tr><tr class="miss"><td>649</td><td><code><pre>                if req.Metadata == nil {</pre></code></td></tr><tr class="miss"><td>650</td><td><code><pre>                        req.Metadata = make(map[string]string)</pre></code></td></tr><tr class="miss"><td>651</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>652</td><td><code><pre>                                req.Metadata[protocol.ServiceError] = err.Error()</pre></code></td></tr><tr><td>653</td><td><code><pre>                        }</pre></code></td></tr><tr><td>654</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>655</td><td><code><pre>                req.Metadata[&#34;server&#34;] = client.Conn.RemoteAddr().String()</pre></code></td></tr><tr class="miss"><td>656</td><td><code><pre>                go client.handleServerRequest(req)</pre></code></td></tr><tr><td>657</td><td><code><pre>        }</pre></code></td></tr><tr><td>658</td><td><code><pre></pre></code></td></tr><tr><td>659</td><td><code><pre>        client.mutex.Lock()</pre></code></td></tr><tr><td>660</td><td><code><pre>        if !client.pluginClosed {</pre></code></td></tr><tr class="miss"><td>661</td><td><code><pre>                if client.Plugins != nil {</pre></code></td></tr><tr class="miss"><td>662</td><td><code><pre>                        client.Plugins.DoClientConnectionClose(client.Conn)</pre></code></td></tr><tr><td>663</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>664</td><td><code><pre>                client.pluginClosed = true</pre></code></td></tr><tr class="miss"><td>665</td><td><code><pre>                client.Conn.Close()</pre></code></td></tr><tr><td>666</td><td><code><pre>        }</pre></code></td></tr><tr><td>667</td><td><code><pre>        client.shutdown = true</pre></code></td></tr><tr><td>668</td><td><code><pre>        closing := client.closing</pre></code></td></tr><tr><td>669</td><td><code><pre>        if err == io.EOF {</pre></code></td></tr><tr class="miss"><td>670</td><td><code><pre>                if closing {</pre></code></td></tr><tr class="miss"><td>671</td><td><code><pre>                        err = ErrShutdown</pre></code></td></tr><tr><td>672</td><td><code><pre>                } else {</pre></code></td></tr><tr class="miss"><td>673</td><td><code><pre>                        err = io.ErrUnexpectedEOF</pre></code></td></tr><tr><td>674</td><td><code><pre>                }</pre></code></td></tr><tr><td>675</td><td><code><pre>        }</pre></code></td></tr><tr><td>676</td><td><code><pre>        for _, call := range client.pending {</pre></code></td></tr><tr class="miss"><td>677</td><td><code><pre>                call.Error = err</pre></code></td></tr><tr class="miss"><td>678</td><td><code><pre>                call.done()</pre></code></td></tr><tr><td>679</td><td><code><pre>        }</pre></code></td></tr><tr><td>680</td><td><code><pre></pre></code></td></tr><tr><td>681</td><td><code><pre>        client.mutex.Unlock()</pre></code></td></tr><tr><td>682</td><td><code><pre></pre></code></td></tr><tr><td>683</td><td><code><pre>        if err != nil &amp;&amp; err != io.EOF &amp;&amp; !closing {</pre></code></td></tr><tr class="miss"><td>684</td><td><code><pre>                log.Error(&#34;rpcx: client protocol error:&#34;, err)</pre></code></td></tr><tr><td>685</td><td><code><pre>        }</pre></code></td></tr><tr><td>686</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.send">func Client.send</div><div class="info"><a href="#s_fn_Client.send">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>458</td><td><code><pre>func (client *Client) send(ctx context.Context, call *Call) {</pre></code></td></tr><tr><td>459</td><td><code><pre></pre></code></td></tr><tr><td>460</td><td><code><pre>        // Register this call.</pre></code></td></tr><tr><td>461</td><td><code><pre>        client.mutex.Lock()</pre></code></td></tr><tr><td>462</td><td><code><pre>        if client.shutdown || client.closing {</pre></code></td></tr><tr class="miss"><td>463</td><td><code><pre>                call.Error = ErrShutdown</pre></code></td></tr><tr class="miss"><td>464</td><td><code><pre>                client.mutex.Unlock()</pre></code></td></tr><tr class="miss"><td>465</td><td><code><pre>                call.done()</pre></code></td></tr><tr class="miss"><td>466</td><td><code><pre>                return</pre></code></td></tr><tr><td>467</td><td><code><pre>        }</pre></code></td></tr><tr><td>468</td><td><code><pre></pre></code></td></tr><tr><td>469</td><td><code><pre>        codec := share.Codecs[client.option.SerializeType]</pre></code></td></tr><tr><td>470</td><td><code><pre>        if codec == nil {</pre></code></td></tr><tr class="miss"><td>471</td><td><code><pre>                call.Error = ErrUnsupportedCodec</pre></code></td></tr><tr class="miss"><td>472</td><td><code><pre>                client.mutex.Unlock()</pre></code></td></tr><tr class="miss"><td>473</td><td><code><pre>                call.done()</pre></code></td></tr><tr class="miss"><td>474</td><td><code><pre>                return</pre></code></td></tr><tr><td>475</td><td><code><pre>        }</pre></code></td></tr><tr><td>476</td><td><code><pre></pre></code></td></tr><tr><td>477</td><td><code><pre>        if client.pending == nil {</pre></code></td></tr><tr><td>478</td><td><code><pre>                client.pending = make(map[uint64]*Call)</pre></code></td></tr><tr><td>479</td><td><code><pre>        }</pre></code></td></tr><tr><td>480</td><td><code><pre></pre></code></td></tr><tr><td>481</td><td><code><pre>        seq := client.seq</pre></code></td></tr><tr><td>482</td><td><code><pre>        client.seq++</pre></code></td></tr><tr><td>483</td><td><code><pre>        client.pending[seq] = call</pre></code></td></tr><tr><td>484</td><td><code><pre>        client.mutex.Unlock()</pre></code></td></tr><tr><td>485</td><td><code><pre></pre></code></td></tr><tr><td>486</td><td><code><pre>        if cseq, ok := ctx.Value(seqKey{}).(*uint64); ok {</pre></code></td></tr><tr><td>487</td><td><code><pre>                *cseq = seq</pre></code></td></tr><tr><td>488</td><td><code><pre>        }</pre></code></td></tr><tr><td>489</td><td><code><pre></pre></code></td></tr><tr><td>490</td><td><code><pre>        //req := protocol.NewMessage()</pre></code></td></tr><tr><td>491</td><td><code><pre>        req := protocol.GetPooledMsg()</pre></code></td></tr><tr><td>492</td><td><code><pre>        req.SetMessageType(protocol.Request)</pre></code></td></tr><tr><td>493</td><td><code><pre>        req.SetSeq(seq)</pre></code></td></tr><tr><td>494</td><td><code><pre>        if call.Reply == nil {</pre></code></td></tr><tr class="miss"><td>495</td><td><code><pre>                req.SetOneway(true)</pre></code></td></tr><tr><td>496</td><td><code><pre>        }</pre></code></td></tr><tr><td>497</td><td><code><pre></pre></code></td></tr><tr><td>498</td><td><code><pre>        // heartbeat</pre></code></td></tr><tr><td>499</td><td><code><pre>        if call.ServicePath == &#34;&#34; &amp;&amp; call.ServiceMethod == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>500</td><td><code><pre>                req.SetHeartbeat(true)</pre></code></td></tr><tr><td>501</td><td><code><pre>        } else {</pre></code></td></tr><tr><td>502</td><td><code><pre>                req.SetSerializeType(client.option.SerializeType)</pre></code></td></tr><tr><td>503</td><td><code><pre>                if call.Metadata != nil {</pre></code></td></tr><tr class="miss"><td>504</td><td><code><pre>                        req.Metadata = call.Metadata</pre></code></td></tr><tr><td>505</td><td><code><pre>                }</pre></code></td></tr><tr><td>506</td><td><code><pre></pre></code></td></tr><tr><td>507</td><td><code><pre>                req.ServicePath = call.ServicePath</pre></code></td></tr><tr><td>508</td><td><code><pre>                req.ServiceMethod = call.ServiceMethod</pre></code></td></tr><tr><td>509</td><td><code><pre></pre></code></td></tr><tr><td>510</td><td><code><pre>                data, err := codec.Encode(call.Args)</pre></code></td></tr><tr><td>511</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>512</td><td><code><pre>                        call.Error = err</pre></code></td></tr><tr class="miss"><td>513</td><td><code><pre>                        call.done()</pre></code></td></tr><tr class="miss"><td>514</td><td><code><pre>                        return</pre></code></td></tr><tr><td>515</td><td><code><pre>                }</pre></code></td></tr><tr><td>516</td><td><code><pre>                if len(data) &gt; 1024 &amp;&amp; client.option.CompressType != protocol.None {</pre></code></td></tr><tr class="miss"><td>517</td><td><code><pre>                        req.SetCompressType(client.option.CompressType)</pre></code></td></tr><tr><td>518</td><td><code><pre>                }</pre></code></td></tr><tr><td>519</td><td><code><pre></pre></code></td></tr><tr><td>520</td><td><code><pre>                req.Payload = data</pre></code></td></tr><tr><td>521</td><td><code><pre>        }</pre></code></td></tr><tr><td>522</td><td><code><pre></pre></code></td></tr><tr><td>523</td><td><code><pre>        if client.Plugins != nil {</pre></code></td></tr><tr><td>524</td><td><code><pre>                client.Plugins.DoClientBeforeEncode(req)</pre></code></td></tr><tr><td>525</td><td><code><pre>        }</pre></code></td></tr><tr><td>526</td><td><code><pre>        data := req.Encode()</pre></code></td></tr><tr><td>527</td><td><code><pre></pre></code></td></tr><tr><td>528</td><td><code><pre>        _, err := client.Conn.Write(data)</pre></code></td></tr><tr><td>529</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>530</td><td><code><pre>                client.mutex.Lock()</pre></code></td></tr><tr class="miss"><td>531</td><td><code><pre>                call = client.pending[seq]</pre></code></td></tr><tr class="miss"><td>532</td><td><code><pre>                delete(client.pending, seq)</pre></code></td></tr><tr class="miss"><td>533</td><td><code><pre>                client.mutex.Unlock()</pre></code></td></tr><tr class="miss"><td>534</td><td><code><pre>                if call != nil {</pre></code></td></tr><tr class="miss"><td>535</td><td><code><pre>                        call.Error = err</pre></code></td></tr><tr class="miss"><td>536</td><td><code><pre>                        call.done()</pre></code></td></tr><tr><td>537</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>538</td><td><code><pre>                return</pre></code></td></tr><tr><td>539</td><td><code><pre>        }</pre></code></td></tr><tr><td>540</td><td><code><pre></pre></code></td></tr><tr><td>541</td><td><code><pre>        isOneway := req.IsOneway()</pre></code></td></tr><tr><td>542</td><td><code><pre>        protocol.FreeMsg(req)</pre></code></td></tr><tr><td>543</td><td><code><pre></pre></code></td></tr><tr><td>544</td><td><code><pre>        if isOneway {</pre></code></td></tr><tr class="miss"><td>545</td><td><code><pre>                client.mutex.Lock()</pre></code></td></tr><tr class="miss"><td>546</td><td><code><pre>                call = client.pending[seq]</pre></code></td></tr><tr class="miss"><td>547</td><td><code><pre>                delete(client.pending, seq)</pre></code></td></tr><tr class="miss"><td>548</td><td><code><pre>                client.mutex.Unlock()</pre></code></td></tr><tr class="miss"><td>549</td><td><code><pre>                if call != nil {</pre></code></td></tr><tr class="miss"><td>550</td><td><code><pre>                        call.done()</pre></code></td></tr><tr><td>551</td><td><code><pre>                }</pre></code></td></tr><tr><td>552</td><td><code><pre>        }</pre></code></td></tr><tr><td>553</td><td><code><pre></pre></code></td></tr><tr><td>554</td><td><code><pre>        if client.option.WriteTimeout != 0 {</pre></code></td></tr><tr class="miss"><td>555</td><td><code><pre>                client.Conn.SetWriteDeadline(time.Now().Add(client.option.WriteTimeout))</pre></code></td></tr><tr><td>556</td><td><code><pre>        }</pre></code></td></tr><tr><td>557</td><td><code><pre></pre></code></td></tr><tr><td>558</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Call.done">func Call.done</div><div class="info"><a href="#s_fn_Call.done">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>171</td><td><code><pre>func (call *Call) done() {</pre></code></td></tr><tr><td>172</td><td><code><pre>        select {</pre></code></td></tr><tr><td>173</td><td><code><pre>        case call.Done &lt;- call:</pre></code></td></tr><tr><td>174</td><td><code><pre>                // ok</pre></code></td></tr><tr><td>175</td><td><code><pre>        default:</pre></code></td></tr><tr class="miss"><td>176</td><td><code><pre>                log.Debug(&#34;rpc: discarding Call reply due to insufficient Done chan capacity&#34;)</pre></code></td></tr><tr><td>177</td><td><code><pre></pre></code></td></tr><tr><td>178</td><td><code><pre>        }</pre></code></td></tr><tr><td>179</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.call">func Client.call</div><div class="info"><a href="#s_fn_Client.call">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>298</td><td><code><pre>func (client *Client) call(ctx context.Context, servicePath, serviceMethod string, args interface{}, reply interface{}) error {</pre></code></td></tr><tr><td>299</td><td><code><pre>        seq := new(uint64)</pre></code></td></tr><tr><td>300</td><td><code><pre>        ctx = context.WithValue(ctx, seqKey{}, seq)</pre></code></td></tr><tr><td>301</td><td><code><pre>        Done := client.Go(ctx, servicePath, serviceMethod, args, reply, make(chan *Call, 1)).Done</pre></code></td></tr><tr><td>302</td><td><code><pre></pre></code></td></tr><tr><td>303</td><td><code><pre>        var err error</pre></code></td></tr><tr><td>304</td><td><code><pre>        select {</pre></code></td></tr><tr><td>305</td><td><code><pre>        case &lt;-ctx.Done(): //cancel by context</pre></code></td></tr><tr class="miss"><td>306</td><td><code><pre>                client.mutex.Lock()</pre></code></td></tr><tr class="miss"><td>307</td><td><code><pre>                call := client.pending[*seq]</pre></code></td></tr><tr class="miss"><td>308</td><td><code><pre>                delete(client.pending, *seq)</pre></code></td></tr><tr class="miss"><td>309</td><td><code><pre>                client.mutex.Unlock()</pre></code></td></tr><tr class="miss"><td>310</td><td><code><pre>                if call != nil {</pre></code></td></tr><tr class="miss"><td>311</td><td><code><pre>                        call.Error = ctx.Err()</pre></code></td></tr><tr class="miss"><td>312</td><td><code><pre>                        call.done()</pre></code></td></tr><tr><td>313</td><td><code><pre>                }</pre></code></td></tr><tr><td>314</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>315</td><td><code><pre>                return ctx.Err()</pre></code></td></tr><tr><td>316</td><td><code><pre>        case call := &lt;-Done:</pre></code></td></tr><tr><td>317</td><td><code><pre>                err = call.Error</pre></code></td></tr><tr><td>318</td><td><code><pre>                meta := ctx.Value(share.ResMetaDataKey)</pre></code></td></tr><tr><td>319</td><td><code><pre>                if meta != nil &amp;&amp; len(call.ResMetadata) &gt; 0 {</pre></code></td></tr><tr class="miss"><td>320</td><td><code><pre>                        resMeta := meta.(map[string]string)</pre></code></td></tr><tr class="miss"><td>321</td><td><code><pre>                        for k, v := range call.ResMetadata {</pre></code></td></tr><tr class="miss"><td>322</td><td><code><pre>                                resMeta[k] = v</pre></code></td></tr><tr><td>323</td><td><code><pre>                        }</pre></code></td></tr><tr><td>324</td><td><code><pre>                }</pre></code></td></tr><tr><td>325</td><td><code><pre>        }</pre></code></td></tr><tr><td>326</td><td><code><pre></pre></code></td></tr><tr><td>327</td><td><code><pre>        return err</pre></code></td></tr><tr><td>328</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.injectOpenTracingSpan">func Client.injectOpenTracingSpan</div><div class="info"><a href="#s_fn_Client.injectOpenTracingSpan">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>240</td><td><code><pre>func (client *Client) injectOpenTracingSpan(ctx context.Context, call *Call) {</pre></code></td></tr><tr><td>241</td><td><code><pre>        var rpcxContext *share.Context</pre></code></td></tr><tr><td>242</td><td><code><pre>        var ok bool</pre></code></td></tr><tr><td>243</td><td><code><pre>        if rpcxContext, ok = ctx.(*share.Context); !ok {</pre></code></td></tr><tr class="miss"><td>244</td><td><code><pre>                return</pre></code></td></tr><tr><td>245</td><td><code><pre>        }</pre></code></td></tr><tr><td>246</td><td><code><pre>        sp := rpcxContext.Value(share.OpentracingSpanClientKey)</pre></code></td></tr><tr><td>247</td><td><code><pre>        if sp == nil { // have not config opentracing plugin</pre></code></td></tr><tr><td>248</td><td><code><pre>                return</pre></code></td></tr><tr><td>249</td><td><code><pre>        }</pre></code></td></tr><tr><td>250</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>251</td><td><code><pre>        span := sp.(opentracing.Span)</pre></code></td></tr><tr class="miss"><td>252</td><td><code><pre>        if call.Metadata == nil {</pre></code></td></tr><tr class="miss"><td>253</td><td><code><pre>                call.Metadata = make(map[string]string)</pre></code></td></tr><tr><td>254</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>255</td><td><code><pre>        meta := call.Metadata</pre></code></td></tr><tr><td>256</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>257</td><td><code><pre>        err := opentracing.GlobalTracer().Inject(</pre></code></td></tr><tr><td>258</td><td><code><pre>                span.Context(),</pre></code></td></tr><tr><td>259</td><td><code><pre>                opentracing.TextMap,</pre></code></td></tr><tr><td>260</td><td><code><pre>                opentracing.TextMapCarrier(meta))</pre></code></td></tr><tr class="miss"><td>261</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>262</td><td><code><pre>                log.Errorf(&#34;failed to inject span: %v&#34;, err)</pre></code></td></tr><tr><td>263</td><td><code><pre>        }</pre></code></td></tr><tr><td>264</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoClientAfterDecode">func pluginContainer.DoClientAfterDecode</div><div class="info"><a href="#s_fn_pluginContainer.DoClientAfterDecode">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/plugin.go</code>:</p></div><table class="listing">
<tr><td>119</td><td><code><pre>func (p *pluginContainer) DoClientAfterDecode(req *protocol.Message) bool {</pre></code></td></tr><tr><td>120</td><td><code><pre>        var handleOk bool</pre></code></td></tr><tr><td>121</td><td><code><pre>        for i := range p.plugins {</pre></code></td></tr><tr class="miss"><td>122</td><td><code><pre>                if plugin, ok := p.plugins[i].(ClientAfterDecodePlugin); ok {</pre></code></td></tr><tr class="miss"><td>123</td><td><code><pre>                        handleOk = plugin.ClientAfterDecode(req)</pre></code></td></tr><tr class="miss"><td>124</td><td><code><pre>                        if !handleOk {</pre></code></td></tr><tr class="miss"><td>125</td><td><code><pre>                                return false</pre></code></td></tr><tr><td>126</td><td><code><pre>                        }</pre></code></td></tr><tr><td>127</td><td><code><pre>                }</pre></code></td></tr><tr><td>128</td><td><code><pre>        }</pre></code></td></tr><tr><td>129</td><td><code><pre>        return true</pre></code></td></tr><tr><td>130</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoClientBeforeEncode">func pluginContainer.DoClientBeforeEncode</div><div class="info"><a href="#s_fn_pluginContainer.DoClientBeforeEncode">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/plugin.go</code>:</p></div><table class="listing">
<tr><td>105</td><td><code><pre>func (p *pluginContainer) DoClientBeforeEncode(req *protocol.Message) bool {</pre></code></td></tr><tr><td>106</td><td><code><pre>        var handleOk bool</pre></code></td></tr><tr><td>107</td><td><code><pre>        for i := range p.plugins {</pre></code></td></tr><tr class="miss"><td>108</td><td><code><pre>                if plugin, ok := p.plugins[i].(ClientBeforeEncodePlugin); ok {</pre></code></td></tr><tr class="miss"><td>109</td><td><code><pre>                        handleOk = plugin.ClientBeforeEncode(req)</pre></code></td></tr><tr class="miss"><td>110</td><td><code><pre>                        if !handleOk {</pre></code></td></tr><tr class="miss"><td>111</td><td><code><pre>                                return false</pre></code></td></tr><tr><td>112</td><td><code><pre>                        }</pre></code></td></tr><tr><td>113</td><td><code><pre>                }</pre></code></td></tr><tr><td>114</td><td><code><pre>        }</pre></code></td></tr><tr><td>115</td><td><code><pre>        return true</pre></code></td></tr><tr><td>116</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoClientConnected">func pluginContainer.DoClientConnected</div><div class="info"><a href="#s_fn_pluginContainer.DoClientConnected">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/plugin.go</code>:</p></div><table class="listing">
<tr><td>77</td><td><code><pre>func (p *pluginContainer) DoClientConnected(conn net.Conn) (net.Conn, bool) {</pre></code></td></tr><tr><td>78</td><td><code><pre>        var handleOk bool</pre></code></td></tr><tr><td>79</td><td><code><pre>        for i := range p.plugins {</pre></code></td></tr><tr class="miss"><td>80</td><td><code><pre>                if plugin, ok := p.plugins[i].(ClientConnectedPlugin); ok {</pre></code></td></tr><tr class="miss"><td>81</td><td><code><pre>                        conn, handleOk = plugin.ClientConnected(conn)</pre></code></td></tr><tr class="miss"><td>82</td><td><code><pre>                        if !handleOk {</pre></code></td></tr><tr class="miss"><td>83</td><td><code><pre>                                return conn, false</pre></code></td></tr><tr><td>84</td><td><code><pre>                        }</pre></code></td></tr><tr><td>85</td><td><code><pre>                }</pre></code></td></tr><tr><td>86</td><td><code><pre>        }</pre></code></td></tr><tr><td>87</td><td><code><pre>        return conn, true</pre></code></td></tr><tr><td>88</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoClientConnectionClose">func pluginContainer.DoClientConnectionClose</div><div class="info"><a href="#s_fn_pluginContainer.DoClientConnectionClose">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/plugin.go</code>:</p></div><table class="listing">
<tr><td>91</td><td><code><pre>func (p *pluginContainer) DoClientConnectionClose(conn net.Conn) bool {</pre></code></td></tr><tr><td>92</td><td><code><pre>        var handleOk bool</pre></code></td></tr><tr><td>93</td><td><code><pre>        for i := range p.plugins {</pre></code></td></tr><tr class="miss"><td>94</td><td><code><pre>                if plugin, ok := p.plugins[i].(ClientConnectionClosePlugin); ok {</pre></code></td></tr><tr class="miss"><td>95</td><td><code><pre>                        handleOk = plugin.ClientConnectionClose(conn)</pre></code></td></tr><tr class="miss"><td>96</td><td><code><pre>                        if !handleOk {</pre></code></td></tr><tr class="miss"><td>97</td><td><code><pre>                                return false</pre></code></td></tr><tr><td>98</td><td><code><pre>                        }</pre></code></td></tr><tr><td>99</td><td><code><pre>                }</pre></code></td></tr><tr><td>100</td><td><code><pre>        }</pre></code></td></tr><tr><td>101</td><td><code><pre>        return true</pre></code></td></tr><tr><td>102</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.injectOpenCensusSpan">func Client.injectOpenCensusSpan</div><div class="info"><a href="#s_fn_Client.injectOpenCensusSpan">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>266</td><td><code><pre>func (client *Client) injectOpenCensusSpan(ctx context.Context, call *Call) {</pre></code></td></tr><tr><td>267</td><td><code><pre>        var rpcxContext *share.Context</pre></code></td></tr><tr><td>268</td><td><code><pre>        var ok bool</pre></code></td></tr><tr><td>269</td><td><code><pre>        if rpcxContext, ok = ctx.(*share.Context); !ok {</pre></code></td></tr><tr class="miss"><td>270</td><td><code><pre>                return</pre></code></td></tr><tr><td>271</td><td><code><pre>        }</pre></code></td></tr><tr><td>272</td><td><code><pre>        sp := rpcxContext.Value(share.OpencensusSpanClientKey)</pre></code></td></tr><tr><td>273</td><td><code><pre>        if sp == nil { // have not config opencensus plugin</pre></code></td></tr><tr><td>274</td><td><code><pre>                return</pre></code></td></tr><tr><td>275</td><td><code><pre>        }</pre></code></td></tr><tr><td>276</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>277</td><td><code><pre>        span := sp.(*trace.Span)</pre></code></td></tr><tr class="miss"><td>278</td><td><code><pre>        if span == nil {</pre></code></td></tr><tr class="miss"><td>279</td><td><code><pre>                return</pre></code></td></tr><tr><td>280</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>281</td><td><code><pre>        if call.Metadata == nil {</pre></code></td></tr><tr class="miss"><td>282</td><td><code><pre>                call.Metadata = make(map[string]string)</pre></code></td></tr><tr><td>283</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>284</td><td><code><pre>        meta := call.Metadata</pre></code></td></tr><tr><td>285</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>286</td><td><code><pre>        spanContext := span.SpanContext()</pre></code></td></tr><tr class="miss"><td>287</td><td><code><pre>        scData := make([]byte, 24)</pre></code></td></tr><tr class="miss"><td>288</td><td><code><pre>        copy(scData[:16], spanContext.TraceID[:])</pre></code></td></tr><tr class="miss"><td>289</td><td><code><pre>        copy(scData[16:24], spanContext.SpanID[:])</pre></code></td></tr><tr class="miss"><td>290</td><td><code><pre>        meta[share.OpencensusSpanRequestKey] = string(scData)</pre></code></td></tr><tr><td>291</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoPostCall">func pluginContainer.DoPostCall</div><div class="info"><a href="#s_fn_pluginContainer.DoPostCall">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/plugin.go</code>:</p></div><table class="listing">
<tr><td>64</td><td><code><pre>func (p *pluginContainer) DoPostCall(ctx context.Context, servicePath, serviceMethod string, args interface{}, reply interface{}, err error) error {</pre></code></td></tr><tr><td>65</td><td><code><pre>        for i := range p.plugins {</pre></code></td></tr><tr class="miss"><td>66</td><td><code><pre>                if plugin, ok := p.plugins[i].(PostCallPlugin); ok {</pre></code></td></tr><tr class="miss"><td>67</td><td><code><pre>                        err = plugin.DoPostCall(ctx, servicePath, serviceMethod, args, reply, err)</pre></code></td></tr><tr class="miss"><td>68</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>69</td><td><code><pre>                                return err</pre></code></td></tr><tr><td>70</td><td><code><pre>                        }</pre></code></td></tr><tr><td>71</td><td><code><pre>                }</pre></code></td></tr><tr><td>72</td><td><code><pre>        }</pre></code></td></tr><tr><td>73</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>74</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoPreCall">func pluginContainer.DoPreCall</div><div class="info"><a href="#s_fn_pluginContainer.DoPreCall">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/plugin.go</code>:</p></div><table class="listing">
<tr><td>50</td><td><code><pre>func (p *pluginContainer) DoPreCall(ctx context.Context, servicePath, serviceMethod string, args interface{}) error {</pre></code></td></tr><tr><td>51</td><td><code><pre>        for i := range p.plugins {</pre></code></td></tr><tr class="miss"><td>52</td><td><code><pre>                if plugin, ok := p.plugins[i].(PreCallPlugin); ok {</pre></code></td></tr><tr class="miss"><td>53</td><td><code><pre>                        err := plugin.DoPreCall(ctx, servicePath, serviceMethod, args)</pre></code></td></tr><tr class="miss"><td>54</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>55</td><td><code><pre>                                return err</pre></code></td></tr><tr><td>56</td><td><code><pre>                        }</pre></code></td></tr><tr><td>57</td><td><code><pre>                }</pre></code></td></tr><tr><td>58</td><td><code><pre>        }</pre></code></td></tr><tr><td>59</td><td><code><pre></pre></code></td></tr><tr><td>60</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>61</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newSelector">func newSelector</div><div class="info"><a href="#s_fn_newSelector">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>23</td><td><code><pre>func newSelector(selectMode SelectMode, servers map[string]string) Selector {</pre></code></td></tr><tr><td>24</td><td><code><pre>        switch selectMode {</pre></code></td></tr><tr><td>25</td><td><code><pre>        case RandomSelect:</pre></code></td></tr><tr><td>26</td><td><code><pre>                return newRandomSelector(servers)</pre></code></td></tr><tr><td>27</td><td><code><pre>        case RoundRobin:</pre></code></td></tr><tr class="miss"><td>28</td><td><code><pre>                return newRoundRobinSelector(servers)</pre></code></td></tr><tr><td>29</td><td><code><pre>        case WeightedRoundRobin:</pre></code></td></tr><tr class="miss"><td>30</td><td><code><pre>                return newWeightedRoundRobinSelector(servers)</pre></code></td></tr><tr><td>31</td><td><code><pre>        case WeightedICMP:</pre></code></td></tr><tr class="miss"><td>32</td><td><code><pre>                return newWeightedICMPSelector(servers)</pre></code></td></tr><tr><td>33</td><td><code><pre>        case ConsistentHash:</pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>                return newConsistentHashSelector(servers)</pre></code></td></tr><tr><td>35</td><td><code><pre>        case SelectByUser:</pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>37</td><td><code><pre>        default:</pre></code></td></tr><tr class="miss"><td>38</td><td><code><pre>                return newRandomSelector(servers)</pre></code></td></tr><tr><td>39</td><td><code><pre>        }</pre></code></td></tr><tr><td>40</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.Call">func xClient.Call</div><div class="info"><a href="#s_fn_xClient.Call">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>370</td><td><code><pre>func (c *xClient) Call(ctx context.Context, serviceMethod string, args interface{}, reply interface{}) error {</pre></code></td></tr><tr><td>371</td><td><code><pre>        if c.isShutdown {</pre></code></td></tr><tr class="miss"><td>372</td><td><code><pre>                return ErrXClientShutdown</pre></code></td></tr><tr><td>373</td><td><code><pre>        }</pre></code></td></tr><tr><td>374</td><td><code><pre></pre></code></td></tr><tr><td>375</td><td><code><pre>        if c.auth != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>376</td><td><code><pre>                metadata := ctx.Value(share.ReqMetaDataKey)</pre></code></td></tr><tr class="miss"><td>377</td><td><code><pre>                if metadata == nil {</pre></code></td></tr><tr class="miss"><td>378</td><td><code><pre>                        metadata = map[string]string{}</pre></code></td></tr><tr class="miss"><td>379</td><td><code><pre>                        ctx = context.WithValue(ctx, share.ReqMetaDataKey, metadata)</pre></code></td></tr><tr><td>380</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>381</td><td><code><pre>                m := metadata.(map[string]string)</pre></code></td></tr><tr class="miss"><td>382</td><td><code><pre>                m[share.AuthKey] = c.auth</pre></code></td></tr><tr><td>383</td><td><code><pre>        }</pre></code></td></tr><tr><td>384</td><td><code><pre></pre></code></td></tr><tr><td>385</td><td><code><pre>        var err error</pre></code></td></tr><tr><td>386</td><td><code><pre>        k, client, err := c.selectClient(ctx, c.servicePath, serviceMethod, args)</pre></code></td></tr><tr><td>387</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>388</td><td><code><pre>                if c.failMode == Failfast {</pre></code></td></tr><tr class="miss"><td>389</td><td><code><pre>                        return err</pre></code></td></tr><tr><td>390</td><td><code><pre>                }</pre></code></td></tr><tr><td>391</td><td><code><pre>        }</pre></code></td></tr><tr><td>392</td><td><code><pre></pre></code></td></tr><tr><td>393</td><td><code><pre>        var e error</pre></code></td></tr><tr><td>394</td><td><code><pre>        switch c.failMode {</pre></code></td></tr><tr><td>395</td><td><code><pre>        case Failtry:</pre></code></td></tr><tr><td>396</td><td><code><pre>                retries := c.option.Retries</pre></code></td></tr><tr><td>397</td><td><code><pre>                for retries &gt; 0 {</pre></code></td></tr><tr><td>398</td><td><code><pre>                        retries--</pre></code></td></tr><tr><td>399</td><td><code><pre></pre></code></td></tr><tr><td>400</td><td><code><pre>                        if client != nil {</pre></code></td></tr><tr><td>401</td><td><code><pre>                                err = c.wrapCall(ctx, client, serviceMethod, args, reply)</pre></code></td></tr><tr><td>402</td><td><code><pre>                                if err == nil {</pre></code></td></tr><tr><td>403</td><td><code><pre>                                        return nil</pre></code></td></tr><tr><td>404</td><td><code><pre>                                }</pre></code></td></tr><tr class="miss"><td>405</td><td><code><pre>                                if _, ok := err.(ServiceError); ok {</pre></code></td></tr><tr class="miss"><td>406</td><td><code><pre>                                        return err</pre></code></td></tr><tr><td>407</td><td><code><pre>                                }</pre></code></td></tr><tr><td>408</td><td><code><pre>                        }</pre></code></td></tr><tr><td>409</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>410</td><td><code><pre>                        c.removeClient(k, client)</pre></code></td></tr><tr class="miss"><td>411</td><td><code><pre>                        client, e = c.getCachedClient(k)</pre></code></td></tr><tr><td>412</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>413</td><td><code><pre>                if err == nil {</pre></code></td></tr><tr class="miss"><td>414</td><td><code><pre>                        err = e</pre></code></td></tr><tr><td>415</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>416</td><td><code><pre>                return err</pre></code></td></tr><tr><td>417</td><td><code><pre>        case Failover:</pre></code></td></tr><tr class="miss"><td>418</td><td><code><pre>                retries := c.option.Retries</pre></code></td></tr><tr class="miss"><td>419</td><td><code><pre>                for retries &gt; 0 {</pre></code></td></tr><tr class="miss"><td>420</td><td><code><pre>                        retries--</pre></code></td></tr><tr><td>421</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>422</td><td><code><pre>                        if client != nil {</pre></code></td></tr><tr class="miss"><td>423</td><td><code><pre>                                err = c.wrapCall(ctx, client, serviceMethod, args, reply)</pre></code></td></tr><tr class="miss"><td>424</td><td><code><pre>                                if err == nil {</pre></code></td></tr><tr class="miss"><td>425</td><td><code><pre>                                        return nil</pre></code></td></tr><tr><td>426</td><td><code><pre>                                }</pre></code></td></tr><tr class="miss"><td>427</td><td><code><pre>                                if _, ok := err.(ServiceError); ok {</pre></code></td></tr><tr class="miss"><td>428</td><td><code><pre>                                        return err</pre></code></td></tr><tr><td>429</td><td><code><pre>                                }</pre></code></td></tr><tr><td>430</td><td><code><pre>                        }</pre></code></td></tr><tr><td>431</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>432</td><td><code><pre>                        c.removeClient(k, client)</pre></code></td></tr><tr><td>433</td><td><code><pre>                        //select another server</pre></code></td></tr><tr class="miss"><td>434</td><td><code><pre>                        k, client, e = c.selectClient(ctx, c.servicePath, serviceMethod, args)</pre></code></td></tr><tr><td>435</td><td><code><pre>                }</pre></code></td></tr><tr><td>436</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>437</td><td><code><pre>                if err == nil {</pre></code></td></tr><tr class="miss"><td>438</td><td><code><pre>                        err = e</pre></code></td></tr><tr><td>439</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>440</td><td><code><pre>                return err</pre></code></td></tr><tr><td>441</td><td><code><pre>        case Failbackup:</pre></code></td></tr><tr class="miss"><td>442</td><td><code><pre>                ctx, cancelFn := context.WithCancel(ctx)</pre></code></td></tr><tr class="miss"><td>443</td><td><code><pre>                defer cancelFn()</pre></code></td></tr><tr class="miss"><td>444</td><td><code><pre>                call1 := make(chan *Call, 10)</pre></code></td></tr><tr class="miss"><td>445</td><td><code><pre>                call2 := make(chan *Call, 10)</pre></code></td></tr><tr><td>446</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>447</td><td><code><pre>                var reply1, reply2 interface{}</pre></code></td></tr><tr><td>448</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>449</td><td><code><pre>                if reply != nil {</pre></code></td></tr><tr class="miss"><td>450</td><td><code><pre>                        reply1 = reflect.New(reflect.ValueOf(reply).Elem().Type()).Interface()</pre></code></td></tr><tr class="miss"><td>451</td><td><code><pre>                        reply2 = reflect.New(reflect.ValueOf(reply).Elem().Type()).Interface()</pre></code></td></tr><tr><td>452</td><td><code><pre>                }</pre></code></td></tr><tr><td>453</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>454</td><td><code><pre>                _, err1 := c.Go(ctx, serviceMethod, args, reply1, call1)</pre></code></td></tr><tr><td>455</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>456</td><td><code><pre>                t := time.NewTimer(c.option.BackupLatency)</pre></code></td></tr><tr class="miss"><td>457</td><td><code><pre>                select {</pre></code></td></tr><tr><td>458</td><td><code><pre>                case &lt;-ctx.Done(): //cancel by context</pre></code></td></tr><tr class="miss"><td>459</td><td><code><pre>                        err = ctx.Err()</pre></code></td></tr><tr class="miss"><td>460</td><td><code><pre>                        return err</pre></code></td></tr><tr><td>461</td><td><code><pre>                case call := &lt;-call1:</pre></code></td></tr><tr class="miss"><td>462</td><td><code><pre>                        err = call.Error</pre></code></td></tr><tr class="miss"><td>463</td><td><code><pre>                        if err == nil &amp;&amp; reply != nil {</pre></code></td></tr><tr class="miss"><td>464</td><td><code><pre>                                reflect.ValueOf(reply).Elem().Set(reflect.ValueOf(reply1).Elem())</pre></code></td></tr><tr><td>465</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>466</td><td><code><pre>                        return err</pre></code></td></tr><tr><td>467</td><td><code><pre>                case &lt;-t.C:</pre></code></td></tr><tr><td>468</td><td><code><pre></pre></code></td></tr><tr><td>469</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>470</td><td><code><pre>                _, err2 := c.Go(ctx, serviceMethod, args, reply2, call2)</pre></code></td></tr><tr class="miss"><td>471</td><td><code><pre>                if err2 != nil {</pre></code></td></tr><tr class="miss"><td>472</td><td><code><pre>                        if _, ok := err.(ServiceError); !ok {</pre></code></td></tr><tr class="miss"><td>473</td><td><code><pre>                                c.removeClient(k, client)</pre></code></td></tr><tr><td>474</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>475</td><td><code><pre>                        err = err1</pre></code></td></tr><tr class="miss"><td>476</td><td><code><pre>                        return err</pre></code></td></tr><tr><td>477</td><td><code><pre>                }</pre></code></td></tr><tr><td>478</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>479</td><td><code><pre>                select {</pre></code></td></tr><tr><td>480</td><td><code><pre>                case &lt;-ctx.Done(): //cancel by context</pre></code></td></tr><tr class="miss"><td>481</td><td><code><pre>                        err = ctx.Err()</pre></code></td></tr><tr><td>482</td><td><code><pre>                case call := &lt;-call1:</pre></code></td></tr><tr class="miss"><td>483</td><td><code><pre>                        err = call.Error</pre></code></td></tr><tr class="miss"><td>484</td><td><code><pre>                        if err == nil &amp;&amp; reply != nil &amp;&amp; reply1 != nil {</pre></code></td></tr><tr class="miss"><td>485</td><td><code><pre>                                reflect.ValueOf(reply).Elem().Set(reflect.ValueOf(reply1).Elem())</pre></code></td></tr><tr><td>486</td><td><code><pre>                        }</pre></code></td></tr><tr><td>487</td><td><code><pre>                case call := &lt;-call2:</pre></code></td></tr><tr class="miss"><td>488</td><td><code><pre>                        err = call.Error</pre></code></td></tr><tr class="miss"><td>489</td><td><code><pre>                        if err == nil &amp;&amp; reply != nil &amp;&amp; reply2 != nil {</pre></code></td></tr><tr class="miss"><td>490</td><td><code><pre>                                reflect.ValueOf(reply).Elem().Set(reflect.ValueOf(reply2).Elem())</pre></code></td></tr><tr><td>491</td><td><code><pre>                        }</pre></code></td></tr><tr><td>492</td><td><code><pre>                }</pre></code></td></tr><tr><td>493</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>494</td><td><code><pre>                return err</pre></code></td></tr><tr><td>495</td><td><code><pre>        default: //Failfast</pre></code></td></tr><tr class="miss"><td>496</td><td><code><pre>                err = c.wrapCall(ctx, client, serviceMethod, args, reply)</pre></code></td></tr><tr class="miss"><td>497</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>498</td><td><code><pre>                        if _, ok := err.(ServiceError); !ok {</pre></code></td></tr><tr class="miss"><td>499</td><td><code><pre>                                c.removeClient(k, client)</pre></code></td></tr><tr><td>500</td><td><code><pre>                        }</pre></code></td></tr><tr><td>501</td><td><code><pre>                }</pre></code></td></tr><tr><td>502</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>503</td><td><code><pre>                return err</pre></code></td></tr><tr><td>504</td><td><code><pre>        }</pre></code></td></tr><tr><td>505</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.SendRaw">func Client.SendRaw</div><div class="info"><a href="#s_fn_Client.SendRaw">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>331</td><td><code><pre>func (client *Client) SendRaw(ctx context.Context, r *protocol.Message) (map[string]string, []byte, error) {</pre></code></td></tr><tr class="miss"><td>332</td><td><code><pre>        ctx = context.WithValue(ctx, seqKey{}, r.Seq())</pre></code></td></tr><tr><td>333</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>334</td><td><code><pre>        call := new(Call)</pre></code></td></tr><tr class="miss"><td>335</td><td><code><pre>        call.Raw = true</pre></code></td></tr><tr class="miss"><td>336</td><td><code><pre>        call.ServicePath = r.ServicePath</pre></code></td></tr><tr class="miss"><td>337</td><td><code><pre>        call.ServiceMethod = r.ServiceMethod</pre></code></td></tr><tr class="miss"><td>338</td><td><code><pre>        meta := ctx.Value(share.ReqMetaDataKey)</pre></code></td></tr><tr><td>339</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>340</td><td><code><pre>        rmeta := make(map[string]string)</pre></code></td></tr><tr class="miss"><td>341</td><td><code><pre>        if meta != nil {</pre></code></td></tr><tr class="miss"><td>342</td><td><code><pre>                for k, v := range meta.(map[string]string) {</pre></code></td></tr><tr class="miss"><td>343</td><td><code><pre>                        rmeta[k] = v</pre></code></td></tr><tr><td>344</td><td><code><pre>                }</pre></code></td></tr><tr><td>345</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>346</td><td><code><pre>        if r.Metadata != nil {</pre></code></td></tr><tr class="miss"><td>347</td><td><code><pre>                for k, v := range r.Metadata {</pre></code></td></tr><tr class="miss"><td>348</td><td><code><pre>                        rmeta[k] = v</pre></code></td></tr><tr><td>349</td><td><code><pre>                }</pre></code></td></tr><tr><td>350</td><td><code><pre>        }</pre></code></td></tr><tr><td>351</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>352</td><td><code><pre>        if meta != nil { //copy meta in context to meta in requests</pre></code></td></tr><tr class="miss"><td>353</td><td><code><pre>                call.Metadata = rmeta</pre></code></td></tr><tr><td>354</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>355</td><td><code><pre>        done := make(chan *Call, 10)</pre></code></td></tr><tr class="miss"><td>356</td><td><code><pre>        call.Done = done</pre></code></td></tr><tr><td>357</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>358</td><td><code><pre>        seq := r.Seq()</pre></code></td></tr><tr class="miss"><td>359</td><td><code><pre>        client.mutex.Lock()</pre></code></td></tr><tr class="miss"><td>360</td><td><code><pre>        if client.pending == nil {</pre></code></td></tr><tr class="miss"><td>361</td><td><code><pre>                client.pending = make(map[uint64]*Call)</pre></code></td></tr><tr><td>362</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>363</td><td><code><pre>        client.pending[seq] = call</pre></code></td></tr><tr class="miss"><td>364</td><td><code><pre>        client.mutex.Unlock()</pre></code></td></tr><tr><td>365</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>366</td><td><code><pre>        data := r.Encode()</pre></code></td></tr><tr class="miss"><td>367</td><td><code><pre>        _, err := client.Conn.Write(data)</pre></code></td></tr><tr class="miss"><td>368</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>369</td><td><code><pre>                client.mutex.Lock()</pre></code></td></tr><tr class="miss"><td>370</td><td><code><pre>                call = client.pending[seq]</pre></code></td></tr><tr class="miss"><td>371</td><td><code><pre>                delete(client.pending, seq)</pre></code></td></tr><tr class="miss"><td>372</td><td><code><pre>                client.mutex.Unlock()</pre></code></td></tr><tr class="miss"><td>373</td><td><code><pre>                if call != nil {</pre></code></td></tr><tr class="miss"><td>374</td><td><code><pre>                        call.Error = err</pre></code></td></tr><tr class="miss"><td>375</td><td><code><pre>                        call.done()</pre></code></td></tr><tr><td>376</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>377</td><td><code><pre>                return nil, nil, err</pre></code></td></tr><tr><td>378</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>379</td><td><code><pre>        if r.IsOneway() {</pre></code></td></tr><tr class="miss"><td>380</td><td><code><pre>                client.mutex.Lock()</pre></code></td></tr><tr class="miss"><td>381</td><td><code><pre>                call = client.pending[seq]</pre></code></td></tr><tr class="miss"><td>382</td><td><code><pre>                delete(client.pending, seq)</pre></code></td></tr><tr class="miss"><td>383</td><td><code><pre>                client.mutex.Unlock()</pre></code></td></tr><tr class="miss"><td>384</td><td><code><pre>                if call != nil {</pre></code></td></tr><tr class="miss"><td>385</td><td><code><pre>                        call.done()</pre></code></td></tr><tr><td>386</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>387</td><td><code><pre>                return nil, nil, nil</pre></code></td></tr><tr><td>388</td><td><code><pre>        }</pre></code></td></tr><tr><td>389</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>390</td><td><code><pre>        var m map[string]string</pre></code></td></tr><tr class="miss"><td>391</td><td><code><pre>        var payload []byte</pre></code></td></tr><tr><td>392</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>393</td><td><code><pre>        select {</pre></code></td></tr><tr><td>394</td><td><code><pre>        case &lt;-ctx.Done(): //cancel by context</pre></code></td></tr><tr class="miss"><td>395</td><td><code><pre>                client.mutex.Lock()</pre></code></td></tr><tr class="miss"><td>396</td><td><code><pre>                call := client.pending[seq]</pre></code></td></tr><tr class="miss"><td>397</td><td><code><pre>                delete(client.pending, seq)</pre></code></td></tr><tr class="miss"><td>398</td><td><code><pre>                client.mutex.Unlock()</pre></code></td></tr><tr class="miss"><td>399</td><td><code><pre>                if call != nil {</pre></code></td></tr><tr class="miss"><td>400</td><td><code><pre>                        call.Error = ctx.Err()</pre></code></td></tr><tr class="miss"><td>401</td><td><code><pre>                        call.done()</pre></code></td></tr><tr><td>402</td><td><code><pre>                }</pre></code></td></tr><tr><td>403</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>404</td><td><code><pre>                return nil, nil, ctx.Err()</pre></code></td></tr><tr><td>405</td><td><code><pre>        case call := &lt;-done:</pre></code></td></tr><tr class="miss"><td>406</td><td><code><pre>                err = call.Error</pre></code></td></tr><tr class="miss"><td>407</td><td><code><pre>                m = call.Metadata</pre></code></td></tr><tr class="miss"><td>408</td><td><code><pre>                if call.Reply != nil {</pre></code></td></tr><tr class="miss"><td>409</td><td><code><pre>                        payload = call.Reply.([]byte)</pre></code></td></tr><tr><td>410</td><td><code><pre>                }</pre></code></td></tr><tr><td>411</td><td><code><pre>        }</pre></code></td></tr><tr><td>412</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>413</td><td><code><pre>        return m, payload, err</pre></code></td></tr><tr><td>414</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.SendRaw">func xClient.SendRaw</div><div class="info"><a href="#s_fn_xClient.SendRaw">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>507</td><td><code><pre>func (c *xClient) SendRaw(ctx context.Context, r *protocol.Message) (map[string]string, []byte, error) {</pre></code></td></tr><tr class="miss"><td>508</td><td><code><pre>        if c.isShutdown {</pre></code></td></tr><tr class="miss"><td>509</td><td><code><pre>                return nil, nil, ErrXClientShutdown</pre></code></td></tr><tr><td>510</td><td><code><pre>        }</pre></code></td></tr><tr><td>511</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>512</td><td><code><pre>        if c.auth != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>513</td><td><code><pre>                metadata := ctx.Value(share.ReqMetaDataKey)</pre></code></td></tr><tr class="miss"><td>514</td><td><code><pre>                if metadata == nil {</pre></code></td></tr><tr class="miss"><td>515</td><td><code><pre>                        metadata = map[string]string{}</pre></code></td></tr><tr class="miss"><td>516</td><td><code><pre>                        ctx = context.WithValue(ctx, share.ReqMetaDataKey, metadata)</pre></code></td></tr><tr><td>517</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>518</td><td><code><pre>                m := metadata.(map[string]string)</pre></code></td></tr><tr class="miss"><td>519</td><td><code><pre>                m[share.AuthKey] = c.auth</pre></code></td></tr><tr><td>520</td><td><code><pre>        }</pre></code></td></tr><tr><td>521</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>522</td><td><code><pre>        var err error</pre></code></td></tr><tr class="miss"><td>523</td><td><code><pre>        k, client, err := c.selectClient(ctx, r.ServicePath, r.ServiceMethod, r.Payload)</pre></code></td></tr><tr><td>524</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>525</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>526</td><td><code><pre>                if c.failMode == Failfast {</pre></code></td></tr><tr class="miss"><td>527</td><td><code><pre>                        return nil, nil, err</pre></code></td></tr><tr><td>528</td><td><code><pre>                }</pre></code></td></tr><tr><td>529</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>530</td><td><code><pre>                if _, ok := err.(ServiceError); ok {</pre></code></td></tr><tr class="miss"><td>531</td><td><code><pre>                        return nil, nil, err</pre></code></td></tr><tr><td>532</td><td><code><pre>                }</pre></code></td></tr><tr><td>533</td><td><code><pre>        }</pre></code></td></tr><tr><td>534</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>535</td><td><code><pre>        var e error</pre></code></td></tr><tr class="miss"><td>536</td><td><code><pre>        switch c.failMode {</pre></code></td></tr><tr><td>537</td><td><code><pre>        case Failtry:</pre></code></td></tr><tr class="miss"><td>538</td><td><code><pre>                retries := c.option.Retries</pre></code></td></tr><tr class="miss"><td>539</td><td><code><pre>                for retries &gt; 0 {</pre></code></td></tr><tr class="miss"><td>540</td><td><code><pre>                        retries--</pre></code></td></tr><tr class="miss"><td>541</td><td><code><pre>                        if client != nil {</pre></code></td></tr><tr class="miss"><td>542</td><td><code><pre>                                m, payload, err := client.SendRaw(ctx, r)</pre></code></td></tr><tr class="miss"><td>543</td><td><code><pre>                                if err == nil {</pre></code></td></tr><tr class="miss"><td>544</td><td><code><pre>                                        return m, payload, nil</pre></code></td></tr><tr><td>545</td><td><code><pre>                                }</pre></code></td></tr><tr class="miss"><td>546</td><td><code><pre>                                if _, ok := err.(ServiceError); ok {</pre></code></td></tr><tr class="miss"><td>547</td><td><code><pre>                                        return nil, nil, err</pre></code></td></tr><tr><td>548</td><td><code><pre>                                }</pre></code></td></tr><tr><td>549</td><td><code><pre>                        }</pre></code></td></tr><tr><td>550</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>551</td><td><code><pre>                        c.removeClient(k, client)</pre></code></td></tr><tr class="miss"><td>552</td><td><code><pre>                        client, e = c.getCachedClient(k)</pre></code></td></tr><tr><td>553</td><td><code><pre>                }</pre></code></td></tr><tr><td>554</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>555</td><td><code><pre>                if err == nil {</pre></code></td></tr><tr class="miss"><td>556</td><td><code><pre>                        err = e</pre></code></td></tr><tr><td>557</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>558</td><td><code><pre>                return nil, nil, err</pre></code></td></tr><tr><td>559</td><td><code><pre>        case Failover:</pre></code></td></tr><tr class="miss"><td>560</td><td><code><pre>                retries := c.option.Retries</pre></code></td></tr><tr class="miss"><td>561</td><td><code><pre>                for retries &gt; 0 {</pre></code></td></tr><tr class="miss"><td>562</td><td><code><pre>                        retries--</pre></code></td></tr><tr class="miss"><td>563</td><td><code><pre>                        if client != nil {</pre></code></td></tr><tr class="miss"><td>564</td><td><code><pre>                                m, payload, err := client.SendRaw(ctx, r)</pre></code></td></tr><tr class="miss"><td>565</td><td><code><pre>                                if err == nil {</pre></code></td></tr><tr class="miss"><td>566</td><td><code><pre>                                        return m, payload, nil</pre></code></td></tr><tr><td>567</td><td><code><pre>                                }</pre></code></td></tr><tr class="miss"><td>568</td><td><code><pre>                                if _, ok := err.(ServiceError); ok {</pre></code></td></tr><tr class="miss"><td>569</td><td><code><pre>                                        return nil, nil, err</pre></code></td></tr><tr><td>570</td><td><code><pre>                                }</pre></code></td></tr><tr><td>571</td><td><code><pre>                        }</pre></code></td></tr><tr><td>572</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>573</td><td><code><pre>                        c.removeClient(k, client)</pre></code></td></tr><tr><td>574</td><td><code><pre>                        //select another server</pre></code></td></tr><tr class="miss"><td>575</td><td><code><pre>                        k, client, e = c.selectClient(ctx, r.ServicePath, r.ServiceMethod, r.Payload)</pre></code></td></tr><tr><td>576</td><td><code><pre>                }</pre></code></td></tr><tr><td>577</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>578</td><td><code><pre>                if err == nil {</pre></code></td></tr><tr class="miss"><td>579</td><td><code><pre>                        err = e</pre></code></td></tr><tr><td>580</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>581</td><td><code><pre>                return nil, nil, err</pre></code></td></tr><tr><td>582</td><td><code><pre></pre></code></td></tr><tr><td>583</td><td><code><pre>        default: //Failfast</pre></code></td></tr><tr class="miss"><td>584</td><td><code><pre>                m, payload, err := client.SendRaw(ctx, r)</pre></code></td></tr><tr><td>585</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>586</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>587</td><td><code><pre>                        if _, ok := err.(ServiceError); !ok {</pre></code></td></tr><tr class="miss"><td>588</td><td><code><pre>                                c.removeClient(k, client)</pre></code></td></tr><tr><td>589</td><td><code><pre>                        }</pre></code></td></tr><tr><td>590</td><td><code><pre>                }</pre></code></td></tr><tr><td>591</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>592</td><td><code><pre>                return m, payload, nil</pre></code></td></tr><tr><td>593</td><td><code><pre>        }</pre></code></td></tr><tr><td>594</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.Fork">func xClient.Fork</div><div class="info"><a href="#s_fn_xClient.Fork">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>680</td><td><code><pre>func (c *xClient) Fork(ctx context.Context, serviceMethod string, args interface{}, reply interface{}) error {</pre></code></td></tr><tr class="miss"><td>681</td><td><code><pre>        if c.isShutdown {</pre></code></td></tr><tr class="miss"><td>682</td><td><code><pre>                return ErrXClientShutdown</pre></code></td></tr><tr><td>683</td><td><code><pre>        }</pre></code></td></tr><tr><td>684</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>685</td><td><code><pre>        if c.auth != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>686</td><td><code><pre>                metadata := ctx.Value(share.ReqMetaDataKey)</pre></code></td></tr><tr class="miss"><td>687</td><td><code><pre>                if metadata == nil {</pre></code></td></tr><tr class="miss"><td>688</td><td><code><pre>                        metadata = map[string]string{}</pre></code></td></tr><tr class="miss"><td>689</td><td><code><pre>                        ctx = context.WithValue(ctx, share.ReqMetaDataKey, metadata)</pre></code></td></tr><tr><td>690</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>691</td><td><code><pre>                m := metadata.(map[string]string)</pre></code></td></tr><tr class="miss"><td>692</td><td><code><pre>                m[share.AuthKey] = c.auth</pre></code></td></tr><tr><td>693</td><td><code><pre>        }</pre></code></td></tr><tr><td>694</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>695</td><td><code><pre>        var clients = make(map[string]RPCClient)</pre></code></td></tr><tr class="miss"><td>696</td><td><code><pre>        c.mu.Lock()</pre></code></td></tr><tr class="miss"><td>697</td><td><code><pre>        for k := range c.servers {</pre></code></td></tr><tr class="miss"><td>698</td><td><code><pre>                client, err := c.getCachedClientWithoutLock(k)</pre></code></td></tr><tr class="miss"><td>699</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>700</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>701</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>702</td><td><code><pre>                clients[k] = client</pre></code></td></tr><tr><td>703</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>704</td><td><code><pre>        c.mu.Unlock()</pre></code></td></tr><tr><td>705</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>706</td><td><code><pre>        if len(clients) == 0 {</pre></code></td></tr><tr class="miss"><td>707</td><td><code><pre>                return ErrXClientNoServer</pre></code></td></tr><tr><td>708</td><td><code><pre>        }</pre></code></td></tr><tr><td>709</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>710</td><td><code><pre>        var err = &amp;ex.MultiError{}</pre></code></td></tr><tr class="miss"><td>711</td><td><code><pre>        l := len(clients)</pre></code></td></tr><tr class="miss"><td>712</td><td><code><pre>        done := make(chan bool, l)</pre></code></td></tr><tr class="miss"><td>713</td><td><code><pre>        for k, client := range clients {</pre></code></td></tr><tr class="miss"><td>714</td><td><code><pre>                k := k</pre></code></td></tr><tr class="miss"><td>715</td><td><code><pre>                client := client</pre></code></td></tr><tr class="miss"><td>716</td><td><code><pre>                go func() {</pre></code></td></tr><tr><td>717</td><td><code><pre>                        var clonedReply interface{}</pre></code></td></tr><tr><td>718</td><td><code><pre>                        if reply != nil {</pre></code></td></tr><tr><td>719</td><td><code><pre>                                clonedReply = reflect.New(reflect.ValueOf(reply).Elem().Type()).Interface()</pre></code></td></tr><tr><td>720</td><td><code><pre>                        }</pre></code></td></tr><tr><td>721</td><td><code><pre></pre></code></td></tr><tr><td>722</td><td><code><pre>                        e := c.wrapCall(ctx, client, serviceMethod, args, clonedReply)</pre></code></td></tr><tr><td>723</td><td><code><pre>                        if e == nil &amp;&amp; reply != nil &amp;&amp; clonedReply != nil {</pre></code></td></tr><tr><td>724</td><td><code><pre>                                reflect.ValueOf(reply).Elem().Set(reflect.ValueOf(clonedReply).Elem())</pre></code></td></tr><tr><td>725</td><td><code><pre>                        }</pre></code></td></tr><tr><td>726</td><td><code><pre>                        done &lt;- (e == nil)</pre></code></td></tr><tr><td>727</td><td><code><pre>                        if e != nil {</pre></code></td></tr><tr><td>728</td><td><code><pre>                                c.removeClient(k, client)</pre></code></td></tr><tr><td>729</td><td><code><pre>                                err.Append(e)</pre></code></td></tr><tr><td>730</td><td><code><pre>                        }</pre></code></td></tr><tr><td>731</td><td><code><pre></pre></code></td></tr><tr><td>732</td><td><code><pre>                }()</pre></code></td></tr><tr><td>733</td><td><code><pre>        }</pre></code></td></tr><tr><td>734</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>735</td><td><code><pre>        timeout := time.After(time.Minute)</pre></code></td></tr><tr class="miss"><td>736</td><td><code><pre>check:</pre></code></td></tr><tr><td>737</td><td><code><pre>        for {</pre></code></td></tr><tr class="miss"><td>738</td><td><code><pre>                select {</pre></code></td></tr><tr><td>739</td><td><code><pre>                case result := &lt;-done:</pre></code></td></tr><tr class="miss"><td>740</td><td><code><pre>                        l--</pre></code></td></tr><tr class="miss"><td>741</td><td><code><pre>                        if result {</pre></code></td></tr><tr class="miss"><td>742</td><td><code><pre>                                return nil</pre></code></td></tr><tr><td>743</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>744</td><td><code><pre>                        if l == 0 { // all returns or some one returns an error</pre></code></td></tr><tr class="miss"><td>745</td><td><code><pre>                                break check</pre></code></td></tr><tr><td>746</td><td><code><pre>                        }</pre></code></td></tr><tr><td>747</td><td><code><pre></pre></code></td></tr><tr><td>748</td><td><code><pre>                case &lt;-timeout:</pre></code></td></tr><tr class="miss"><td>749</td><td><code><pre>                        err.Append(errors.New((&#34;timeout&#34;)))</pre></code></td></tr><tr class="miss"><td>750</td><td><code><pre>                        break check</pre></code></td></tr><tr><td>751</td><td><code><pre>                }</pre></code></td></tr><tr><td>752</td><td><code><pre>        }</pre></code></td></tr><tr><td>753</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>754</td><td><code><pre>        if err.Error() == &#34;[]&#34; {</pre></code></td></tr><tr class="miss"><td>755</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>756</td><td><code><pre>        }</pre></code></td></tr><tr><td>757</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>758</td><td><code><pre>        return err</pre></code></td></tr><tr><td>759</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.SendFile">func xClient.SendFile</div><div class="info"><a href="#s_fn_xClient.SendFile">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>764</td><td><code><pre>func (c *xClient) SendFile(ctx context.Context, fileName string, rateInBytesPerSecond int64) error {</pre></code></td></tr><tr class="miss"><td>765</td><td><code><pre>        file, err := os.Open(fileName)</pre></code></td></tr><tr class="miss"><td>766</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>767</td><td><code><pre>                return err</pre></code></td></tr><tr><td>768</td><td><code><pre>        }</pre></code></td></tr><tr><td>769</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>770</td><td><code><pre>        fi, err := os.Stat(fileName)</pre></code></td></tr><tr class="miss"><td>771</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>772</td><td><code><pre>                return err</pre></code></td></tr><tr><td>773</td><td><code><pre>        }</pre></code></td></tr><tr><td>774</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>775</td><td><code><pre>        args := serverplugin.FileTransferArgs{</pre></code></td></tr><tr><td>776</td><td><code><pre>                FileName: fi.Name(),</pre></code></td></tr><tr><td>777</td><td><code><pre>                FileSize: fi.Size(),</pre></code></td></tr><tr><td>778</td><td><code><pre>        }</pre></code></td></tr><tr><td>779</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>780</td><td><code><pre>        reply := &amp;serverplugin.FileTransferReply{}</pre></code></td></tr><tr class="miss"><td>781</td><td><code><pre>        err = c.Call(ctx, &#34;TransferFile&#34;, args, reply)</pre></code></td></tr><tr class="miss"><td>782</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>783</td><td><code><pre>                return err</pre></code></td></tr><tr><td>784</td><td><code><pre>        }</pre></code></td></tr><tr><td>785</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>786</td><td><code><pre>        conn, err := net.DialTimeout(&#34;tcp&#34;, reply.Addr, c.option.ConnectTimeout)</pre></code></td></tr><tr class="miss"><td>787</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>788</td><td><code><pre>                return err</pre></code></td></tr><tr><td>789</td><td><code><pre>        }</pre></code></td></tr><tr><td>790</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>791</td><td><code><pre>        defer conn.Close()</pre></code></td></tr><tr><td>792</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>793</td><td><code><pre>        _, err = conn.Write(reply.Token)</pre></code></td></tr><tr class="miss"><td>794</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>795</td><td><code><pre>                return err</pre></code></td></tr><tr><td>796</td><td><code><pre>        }</pre></code></td></tr><tr><td>797</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>798</td><td><code><pre>        var tb *ratelimit.Bucket</pre></code></td></tr><tr><td>799</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>800</td><td><code><pre>        if rateInBytesPerSecond &gt; 0 {</pre></code></td></tr><tr class="miss"><td>801</td><td><code><pre>                tb = ratelimit.NewBucketWithRate(float64(rateInBytesPerSecond), rateInBytesPerSecond)</pre></code></td></tr><tr><td>802</td><td><code><pre>        }</pre></code></td></tr><tr><td>803</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>804</td><td><code><pre>        sendBuffer := make([]byte, FileTransferBufferSize)</pre></code></td></tr><tr class="miss"><td>805</td><td><code><pre>loop:</pre></code></td></tr><tr><td>806</td><td><code><pre>        for {</pre></code></td></tr><tr class="miss"><td>807</td><td><code><pre>                select {</pre></code></td></tr><tr><td>808</td><td><code><pre>                case &lt;-ctx.Done():</pre></code></td></tr><tr><td>809</td><td><code><pre>                default:</pre></code></td></tr><tr class="miss"><td>810</td><td><code><pre>                        if tb != nil {</pre></code></td></tr><tr class="miss"><td>811</td><td><code><pre>                                tb.Wait(FileTransferBufferSize)</pre></code></td></tr><tr><td>812</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>813</td><td><code><pre>                        n, err := file.Read(sendBuffer)</pre></code></td></tr><tr class="miss"><td>814</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>815</td><td><code><pre>                                if err == io.EOF {</pre></code></td></tr><tr class="miss"><td>816</td><td><code><pre>                                        return nil</pre></code></td></tr><tr><td>817</td><td><code><pre>                                } else {</pre></code></td></tr><tr class="miss"><td>818</td><td><code><pre>                                        return err</pre></code></td></tr><tr><td>819</td><td><code><pre>                                }</pre></code></td></tr><tr><td>820</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>821</td><td><code><pre>                        if n == 0 {</pre></code></td></tr><tr class="miss"><td>822</td><td><code><pre>                                break loop</pre></code></td></tr><tr><td>823</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>824</td><td><code><pre>                        _, err = conn.Write(sendBuffer)</pre></code></td></tr><tr class="miss"><td>825</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>826</td><td><code><pre>                                if err == io.EOF {</pre></code></td></tr><tr class="miss"><td>827</td><td><code><pre>                                        return nil</pre></code></td></tr><tr><td>828</td><td><code><pre>                                } else {</pre></code></td></tr><tr class="miss"><td>829</td><td><code><pre>                                        return err</pre></code></td></tr><tr><td>830</td><td><code><pre>                                }</pre></code></td></tr><tr><td>831</td><td><code><pre>                        }</pre></code></td></tr><tr><td>832</td><td><code><pre>                }</pre></code></td></tr><tr><td>833</td><td><code><pre>        }</pre></code></td></tr><tr><td>834</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>835</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>836</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.Broadcast">func xClient.Broadcast</div><div class="info"><a href="#s_fn_xClient.Broadcast">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>611</td><td><code><pre>func (c *xClient) Broadcast(ctx context.Context, serviceMethod string, args interface{}, reply interface{}) error {</pre></code></td></tr><tr class="miss"><td>612</td><td><code><pre>        if c.isShutdown {</pre></code></td></tr><tr class="miss"><td>613</td><td><code><pre>                return ErrXClientShutdown</pre></code></td></tr><tr><td>614</td><td><code><pre>        }</pre></code></td></tr><tr><td>615</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>616</td><td><code><pre>        if c.auth != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>617</td><td><code><pre>                metadata := ctx.Value(share.ReqMetaDataKey)</pre></code></td></tr><tr class="miss"><td>618</td><td><code><pre>                if metadata == nil {</pre></code></td></tr><tr class="miss"><td>619</td><td><code><pre>                        metadata = map[string]string{}</pre></code></td></tr><tr class="miss"><td>620</td><td><code><pre>                        ctx = context.WithValue(ctx, share.ReqMetaDataKey, metadata)</pre></code></td></tr><tr><td>621</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>622</td><td><code><pre>                m := metadata.(map[string]string)</pre></code></td></tr><tr class="miss"><td>623</td><td><code><pre>                m[share.AuthKey] = c.auth</pre></code></td></tr><tr><td>624</td><td><code><pre>        }</pre></code></td></tr><tr><td>625</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>626</td><td><code><pre>        var clients = make(map[string]RPCClient)</pre></code></td></tr><tr class="miss"><td>627</td><td><code><pre>        c.mu.Lock()</pre></code></td></tr><tr class="miss"><td>628</td><td><code><pre>        for k := range c.servers {</pre></code></td></tr><tr class="miss"><td>629</td><td><code><pre>                client, err := c.getCachedClientWithoutLock(k)</pre></code></td></tr><tr class="miss"><td>630</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>631</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>632</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>633</td><td><code><pre>                clients[k] = client</pre></code></td></tr><tr><td>634</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>635</td><td><code><pre>        c.mu.Unlock()</pre></code></td></tr><tr><td>636</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>637</td><td><code><pre>        if len(clients) == 0 {</pre></code></td></tr><tr class="miss"><td>638</td><td><code><pre>                return ErrXClientNoServer</pre></code></td></tr><tr><td>639</td><td><code><pre>        }</pre></code></td></tr><tr><td>640</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>641</td><td><code><pre>        var err = &amp;ex.MultiError{}</pre></code></td></tr><tr class="miss"><td>642</td><td><code><pre>        l := len(clients)</pre></code></td></tr><tr class="miss"><td>643</td><td><code><pre>        done := make(chan bool, l)</pre></code></td></tr><tr class="miss"><td>644</td><td><code><pre>        for k, client := range clients {</pre></code></td></tr><tr class="miss"><td>645</td><td><code><pre>                k := k</pre></code></td></tr><tr class="miss"><td>646</td><td><code><pre>                client := client</pre></code></td></tr><tr class="miss"><td>647</td><td><code><pre>                go func() {</pre></code></td></tr><tr><td>648</td><td><code><pre>                        e := c.wrapCall(ctx, client, serviceMethod, args, reply)</pre></code></td></tr><tr><td>649</td><td><code><pre>                        done &lt;- (e == nil)</pre></code></td></tr><tr><td>650</td><td><code><pre>                        if e != nil {</pre></code></td></tr><tr><td>651</td><td><code><pre>                                c.removeClient(k, client)</pre></code></td></tr><tr><td>652</td><td><code><pre>                                err.Append(e)</pre></code></td></tr><tr><td>653</td><td><code><pre>                        }</pre></code></td></tr><tr><td>654</td><td><code><pre>                }()</pre></code></td></tr><tr><td>655</td><td><code><pre>        }</pre></code></td></tr><tr><td>656</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>657</td><td><code><pre>        timeout := time.After(time.Minute)</pre></code></td></tr><tr class="miss"><td>658</td><td><code><pre>check:</pre></code></td></tr><tr><td>659</td><td><code><pre>        for {</pre></code></td></tr><tr class="miss"><td>660</td><td><code><pre>                select {</pre></code></td></tr><tr><td>661</td><td><code><pre>                case result := &lt;-done:</pre></code></td></tr><tr class="miss"><td>662</td><td><code><pre>                        l--</pre></code></td></tr><tr class="miss"><td>663</td><td><code><pre>                        if l == 0 || !result { // all returns or some one returns an error</pre></code></td></tr><tr class="miss"><td>664</td><td><code><pre>                                break check</pre></code></td></tr><tr><td>665</td><td><code><pre>                        }</pre></code></td></tr><tr><td>666</td><td><code><pre>                case &lt;-timeout:</pre></code></td></tr><tr class="miss"><td>667</td><td><code><pre>                        err.Append(errors.New((&#34;timeout&#34;)))</pre></code></td></tr><tr class="miss"><td>668</td><td><code><pre>                        break check</pre></code></td></tr><tr><td>669</td><td><code><pre>                }</pre></code></td></tr><tr><td>670</td><td><code><pre>        }</pre></code></td></tr><tr><td>671</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>672</td><td><code><pre>        if err.Error() == &#34;[]&#34; {</pre></code></td></tr><tr class="miss"><td>673</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>674</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>675</td><td><code><pre>        return err</pre></code></td></tr><tr><td>676</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_inprocessClient.Call">func inprocessClient.Call</div><div class="info"><a href="#s_fn_inprocessClient.Call">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_client.go</code>:</p></div><table class="listing">
<tr><td>80</td><td><code><pre>func (client *inprocessClient) Call(ctx context.Context, servicePath, serviceMethod string, args interface{}, reply interface{}) (err error) {</pre></code></td></tr><tr class="miss"><td>81</td><td><code><pre>        defer func() {</pre></code></td></tr><tr><td>82</td><td><code><pre>                if e := recover(); e != nil {</pre></code></td></tr><tr><td>83</td><td><code><pre>                        var ok bool</pre></code></td></tr><tr><td>84</td><td><code><pre>                        if err, ok = e.(error); ok {</pre></code></td></tr><tr><td>85</td><td><code><pre>                                err = fmt.Errorf(&#34;failed to call %s.%s because of %v&#34;, servicePath, serviceMethod, err)</pre></code></td></tr><tr><td>86</td><td><code><pre>                        }</pre></code></td></tr><tr><td>87</td><td><code><pre>                }</pre></code></td></tr><tr><td>88</td><td><code><pre>        }()</pre></code></td></tr><tr><td>89</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>90</td><td><code><pre>        client.RLock()</pre></code></td></tr><tr class="miss"><td>91</td><td><code><pre>        service := client.services[servicePath]</pre></code></td></tr><tr class="miss"><td>92</td><td><code><pre>        client.RUnlock()</pre></code></td></tr><tr class="miss"><td>93</td><td><code><pre>        if service == nil {</pre></code></td></tr><tr class="miss"><td>94</td><td><code><pre>                return fmt.Errorf(&#34;service %s not found&#34;, servicePath)</pre></code></td></tr><tr><td>95</td><td><code><pre>        }</pre></code></td></tr><tr><td>96</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>97</td><td><code><pre>        key := servicePath + &#34;.&#34; + serviceMethod</pre></code></td></tr><tr class="miss"><td>98</td><td><code><pre>        client.mmu.RLock()</pre></code></td></tr><tr class="miss"><td>99</td><td><code><pre>        var mv = &amp;reflect.Value{}</pre></code></td></tr><tr class="miss"><td>100</td><td><code><pre>        mv = client.methods[key]</pre></code></td></tr><tr class="miss"><td>101</td><td><code><pre>        client.mmu.RUnlock()</pre></code></td></tr><tr><td>102</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>103</td><td><code><pre>        if mv == nil {</pre></code></td></tr><tr class="miss"><td>104</td><td><code><pre>                client.mmu.Lock()</pre></code></td></tr><tr class="miss"><td>105</td><td><code><pre>                mv = client.methods[key]</pre></code></td></tr><tr class="miss"><td>106</td><td><code><pre>                if mv == nil {</pre></code></td></tr><tr class="miss"><td>107</td><td><code><pre>                        v := reflect.ValueOf(service)</pre></code></td></tr><tr class="miss"><td>108</td><td><code><pre>                        t := v.MethodByName(serviceMethod)</pre></code></td></tr><tr class="miss"><td>109</td><td><code><pre>                        if t == (reflect.Value{}) {</pre></code></td></tr><tr class="miss"><td>110</td><td><code><pre>                                client.mmu.Unlock()</pre></code></td></tr><tr class="miss"><td>111</td><td><code><pre>                                return fmt.Errorf(&#34;method %s.%s not found&#34;, servicePath, serviceMethod)</pre></code></td></tr><tr><td>112</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>113</td><td><code><pre>                        mv = &amp;t</pre></code></td></tr><tr><td>114</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>115</td><td><code><pre>                client.mmu.Unlock()</pre></code></td></tr><tr><td>116</td><td><code><pre>        }</pre></code></td></tr><tr><td>117</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>118</td><td><code><pre>        argv := reflect.ValueOf(args)</pre></code></td></tr><tr class="miss"><td>119</td><td><code><pre>        replyv := reflect.ValueOf(reply)</pre></code></td></tr><tr><td>120</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>121</td><td><code><pre>        err = nil</pre></code></td></tr><tr class="miss"><td>122</td><td><code><pre>        returnValues := mv.Call([]reflect.Value{reflect.ValueOf(ctx), argv, replyv})</pre></code></td></tr><tr class="miss"><td>123</td><td><code><pre>        errInter := returnValues[0].Interface()</pre></code></td></tr><tr class="miss"><td>124</td><td><code><pre>        if errInter != nil {</pre></code></td></tr><tr class="miss"><td>125</td><td><code><pre>                err = errInter.(error)</pre></code></td></tr><tr><td>126</td><td><code><pre>        }</pre></code></td></tr><tr><td>127</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>128</td><td><code><pre>        return err</pre></code></td></tr><tr><td>129</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.DownloadFile">func xClient.DownloadFile</div><div class="info"><a href="#s_fn_xClient.DownloadFile">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>838</td><td><code><pre>func (c *xClient) DownloadFile(ctx context.Context, requestFileName string, saveTo io.Writer) error {</pre></code></td></tr><tr class="miss"><td>839</td><td><code><pre>        args := serverplugin.DownloadFileArgs{</pre></code></td></tr><tr><td>840</td><td><code><pre>                FileName: requestFileName,</pre></code></td></tr><tr><td>841</td><td><code><pre>        }</pre></code></td></tr><tr><td>842</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>843</td><td><code><pre>        reply := &amp;serverplugin.FileTransferReply{}</pre></code></td></tr><tr class="miss"><td>844</td><td><code><pre>        err := c.Call(ctx, &#34;DownloadFile&#34;, args, reply)</pre></code></td></tr><tr class="miss"><td>845</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>846</td><td><code><pre>                return err</pre></code></td></tr><tr><td>847</td><td><code><pre>        }</pre></code></td></tr><tr><td>848</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>849</td><td><code><pre>        conn, err := net.DialTimeout(&#34;tcp&#34;, reply.Addr, c.option.ConnectTimeout)</pre></code></td></tr><tr class="miss"><td>850</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>851</td><td><code><pre>                return err</pre></code></td></tr><tr><td>852</td><td><code><pre>        }</pre></code></td></tr><tr><td>853</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>854</td><td><code><pre>        defer conn.Close()</pre></code></td></tr><tr><td>855</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>856</td><td><code><pre>        _, err = conn.Write(reply.Token)</pre></code></td></tr><tr class="miss"><td>857</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>858</td><td><code><pre>                return err</pre></code></td></tr><tr><td>859</td><td><code><pre>        }</pre></code></td></tr><tr><td>860</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>861</td><td><code><pre>        buf := make([]byte, FileTransferBufferSize)</pre></code></td></tr><tr class="miss"><td>862</td><td><code><pre>        r := bufio.NewReader(conn)</pre></code></td></tr><tr class="miss"><td>863</td><td><code><pre>loop:</pre></code></td></tr><tr><td>864</td><td><code><pre>        for {</pre></code></td></tr><tr class="miss"><td>865</td><td><code><pre>                select {</pre></code></td></tr><tr><td>866</td><td><code><pre>                case &lt;-ctx.Done():</pre></code></td></tr><tr><td>867</td><td><code><pre>                default:</pre></code></td></tr><tr class="miss"><td>868</td><td><code><pre>                        n, er := r.Read(buf)</pre></code></td></tr><tr class="miss"><td>869</td><td><code><pre>                        if n &gt; 0 {</pre></code></td></tr><tr class="miss"><td>870</td><td><code><pre>                                _, ew := saveTo.Write(buf[0:n])</pre></code></td></tr><tr class="miss"><td>871</td><td><code><pre>                                if ew != nil {</pre></code></td></tr><tr class="miss"><td>872</td><td><code><pre>                                        err = ew</pre></code></td></tr><tr class="miss"><td>873</td><td><code><pre>                                        break loop</pre></code></td></tr><tr><td>874</td><td><code><pre>                                }</pre></code></td></tr><tr><td>875</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>876</td><td><code><pre>                        if er != nil {</pre></code></td></tr><tr class="miss"><td>877</td><td><code><pre>                                if er != io.EOF {</pre></code></td></tr><tr class="miss"><td>878</td><td><code><pre>                                        err = er</pre></code></td></tr><tr><td>879</td><td><code><pre>                                }</pre></code></td></tr><tr class="miss"><td>880</td><td><code><pre>                                break loop</pre></code></td></tr><tr><td>881</td><td><code><pre>                        }</pre></code></td></tr><tr><td>882</td><td><code><pre>                }</pre></code></td></tr><tr><td>883</td><td><code><pre></pre></code></td></tr><tr><td>884</td><td><code><pre>        }</pre></code></td></tr><tr><td>885</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>886</td><td><code><pre>        return err</pre></code></td></tr><tr><td>887</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newDirectHTTPConn">func newDirectHTTPConn</div><div class="info"><a href="#s_fn_newDirectHTTPConn">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/connection.go</code>:</p></div><table class="listing">
<tr><td>98</td><td><code><pre>func newDirectHTTPConn(c *Client, network, address string) (net.Conn, error) {</pre></code></td></tr><tr class="miss"><td>99</td><td><code><pre>        path := c.option.RPCPath</pre></code></td></tr><tr class="miss"><td>100</td><td><code><pre>        if path == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>101</td><td><code><pre>                path = share.DefaultRPCPath</pre></code></td></tr><tr><td>102</td><td><code><pre>        }</pre></code></td></tr><tr><td>103</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>104</td><td><code><pre>        var conn net.Conn</pre></code></td></tr><tr class="miss"><td>105</td><td><code><pre>        var tlsConn *tls.Conn</pre></code></td></tr><tr class="miss"><td>106</td><td><code><pre>        var err error</pre></code></td></tr><tr><td>107</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>108</td><td><code><pre>        if c != nil &amp;&amp; c.option.TLSConfig != nil {</pre></code></td></tr><tr class="miss"><td>109</td><td><code><pre>                dialer := &amp;net.Dialer{</pre></code></td></tr><tr><td>110</td><td><code><pre>                        Timeout: c.option.ConnectTimeout,</pre></code></td></tr><tr><td>111</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>112</td><td><code><pre>                tlsConn, err = tls.DialWithDialer(dialer, &#34;tcp&#34;, address, c.option.TLSConfig)</pre></code></td></tr><tr><td>113</td><td><code><pre>                //or conn:= tls.Client(netConn, &amp;config)</pre></code></td></tr><tr><td>114</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>115</td><td><code><pre>                conn = net.Conn(tlsConn)</pre></code></td></tr><tr><td>116</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>117</td><td><code><pre>                conn, err = net.DialTimeout(&#34;tcp&#34;, address, c.option.ConnectTimeout)</pre></code></td></tr><tr><td>118</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>119</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>120</td><td><code><pre>                log.Errorf(&#34;failed to dial server: %v&#34;, err)</pre></code></td></tr><tr class="miss"><td>121</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>122</td><td><code><pre>        }</pre></code></td></tr><tr><td>123</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>124</td><td><code><pre>        io.WriteString(conn, &#34;CONNECT &#34;+path+&#34; HTTP/1.0\n\n&#34;)</pre></code></td></tr><tr><td>125</td><td><code><pre></pre></code></td></tr><tr><td>126</td><td><code><pre>        // Require successful HTTP response</pre></code></td></tr><tr><td>127</td><td><code><pre>        // before switching to RPC protocol.</pre></code></td></tr><tr class="miss"><td>128</td><td><code><pre>        resp, err := http.ReadResponse(bufio.NewReader(conn), &amp;http.Request{Method: &#34;CONNECT&#34;})</pre></code></td></tr><tr class="miss"><td>129</td><td><code><pre>        if err == nil &amp;&amp; resp.Status == connected {</pre></code></td></tr><tr class="miss"><td>130</td><td><code><pre>                return conn, nil</pre></code></td></tr><tr><td>131</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>132</td><td><code><pre>        if err == nil {</pre></code></td></tr><tr class="miss"><td>133</td><td><code><pre>                log.Errorf(&#34;unexpected HTTP response: %v&#34;, err)</pre></code></td></tr><tr class="miss"><td>134</td><td><code><pre>                err = errors.New(&#34;unexpected HTTP response: &#34; + resp.Status)</pre></code></td></tr><tr><td>135</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>136</td><td><code><pre>        conn.Close()</pre></code></td></tr><tr class="miss"><td>137</td><td><code><pre>        return nil, &amp;net.OpError{</pre></code></td></tr><tr><td>138</td><td><code><pre>                Op:   &#34;dial-http&#34;,</pre></code></td></tr><tr><td>139</td><td><code><pre>                Net:  network + &#34; &#34; + address,</pre></code></td></tr><tr><td>140</td><td><code><pre>                Addr: nil,</pre></code></td></tr><tr><td>141</td><td><code><pre>                Err:  err,</pre></code></td></tr><tr><td>142</td><td><code><pre>        }</pre></code></td></tr><tr><td>143</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_getClosestServer">func getClosestServer</div><div class="info"><a href="#s_fn_getClosestServer">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/geo_utils.go</code>:</p></div><table class="listing">
<tr><td>9</td><td><code><pre>func getClosestServer(lat1, lon1 float64, servers map[string]string) []string {</pre></code></td></tr><tr class="miss"><td>10</td><td><code><pre>        var server []string</pre></code></td></tr><tr class="miss"><td>11</td><td><code><pre>        min := math.MaxFloat64</pre></code></td></tr><tr><td>12</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>13</td><td><code><pre>        for s, metadata := range servers {</pre></code></td></tr><tr class="miss"><td>14</td><td><code><pre>                if v, err := url.ParseQuery(metadata); err == nil {</pre></code></td></tr><tr class="miss"><td>15</td><td><code><pre>                        lat2Str := v.Get(&#34;latitude&#34;)</pre></code></td></tr><tr class="miss"><td>16</td><td><code><pre>                        lon2Str := v.Get(&#34;longitude&#34;)</pre></code></td></tr><tr><td>17</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>18</td><td><code><pre>                        if lat2Str == &#34;&#34; || lon2Str == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>19</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>20</td><td><code><pre>                        }</pre></code></td></tr><tr><td>21</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>22</td><td><code><pre>                        lat2, err := strconv.ParseFloat(lat2Str, 64)</pre></code></td></tr><tr class="miss"><td>23</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>24</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>25</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>26</td><td><code><pre>                        lon2, err := strconv.ParseFloat(lon2Str, 64)</pre></code></td></tr><tr class="miss"><td>27</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>28</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>29</td><td><code><pre>                        }</pre></code></td></tr><tr><td>30</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>31</td><td><code><pre>                        d := getDistanceFrom(lat1, lon1, lat2, lon2)</pre></code></td></tr><tr class="miss"><td>32</td><td><code><pre>                        if d &lt; min {</pre></code></td></tr><tr class="miss"><td>33</td><td><code><pre>                                server = []string{s}</pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>                                min = d</pre></code></td></tr><tr class="miss"><td>35</td><td><code><pre>                        } else if d == min {</pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>                                server = append(server, s)</pre></code></td></tr><tr><td>37</td><td><code><pre>                        }</pre></code></td></tr><tr><td>38</td><td><code><pre></pre></code></td></tr><tr><td>39</td><td><code><pre>                }</pre></code></td></tr><tr><td>40</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>41</td><td><code><pre>        return server</pre></code></td></tr><tr><td>42</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.getCachedClientWithoutLock">func xClient.getCachedClientWithoutLock</div><div class="info"><a href="#s_fn_xClient.getCachedClientWithoutLock">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>286</td><td><code><pre>func (c *xClient) getCachedClientWithoutLock(k string) (RPCClient, error) {</pre></code></td></tr><tr class="miss"><td>287</td><td><code><pre>        client := c.cachedClient[k]</pre></code></td></tr><tr class="miss"><td>288</td><td><code><pre>        if client != nil {</pre></code></td></tr><tr class="miss"><td>289</td><td><code><pre>                if !client.IsClosing() &amp;&amp; !client.IsShutdown() {</pre></code></td></tr><tr class="miss"><td>290</td><td><code><pre>                        return client, nil</pre></code></td></tr><tr><td>291</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>292</td><td><code><pre>                delete(c.cachedClient, k)</pre></code></td></tr><tr class="miss"><td>293</td><td><code><pre>                client.Close()</pre></code></td></tr><tr><td>294</td><td><code><pre>        }</pre></code></td></tr><tr><td>295</td><td><code><pre></pre></code></td></tr><tr><td>296</td><td><code><pre>        //double check</pre></code></td></tr><tr class="miss"><td>297</td><td><code><pre>        client = c.cachedClient[k]</pre></code></td></tr><tr class="miss"><td>298</td><td><code><pre>        if client == nil || client.IsShutdown() {</pre></code></td></tr><tr class="miss"><td>299</td><td><code><pre>                network, addr := splitNetworkAndAddress(k)</pre></code></td></tr><tr class="miss"><td>300</td><td><code><pre>                if network == &#34;inprocess&#34; {</pre></code></td></tr><tr class="miss"><td>301</td><td><code><pre>                        client = InprocessClient</pre></code></td></tr><tr><td>302</td><td><code><pre>                } else {</pre></code></td></tr><tr class="miss"><td>303</td><td><code><pre>                        client = &amp;Client{</pre></code></td></tr><tr><td>304</td><td><code><pre>                                option:  c.option,</pre></code></td></tr><tr><td>305</td><td><code><pre>                                Plugins: c.Plugins,</pre></code></td></tr><tr><td>306</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>307</td><td><code><pre>                        err := client.Connect(network, addr)</pre></code></td></tr><tr class="miss"><td>308</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>309</td><td><code><pre>                                return nil, err</pre></code></td></tr><tr><td>310</td><td><code><pre>                        }</pre></code></td></tr><tr><td>311</td><td><code><pre>                }</pre></code></td></tr><tr><td>312</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>313</td><td><code><pre>                client.RegisterServerMessageChan(c.serverMessageChan)</pre></code></td></tr><tr><td>314</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>315</td><td><code><pre>                c.cachedClient[k] = client</pre></code></td></tr><tr><td>316</td><td><code><pre>        }</pre></code></td></tr><tr><td>317</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>318</td><td><code><pre>        return client, nil</pre></code></td></tr><tr><td>319</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_inprocessClient.Go">func inprocessClient.Go</div><div class="info"><a href="#s_fn_inprocessClient.Go">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_client.go</code>:</p></div><table class="listing">
<tr><td>48</td><td><code><pre>func (client *inprocessClient) Go(ctx context.Context, servicePath, serviceMethod string, args interface{}, reply interface{}, done chan *Call) *Call {</pre></code></td></tr><tr class="miss"><td>49</td><td><code><pre>        call := new(Call)</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>        call.ServicePath = servicePath</pre></code></td></tr><tr class="miss"><td>51</td><td><code><pre>        call.ServiceMethod = serviceMethod</pre></code></td></tr><tr class="miss"><td>52</td><td><code><pre>        meta := ctx.Value(share.ReqMetaDataKey)</pre></code></td></tr><tr class="miss"><td>53</td><td><code><pre>        if meta != nil { //copy meta in context to meta in requests</pre></code></td></tr><tr class="miss"><td>54</td><td><code><pre>                call.Metadata = meta.(map[string]string)</pre></code></td></tr><tr><td>55</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>56</td><td><code><pre>        call.Args = args</pre></code></td></tr><tr class="miss"><td>57</td><td><code><pre>        call.Reply = reply</pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>        if done == nil {</pre></code></td></tr><tr class="miss"><td>59</td><td><code><pre>                done = make(chan *Call, 10) // buffered.</pre></code></td></tr><tr><td>60</td><td><code><pre>        } else {</pre></code></td></tr><tr><td>61</td><td><code><pre>                // If caller passes done != nil, it must arrange that</pre></code></td></tr><tr><td>62</td><td><code><pre>                // done has enough buffer for the number of simultaneous</pre></code></td></tr><tr><td>63</td><td><code><pre>                // RPCs that will be using that channel. If the channel</pre></code></td></tr><tr><td>64</td><td><code><pre>                // is totally unbuffered, it&#39;s best not to run at all.</pre></code></td></tr><tr class="miss"><td>65</td><td><code><pre>                if cap(done) == 0 {</pre></code></td></tr><tr class="miss"><td>66</td><td><code><pre>                        log.Panic(&#34;rpc: done channel is unbuffered&#34;)</pre></code></td></tr><tr><td>67</td><td><code><pre>                }</pre></code></td></tr><tr><td>68</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>69</td><td><code><pre>        call.Done = done</pre></code></td></tr><tr class="miss"><td>70</td><td><code><pre>        err := client.Call(ctx, servicePath, serviceMethod, args, reply)</pre></code></td></tr><tr class="miss"><td>71</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>72</td><td><code><pre>                call.Error = ServiceError(err.Error())</pre></code></td></tr><tr><td>73</td><td><code><pre></pre></code></td></tr><tr><td>74</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>75</td><td><code><pre>        call.done()</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>        return call</pre></code></td></tr><tr><td>77</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_convertRes2Raw">func convertRes2Raw</div><div class="info"><a href="#s_fn_convertRes2Raw">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>416</td><td><code><pre>func convertRes2Raw(res *protocol.Message) (map[string]string, []byte, error) {</pre></code></td></tr><tr class="miss"><td>417</td><td><code><pre>        m := make(map[string]string)</pre></code></td></tr><tr class="miss"><td>418</td><td><code><pre>        m[XVersion] = strconv.Itoa(int(res.Version()))</pre></code></td></tr><tr class="miss"><td>419</td><td><code><pre>        if res.IsHeartbeat() {</pre></code></td></tr><tr class="miss"><td>420</td><td><code><pre>                m[XHeartbeat] = &#34;true&#34;</pre></code></td></tr><tr><td>421</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>422</td><td><code><pre>        if res.IsOneway() {</pre></code></td></tr><tr class="miss"><td>423</td><td><code><pre>                m[XOneway] = &#34;true&#34;</pre></code></td></tr><tr><td>424</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>425</td><td><code><pre>        if res.MessageStatusType() == protocol.Error {</pre></code></td></tr><tr class="miss"><td>426</td><td><code><pre>                m[XMessageStatusType] = &#34;Error&#34;</pre></code></td></tr><tr><td>427</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>428</td><td><code><pre>                m[XMessageStatusType] = &#34;Normal&#34;</pre></code></td></tr><tr><td>429</td><td><code><pre>        }</pre></code></td></tr><tr><td>430</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>431</td><td><code><pre>        if res.CompressType() == protocol.Gzip {</pre></code></td></tr><tr class="miss"><td>432</td><td><code><pre>                m[&#34;Content-Encoding&#34;] = &#34;gzip&#34;</pre></code></td></tr><tr><td>433</td><td><code><pre>        }</pre></code></td></tr><tr><td>434</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>435</td><td><code><pre>        m[XMeta] = urlencode(res.Metadata)</pre></code></td></tr><tr class="miss"><td>436</td><td><code><pre>        m[XSerializeType] = strconv.Itoa(int(res.SerializeType()))</pre></code></td></tr><tr class="miss"><td>437</td><td><code><pre>        m[XMessageID] = strconv.FormatUint(res.Seq(), 10)</pre></code></td></tr><tr class="miss"><td>438</td><td><code><pre>        m[XServicePath] = res.ServicePath</pre></code></td></tr><tr class="miss"><td>439</td><td><code><pre>        m[XServiceMethod] = res.ServiceMethod</pre></code></td></tr><tr><td>440</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>441</td><td><code><pre>        return m, res.Payload, nil</pre></code></td></tr><tr><td>442</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MDNSDiscovery.browse">func MDNSDiscovery.browse</div><div class="info"><a href="#s_fn_MDNSDiscovery.browse">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/mdns_discovery.go</code>:</p></div><table class="listing">
<tr><td>127</td><td><code><pre>func (d *MDNSDiscovery) browse() ([]*KVPair, error) {</pre></code></td></tr><tr class="miss"><td>128</td><td><code><pre>        resolver, err := zeroconf.NewResolver(nil)</pre></code></td></tr><tr class="miss"><td>129</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>130</td><td><code><pre>                log.Warnf(&#34;Failed to initialize resolver: %v&#34;, err)</pre></code></td></tr><tr class="miss"><td>131</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>132</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>133</td><td><code><pre>        entries := make(chan *zeroconf.ServiceEntry)</pre></code></td></tr><tr><td>134</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>135</td><td><code><pre>        var totalServices []*KVPair</pre></code></td></tr><tr class="miss"><td>136</td><td><code><pre>        var services []*serviceMeta</pre></code></td></tr><tr><td>137</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>138</td><td><code><pre>        done := make(chan struct{})</pre></code></td></tr><tr class="miss"><td>139</td><td><code><pre>        go func(results &lt;-chan *zeroconf.ServiceEntry) {</pre></code></td></tr><tr><td>140</td><td><code><pre>                for entry := range entries {</pre></code></td></tr><tr><td>141</td><td><code><pre>                        s, _ := url.QueryUnescape(entry.Text[0])</pre></code></td></tr><tr><td>142</td><td><code><pre>                        err := json.Unmarshal([]byte(s), &amp;services)</pre></code></td></tr><tr><td>143</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr><td>144</td><td><code><pre>                                log.Warnf(&#34;Failed to browse: %v&#34;, err)</pre></code></td></tr><tr><td>145</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>146</td><td><code><pre>                        }</pre></code></td></tr><tr><td>147</td><td><code><pre></pre></code></td></tr><tr><td>148</td><td><code><pre>                        for _, sm := range services {</pre></code></td></tr><tr><td>149</td><td><code><pre>                                totalServices = append(totalServices, &amp;KVPair{</pre></code></td></tr><tr><td>150</td><td><code><pre>                                        Key:   sm.ServiceAddress,</pre></code></td></tr><tr><td>151</td><td><code><pre>                                        Value: sm.Meta,</pre></code></td></tr><tr><td>152</td><td><code><pre>                                })</pre></code></td></tr><tr><td>153</td><td><code><pre>                        }</pre></code></td></tr><tr><td>154</td><td><code><pre>                }</pre></code></td></tr><tr><td>155</td><td><code><pre></pre></code></td></tr><tr><td>156</td><td><code><pre>                close(done)</pre></code></td></tr><tr><td>157</td><td><code><pre>        }(entries)</pre></code></td></tr><tr><td>158</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>159</td><td><code><pre>        ctx, cancel := context.WithTimeout(context.Background(), d.Timeout)</pre></code></td></tr><tr class="miss"><td>160</td><td><code><pre>        defer cancel()</pre></code></td></tr><tr class="miss"><td>161</td><td><code><pre>        err = resolver.Browse(ctx, &#34;_rpcxservices&#34;, d.domain, entries)</pre></code></td></tr><tr class="miss"><td>162</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>163</td><td><code><pre>                log.Warnf(&#34;Failed to browse: %v&#34;, err)</pre></code></td></tr><tr><td>164</td><td><code><pre>        }</pre></code></td></tr><tr><td>165</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>166</td><td><code><pre>        &lt;-done</pre></code></td></tr><tr class="miss"><td>167</td><td><code><pre>        return totalServices, nil</pre></code></td></tr><tr><td>168</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_createGeoServer">func createGeoServer</div><div class="info"><a href="#s_fn_createGeoServer">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>207</td><td><code><pre>func createGeoServer(servers map[string]string) []*geoServer {</pre></code></td></tr><tr class="miss"><td>208</td><td><code><pre>        var geoServers = make([]*geoServer, 0, len(servers))</pre></code></td></tr><tr><td>209</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>210</td><td><code><pre>        for s, metadata := range servers {</pre></code></td></tr><tr class="miss"><td>211</td><td><code><pre>                if v, err := url.ParseQuery(metadata); err == nil {</pre></code></td></tr><tr class="miss"><td>212</td><td><code><pre>                        latStr := v.Get(&#34;latitude&#34;)</pre></code></td></tr><tr class="miss"><td>213</td><td><code><pre>                        lonStr := v.Get(&#34;longitude&#34;)</pre></code></td></tr><tr><td>214</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>215</td><td><code><pre>                        if latStr == &#34;&#34; || lonStr == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>216</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>217</td><td><code><pre>                        }</pre></code></td></tr><tr><td>218</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>219</td><td><code><pre>                        lat, err := strconv.ParseFloat(latStr, 64)</pre></code></td></tr><tr class="miss"><td>220</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>221</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>222</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>223</td><td><code><pre>                        lon, err := strconv.ParseFloat(lonStr, 64)</pre></code></td></tr><tr class="miss"><td>224</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>225</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>226</td><td><code><pre>                        }</pre></code></td></tr><tr><td>227</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>228</td><td><code><pre>                        geoServers = append(geoServers, &amp;geoServer{Server: s, Latitude: lat, Longitude: lon})</pre></code></td></tr><tr><td>229</td><td><code><pre></pre></code></td></tr><tr><td>230</td><td><code><pre>                }</pre></code></td></tr><tr><td>231</td><td><code><pre>        }</pre></code></td></tr><tr><td>232</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>233</td><td><code><pre>        return geoServers</pre></code></td></tr><tr><td>234</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_nextWeighted">func nextWeighted</div><div class="info"><a href="#s_fn_nextWeighted">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/smooth-weighted-round-robin.go</code>:</p></div><table class="listing">
<tr><td>19</td><td><code><pre>func nextWeighted(servers []*Weighted) (best *Weighted) {</pre></code></td></tr><tr class="miss"><td>20</td><td><code><pre>        total := 0</pre></code></td></tr><tr><td>21</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>22</td><td><code><pre>        for i := 0; i &lt; len(servers); i++ {</pre></code></td></tr><tr class="miss"><td>23</td><td><code><pre>                w := servers[i]</pre></code></td></tr><tr><td>24</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>25</td><td><code><pre>                if w == nil {</pre></code></td></tr><tr class="miss"><td>26</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>27</td><td><code><pre>                }</pre></code></td></tr><tr><td>28</td><td><code><pre>                //if w is down, continue</pre></code></td></tr><tr><td>29</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>30</td><td><code><pre>                w.CurrentWeight += w.EffectiveWeight</pre></code></td></tr><tr class="miss"><td>31</td><td><code><pre>                total += w.EffectiveWeight</pre></code></td></tr><tr class="miss"><td>32</td><td><code><pre>                if w.EffectiveWeight &lt; w.Weight {</pre></code></td></tr><tr class="miss"><td>33</td><td><code><pre>                        w.EffectiveWeight++</pre></code></td></tr><tr><td>34</td><td><code><pre>                }</pre></code></td></tr><tr><td>35</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>                if best == nil || w.CurrentWeight &gt; best.CurrentWeight {</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>                        best = w</pre></code></td></tr><tr><td>38</td><td><code><pre>                }</pre></code></td></tr><tr><td>39</td><td><code><pre></pre></code></td></tr><tr><td>40</td><td><code><pre>        }</pre></code></td></tr><tr><td>41</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>        if best == nil {</pre></code></td></tr><tr class="miss"><td>43</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>44</td><td><code><pre>        }</pre></code></td></tr><tr><td>45</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>        best.CurrentWeight -= total</pre></code></td></tr><tr class="miss"><td>47</td><td><code><pre>        return best</pre></code></td></tr><tr><td>48</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewBidirectionalXClient">func NewBidirectionalXClient</div><div class="info"><a href="#s_fn_NewBidirectionalXClient">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>129</td><td><code><pre>func NewBidirectionalXClient(servicePath string, failMode FailMode, selectMode SelectMode, discovery ServiceDiscovery, option Option, serverMessageChan chan&lt;- *protocol.Message) XClient {</pre></code></td></tr><tr class="miss"><td>130</td><td><code><pre>        client := &amp;xClient{</pre></code></td></tr><tr><td>131</td><td><code><pre>                failMode:          failMode,</pre></code></td></tr><tr><td>132</td><td><code><pre>                selectMode:        selectMode,</pre></code></td></tr><tr><td>133</td><td><code><pre>                discovery:         discovery,</pre></code></td></tr><tr><td>134</td><td><code><pre>                servicePath:       servicePath,</pre></code></td></tr><tr><td>135</td><td><code><pre>                cachedClient:      make(map[string]RPCClient),</pre></code></td></tr><tr><td>136</td><td><code><pre>                option:            option,</pre></code></td></tr><tr><td>137</td><td><code><pre>                serverMessageChan: serverMessageChan,</pre></code></td></tr><tr><td>138</td><td><code><pre>        }</pre></code></td></tr><tr><td>139</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>140</td><td><code><pre>        servers := make(map[string]string)</pre></code></td></tr><tr class="miss"><td>141</td><td><code><pre>        pairs := discovery.GetServices()</pre></code></td></tr><tr class="miss"><td>142</td><td><code><pre>        for _, p := range pairs {</pre></code></td></tr><tr class="miss"><td>143</td><td><code><pre>                servers[p.Key] = p.Value</pre></code></td></tr><tr><td>144</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>145</td><td><code><pre>        filterByStateAndGroup(client.option.Group, servers)</pre></code></td></tr><tr class="miss"><td>146</td><td><code><pre>        client.servers = servers</pre></code></td></tr><tr class="miss"><td>147</td><td><code><pre>        if selectMode != Closest &amp;&amp; selectMode != SelectByUser {</pre></code></td></tr><tr class="miss"><td>148</td><td><code><pre>                client.selector = newSelector(selectMode, servers)</pre></code></td></tr><tr><td>149</td><td><code><pre>        }</pre></code></td></tr><tr><td>150</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>151</td><td><code><pre>        client.Plugins = &amp;pluginContainer{}</pre></code></td></tr><tr><td>152</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>153</td><td><code><pre>        ch := client.discovery.WatchService()</pre></code></td></tr><tr class="miss"><td>154</td><td><code><pre>        if ch != nil {</pre></code></td></tr><tr class="miss"><td>155</td><td><code><pre>                client.ch = ch</pre></code></td></tr><tr class="miss"><td>156</td><td><code><pre>                go client.watch(ch)</pre></code></td></tr><tr><td>157</td><td><code><pre>        }</pre></code></td></tr><tr><td>158</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>159</td><td><code><pre>        return client</pre></code></td></tr><tr><td>160</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OneClient.SendRaw">func OneClient.SendRaw</div><div class="info"><a href="#s_fn_OneClient.SendRaw">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>187</td><td><code><pre>func (c *OneClient) SendRaw(ctx context.Context, r *protocol.Message) (map[string]string, []byte, error) {</pre></code></td></tr><tr class="miss"><td>188</td><td><code><pre>        servicePath := r.ServicePath</pre></code></td></tr><tr><td>189</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>190</td><td><code><pre>        c.mu.RLock()</pre></code></td></tr><tr class="miss"><td>191</td><td><code><pre>        xclient := c.xclients[servicePath]</pre></code></td></tr><tr class="miss"><td>192</td><td><code><pre>        c.mu.RUnlock()</pre></code></td></tr><tr><td>193</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>194</td><td><code><pre>        if xclient == nil {</pre></code></td></tr><tr class="miss"><td>195</td><td><code><pre>                var err error</pre></code></td></tr><tr class="miss"><td>196</td><td><code><pre>                c.mu.Lock()</pre></code></td></tr><tr class="miss"><td>197</td><td><code><pre>                xclient = c.xclients[servicePath]</pre></code></td></tr><tr class="miss"><td>198</td><td><code><pre>                if xclient == nil {</pre></code></td></tr><tr class="miss"><td>199</td><td><code><pre>                        xclient, err = c.newXClient(servicePath)</pre></code></td></tr><tr class="miss"><td>200</td><td><code><pre>                        c.xclients[servicePath] = xclient</pre></code></td></tr><tr><td>201</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>202</td><td><code><pre>                c.mu.Unlock()</pre></code></td></tr><tr><td>203</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>204</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>205</td><td><code><pre>                        return nil, nil, err</pre></code></td></tr><tr><td>206</td><td><code><pre>                }</pre></code></td></tr><tr><td>207</td><td><code><pre>        }</pre></code></td></tr><tr><td>208</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>209</td><td><code><pre>        return xclient.SendRaw(ctx, r)</pre></code></td></tr><tr><td>210</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OneClient.Go">func OneClient.Go</div><div class="info"><a href="#s_fn_OneClient.Go">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>105</td><td><code><pre>func (c *OneClient) Go(ctx context.Context, servicePath string, serviceMethod string, args interface{}, reply interface{}, done chan *Call) (*Call, error) {</pre></code></td></tr><tr class="miss"><td>106</td><td><code><pre>        c.mu.RLock()</pre></code></td></tr><tr class="miss"><td>107</td><td><code><pre>        xclient := c.xclients[servicePath]</pre></code></td></tr><tr class="miss"><td>108</td><td><code><pre>        c.mu.RUnlock()</pre></code></td></tr><tr><td>109</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>110</td><td><code><pre>        if xclient == nil {</pre></code></td></tr><tr class="miss"><td>111</td><td><code><pre>                var err error</pre></code></td></tr><tr class="miss"><td>112</td><td><code><pre>                c.mu.Lock()</pre></code></td></tr><tr class="miss"><td>113</td><td><code><pre>                xclient = c.xclients[servicePath]</pre></code></td></tr><tr class="miss"><td>114</td><td><code><pre>                if xclient == nil {</pre></code></td></tr><tr class="miss"><td>115</td><td><code><pre>                        xclient, err = c.newXClient(servicePath)</pre></code></td></tr><tr class="miss"><td>116</td><td><code><pre>                        c.xclients[servicePath] = xclient</pre></code></td></tr><tr><td>117</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>118</td><td><code><pre>                c.mu.Unlock()</pre></code></td></tr><tr class="miss"><td>119</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>120</td><td><code><pre>                        return nil, err</pre></code></td></tr><tr><td>121</td><td><code><pre>                }</pre></code></td></tr><tr><td>122</td><td><code><pre>        }</pre></code></td></tr><tr><td>123</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>124</td><td><code><pre>        return xclient.Go(ctx, serviceMethod, args, reply, done)</pre></code></td></tr><tr><td>125</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_geoSelector.Select">func geoSelector.Select</div><div class="info"><a href="#s_fn_geoSelector.Select">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>178</td><td><code><pre>func (s geoSelector) Select(ctx context.Context, servicePath, serviceMethod string, args interface{}) string {</pre></code></td></tr><tr class="miss"><td>179</td><td><code><pre>        if len(s.servers) == 0 {</pre></code></td></tr><tr class="miss"><td>180</td><td><code><pre>                return &#34;&#34;</pre></code></td></tr><tr><td>181</td><td><code><pre>        }</pre></code></td></tr><tr><td>182</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>183</td><td><code><pre>        var server []string</pre></code></td></tr><tr class="miss"><td>184</td><td><code><pre>        min := math.MaxFloat64</pre></code></td></tr><tr class="miss"><td>185</td><td><code><pre>        for _, gs := range s.servers {</pre></code></td></tr><tr class="miss"><td>186</td><td><code><pre>                d := getDistanceFrom(s.Latitude, s.Longitude, gs.Latitude, gs.Longitude)</pre></code></td></tr><tr class="miss"><td>187</td><td><code><pre>                if d &lt; min {</pre></code></td></tr><tr class="miss"><td>188</td><td><code><pre>                        server = []string{gs.Server}</pre></code></td></tr><tr class="miss"><td>189</td><td><code><pre>                        min = d</pre></code></td></tr><tr class="miss"><td>190</td><td><code><pre>                } else if d == min {</pre></code></td></tr><tr class="miss"><td>191</td><td><code><pre>                        server = append(server, gs.Server)</pre></code></td></tr><tr><td>192</td><td><code><pre>                }</pre></code></td></tr><tr><td>193</td><td><code><pre>        }</pre></code></td></tr><tr><td>194</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>195</td><td><code><pre>        if len(server) == 1 {</pre></code></td></tr><tr class="miss"><td>196</td><td><code><pre>                return server[0]</pre></code></td></tr><tr><td>197</td><td><code><pre>        }</pre></code></td></tr><tr><td>198</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>199</td><td><code><pre>        return server[s.r.Intn(len(server))]</pre></code></td></tr><tr><td>200</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OneClient.Call">func OneClient.Call</div><div class="info"><a href="#s_fn_OneClient.Call">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>165</td><td><code><pre>func (c *OneClient) Call(ctx context.Context, servicePath string, serviceMethod string, args interface{}, reply interface{}) error {</pre></code></td></tr><tr class="miss"><td>166</td><td><code><pre>        c.mu.RLock()</pre></code></td></tr><tr class="miss"><td>167</td><td><code><pre>        xclient := c.xclients[servicePath]</pre></code></td></tr><tr class="miss"><td>168</td><td><code><pre>        c.mu.RUnlock()</pre></code></td></tr><tr><td>169</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>170</td><td><code><pre>        if xclient == nil {</pre></code></td></tr><tr class="miss"><td>171</td><td><code><pre>                var err error</pre></code></td></tr><tr class="miss"><td>172</td><td><code><pre>                c.mu.Lock()</pre></code></td></tr><tr class="miss"><td>173</td><td><code><pre>                xclient = c.xclients[servicePath]</pre></code></td></tr><tr class="miss"><td>174</td><td><code><pre>                if xclient == nil {</pre></code></td></tr><tr class="miss"><td>175</td><td><code><pre>                        xclient, err = c.newXClient(servicePath)</pre></code></td></tr><tr class="miss"><td>176</td><td><code><pre>                        c.xclients[servicePath] = xclient</pre></code></td></tr><tr><td>177</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>178</td><td><code><pre>                c.mu.Unlock()</pre></code></td></tr><tr class="miss"><td>179</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>180</td><td><code><pre>                        return err</pre></code></td></tr><tr><td>181</td><td><code><pre>                }</pre></code></td></tr><tr><td>182</td><td><code><pre>        }</pre></code></td></tr><tr><td>183</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>184</td><td><code><pre>        return xclient.Call(ctx, serviceMethod, args, reply)</pre></code></td></tr><tr><td>185</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OneClient.DownloadFile">func OneClient.DownloadFile</div><div class="info"><a href="#s_fn_OneClient.DownloadFile">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>283</td><td><code><pre>func (c *OneClient) DownloadFile(ctx context.Context, requestFileName string, saveTo io.Writer) error {</pre></code></td></tr><tr class="miss"><td>284</td><td><code><pre>        c.mu.RLock()</pre></code></td></tr><tr class="miss"><td>285</td><td><code><pre>        xclient := c.xclients[serverplugin.SendFileServiceName]</pre></code></td></tr><tr class="miss"><td>286</td><td><code><pre>        c.mu.RUnlock()</pre></code></td></tr><tr><td>287</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>288</td><td><code><pre>        if xclient == nil {</pre></code></td></tr><tr class="miss"><td>289</td><td><code><pre>                var err error</pre></code></td></tr><tr class="miss"><td>290</td><td><code><pre>                c.mu.Lock()</pre></code></td></tr><tr class="miss"><td>291</td><td><code><pre>                xclient = c.xclients[serverplugin.SendFileServiceName]</pre></code></td></tr><tr class="miss"><td>292</td><td><code><pre>                if xclient == nil {</pre></code></td></tr><tr class="miss"><td>293</td><td><code><pre>                        xclient, err = c.newXClient(serverplugin.SendFileServiceName)</pre></code></td></tr><tr class="miss"><td>294</td><td><code><pre>                        c.xclients[serverplugin.SendFileServiceName] = xclient</pre></code></td></tr><tr><td>295</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>296</td><td><code><pre>                c.mu.Unlock()</pre></code></td></tr><tr class="miss"><td>297</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>298</td><td><code><pre>                        return err</pre></code></td></tr><tr><td>299</td><td><code><pre>                }</pre></code></td></tr><tr><td>300</td><td><code><pre>        }</pre></code></td></tr><tr><td>301</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>302</td><td><code><pre>        return xclient.DownloadFile(ctx, requestFileName, saveTo)</pre></code></td></tr><tr><td>303</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OneClient.Fork">func OneClient.Fork</div><div class="info"><a href="#s_fn_OneClient.Fork">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>239</td><td><code><pre>func (c *OneClient) Fork(ctx context.Context, servicePath string, serviceMethod string, args interface{}, reply interface{}) error {</pre></code></td></tr><tr class="miss"><td>240</td><td><code><pre>        c.mu.RLock()</pre></code></td></tr><tr class="miss"><td>241</td><td><code><pre>        xclient := c.xclients[servicePath]</pre></code></td></tr><tr class="miss"><td>242</td><td><code><pre>        c.mu.RUnlock()</pre></code></td></tr><tr><td>243</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>244</td><td><code><pre>        if xclient == nil {</pre></code></td></tr><tr class="miss"><td>245</td><td><code><pre>                var err error</pre></code></td></tr><tr class="miss"><td>246</td><td><code><pre>                c.mu.Lock()</pre></code></td></tr><tr class="miss"><td>247</td><td><code><pre>                xclient = c.xclients[servicePath]</pre></code></td></tr><tr class="miss"><td>248</td><td><code><pre>                if xclient == nil {</pre></code></td></tr><tr class="miss"><td>249</td><td><code><pre>                        xclient, err = c.newXClient(servicePath)</pre></code></td></tr><tr class="miss"><td>250</td><td><code><pre>                        c.xclients[servicePath] = xclient</pre></code></td></tr><tr><td>251</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>252</td><td><code><pre>                c.mu.Unlock()</pre></code></td></tr><tr class="miss"><td>253</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>254</td><td><code><pre>                        return err</pre></code></td></tr><tr><td>255</td><td><code><pre>                }</pre></code></td></tr><tr><td>256</td><td><code><pre>        }</pre></code></td></tr><tr><td>257</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>258</td><td><code><pre>        return xclient.Fork(ctx, serviceMethod, args, reply)</pre></code></td></tr><tr><td>259</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OneClient.SendFile">func OneClient.SendFile</div><div class="info"><a href="#s_fn_OneClient.SendFile">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>261</td><td><code><pre>func (c *OneClient) SendFile(ctx context.Context, fileName string, rateInBytesPerSecond int64) error {</pre></code></td></tr><tr class="miss"><td>262</td><td><code><pre>        c.mu.RLock()</pre></code></td></tr><tr class="miss"><td>263</td><td><code><pre>        xclient := c.xclients[serverplugin.SendFileServiceName]</pre></code></td></tr><tr class="miss"><td>264</td><td><code><pre>        c.mu.RUnlock()</pre></code></td></tr><tr><td>265</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>266</td><td><code><pre>        if xclient == nil {</pre></code></td></tr><tr class="miss"><td>267</td><td><code><pre>                var err error</pre></code></td></tr><tr class="miss"><td>268</td><td><code><pre>                c.mu.Lock()</pre></code></td></tr><tr class="miss"><td>269</td><td><code><pre>                xclient = c.xclients[serverplugin.SendFileServiceName]</pre></code></td></tr><tr class="miss"><td>270</td><td><code><pre>                if xclient == nil {</pre></code></td></tr><tr class="miss"><td>271</td><td><code><pre>                        xclient, err = c.newXClient(serverplugin.SendFileServiceName)</pre></code></td></tr><tr class="miss"><td>272</td><td><code><pre>                        c.xclients[serverplugin.SendFileServiceName] = xclient</pre></code></td></tr><tr><td>273</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>274</td><td><code><pre>                c.mu.Unlock()</pre></code></td></tr><tr class="miss"><td>275</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>276</td><td><code><pre>                        return err</pre></code></td></tr><tr><td>277</td><td><code><pre>                }</pre></code></td></tr><tr><td>278</td><td><code><pre>        }</pre></code></td></tr><tr><td>279</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>280</td><td><code><pre>        return xclient.SendFile(ctx, fileName, rateInBytesPerSecond)</pre></code></td></tr><tr><td>281</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OneClient.Broadcast">func OneClient.Broadcast</div><div class="info"><a href="#s_fn_OneClient.Broadcast">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>215</td><td><code><pre>func (c *OneClient) Broadcast(ctx context.Context, servicePath string, serviceMethod string, args interface{}, reply interface{}) error {</pre></code></td></tr><tr class="miss"><td>216</td><td><code><pre>        c.mu.RLock()</pre></code></td></tr><tr class="miss"><td>217</td><td><code><pre>        xclient := c.xclients[servicePath]</pre></code></td></tr><tr class="miss"><td>218</td><td><code><pre>        c.mu.RUnlock()</pre></code></td></tr><tr><td>219</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>220</td><td><code><pre>        if xclient == nil {</pre></code></td></tr><tr class="miss"><td>221</td><td><code><pre>                var err error</pre></code></td></tr><tr class="miss"><td>222</td><td><code><pre>                c.mu.Lock()</pre></code></td></tr><tr class="miss"><td>223</td><td><code><pre>                xclient = c.xclients[servicePath]</pre></code></td></tr><tr class="miss"><td>224</td><td><code><pre>                if xclient == nil {</pre></code></td></tr><tr class="miss"><td>225</td><td><code><pre>                        xclient, err = c.newXClient(servicePath)</pre></code></td></tr><tr class="miss"><td>226</td><td><code><pre>                        c.xclients[servicePath] = xclient</pre></code></td></tr><tr><td>227</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>228</td><td><code><pre>                c.mu.Unlock()</pre></code></td></tr><tr class="miss"><td>229</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>230</td><td><code><pre>                        return err</pre></code></td></tr><tr><td>231</td><td><code><pre>                }</pre></code></td></tr><tr><td>232</td><td><code><pre>        }</pre></code></td></tr><tr><td>233</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>234</td><td><code><pre>        return xclient.Broadcast(ctx, serviceMethod, args, reply)</pre></code></td></tr><tr><td>235</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OneClient.newXClient">func OneClient.newXClient</div><div class="info"><a href="#s_fn_OneClient.newXClient">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>127</td><td><code><pre>func (c *OneClient) newXClient(servicePath string) (xclient XClient, err error) {</pre></code></td></tr><tr class="miss"><td>128</td><td><code><pre>        defer func() {</pre></code></td></tr><tr><td>129</td><td><code><pre>                if r := recover(); r != nil {</pre></code></td></tr><tr><td>130</td><td><code><pre>                        if e, ok := r.(error); ok {</pre></code></td></tr><tr><td>131</td><td><code><pre>                                err = e</pre></code></td></tr><tr><td>132</td><td><code><pre>                        } else {</pre></code></td></tr><tr><td>133</td><td><code><pre>                                err = fmt.Errorf(&#34;%v&#34;, r)</pre></code></td></tr><tr><td>134</td><td><code><pre>                        }</pre></code></td></tr><tr><td>135</td><td><code><pre>                }</pre></code></td></tr><tr><td>136</td><td><code><pre>        }()</pre></code></td></tr><tr><td>137</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>138</td><td><code><pre>        if c.serverMessageChan == nil {</pre></code></td></tr><tr class="miss"><td>139</td><td><code><pre>                xclient = NewXClient(servicePath, c.failMode, c.selectMode, c.discovery.Clone(servicePath), c.option)</pre></code></td></tr><tr><td>140</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>141</td><td><code><pre>                xclient = NewBidirectionalXClient(servicePath, c.failMode, c.selectMode, c.discovery.Clone(servicePath), c.option, c.serverMessageChan)</pre></code></td></tr><tr><td>142</td><td><code><pre>        }</pre></code></td></tr><tr><td>143</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>144</td><td><code><pre>        if c.Plugins != nil {</pre></code></td></tr><tr class="miss"><td>145</td><td><code><pre>                xclient.SetPlugins(c.Plugins)</pre></code></td></tr><tr><td>146</td><td><code><pre>        }</pre></code></td></tr><tr><td>147</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>148</td><td><code><pre>        if s, ok := c.selectors[servicePath]; ok {</pre></code></td></tr><tr class="miss"><td>149</td><td><code><pre>                xclient.SetSelector(s)</pre></code></td></tr><tr><td>150</td><td><code><pre>        }</pre></code></td></tr><tr><td>151</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>152</td><td><code><pre>        if c.selectMode == Closest {</pre></code></td></tr><tr class="miss"><td>153</td><td><code><pre>                xclient.ConfigGeoSelector(c.latitude, c.longitude)</pre></code></td></tr><tr><td>154</td><td><code><pre>        }</pre></code></td></tr><tr><td>155</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>156</td><td><code><pre>        if c.auth != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>157</td><td><code><pre>                xclient.Auth(c.auth)</pre></code></td></tr><tr><td>158</td><td><code><pre>        }</pre></code></td></tr><tr><td>159</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>160</td><td><code><pre>        return xclient, err</pre></code></td></tr><tr><td>161</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.Go">func xClient.Go</div><div class="info"><a href="#s_fn_xClient.Go">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>346</td><td><code><pre>func (c *xClient) Go(ctx context.Context, serviceMethod string, args interface{}, reply interface{}, done chan *Call) (*Call, error) {</pre></code></td></tr><tr class="miss"><td>347</td><td><code><pre>        if c.isShutdown {</pre></code></td></tr><tr class="miss"><td>348</td><td><code><pre>                return nil, ErrXClientShutdown</pre></code></td></tr><tr><td>349</td><td><code><pre>        }</pre></code></td></tr><tr><td>350</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>351</td><td><code><pre>        if c.auth != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>352</td><td><code><pre>                metadata := ctx.Value(share.ReqMetaDataKey)</pre></code></td></tr><tr class="miss"><td>353</td><td><code><pre>                if metadata == nil {</pre></code></td></tr><tr class="miss"><td>354</td><td><code><pre>                        metadata = map[string]string{}</pre></code></td></tr><tr class="miss"><td>355</td><td><code><pre>                        ctx = context.WithValue(ctx, share.ReqMetaDataKey, metadata)</pre></code></td></tr><tr><td>356</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>357</td><td><code><pre>                m := metadata.(map[string]string)</pre></code></td></tr><tr class="miss"><td>358</td><td><code><pre>                m[share.AuthKey] = c.auth</pre></code></td></tr><tr><td>359</td><td><code><pre>        }</pre></code></td></tr><tr><td>360</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>361</td><td><code><pre>        _, client, err := c.selectClient(ctx, c.servicePath, serviceMethod, args)</pre></code></td></tr><tr class="miss"><td>362</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>363</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>364</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>365</td><td><code><pre>        return client.Go(ctx, c.servicePath, serviceMethod, args, reply, done), nil</pre></code></td></tr><tr><td>366</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MDNSDiscovery.watch">func MDNSDiscovery.watch</div><div class="info"><a href="#s_fn_MDNSDiscovery.watch">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/mdns_discovery.go</code>:</p></div><table class="listing">
<tr><td>94</td><td><code><pre>func (d *MDNSDiscovery) watch() {</pre></code></td></tr><tr class="miss"><td>95</td><td><code><pre>        t := time.NewTicker(d.WatchInterval)</pre></code></td></tr><tr><td>96</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>97</td><td><code><pre>        for {</pre></code></td></tr><tr class="miss"><td>98</td><td><code><pre>                select {</pre></code></td></tr><tr><td>99</td><td><code><pre>                case &lt;-d.stopCh:</pre></code></td></tr><tr class="miss"><td>100</td><td><code><pre>                        t.Stop()</pre></code></td></tr><tr class="miss"><td>101</td><td><code><pre>                        log.Info(&#34;discovery has been closed&#34;)</pre></code></td></tr><tr class="miss"><td>102</td><td><code><pre>                        return</pre></code></td></tr><tr><td>103</td><td><code><pre>                case &lt;-t.C:</pre></code></td></tr><tr class="miss"><td>104</td><td><code><pre>                        pairs, err := d.browse()</pre></code></td></tr><tr class="miss"><td>105</td><td><code><pre>                        if err == nil {</pre></code></td></tr><tr class="miss"><td>106</td><td><code><pre>                                d.pairs = pairs</pre></code></td></tr><tr class="miss"><td>107</td><td><code><pre>                                for _, ch := range d.chans {</pre></code></td></tr><tr class="miss"><td>108</td><td><code><pre>                                        ch := ch</pre></code></td></tr><tr class="miss"><td>109</td><td><code><pre>                                        go func() {</pre></code></td></tr><tr><td>110</td><td><code><pre>                                                defer func() {</pre></code></td></tr><tr><td>111</td><td><code><pre>                                                        if r := recover(); r != nil {</pre></code></td></tr><tr><td>112</td><td><code><pre></pre></code></td></tr><tr><td>113</td><td><code><pre>                                                        }</pre></code></td></tr><tr><td>114</td><td><code><pre>                                                }()</pre></code></td></tr><tr><td>115</td><td><code><pre>                                                select {</pre></code></td></tr><tr><td>116</td><td><code><pre>                                                case ch &lt;- pairs:</pre></code></td></tr><tr><td>117</td><td><code><pre>                                                case &lt;-time.After(time.Minute):</pre></code></td></tr><tr><td>118</td><td><code><pre>                                                        log.Warn(&#34;chan is full and new change has ben dropped&#34;)</pre></code></td></tr><tr><td>119</td><td><code><pre>                                                }</pre></code></td></tr><tr><td>120</td><td><code><pre>                                        }()</pre></code></td></tr><tr><td>121</td><td><code><pre>                                }</pre></code></td></tr><tr><td>122</td><td><code><pre>                        }</pre></code></td></tr><tr><td>123</td><td><code><pre>                }</pre></code></td></tr><tr><td>124</td><td><code><pre>        }</pre></code></td></tr><tr><td>125</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OpenTracingPlugin.DoPreCall">func OpenTracingPlugin.DoPreCall</div><div class="info"><a href="#s_fn_OpenTracingPlugin.DoPreCall">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/opentracing.go</code>:</p></div><table class="listing">
<tr><td>13</td><td><code><pre>func (p *OpenTracingPlugin) DoPreCall(ctx context.Context, servicePath, serviceMethod string, args interface{}) error {</pre></code></td></tr><tr class="miss"><td>14</td><td><code><pre>        var span1 opentracing.Span</pre></code></td></tr><tr><td>15</td><td><code><pre></pre></code></td></tr><tr><td>16</td><td><code><pre>        // if it is called in rpc service in case that a service calls antoher service,</pre></code></td></tr><tr><td>17</td><td><code><pre>        // we uses the span in the service context as the parent span.</pre></code></td></tr><tr class="miss"><td>18</td><td><code><pre>        parentSpan := ctx.Value(share.OpentracingSpanServerKey)</pre></code></td></tr><tr class="miss"><td>19</td><td><code><pre>        if parentSpan != nil {</pre></code></td></tr><tr class="miss"><td>20</td><td><code><pre>                span1 = opentracing.StartSpan(</pre></code></td></tr><tr><td>21</td><td><code><pre>                        &#34;rpcx.client.&#34;+servicePath+&#34;.&#34;+serviceMethod,</pre></code></td></tr><tr><td>22</td><td><code><pre>                        opentracing.ChildOf(parentSpan.(opentracing.Span).Context()))</pre></code></td></tr><tr><td>23</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>24</td><td><code><pre>                wireContext, err := share.GetSpanContextFromContext(ctx)</pre></code></td></tr><tr class="miss"><td>25</td><td><code><pre>                if err == nil &amp;&amp; wireContext != nil { //try to parse span from request</pre></code></td></tr><tr class="miss"><td>26</td><td><code><pre>                        span1 = opentracing.StartSpan(</pre></code></td></tr><tr><td>27</td><td><code><pre>                                &#34;rpcx.client.&#34;+servicePath+&#34;.&#34;+serviceMethod,</pre></code></td></tr><tr><td>28</td><td><code><pre>                                ext.RPCServerOption(wireContext))</pre></code></td></tr><tr><td>29</td><td><code><pre>                } else { // parse span from context or create root context</pre></code></td></tr><tr class="miss"><td>30</td><td><code><pre>                        span1, _ = opentracing.StartSpanFromContext(ctx, &#34;rpcx.client.&#34;+servicePath+&#34;.&#34;+serviceMethod)</pre></code></td></tr><tr><td>31</td><td><code><pre>                }</pre></code></td></tr><tr><td>32</td><td><code><pre>        }</pre></code></td></tr><tr><td>33</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>        if rpcxContext, ok := ctx.(*share.Context); ok {</pre></code></td></tr><tr class="miss"><td>35</td><td><code><pre>                rpcxContext.SetValue(share.OpentracingSpanClientKey, span1)</pre></code></td></tr><tr><td>36</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>38</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_createWeighted">func createWeighted</div><div class="info"><a href="#s_fn_createWeighted">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>137</td><td><code><pre>func createWeighted(servers map[string]string) []*Weighted {</pre></code></td></tr><tr class="miss"><td>138</td><td><code><pre>        var ss = make([]*Weighted, 0, len(servers))</pre></code></td></tr><tr class="miss"><td>139</td><td><code><pre>        for k, metadata := range servers {</pre></code></td></tr><tr class="miss"><td>140</td><td><code><pre>                w := &amp;Weighted{Server: k, Weight: 1, EffectiveWeight: 1}</pre></code></td></tr><tr><td>141</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>142</td><td><code><pre>                if v, err := url.ParseQuery(metadata); err == nil {</pre></code></td></tr><tr class="miss"><td>143</td><td><code><pre>                        ww := v.Get(&#34;weight&#34;)</pre></code></td></tr><tr class="miss"><td>144</td><td><code><pre>                        if ww != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>145</td><td><code><pre>                                if weight, err := strconv.Atoi(ww); err == nil {</pre></code></td></tr><tr class="miss"><td>146</td><td><code><pre>                                        w.Weight = weight</pre></code></td></tr><tr class="miss"><td>147</td><td><code><pre>                                        w.EffectiveWeight = weight</pre></code></td></tr><tr><td>148</td><td><code><pre>                                }</pre></code></td></tr><tr><td>149</td><td><code><pre>                        }</pre></code></td></tr><tr><td>150</td><td><code><pre>                }</pre></code></td></tr><tr><td>151</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>152</td><td><code><pre>                ss = append(ss, w)</pre></code></td></tr><tr><td>153</td><td><code><pre>        }</pre></code></td></tr><tr><td>154</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>155</td><td><code><pre>        return ss</pre></code></td></tr><tr><td>156</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OpenCensusPlugin.DoPreCall">func OpenCensusPlugin.DoPreCall</div><div class="info"><a href="#s_fn_OpenCensusPlugin.DoPreCall">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/opencensus.go</code>:</p></div><table class="listing">
<tr><td>12</td><td><code><pre>func (p *OpenCensusPlugin) DoPreCall(ctx context.Context, servicePath, serviceMethod string, args interface{}) error {</pre></code></td></tr><tr class="miss"><td>13</td><td><code><pre>        var span1 *trace.Span</pre></code></td></tr><tr><td>14</td><td><code><pre></pre></code></td></tr><tr><td>15</td><td><code><pre>        // if it is called in rpc service in case that a service calls antoher service,</pre></code></td></tr><tr><td>16</td><td><code><pre>        // we uses the span in the service context as the parent span.</pre></code></td></tr><tr class="miss"><td>17</td><td><code><pre>        parentSpan := ctx.Value(share.OpencensusSpanServerKey)</pre></code></td></tr><tr class="miss"><td>18</td><td><code><pre>        if parentSpan != nil {</pre></code></td></tr><tr class="miss"><td>19</td><td><code><pre>                _, span1 = trace.StartSpanWithRemoteParent(ctx, &#34;rpcx.client.&#34;+servicePath+&#34;.&#34;+serviceMethod,</pre></code></td></tr><tr><td>20</td><td><code><pre>                        parentSpan.(*trace.Span).SpanContext())</pre></code></td></tr><tr><td>21</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>22</td><td><code><pre>                parentContext, err := share.GetOpencensusSpanContextFromContext(ctx)</pre></code></td></tr><tr class="miss"><td>23</td><td><code><pre>                if err == nil &amp;&amp; parentContext != nil { //try to parse span from request</pre></code></td></tr><tr class="miss"><td>24</td><td><code><pre>                        _, span1 = trace.StartSpanWithRemoteParent(ctx, &#34;rpcx.client.&#34;+servicePath+&#34;.&#34;+serviceMethod,</pre></code></td></tr><tr><td>25</td><td><code><pre>                                *parentContext)</pre></code></td></tr><tr><td>26</td><td><code><pre>                } else { // parse span from context or create root context</pre></code></td></tr><tr class="miss"><td>27</td><td><code><pre>                        _, span1 = trace.StartSpan(ctx, &#34;rpcx.client.&#34;+servicePath+&#34;.&#34;+serviceMethod)</pre></code></td></tr><tr><td>28</td><td><code><pre>                }</pre></code></td></tr><tr><td>29</td><td><code><pre>        }</pre></code></td></tr><tr><td>30</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>31</td><td><code><pre>        if rpcxContext, ok := ctx.(*share.Context); ok {</pre></code></td></tr><tr class="miss"><td>32</td><td><code><pre>                rpcxContext.SetValue(share.OpencensusSpanClientKey, span1)</pre></code></td></tr><tr><td>33</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>35</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@716:6">func @716:6</div><div class="info"><a href="#s_fn_@716:6">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>716</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>717</td><td><code><pre>                        var clonedReply interface{}</pre></code></td></tr><tr class="miss"><td>718</td><td><code><pre>                        if reply != nil {</pre></code></td></tr><tr class="miss"><td>719</td><td><code><pre>                                clonedReply = reflect.New(reflect.ValueOf(reply).Elem().Type()).Interface()</pre></code></td></tr><tr><td>720</td><td><code><pre>                        }</pre></code></td></tr><tr><td>721</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>722</td><td><code><pre>                        e := c.wrapCall(ctx, client, serviceMethod, args, clonedReply)</pre></code></td></tr><tr class="miss"><td>723</td><td><code><pre>                        if e == nil &amp;&amp; reply != nil &amp;&amp; clonedReply != nil {</pre></code></td></tr><tr class="miss"><td>724</td><td><code><pre>                                reflect.ValueOf(reply).Elem().Set(reflect.ValueOf(clonedReply).Elem())</pre></code></td></tr><tr><td>725</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>726</td><td><code><pre>                        done &lt;- (e == nil)</pre></code></td></tr><tr class="miss"><td>727</td><td><code><pre>                        if e != nil {</pre></code></td></tr><tr class="miss"><td>728</td><td><code><pre>                                c.removeClient(k, client)</pre></code></td></tr><tr class="miss"><td>729</td><td><code><pre>                                err.Append(e)</pre></code></td></tr><tr><td>730</td><td><code><pre>                        }</pre></code></td></tr><tr><td>731</td><td><code><pre></pre></code></td></tr><tr><td>732</td><td><code><pre>                }</pre></code></td></tr></table>

<div class="funcname" id="fn_urlencode">func urlencode</div><div class="info"><a href="#s_fn_urlencode">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>444</td><td><code><pre>func urlencode(data map[string]string) string {</pre></code></td></tr><tr class="miss"><td>445</td><td><code><pre>        if len(data) == 0 {</pre></code></td></tr><tr class="miss"><td>446</td><td><code><pre>                return &#34;&#34;</pre></code></td></tr><tr><td>447</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>448</td><td><code><pre>        var buf bytes.Buffer</pre></code></td></tr><tr class="miss"><td>449</td><td><code><pre>        for k, v := range data {</pre></code></td></tr><tr class="miss"><td>450</td><td><code><pre>                buf.WriteString(url.QueryEscape(k))</pre></code></td></tr><tr class="miss"><td>451</td><td><code><pre>                buf.WriteByte(&#39;=&#39;)</pre></code></td></tr><tr class="miss"><td>452</td><td><code><pre>                buf.WriteString(url.QueryEscape(v))</pre></code></td></tr><tr class="miss"><td>453</td><td><code><pre>                buf.WriteByte(&#39;&amp;&#39;)</pre></code></td></tr><tr><td>454</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>455</td><td><code><pre>        s := buf.String()</pre></code></td></tr><tr class="miss"><td>456</td><td><code><pre>        return s[0 : len(s)-1]</pre></code></td></tr><tr><td>457</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.watch">func xClient.watch</div><div class="info"><a href="#s_fn_xClient.watch">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>189</td><td><code><pre>func (c *xClient) watch(ch chan []*KVPair) {</pre></code></td></tr><tr class="miss"><td>190</td><td><code><pre>        for pairs := range ch {</pre></code></td></tr><tr class="miss"><td>191</td><td><code><pre>                servers := make(map[string]string)</pre></code></td></tr><tr class="miss"><td>192</td><td><code><pre>                for _, p := range pairs {</pre></code></td></tr><tr class="miss"><td>193</td><td><code><pre>                        servers[p.Key] = p.Value</pre></code></td></tr><tr><td>194</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>195</td><td><code><pre>                c.mu.Lock()</pre></code></td></tr><tr class="miss"><td>196</td><td><code><pre>                filterByStateAndGroup(c.option.Group, servers)</pre></code></td></tr><tr class="miss"><td>197</td><td><code><pre>                c.servers = servers</pre></code></td></tr><tr><td>198</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>199</td><td><code><pre>                if c.selector != nil {</pre></code></td></tr><tr class="miss"><td>200</td><td><code><pre>                        c.selector.UpdateServer(servers)</pre></code></td></tr><tr><td>201</td><td><code><pre>                }</pre></code></td></tr><tr><td>202</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>203</td><td><code><pre>                c.mu.Unlock()</pre></code></td></tr><tr><td>204</td><td><code><pre>        }</pre></code></td></tr><tr><td>205</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewMDNSDiscovery">func NewMDNSDiscovery</div><div class="info"><a href="#s_fn_NewMDNSDiscovery">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/mdns_discovery.go</code>:</p></div><table class="listing">
<tr><td>37</td><td><code><pre>func NewMDNSDiscovery(service string, timeout time.Duration, watchInterval time.Duration, domain string) ServiceDiscovery {</pre></code></td></tr><tr class="miss"><td>38</td><td><code><pre>        if domain == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>                domain = &#34;local.&#34;</pre></code></td></tr><tr><td>40</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>41</td><td><code><pre>        d := &amp;MDNSDiscovery{service: service, Timeout: timeout, WatchInterval: watchInterval, domain: domain}</pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>        d.stopCh = make(chan struct{})</pre></code></td></tr><tr><td>43</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>44</td><td><code><pre>        var err error</pre></code></td></tr><tr class="miss"><td>45</td><td><code><pre>        d.pairs, err = d.browse()</pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>47</td><td><code><pre>                log.Warnf(&#34;failed to browse services: %v&#34;, err)</pre></code></td></tr><tr><td>48</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>49</td><td><code><pre>        go d.watch()</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>        return d</pre></code></td></tr><tr><td>51</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_consistentHashSelector.UpdateServer">func consistentHashSelector.UpdateServer</div><div class="info"><a href="#s_fn_consistentHashSelector.UpdateServer">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>262</td><td><code><pre>func (s *consistentHashSelector) UpdateServer(servers map[string]string) {</pre></code></td></tr><tr class="miss"><td>263</td><td><code><pre>        var ss = make([]string, 0, len(servers))</pre></code></td></tr><tr class="miss"><td>264</td><td><code><pre>        for k := range servers {</pre></code></td></tr><tr class="miss"><td>265</td><td><code><pre>                s.h.Add(k)</pre></code></td></tr><tr class="miss"><td>266</td><td><code><pre>                ss = append(ss, k)</pre></code></td></tr><tr><td>267</td><td><code><pre>        }</pre></code></td></tr><tr><td>268</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>269</td><td><code><pre>        sort.Slice(ss, func(i, j int) bool { return ss[i] &lt; ss[j] })</pre></code></td></tr><tr><td>270</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>271</td><td><code><pre>        for _, k := range s.servers {</pre></code></td></tr><tr class="miss"><td>272</td><td><code><pre>                if servers[k] == &#34;&#34; { //remove</pre></code></td></tr><tr class="miss"><td>273</td><td><code><pre>                        s.h.Remove(k)</pre></code></td></tr><tr><td>274</td><td><code><pre>                }</pre></code></td></tr><tr><td>275</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>276</td><td><code><pre>        s.servers = ss</pre></code></td></tr><tr><td>277</td><td><code><pre></pre></code></td></tr><tr><td>278</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@139:5">func @139:5</div><div class="info"><a href="#s_fn_@139:5">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/mdns_discovery.go</code>:</p></div><table class="listing">
<tr><td>139</td><td><code><pre>func(results &lt;-chan *zeroconf.ServiceEntry) {</pre></code></td></tr><tr class="miss"><td>140</td><td><code><pre>                for entry := range entries {</pre></code></td></tr><tr class="miss"><td>141</td><td><code><pre>                        s, _ := url.QueryUnescape(entry.Text[0])</pre></code></td></tr><tr class="miss"><td>142</td><td><code><pre>                        err := json.Unmarshal([]byte(s), &amp;services)</pre></code></td></tr><tr class="miss"><td>143</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>144</td><td><code><pre>                                log.Warnf(&#34;Failed to browse: %v&#34;, err)</pre></code></td></tr><tr class="miss"><td>145</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>146</td><td><code><pre>                        }</pre></code></td></tr><tr><td>147</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>148</td><td><code><pre>                        for _, sm := range services {</pre></code></td></tr><tr class="miss"><td>149</td><td><code><pre>                                totalServices = append(totalServices, &amp;KVPair{</pre></code></td></tr><tr><td>150</td><td><code><pre>                                        Key:   sm.ServiceAddress,</pre></code></td></tr><tr><td>151</td><td><code><pre>                                        Value: sm.Meta,</pre></code></td></tr><tr><td>152</td><td><code><pre>                                })</pre></code></td></tr><tr><td>153</td><td><code><pre>                        }</pre></code></td></tr><tr><td>154</td><td><code><pre>                }</pre></code></td></tr><tr><td>155</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>156</td><td><code><pre>                close(done)</pre></code></td></tr><tr><td>157</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.heartbeat">func Client.heartbeat</div><div class="info"><a href="#s_fn_Client.heartbeat">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>705</td><td><code><pre>func (client *Client) heartbeat() {</pre></code></td></tr><tr class="miss"><td>706</td><td><code><pre>        t := time.NewTicker(client.option.HeartbeatInterval)</pre></code></td></tr><tr><td>707</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>708</td><td><code><pre>        for range t.C {</pre></code></td></tr><tr class="miss"><td>709</td><td><code><pre>                if client.shutdown || client.closing {</pre></code></td></tr><tr class="miss"><td>710</td><td><code><pre>                        t.Stop()</pre></code></td></tr><tr class="miss"><td>711</td><td><code><pre>                        return</pre></code></td></tr><tr><td>712</td><td><code><pre>                }</pre></code></td></tr><tr><td>713</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>714</td><td><code><pre>                err := client.Call(context.Background(), &#34;&#34;, &#34;&#34;, nil, nil)</pre></code></td></tr><tr class="miss"><td>715</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>716</td><td><code><pre>                        log.Warnf(&#34;failed to heartbeat to %s&#34;, client.Conn.RemoteAddr().String())</pre></code></td></tr><tr><td>717</td><td><code><pre>                }</pre></code></td></tr><tr><td>718</td><td><code><pre>        }</pre></code></td></tr><tr><td>719</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Hash">func Hash</div><div class="info"><a href="#s_fn_Hash">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/hash_utils.go</code>:</p></div><table class="listing">
<tr><td>9</td><td><code><pre>func Hash(key uint64, buckets int32) int32 {</pre></code></td></tr><tr class="miss"><td>10</td><td><code><pre>        if buckets &lt;= 0 {</pre></code></td></tr><tr class="miss"><td>11</td><td><code><pre>                buckets = 1</pre></code></td></tr><tr><td>12</td><td><code><pre>        }</pre></code></td></tr><tr><td>13</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>14</td><td><code><pre>        var b, j int64</pre></code></td></tr><tr><td>15</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>16</td><td><code><pre>        for j &lt; int64(buckets) {</pre></code></td></tr><tr class="miss"><td>17</td><td><code><pre>                b = j</pre></code></td></tr><tr class="miss"><td>18</td><td><code><pre>                key = key*2862933555777941757 + 1</pre></code></td></tr><tr class="miss"><td>19</td><td><code><pre>                j = int64(float64(b+1) * (float64(int64(1)&lt;&lt;31) / float64((key&gt;&gt;33)+1)))</pre></code></td></tr><tr><td>20</td><td><code><pre>        }</pre></code></td></tr><tr><td>21</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>22</td><td><code><pre>        return int32(b)</pre></code></td></tr><tr><td>23</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.removeClient">func xClient.removeClient</div><div class="info"><a href="#s_fn_xClient.removeClient">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>321</td><td><code><pre>func (c *xClient) removeClient(k string, client RPCClient) {</pre></code></td></tr><tr class="miss"><td>322</td><td><code><pre>        c.mu.Lock()</pre></code></td></tr><tr class="miss"><td>323</td><td><code><pre>        cl := c.cachedClient[k]</pre></code></td></tr><tr class="miss"><td>324</td><td><code><pre>        if cl == client {</pre></code></td></tr><tr class="miss"><td>325</td><td><code><pre>                delete(c.cachedClient, k)</pre></code></td></tr><tr><td>326</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>327</td><td><code><pre>        c.mu.Unlock()</pre></code></td></tr><tr><td>328</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>329</td><td><code><pre>        if client != nil {</pre></code></td></tr><tr class="miss"><td>330</td><td><code><pre>                client.UnregisterServerMessageChan()</pre></code></td></tr><tr class="miss"><td>331</td><td><code><pre>                client.Close()</pre></code></td></tr><tr><td>332</td><td><code><pre>        }</pre></code></td></tr><tr><td>333</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MDNSDiscovery.RemoveWatcher">func MDNSDiscovery.RemoveWatcher</div><div class="info"><a href="#s_fn_MDNSDiscovery.RemoveWatcher">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/mdns_discovery.go</code>:</p></div><table class="listing">
<tr><td>78</td><td><code><pre>func (d *MDNSDiscovery) RemoveWatcher(ch chan []*KVPair) {</pre></code></td></tr><tr class="miss"><td>79</td><td><code><pre>        d.mu.Lock()</pre></code></td></tr><tr class="miss"><td>80</td><td><code><pre>        defer d.mu.Unlock()</pre></code></td></tr><tr><td>81</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>82</td><td><code><pre>        var chans []chan []*KVPair</pre></code></td></tr><tr class="miss"><td>83</td><td><code><pre>        for _, c := range d.chans {</pre></code></td></tr><tr class="miss"><td>84</td><td><code><pre>                if c == ch {</pre></code></td></tr><tr class="miss"><td>85</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>86</td><td><code><pre>                }</pre></code></td></tr><tr><td>87</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>88</td><td><code><pre>                chans = append(chans, c)</pre></code></td></tr><tr><td>89</td><td><code><pre>        }</pre></code></td></tr><tr><td>90</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>91</td><td><code><pre>        d.chans = chans</pre></code></td></tr><tr><td>92</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_getDistanceFrom">func getDistanceFrom</div><div class="info"><a href="#s_fn_getDistanceFrom">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/geo_utils.go</code>:</p></div><table class="listing">
<tr><td>45</td><td><code><pre>func getDistanceFrom(lat1, lon1, lat2, lon2 float64) float64 {</pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>        var la1, lo1, la2, lo2, r float64</pre></code></td></tr><tr class="miss"><td>47</td><td><code><pre>        la1 = lat1 * math.Pi / 180</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>        lo1 = lon1 * math.Pi / 180</pre></code></td></tr><tr class="miss"><td>49</td><td><code><pre>        la2 = lat2 * math.Pi / 180</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>        lo2 = lon2 * math.Pi / 180</pre></code></td></tr><tr><td>51</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>52</td><td><code><pre>        r = 6378100 // Earth radius in METERS</pre></code></td></tr><tr><td>53</td><td><code><pre></pre></code></td></tr><tr><td>54</td><td><code><pre>        // calculate</pre></code></td></tr><tr class="miss"><td>55</td><td><code><pre>        h := hsin(la2-la1) + math.Cos(la1)*math.Cos(la2)*hsin(lo2-lo1)</pre></code></td></tr><tr><td>56</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>57</td><td><code><pre>        return 2 * r * math.Asin(math.Sqrt(h))</pre></code></td></tr><tr><td>58</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MultipleServersDiscovery.RemoveWatcher">func MultipleServersDiscovery.RemoveWatcher</div><div class="info"><a href="#s_fn_MultipleServersDiscovery.RemoveWatcher">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code>:</p></div><table class="listing">
<tr><td>42</td><td><code><pre>func (d *MultipleServersDiscovery) RemoveWatcher(ch chan []*KVPair) {</pre></code></td></tr><tr class="miss"><td>43</td><td><code><pre>        d.mu.Lock()</pre></code></td></tr><tr class="miss"><td>44</td><td><code><pre>        defer d.mu.Unlock()</pre></code></td></tr><tr><td>45</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>        var chans []chan []*KVPair</pre></code></td></tr><tr class="miss"><td>47</td><td><code><pre>        for _, c := range d.chans {</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>                if c == ch {</pre></code></td></tr><tr class="miss"><td>49</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>50</td><td><code><pre>                }</pre></code></td></tr><tr><td>51</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>52</td><td><code><pre>                chans = append(chans, c)</pre></code></td></tr><tr><td>53</td><td><code><pre>        }</pre></code></td></tr><tr><td>54</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>55</td><td><code><pre>        d.chans = chans</pre></code></td></tr><tr><td>56</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OneClient.Close">func OneClient.Close</div><div class="info"><a href="#s_fn_OneClient.Close">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>306</td><td><code><pre>func (c *OneClient) Close() error {</pre></code></td></tr><tr class="miss"><td>307</td><td><code><pre>        var result error</pre></code></td></tr><tr><td>308</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>309</td><td><code><pre>        c.mu.RLock()</pre></code></td></tr><tr class="miss"><td>310</td><td><code><pre>        for _, v := range c.xclients {</pre></code></td></tr><tr class="miss"><td>311</td><td><code><pre>                err := v.Close()</pre></code></td></tr><tr class="miss"><td>312</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>313</td><td><code><pre>                        result = multierror.Append(result, err)</pre></code></td></tr><tr><td>314</td><td><code><pre>                }</pre></code></td></tr><tr><td>315</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>316</td><td><code><pre>        c.mu.RUnlock()</pre></code></td></tr><tr><td>317</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>318</td><td><code><pre>        return result</pre></code></td></tr><tr><td>319</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OneClient.ConfigGeoSelector">func OneClient.ConfigGeoSelector</div><div class="info"><a href="#s_fn_OneClient.ConfigGeoSelector">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>81</td><td><code><pre>func (c *OneClient) ConfigGeoSelector(latitude, longitude float64) {</pre></code></td></tr><tr class="miss"><td>82</td><td><code><pre>        c.selectMode = Closest</pre></code></td></tr><tr class="miss"><td>83</td><td><code><pre>        c.latitude = latitude</pre></code></td></tr><tr class="miss"><td>84</td><td><code><pre>        c.longitude = longitude</pre></code></td></tr><tr><td>85</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>86</td><td><code><pre>        c.mu.RLock()</pre></code></td></tr><tr class="miss"><td>87</td><td><code><pre>        for _, v := range c.xclients {</pre></code></td></tr><tr class="miss"><td>88</td><td><code><pre>                v.ConfigGeoSelector(latitude, longitude)</pre></code></td></tr><tr><td>89</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>90</td><td><code><pre>        c.mu.RUnlock()</pre></code></td></tr><tr><td>91</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_roundRobinSelector.Select">func roundRobinSelector.Select</div><div class="info"><a href="#s_fn_roundRobinSelector.Select">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>89</td><td><code><pre>func (s *roundRobinSelector) Select(ctx context.Context, servicePath, serviceMethod string, args interface{}) string {</pre></code></td></tr><tr class="miss"><td>90</td><td><code><pre>        var ss = s.servers</pre></code></td></tr><tr class="miss"><td>91</td><td><code><pre>        if len(ss) == 0 {</pre></code></td></tr><tr class="miss"><td>92</td><td><code><pre>                return &#34;&#34;</pre></code></td></tr><tr><td>93</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>94</td><td><code><pre>        i := s.i</pre></code></td></tr><tr class="miss"><td>95</td><td><code><pre>        i = i % len(ss)</pre></code></td></tr><tr class="miss"><td>96</td><td><code><pre>        s.i = i + 1</pre></code></td></tr><tr><td>97</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>98</td><td><code><pre>        return ss[i]</pre></code></td></tr><tr><td>99</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.Remove">func pluginContainer.Remove</div><div class="info"><a href="#s_fn_pluginContainer.Remove">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/plugin.go</code>:</p></div><table class="listing">
<tr><td>29</td><td><code><pre>func (p *pluginContainer) Remove(plugin Plugin) {</pre></code></td></tr><tr class="miss"><td>30</td><td><code><pre>        if p.plugins == nil {</pre></code></td></tr><tr class="miss"><td>31</td><td><code><pre>                return</pre></code></td></tr><tr><td>32</td><td><code><pre>        }</pre></code></td></tr><tr><td>33</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>        var plugins []Plugin</pre></code></td></tr><tr class="miss"><td>35</td><td><code><pre>        for _, pp := range p.plugins {</pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>                if pp != plugin {</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>                        plugins = append(plugins, pp)</pre></code></td></tr><tr><td>38</td><td><code><pre>                }</pre></code></td></tr><tr><td>39</td><td><code><pre>        }</pre></code></td></tr><tr><td>40</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>41</td><td><code><pre>        p.plugins = plugins</pre></code></td></tr><tr><td>42</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_weightedRoundRobinSelector.Select">func weightedRoundRobinSelector.Select</div><div class="info"><a href="#s_fn_weightedRoundRobinSelector.Select">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>120</td><td><code><pre>func (s *weightedRoundRobinSelector) Select(ctx context.Context, servicePath, serviceMethod string, args interface{}) string {</pre></code></td></tr><tr class="miss"><td>121</td><td><code><pre>        ss := s.servers</pre></code></td></tr><tr class="miss"><td>122</td><td><code><pre>        if len(ss) == 0 {</pre></code></td></tr><tr class="miss"><td>123</td><td><code><pre>                return &#34;&#34;</pre></code></td></tr><tr><td>124</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>125</td><td><code><pre>        w := nextWeighted(ss)</pre></code></td></tr><tr class="miss"><td>126</td><td><code><pre>        if w == nil {</pre></code></td></tr><tr class="miss"><td>127</td><td><code><pre>                return &#34;&#34;</pre></code></td></tr><tr><td>128</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>129</td><td><code><pre>        return w.Server</pre></code></td></tr><tr><td>130</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.handleServerRequest">func Client.handleServerRequest</div><div class="info"><a href="#s_fn_Client.handleServerRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>688</td><td><code><pre>func (client *Client) handleServerRequest(msg *protocol.Message) {</pre></code></td></tr><tr class="miss"><td>689</td><td><code><pre>        defer func() {</pre></code></td></tr><tr><td>690</td><td><code><pre>                if r := recover(); r != nil {</pre></code></td></tr><tr><td>691</td><td><code><pre>                        log.Errorf(&#34;ServerMessageChan may be closed so client remove it. Please add it again if you want to handle server requests. error is %v&#34;, r)</pre></code></td></tr><tr><td>692</td><td><code><pre>                        client.ServerMessageChan = nil</pre></code></td></tr><tr><td>693</td><td><code><pre>                }</pre></code></td></tr><tr><td>694</td><td><code><pre>        }()</pre></code></td></tr><tr><td>695</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>696</td><td><code><pre>        t := time.NewTimer(5 * time.Second)</pre></code></td></tr><tr class="miss"><td>697</td><td><code><pre>        select {</pre></code></td></tr><tr><td>698</td><td><code><pre>        case client.ServerMessageChan &lt;- msg:</pre></code></td></tr><tr><td>699</td><td><code><pre>        case &lt;-t.C:</pre></code></td></tr><tr class="miss"><td>700</td><td><code><pre>                log.Warnf(&#34;ServerMessageChan may be full so the server request %d has been dropped&#34;, msg.Seq())</pre></code></td></tr><tr><td>701</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>702</td><td><code><pre>        t.Stop()</pre></code></td></tr><tr><td>703</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OneClient.SetSelector">func OneClient.SetSelector</div><div class="info"><a href="#s_fn_OneClient.SetSelector">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>60</td><td><code><pre>func (c *OneClient) SetSelector(servicePath string, s Selector) {</pre></code></td></tr><tr class="miss"><td>61</td><td><code><pre>        c.mu.Lock()</pre></code></td></tr><tr class="miss"><td>62</td><td><code><pre>        c.selectors[servicePath] = s</pre></code></td></tr><tr class="miss"><td>63</td><td><code><pre>        if xclient, ok := c.xclients[servicePath]; ok {</pre></code></td></tr><tr class="miss"><td>64</td><td><code><pre>                xclient.SetSelector(s)</pre></code></td></tr><tr><td>65</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>66</td><td><code><pre>        c.mu.Unlock()</pre></code></td></tr><tr><td>67</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OneClient.SetPlugins">func OneClient.SetPlugins</div><div class="info"><a href="#s_fn_OneClient.SetPlugins">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>70</td><td><code><pre>func (c *OneClient) SetPlugins(plugins PluginContainer) {</pre></code></td></tr><tr class="miss"><td>71</td><td><code><pre>        c.Plugins = plugins</pre></code></td></tr><tr class="miss"><td>72</td><td><code><pre>        c.mu.RLock()</pre></code></td></tr><tr class="miss"><td>73</td><td><code><pre>        for _, v := range c.xclients {</pre></code></td></tr><tr class="miss"><td>74</td><td><code><pre>                v.SetPlugins(plugins)</pre></code></td></tr><tr><td>75</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>        c.mu.RUnlock()</pre></code></td></tr><tr><td>77</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewXClientPool">func NewXClientPool</div><div class="info"><a href="#s_fn_NewXClientPool">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient_pool.go</code>:</p></div><table class="listing">
<tr><td>26</td><td><code><pre>func NewXClientPool(count int, servicePath string, failMode FailMode, selectMode SelectMode, discovery ServiceDiscovery, option Option) *XClientPool {</pre></code></td></tr><tr class="miss"><td>27</td><td><code><pre>        pool := &amp;XClientPool{</pre></code></td></tr><tr><td>28</td><td><code><pre>                count:       uint64(count),</pre></code></td></tr><tr><td>29</td><td><code><pre>                xclients:    make([]XClient, count),</pre></code></td></tr><tr><td>30</td><td><code><pre>                servicePath: servicePath,</pre></code></td></tr><tr><td>31</td><td><code><pre>                failMode:    failMode,</pre></code></td></tr><tr><td>32</td><td><code><pre>                selectMode:  selectMode,</pre></code></td></tr><tr><td>33</td><td><code><pre>                discovery:   discovery,</pre></code></td></tr><tr><td>34</td><td><code><pre>                option:      option,</pre></code></td></tr><tr><td>35</td><td><code><pre>        }</pre></code></td></tr><tr><td>36</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>        for i := 0; i &lt; count; i++ {</pre></code></td></tr><tr class="miss"><td>38</td><td><code><pre>                xclient := NewXClient(servicePath, failMode, selectMode, discovery, option)</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>                pool.xclients[i] = xclient</pre></code></td></tr><tr><td>40</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>41</td><td><code><pre>        return pool</pre></code></td></tr><tr><td>42</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewOneClientPool">func NewOneClientPool</div><div class="info"><a href="#s_fn_NewOneClientPool">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient_pool.go</code>:</p></div><table class="listing">
<tr><td>26</td><td><code><pre>func NewOneClientPool(count int, servicePath string, failMode FailMode, selectMode SelectMode, discovery ServiceDiscovery, option Option) *OneClientPool {</pre></code></td></tr><tr class="miss"><td>27</td><td><code><pre>        pool := &amp;OneClientPool{</pre></code></td></tr><tr><td>28</td><td><code><pre>                count:       uint64(count),</pre></code></td></tr><tr><td>29</td><td><code><pre>                oneclients:  make([]*OneClient, count),</pre></code></td></tr><tr><td>30</td><td><code><pre>                servicePath: servicePath,</pre></code></td></tr><tr><td>31</td><td><code><pre>                failMode:    failMode,</pre></code></td></tr><tr><td>32</td><td><code><pre>                selectMode:  selectMode,</pre></code></td></tr><tr><td>33</td><td><code><pre>                discovery:   discovery,</pre></code></td></tr><tr><td>34</td><td><code><pre>                option:      option,</pre></code></td></tr><tr><td>35</td><td><code><pre>        }</pre></code></td></tr><tr><td>36</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>        for i := 0; i &lt; count; i++ {</pre></code></td></tr><tr class="miss"><td>38</td><td><code><pre>                oneclient := NewOneClient(failMode, selectMode, discovery, option)</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>                pool.oneclients[i] = oneclient</pre></code></td></tr><tr><td>40</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>41</td><td><code><pre>        return pool</pre></code></td></tr><tr><td>42</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OpenCensusPlugin.DoPostCall">func OpenCensusPlugin.DoPostCall</div><div class="info"><a href="#s_fn_OpenCensusPlugin.DoPostCall">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/opencensus.go</code>:</p></div><table class="listing">
<tr><td>36</td><td><code><pre>func (p *OpenCensusPlugin) DoPostCall(ctx context.Context, servicePath, serviceMethod string, args interface{}, reply interface{}, err error) error {</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>        if rpcxContext, ok := ctx.(*share.Context); ok {</pre></code></td></tr><tr class="miss"><td>38</td><td><code><pre>                span1 := rpcxContext.Value(share.OpencensusSpanClientKey)</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>                if span1 != nil {</pre></code></td></tr><tr class="miss"><td>40</td><td><code><pre>                        span1.(*trace.Span).End()</pre></code></td></tr><tr><td>41</td><td><code><pre>                }</pre></code></td></tr><tr><td>42</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>43</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>44</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_consistentHashSelector.Select">func consistentHashSelector.Select</div><div class="info"><a href="#s_fn_consistentHashSelector.Select">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>252</td><td><code><pre>func (s consistentHashSelector) Select(ctx context.Context, servicePath, serviceMethod string, args interface{}) string {</pre></code></td></tr><tr class="miss"><td>253</td><td><code><pre>        ss := s.servers</pre></code></td></tr><tr class="miss"><td>254</td><td><code><pre>        if len(ss) == 0 {</pre></code></td></tr><tr class="miss"><td>255</td><td><code><pre>                return &#34;&#34;</pre></code></td></tr><tr><td>256</td><td><code><pre>        }</pre></code></td></tr><tr><td>257</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>258</td><td><code><pre>        key := genKey(servicePath, serviceMethod, args)</pre></code></td></tr><tr class="miss"><td>259</td><td><code><pre>        return s.h.Get(key).(string)</pre></code></td></tr><tr><td>260</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newConsistentHashSelector">func newConsistentHashSelector</div><div class="info"><a href="#s_fn_newConsistentHashSelector">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>242</td><td><code><pre>func newConsistentHashSelector(servers map[string]string) Selector {</pre></code></td></tr><tr class="miss"><td>243</td><td><code><pre>        var ss = make([]string, 0, len(servers))</pre></code></td></tr><tr class="miss"><td>244</td><td><code><pre>        for k := range servers {</pre></code></td></tr><tr class="miss"><td>245</td><td><code><pre>                ss = append(ss, k)</pre></code></td></tr><tr><td>246</td><td><code><pre>        }</pre></code></td></tr><tr><td>247</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>248</td><td><code><pre>        sort.Slice(ss, func(i, j int) bool { return ss[i] &lt; ss[j] })</pre></code></td></tr><tr class="miss"><td>249</td><td><code><pre>        return &amp;consistentHashSelector{servers: ss, h: doublejump.NewHash()}</pre></code></td></tr><tr><td>250</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OneClient.Auth">func OneClient.Auth</div><div class="info"><a href="#s_fn_OneClient.Auth">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>94</td><td><code><pre>func (c *OneClient) Auth(auth string) {</pre></code></td></tr><tr class="miss"><td>95</td><td><code><pre>        c.auth = auth</pre></code></td></tr><tr class="miss"><td>96</td><td><code><pre>        c.mu.RLock()</pre></code></td></tr><tr class="miss"><td>97</td><td><code><pre>        for _, v := range c.xclients {</pre></code></td></tr><tr class="miss"><td>98</td><td><code><pre>                v.Auth(auth)</pre></code></td></tr><tr><td>99</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>100</td><td><code><pre>        c.mu.RUnlock()</pre></code></td></tr><tr><td>101</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewBidirectionalXClientPool">func NewBidirectionalXClientPool</div><div class="info"><a href="#s_fn_NewBidirectionalXClientPool">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient_pool.go</code>:</p></div><table class="listing">
<tr><td>45</td><td><code><pre>func NewBidirectionalXClientPool(count int, servicePath string, failMode FailMode, selectMode SelectMode, discovery ServiceDiscovery, option Option, serverMessageChan chan&lt;- *protocol.Message) *XClientPool {</pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>        pool := &amp;XClientPool{</pre></code></td></tr><tr><td>47</td><td><code><pre>                count:             uint64(count),</pre></code></td></tr><tr><td>48</td><td><code><pre>                xclients:          make([]XClient, count),</pre></code></td></tr><tr><td>49</td><td><code><pre>                servicePath:       servicePath,</pre></code></td></tr><tr><td>50</td><td><code><pre>                failMode:          failMode,</pre></code></td></tr><tr><td>51</td><td><code><pre>                selectMode:        selectMode,</pre></code></td></tr><tr><td>52</td><td><code><pre>                discovery:         discovery,</pre></code></td></tr><tr><td>53</td><td><code><pre>                option:            option,</pre></code></td></tr><tr><td>54</td><td><code><pre>                serverMessageChan: serverMessageChan,</pre></code></td></tr><tr><td>55</td><td><code><pre>        }</pre></code></td></tr><tr><td>56</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>57</td><td><code><pre>        for i := 0; i &lt; count; i++ {</pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>                xclient := NewBidirectionalXClient(servicePath, failMode, selectMode, discovery, option, serverMessageChan)</pre></code></td></tr><tr class="miss"><td>59</td><td><code><pre>                pool.xclients[i] = xclient</pre></code></td></tr><tr><td>60</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>61</td><td><code><pre>        return pool</pre></code></td></tr><tr><td>62</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewBidirectionalOneClientPool">func NewBidirectionalOneClientPool</div><div class="info"><a href="#s_fn_NewBidirectionalOneClientPool">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient_pool.go</code>:</p></div><table class="listing">
<tr><td>45</td><td><code><pre>func NewBidirectionalOneClientPool(count int, servicePath string, failMode FailMode, selectMode SelectMode, discovery ServiceDiscovery, option Option, serverMessageChan chan&lt;- *protocol.Message) *OneClientPool {</pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>        pool := &amp;OneClientPool{</pre></code></td></tr><tr><td>47</td><td><code><pre>                count:             uint64(count),</pre></code></td></tr><tr><td>48</td><td><code><pre>                oneclients:        make([]*OneClient, count),</pre></code></td></tr><tr><td>49</td><td><code><pre>                servicePath:       servicePath,</pre></code></td></tr><tr><td>50</td><td><code><pre>                failMode:          failMode,</pre></code></td></tr><tr><td>51</td><td><code><pre>                selectMode:        selectMode,</pre></code></td></tr><tr><td>52</td><td><code><pre>                discovery:         discovery,</pre></code></td></tr><tr><td>53</td><td><code><pre>                option:            option,</pre></code></td></tr><tr><td>54</td><td><code><pre>                serverMessageChan: serverMessageChan,</pre></code></td></tr><tr><td>55</td><td><code><pre>        }</pre></code></td></tr><tr><td>56</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>57</td><td><code><pre>        for i := 0; i &lt; count; i++ {</pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>                oneclient := NewBidirectionalOneClient(failMode, selectMode, discovery, option, serverMessageChan)</pre></code></td></tr><tr class="miss"><td>59</td><td><code><pre>                pool.oneclients[i] = oneclient</pre></code></td></tr><tr><td>60</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>61</td><td><code><pre>        return pool</pre></code></td></tr><tr><td>62</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@647:6">func @647:6</div><div class="info"><a href="#s_fn_@647:6">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>647</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>648</td><td><code><pre>                        e := c.wrapCall(ctx, client, serviceMethod, args, reply)</pre></code></td></tr><tr class="miss"><td>649</td><td><code><pre>                        done &lt;- (e == nil)</pre></code></td></tr><tr class="miss"><td>650</td><td><code><pre>                        if e != nil {</pre></code></td></tr><tr class="miss"><td>651</td><td><code><pre>                                c.removeClient(k, client)</pre></code></td></tr><tr class="miss"><td>652</td><td><code><pre>                                err.Append(e)</pre></code></td></tr><tr><td>653</td><td><code><pre>                        }</pre></code></td></tr><tr><td>654</td><td><code><pre>                }</pre></code></td></tr></table>

<div class="funcname" id="fn_OpenTracingPlugin.DoPostCall">func OpenTracingPlugin.DoPostCall</div><div class="info"><a href="#s_fn_OpenTracingPlugin.DoPostCall">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/opentracing.go</code>:</p></div><table class="listing">
<tr><td>39</td><td><code><pre>func (p *OpenTracingPlugin) DoPostCall(ctx context.Context, servicePath, serviceMethod string, args interface{}, reply interface{}, err error) error {</pre></code></td></tr><tr class="miss"><td>40</td><td><code><pre>        if rpcxContext, ok := ctx.(*share.Context); ok {</pre></code></td></tr><tr class="miss"><td>41</td><td><code><pre>                span1 := rpcxContext.Value(share.OpentracingSpanClientKey)</pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>                if span1 != nil {</pre></code></td></tr><tr class="miss"><td>43</td><td><code><pre>                        span1.(opentracing.Span).Finish()</pre></code></td></tr><tr><td>44</td><td><code><pre>                }</pre></code></td></tr><tr><td>45</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>47</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@128:8">func @128:8</div><div class="info"><a href="#s_fn_@128:8">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>128</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>129</td><td><code><pre>                if r := recover(); r != nil {</pre></code></td></tr><tr class="miss"><td>130</td><td><code><pre>                        if e, ok := r.(error); ok {</pre></code></td></tr><tr class="miss"><td>131</td><td><code><pre>                                err = e</pre></code></td></tr><tr><td>132</td><td><code><pre>                        } else {</pre></code></td></tr><tr class="miss"><td>133</td><td><code><pre>                                err = fmt.Errorf(&#34;%v&#34;, r)</pre></code></td></tr><tr><td>134</td><td><code><pre>                        }</pre></code></td></tr><tr><td>135</td><td><code><pre>                }</pre></code></td></tr><tr><td>136</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_FailMode.IsAFailMode">func FailMode.IsAFailMode</div><div class="info"><a href="#s_fn_FailMode.IsAFailMode">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/failmode_enumer.go</code>:</p></div><table class="listing">
<tr><td>44</td><td><code><pre>func (i FailMode) IsAFailMode() bool {</pre></code></td></tr><tr class="miss"><td>45</td><td><code><pre>        for _, v := range _FailModeValues {</pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>                if i == v {</pre></code></td></tr><tr class="miss"><td>47</td><td><code><pre>                        return true</pre></code></td></tr><tr><td>48</td><td><code><pre>                }</pre></code></td></tr><tr><td>49</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>        return false</pre></code></td></tr><tr><td>51</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_SelectMode.IsASelectMode">func SelectMode.IsASelectMode</div><div class="info"><a href="#s_fn_SelectMode.IsASelectMode">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selectmode_enumer.go</code>:</p></div><table class="listing">
<tr><td>46</td><td><code><pre>func (i SelectMode) IsASelectMode() bool {</pre></code></td></tr><tr class="miss"><td>47</td><td><code><pre>        for _, v := range _SelectModeValues {</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>                if i == v {</pre></code></td></tr><tr class="miss"><td>49</td><td><code><pre>                        return true</pre></code></td></tr><tr><td>50</td><td><code><pre>                }</pre></code></td></tr><tr><td>51</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>52</td><td><code><pre>        return false</pre></code></td></tr><tr><td>53</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_genKey">func genKey</div><div class="info"><a href="#s_fn_genKey">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/hash_utils.go</code>:</p></div><table class="listing">
<tr><td>39</td><td><code><pre>func genKey(options ...interface{}) uint64 {</pre></code></td></tr><tr class="miss"><td>40</td><td><code><pre>        keyString := &#34;&#34;</pre></code></td></tr><tr class="miss"><td>41</td><td><code><pre>        for _, opt := range options {</pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>                keyString = keyString + &#34;/&#34; + toString(opt)</pre></code></td></tr><tr><td>43</td><td><code><pre>        }</pre></code></td></tr><tr><td>44</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>45</td><td><code><pre>        return HashString(keyString)</pre></code></td></tr><tr><td>46</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_randomSelector.UpdateServer">func randomSelector.UpdateServer</div><div class="info"><a href="#s_fn_randomSelector.UpdateServer">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>65</td><td><code><pre>func (s *randomSelector) UpdateServer(servers map[string]string) {</pre></code></td></tr><tr class="miss"><td>66</td><td><code><pre>        var ss = make([]string, 0, len(servers))</pre></code></td></tr><tr class="miss"><td>67</td><td><code><pre>        for k := range servers {</pre></code></td></tr><tr class="miss"><td>68</td><td><code><pre>                ss = append(ss, k)</pre></code></td></tr><tr><td>69</td><td><code><pre>        }</pre></code></td></tr><tr><td>70</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>71</td><td><code><pre>        s.servers = ss</pre></code></td></tr><tr><td>72</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_roundRobinSelector.UpdateServer">func roundRobinSelector.UpdateServer</div><div class="info"><a href="#s_fn_roundRobinSelector.UpdateServer">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>101</td><td><code><pre>func (s *roundRobinSelector) UpdateServer(servers map[string]string) {</pre></code></td></tr><tr class="miss"><td>102</td><td><code><pre>        var ss = make([]string, 0, len(servers))</pre></code></td></tr><tr class="miss"><td>103</td><td><code><pre>        for k := range servers {</pre></code></td></tr><tr class="miss"><td>104</td><td><code><pre>                ss = append(ss, k)</pre></code></td></tr><tr><td>105</td><td><code><pre>        }</pre></code></td></tr><tr><td>106</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>107</td><td><code><pre>        s.servers = ss</pre></code></td></tr><tr><td>108</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.SetSelector">func xClient.SetSelector</div><div class="info"><a href="#s_fn_xClient.SetSelector">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>163</td><td><code><pre>func (c *xClient) SetSelector(s Selector) {</pre></code></td></tr><tr class="miss"><td>164</td><td><code><pre>        c.mu.RLock()</pre></code></td></tr><tr class="miss"><td>165</td><td><code><pre>        s.UpdateServer(c.servers)</pre></code></td></tr><tr class="miss"><td>166</td><td><code><pre>        c.mu.RUnlock()</pre></code></td></tr><tr><td>167</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>168</td><td><code><pre>        c.selector = s</pre></code></td></tr><tr><td>169</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@81:8">func @81:8</div><div class="info"><a href="#s_fn_@81:8">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_client.go</code>:</p></div><table class="listing">
<tr><td>81</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>82</td><td><code><pre>                if e := recover(); e != nil {</pre></code></td></tr><tr class="miss"><td>83</td><td><code><pre>                        var ok bool</pre></code></td></tr><tr class="miss"><td>84</td><td><code><pre>                        if err, ok = e.(error); ok {</pre></code></td></tr><tr class="miss"><td>85</td><td><code><pre>                                err = fmt.Errorf(&#34;failed to call %s.%s because of %v&#34;, servicePath, serviceMethod, err)</pre></code></td></tr><tr><td>86</td><td><code><pre>                        }</pre></code></td></tr><tr><td>87</td><td><code><pre>                }</pre></code></td></tr><tr><td>88</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_inprocessClient.Unregister">func inprocessClient.Unregister</div><div class="info"><a href="#s_fn_inprocessClient.Unregister">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_client.go</code>:</p></div><table class="listing">
<tr><td>157</td><td><code><pre>func (client *inprocessClient) Unregister(name string) error {</pre></code></td></tr><tr class="miss"><td>158</td><td><code><pre>        client.Lock()</pre></code></td></tr><tr class="miss"><td>159</td><td><code><pre>        delete(client.services, name)</pre></code></td></tr><tr class="miss"><td>160</td><td><code><pre>        client.Unlock()</pre></code></td></tr><tr class="miss"><td>161</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>162</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_inprocessClient.Register">func inprocessClient.Register</div><div class="info"><a href="#s_fn_inprocessClient.Register">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_client.go</code>:</p></div><table class="listing">
<tr><td>150</td><td><code><pre>func (client *inprocessClient) Register(name string, rcvr interface{}, metadata string) (err error) {</pre></code></td></tr><tr class="miss"><td>151</td><td><code><pre>        client.Lock()</pre></code></td></tr><tr class="miss"><td>152</td><td><code><pre>        client.services[name] = rcvr</pre></code></td></tr><tr class="miss"><td>153</td><td><code><pre>        client.Unlock()</pre></code></td></tr><tr class="miss"><td>154</td><td><code><pre>        return</pre></code></td></tr><tr><td>155</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newRoundRobinSelector">func newRoundRobinSelector</div><div class="info"><a href="#s_fn_newRoundRobinSelector">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>80</td><td><code><pre>func newRoundRobinSelector(servers map[string]string) Selector {</pre></code></td></tr><tr class="miss"><td>81</td><td><code><pre>        var ss = make([]string, 0, len(servers))</pre></code></td></tr><tr class="miss"><td>82</td><td><code><pre>        for k := range servers {</pre></code></td></tr><tr class="miss"><td>83</td><td><code><pre>                ss = append(ss, k)</pre></code></td></tr><tr><td>84</td><td><code><pre>        }</pre></code></td></tr><tr><td>85</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>86</td><td><code><pre>        return &amp;roundRobinSelector{servers: ss}</pre></code></td></tr><tr><td>87</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@109:9">func @109:9</div><div class="info"><a href="#s_fn_@109:9">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/mdns_discovery.go</code>:</p></div><table class="listing">
<tr><td>109</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>110</td><td><code><pre>                                                defer func() {</pre></code></td></tr><tr><td>111</td><td><code><pre>                                                        if r := recover(); r != nil {</pre></code></td></tr><tr><td>112</td><td><code><pre></pre></code></td></tr><tr><td>113</td><td><code><pre>                                                        }</pre></code></td></tr><tr><td>114</td><td><code><pre>                                                }()</pre></code></td></tr><tr class="miss"><td>115</td><td><code><pre>                                                select {</pre></code></td></tr><tr><td>116</td><td><code><pre>                                                case ch &lt;- pairs:</pre></code></td></tr><tr><td>117</td><td><code><pre>                                                case &lt;-time.After(time.Minute):</pre></code></td></tr><tr class="miss"><td>118</td><td><code><pre>                                                        log.Warn(&#34;chan is full and new change has ben dropped&#34;)</pre></code></td></tr><tr><td>119</td><td><code><pre>                                                }</pre></code></td></tr><tr><td>120</td><td><code><pre>                                        }</pre></code></td></tr></table>

<div class="funcname" id="fn_OneClientPool.Close">func OneClientPool.Close</div><div class="info"><a href="#s_fn_OneClientPool.Close">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient_pool.go</code>:</p></div><table class="listing">
<tr><td>75</td><td><code><pre>func (p OneClientPool) Close() {</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>        for _, c := range p.oneclients {</pre></code></td></tr><tr class="miss"><td>77</td><td><code><pre>                c.Close()</pre></code></td></tr><tr><td>78</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>79</td><td><code><pre>        p.oneclients = nil</pre></code></td></tr><tr><td>80</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OneClientPool.Get">func OneClientPool.Get</div><div class="info"><a href="#s_fn_OneClientPool.Get">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient_pool.go</code>:</p></div><table class="listing">
<tr><td>67</td><td><code><pre>func (p OneClientPool) Get() *OneClient {</pre></code></td></tr><tr class="miss"><td>68</td><td><code><pre>        i := atomic.AddUint64(&amp;p.index, 1)</pre></code></td></tr><tr class="miss"><td>69</td><td><code><pre>        picked := int(i % p.count)</pre></code></td></tr><tr class="miss"><td>70</td><td><code><pre>        return p.oneclients[picked]</pre></code></td></tr><tr><td>71</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_XClientPool.Get">func XClientPool.Get</div><div class="info"><a href="#s_fn_XClientPool.Get">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient_pool.go</code>:</p></div><table class="listing">
<tr><td>67</td><td><code><pre>func (p XClientPool) Get() XClient {</pre></code></td></tr><tr class="miss"><td>68</td><td><code><pre>        i := atomic.AddUint64(&amp;p.index, 1)</pre></code></td></tr><tr class="miss"><td>69</td><td><code><pre>        picked := int(i % p.count)</pre></code></td></tr><tr class="miss"><td>70</td><td><code><pre>        return p.xclients[picked]</pre></code></td></tr><tr><td>71</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@689:8">func @689:8</div><div class="info"><a href="#s_fn_@689:8">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>689</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>690</td><td><code><pre>                if r := recover(); r != nil {</pre></code></td></tr><tr class="miss"><td>691</td><td><code><pre>                        log.Errorf(&#34;ServerMessageChan may be closed so client remove it. Please add it again if you want to handle server requests. error is %v&#34;, r)</pre></code></td></tr><tr class="miss"><td>692</td><td><code><pre>                        client.ServerMessageChan = nil</pre></code></td></tr><tr><td>693</td><td><code><pre>                }</pre></code></td></tr><tr><td>694</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_FailMode.String">func FailMode.String</div><div class="info"><a href="#s_fn_FailMode.String">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/failmode_enumer.go</code>:</p></div><table class="listing">
<tr><td>13</td><td><code><pre>func (i FailMode) String() string {</pre></code></td></tr><tr class="miss"><td>14</td><td><code><pre>        if i &lt; 0 || i &gt;= FailMode(len(_FailModeIndex)-1) {</pre></code></td></tr><tr class="miss"><td>15</td><td><code><pre>                return fmt.Sprintf(&#34;FailMode(%d)&#34;, i)</pre></code></td></tr><tr><td>16</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>17</td><td><code><pre>        return _FailModeName[_FailModeIndex[i]:_FailModeIndex[i+1]]</pre></code></td></tr><tr><td>18</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_FailModeString">func FailModeString</div><div class="info"><a href="#s_fn_FailModeString">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/failmode_enumer.go</code>:</p></div><table class="listing">
<tr><td>31</td><td><code><pre>func FailModeString(s string) (FailMode, error) {</pre></code></td></tr><tr class="miss"><td>32</td><td><code><pre>        if val, ok := _FailModeNameToValueMap[s]; ok {</pre></code></td></tr><tr class="miss"><td>33</td><td><code><pre>                return val, nil</pre></code></td></tr><tr><td>34</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>35</td><td><code><pre>        return 0, fmt.Errorf(&#34;%s does not belong to FailMode values&#34;, s)</pre></code></td></tr><tr><td>36</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_HashString">func HashString</div><div class="info"><a href="#s_fn_HashString">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/hash_utils.go</code>:</p></div><table class="listing">
<tr><td>26</td><td><code><pre>func HashString(s string) uint64 {</pre></code></td></tr><tr class="miss"><td>27</td><td><code><pre>        h := fnv.New64a()</pre></code></td></tr><tr class="miss"><td>28</td><td><code><pre>        h.Write([]byte(s))</pre></code></td></tr><tr class="miss"><td>29</td><td><code><pre>        return h.Sum64()</pre></code></td></tr><tr><td>30</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_SelectModeString">func SelectModeString</div><div class="info"><a href="#s_fn_SelectModeString">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selectmode_enumer.go</code>:</p></div><table class="listing">
<tr><td>33</td><td><code><pre>func SelectModeString(s string) (SelectMode, error) {</pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>        if val, ok := _SelectModeNameToValueMap[s]; ok {</pre></code></td></tr><tr class="miss"><td>35</td><td><code><pre>                return val, nil</pre></code></td></tr><tr><td>36</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>        return 0, fmt.Errorf(&#34;%s does not belong to SelectMode values&#34;, s)</pre></code></td></tr><tr><td>38</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_SelectMode.String">func SelectMode.String</div><div class="info"><a href="#s_fn_SelectMode.String">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selectmode_enumer.go</code>:</p></div><table class="listing">
<tr><td>13</td><td><code><pre>func (i SelectMode) String() string {</pre></code></td></tr><tr class="miss"><td>14</td><td><code><pre>        if i &lt; 0 || i &gt;= SelectMode(len(_SelectModeIndex)-1) {</pre></code></td></tr><tr class="miss"><td>15</td><td><code><pre>                return fmt.Sprintf(&#34;SelectMode(%d)&#34;, i)</pre></code></td></tr><tr><td>16</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>17</td><td><code><pre>        return _SelectModeName[_SelectModeIndex[i]:_SelectModeIndex[i+1]]</pre></code></td></tr><tr><td>18</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_XClientPool.Close">func XClientPool.Close</div><div class="info"><a href="#s_fn_XClientPool.Close">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient_pool.go</code>:</p></div><table class="listing">
<tr><td>75</td><td><code><pre>func (p XClientPool) Close() {</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>        for _, c := range p.xclients {</pre></code></td></tr><tr class="miss"><td>77</td><td><code><pre>                c.Close()</pre></code></td></tr><tr><td>78</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>79</td><td><code><pre>        p.xclients = nil</pre></code></td></tr><tr><td>80</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newGeoSelector">func newGeoSelector</div><div class="info"><a href="#s_fn_newGeoSelector">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>172</td><td><code><pre>func newGeoSelector(servers map[string]string, latitude, longitude float64) Selector {</pre></code></td></tr><tr class="miss"><td>173</td><td><code><pre>        ss := createGeoServer(servers)</pre></code></td></tr><tr class="miss"><td>174</td><td><code><pre>        r := rand.New(rand.NewSource(time.Now().UnixNano()))</pre></code></td></tr><tr class="miss"><td>175</td><td><code><pre>        return &amp;geoSelector{servers: ss, Latitude: latitude, Longitude: longitude, r: r}</pre></code></td></tr><tr><td>176</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewMDNSDiscoveryTemplate">func NewMDNSDiscoveryTemplate</div><div class="info"><a href="#s_fn_NewMDNSDiscoveryTemplate">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/mdns_discovery.go</code>:</p></div><table class="listing">
<tr><td>54</td><td><code><pre>func NewMDNSDiscoveryTemplate(timeout time.Duration, watchInterval time.Duration, domain string) ServiceDiscovery {</pre></code></td></tr><tr class="miss"><td>55</td><td><code><pre>        if domain == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>56</td><td><code><pre>                domain = &#34;local.&#34;</pre></code></td></tr><tr><td>57</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>        return &amp;MDNSDiscovery{Timeout: timeout, WatchInterval: watchInterval, domain: domain}</pre></code></td></tr><tr><td>59</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MDNSDiscovery.WatchService">func MDNSDiscovery.WatchService</div><div class="info"><a href="#s_fn_MDNSDiscovery.WatchService">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/mdns_discovery.go</code>:</p></div><table class="listing">
<tr><td>72</td><td><code><pre>func (d *MDNSDiscovery) WatchService() chan []*KVPair {</pre></code></td></tr><tr class="miss"><td>73</td><td><code><pre>        ch := make(chan []*KVPair, 10)</pre></code></td></tr><tr class="miss"><td>74</td><td><code><pre>        d.chans = append(d.chans, ch)</pre></code></td></tr><tr class="miss"><td>75</td><td><code><pre>        return ch</pre></code></td></tr><tr><td>76</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MultipleServersDiscovery.WatchService">func MultipleServersDiscovery.WatchService</div><div class="info"><a href="#s_fn_MultipleServersDiscovery.WatchService">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code>:</p></div><table class="listing">
<tr><td>36</td><td><code><pre>func (d *MultipleServersDiscovery) WatchService() chan []*KVPair {</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>        ch := make(chan []*KVPair, 10)</pre></code></td></tr><tr class="miss"><td>38</td><td><code><pre>        d.chans = append(d.chans, ch)</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>        return ch</pre></code></td></tr><tr><td>40</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@62:6">func @62:6</div><div class="info"><a href="#s_fn_@62:6">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code>:</p></div><table class="listing">
<tr><td>62</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>63</td><td><code><pre>                        defer func() {</pre></code></td></tr><tr><td>64</td><td><code><pre>                                if r := recover(); r != nil {</pre></code></td></tr><tr><td>65</td><td><code><pre></pre></code></td></tr><tr><td>66</td><td><code><pre>                                }</pre></code></td></tr><tr><td>67</td><td><code><pre>                        }()</pre></code></td></tr><tr class="miss"><td>68</td><td><code><pre>                        select {</pre></code></td></tr><tr><td>69</td><td><code><pre>                        case ch &lt;- pairs:</pre></code></td></tr><tr><td>70</td><td><code><pre>                        case &lt;-time.After(time.Minute):</pre></code></td></tr><tr class="miss"><td>71</td><td><code><pre>                                log.Warn(&#34;chan is full and new change has been dropped&#34;)</pre></code></td></tr><tr><td>72</td><td><code><pre>                        }</pre></code></td></tr><tr><td>73</td><td><code><pre>                }</pre></code></td></tr></table>

<div class="funcname" id="fn_MultipleServersDiscovery.Update">func MultipleServersDiscovery.Update</div><div class="info"><a href="#s_fn_MultipleServersDiscovery.Update">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code>:</p></div><table class="listing">
<tr><td>59</td><td><code><pre>func (d *MultipleServersDiscovery) Update(pairs []*KVPair) {</pre></code></td></tr><tr class="miss"><td>60</td><td><code><pre>        for _, ch := range d.chans {</pre></code></td></tr><tr class="miss"><td>61</td><td><code><pre>                ch := ch</pre></code></td></tr><tr class="miss"><td>62</td><td><code><pre>                go func() {</pre></code></td></tr><tr><td>63</td><td><code><pre>                        defer func() {</pre></code></td></tr><tr><td>64</td><td><code><pre>                                if r := recover(); r != nil {</pre></code></td></tr><tr><td>65</td><td><code><pre></pre></code></td></tr><tr><td>66</td><td><code><pre>                                }</pre></code></td></tr><tr><td>67</td><td><code><pre>                        }()</pre></code></td></tr><tr><td>68</td><td><code><pre>                        select {</pre></code></td></tr><tr><td>69</td><td><code><pre>                        case ch &lt;- pairs:</pre></code></td></tr><tr><td>70</td><td><code><pre>                        case &lt;-time.After(time.Minute):</pre></code></td></tr><tr><td>71</td><td><code><pre>                                log.Warn(&#34;chan is full and new change has been dropped&#34;)</pre></code></td></tr><tr><td>72</td><td><code><pre>                        }</pre></code></td></tr><tr><td>73</td><td><code><pre>                }()</pre></code></td></tr><tr><td>74</td><td><code><pre>        }</pre></code></td></tr><tr><td>75</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newWeightedRoundRobinSelector">func newWeightedRoundRobinSelector</div><div class="info"><a href="#s_fn_newWeightedRoundRobinSelector">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>115</td><td><code><pre>func newWeightedRoundRobinSelector(servers map[string]string) Selector {</pre></code></td></tr><tr class="miss"><td>116</td><td><code><pre>        ss := createWeighted(servers)</pre></code></td></tr><tr class="miss"><td>117</td><td><code><pre>        return &amp;weightedRoundRobinSelector{servers: ss}</pre></code></td></tr><tr><td>118</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_weightedRoundRobinSelector.UpdateServer">func weightedRoundRobinSelector.UpdateServer</div><div class="info"><a href="#s_fn_weightedRoundRobinSelector.UpdateServer">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>132</td><td><code><pre>func (s *weightedRoundRobinSelector) UpdateServer(servers map[string]string) {</pre></code></td></tr><tr class="miss"><td>133</td><td><code><pre>        ss := createWeighted(servers)</pre></code></td></tr><tr class="miss"><td>134</td><td><code><pre>        s.servers = ss</pre></code></td></tr><tr><td>135</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.ConfigGeoSelector">func xClient.ConfigGeoSelector</div><div class="info"><a href="#s_fn_xClient.ConfigGeoSelector">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>178</td><td><code><pre>func (c *xClient) ConfigGeoSelector(latitude, longitude float64) {</pre></code></td></tr><tr class="miss"><td>179</td><td><code><pre>        c.selector = newGeoSelector(c.servers, latitude, longitude)</pre></code></td></tr><tr class="miss"><td>180</td><td><code><pre>        c.selectMode = Closest</pre></code></td></tr><tr><td>181</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_geoSelector.UpdateServer">func geoSelector.UpdateServer</div><div class="info"><a href="#s_fn_geoSelector.UpdateServer">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr><td>202</td><td><code><pre>func (s *geoSelector) UpdateServer(servers map[string]string) {</pre></code></td></tr><tr class="miss"><td>203</td><td><code><pre>        ss := createGeoServer(servers)</pre></code></td></tr><tr class="miss"><td>204</td><td><code><pre>        s.servers = ss</pre></code></td></tr><tr><td>205</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.Add">func pluginContainer.Add</div><div class="info"><a href="#s_fn_pluginContainer.Add">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/plugin.go</code>:</p></div><table class="listing">
<tr><td>24</td><td><code><pre>func (p *pluginContainer) Add(plugin Plugin) {</pre></code></td></tr><tr class="miss"><td>25</td><td><code><pre>        p.plugins = append(p.plugins, plugin)</pre></code></td></tr><tr><td>26</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MultipleServersDiscovery.Clone">func MultipleServersDiscovery.Clone</div><div class="info"><a href="#s_fn_MultipleServersDiscovery.Clone">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code>:</p></div><table class="listing">
<tr><td>26</td><td><code><pre>func (d MultipleServersDiscovery) Clone(servicePath string) ServiceDiscovery {</pre></code></td></tr><tr class="miss"><td>27</td><td><code><pre>        return &amp;d</pre></code></td></tr><tr><td>28</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewMultipleServersDiscovery">func NewMultipleServersDiscovery</div><div class="info"><a href="#s_fn_NewMultipleServersDiscovery">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code>:</p></div><table class="listing">
<tr><td>19</td><td><code><pre>func NewMultipleServersDiscovery(pairs []*KVPair) ServiceDiscovery {</pre></code></td></tr><tr class="miss"><td>20</td><td><code><pre>        return &amp;MultipleServersDiscovery{</pre></code></td></tr><tr><td>21</td><td><code><pre>                pairs: pairs,</pre></code></td></tr><tr><td>22</td><td><code><pre>        }</pre></code></td></tr><tr><td>23</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MDNSDiscovery.Close">func MDNSDiscovery.Close</div><div class="info"><a href="#s_fn_MDNSDiscovery.Close">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/mdns_discovery.go</code>:</p></div><table class="listing">
<tr><td>170</td><td><code><pre>func (d *MDNSDiscovery) Close() {</pre></code></td></tr><tr class="miss"><td>171</td><td><code><pre>        close(d.stopCh)</pre></code></td></tr><tr><td>172</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@110:13">func @110:13</div><div class="info"><a href="#s_fn_@110:13">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/mdns_discovery.go</code>:</p></div><table class="listing">
<tr><td>110</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>111</td><td><code><pre>                                                        if r := recover(); r != nil {</pre></code></td></tr><tr><td>112</td><td><code><pre></pre></code></td></tr><tr><td>113</td><td><code><pre>                                                        }</pre></code></td></tr><tr><td>114</td><td><code><pre>                                                }</pre></code></td></tr></table>

<div class="funcname" id="fn_MultipleServersDiscovery.GetServices">func MultipleServersDiscovery.GetServices</div><div class="info"><a href="#s_fn_MultipleServersDiscovery.GetServices">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code>:</p></div><table class="listing">
<tr><td>31</td><td><code><pre>func (d MultipleServersDiscovery) GetServices() []*KVPair {</pre></code></td></tr><tr class="miss"><td>32</td><td><code><pre>        return d.pairs</pre></code></td></tr><tr><td>33</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_SelectModeValues">func SelectModeValues</div><div class="info"><a href="#s_fn_SelectModeValues">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selectmode_enumer.go</code>:</p></div><table class="listing">
<tr><td>41</td><td><code><pre>func SelectModeValues() []SelectMode {</pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>        return _SelectModeValues</pre></code></td></tr><tr><td>43</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Peer2PeerDiscovery.Clone">func Peer2PeerDiscovery.Clone</div><div class="info"><a href="#s_fn_Peer2PeerDiscovery.Clone">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/peer2peer_discovery.go</code>:</p></div><table class="listing">
<tr><td>16</td><td><code><pre>func (d Peer2PeerDiscovery) Clone(servicePath string) ServiceDiscovery {</pre></code></td></tr><tr class="miss"><td>17</td><td><code><pre>        return &amp;d</pre></code></td></tr><tr><td>18</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@63:10">func @63:10</div><div class="info"><a href="#s_fn_@63:10">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code>:</p></div><table class="listing">
<tr><td>63</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>64</td><td><code><pre>                                if r := recover(); r != nil {</pre></code></td></tr><tr><td>65</td><td><code><pre></pre></code></td></tr><tr><td>66</td><td><code><pre>                                }</pre></code></td></tr><tr><td>67</td><td><code><pre>                        }</pre></code></td></tr></table>

<div class="funcname" id="fn_MDNSDiscovery.Clone">func MDNSDiscovery.Clone</div><div class="info"><a href="#s_fn_MDNSDiscovery.Clone">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/mdns_discovery.go</code>:</p></div><table class="listing">
<tr><td>62</td><td><code><pre>func (d MDNSDiscovery) Clone(servicePath string) ServiceDiscovery {</pre></code></td></tr><tr class="miss"><td>63</td><td><code><pre>        return NewMDNSDiscovery(servicePath, d.Timeout, d.WatchInterval, d.domain)</pre></code></td></tr><tr><td>64</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_ConsecCircuitBreaker.Ready">func ConsecCircuitBreaker.Ready</div><div class="info"><a href="#s_fn_ConsecCircuitBreaker.Ready">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/circuit_breaker.go</code>:</p></div><table class="listing">
<tr><td>91</td><td><code><pre>func (cb *ConsecCircuitBreaker) Ready() bool {</pre></code></td></tr><tr class="miss"><td>92</td><td><code><pre>        return cb.ready()</pre></code></td></tr><tr><td>93</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewOneClient">func NewOneClient</div><div class="info"><a href="#s_fn_NewOneClient">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>35</td><td><code><pre>func NewOneClient(failMode FailMode, selectMode SelectMode, discovery ServiceDiscovery, option Option) *OneClient {</pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>        return &amp;OneClient{</pre></code></td></tr><tr><td>37</td><td><code><pre>                failMode:   failMode,</pre></code></td></tr><tr><td>38</td><td><code><pre>                selectMode: selectMode,</pre></code></td></tr><tr><td>39</td><td><code><pre>                discovery:  discovery,</pre></code></td></tr><tr><td>40</td><td><code><pre>                option:     option,</pre></code></td></tr><tr><td>41</td><td><code><pre>                xclients:   make(map[string]XClient),</pre></code></td></tr><tr><td>42</td><td><code><pre>                selectors:  make(map[string]Selector),</pre></code></td></tr><tr><td>43</td><td><code><pre>        }</pre></code></td></tr><tr><td>44</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.All">func pluginContainer.All</div><div class="info"><a href="#s_fn_pluginContainer.All">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/plugin.go</code>:</p></div><table class="listing">
<tr><td>45</td><td><code><pre>func (p *pluginContainer) All() []Plugin {</pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>        return p.plugins</pre></code></td></tr><tr><td>47</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_ServiceError.Error">func ServiceError.Error</div><div class="info"><a href="#s_fn_ServiceError.Error">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>41</td><td><code><pre>func (e ServiceError) Error() string {</pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>        return string(e)</pre></code></td></tr><tr><td>43</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewBidirectionalOneClient">func NewBidirectionalOneClient</div><div class="info"><a href="#s_fn_NewBidirectionalOneClient">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/oneclient.go</code>:</p></div><table class="listing">
<tr><td>47</td><td><code><pre>func NewBidirectionalOneClient(failMode FailMode, selectMode SelectMode, discovery ServiceDiscovery, option Option, serverMessageChan chan&lt;- *protocol.Message) *OneClient {</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>        return &amp;OneClient{</pre></code></td></tr><tr><td>49</td><td><code><pre>                failMode:          failMode,</pre></code></td></tr><tr><td>50</td><td><code><pre>                selectMode:        selectMode,</pre></code></td></tr><tr><td>51</td><td><code><pre>                discovery:         discovery,</pre></code></td></tr><tr><td>52</td><td><code><pre>                option:            option,</pre></code></td></tr><tr><td>53</td><td><code><pre>                xclients:          make(map[string]XClient),</pre></code></td></tr><tr><td>54</td><td><code><pre>                selectors:         make(map[string]Selector),</pre></code></td></tr><tr><td>55</td><td><code><pre>                serverMessageChan: serverMessageChan,</pre></code></td></tr><tr><td>56</td><td><code><pre>        }</pre></code></td></tr><tr><td>57</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.IsClosing">func Client.IsClosing</div><div class="info"><a href="#s_fn_Client.IsClosing">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>192</td><td><code><pre>func (client *Client) IsClosing() bool {</pre></code></td></tr><tr class="miss"><td>193</td><td><code><pre>        return client.closing</pre></code></td></tr><tr><td>194</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_InprocessDiscovery.WatchService">func InprocessDiscovery.WatchService</div><div class="info"><a href="#s_fn_InprocessDiscovery.WatchService">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_discovery.go</code>:</p></div><table class="listing">
<tr><td>24</td><td><code><pre>func (d InprocessDiscovery) WatchService() chan []*KVPair {</pre></code></td></tr><tr class="miss"><td>25</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>26</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@248:17">func @248:17</div><div class="info"><a href="#s_fn_@248:17">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr class="miss"><td>248</td><td><code><pre>func(i, j int) bool { return ss[i] &lt; ss[j] }</pre></code></td></tr></table>

<div class="funcname" id="fn_InprocessDiscovery.GetServices">func InprocessDiscovery.GetServices</div><div class="info"><a href="#s_fn_InprocessDiscovery.GetServices">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_discovery.go</code>:</p></div><table class="listing">
<tr><td>19</td><td><code><pre>func (d InprocessDiscovery) GetServices() []*KVPair {</pre></code></td></tr><tr class="miss"><td>20</td><td><code><pre>        return []*KVPair{&amp;KVPair{Key: &#34;inprocess@127.0.0.1:0&#34;, Value: &#34;&#34;}}</pre></code></td></tr><tr><td>21</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_InprocessDiscovery.Clone">func InprocessDiscovery.Clone</div><div class="info"><a href="#s_fn_InprocessDiscovery.Clone">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_discovery.go</code>:</p></div><table class="listing">
<tr><td>14</td><td><code><pre>func (d InprocessDiscovery) Clone(servicePath string) ServiceDiscovery {</pre></code></td></tr><tr class="miss"><td>15</td><td><code><pre>        return &amp;d</pre></code></td></tr><tr><td>16</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@269:17">func @269:17</div><div class="info"><a href="#s_fn_@269:17">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/selector.go</code>:</p></div><table class="listing">
<tr class="miss"><td>269</td><td><code><pre>func(i, j int) bool { return ss[i] &lt; ss[j] }</pre></code></td></tr></table>

<div class="funcname" id="fn_NewInprocessDiscovery">func NewInprocessDiscovery</div><div class="info"><a href="#s_fn_NewInprocessDiscovery">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_discovery.go</code>:</p></div><table class="listing">
<tr><td>9</td><td><code><pre>func NewInprocessDiscovery() ServiceDiscovery {</pre></code></td></tr><tr class="miss"><td>10</td><td><code><pre>        return &amp;InprocessDiscovery{}</pre></code></td></tr><tr><td>11</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_inprocessClient.IsShutdown">func inprocessClient.IsShutdown</div><div class="info"><a href="#s_fn_inprocessClient.IsShutdown">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_client.go</code>:</p></div><table class="listing">
<tr><td>146</td><td><code><pre>func (client *inprocessClient) IsShutdown() bool {</pre></code></td></tr><tr class="miss"><td>147</td><td><code><pre>        return false</pre></code></td></tr><tr><td>148</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_inprocessClient.IsClosing">func inprocessClient.IsClosing</div><div class="info"><a href="#s_fn_inprocessClient.IsClosing">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_client.go</code>:</p></div><table class="listing">
<tr><td>141</td><td><code><pre>func (client *inprocessClient) IsClosing() bool {</pre></code></td></tr><tr class="miss"><td>142</td><td><code><pre>        return false</pre></code></td></tr><tr><td>143</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewClient">func NewClient</div><div class="info"><a href="#s_fn_NewClient">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>117</td><td><code><pre>func NewClient(option Option) *Client {</pre></code></td></tr><tr class="miss"><td>118</td><td><code><pre>        return &amp;Client{</pre></code></td></tr><tr><td>119</td><td><code><pre>                option: option,</pre></code></td></tr><tr><td>120</td><td><code><pre>        }</pre></code></td></tr><tr><td>121</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.SetPlugins">func xClient.SetPlugins</div><div class="info"><a href="#s_fn_xClient.SetPlugins">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>172</td><td><code><pre>func (c *xClient) SetPlugins(plugins PluginContainer) {</pre></code></td></tr><tr class="miss"><td>173</td><td><code><pre>        c.Plugins = plugins</pre></code></td></tr><tr><td>174</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewPluginContainer">func NewPluginContainer</div><div class="info"><a href="#s_fn_NewPluginContainer">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/plugin.go</code>:</p></div><table class="listing">
<tr><td>15</td><td><code><pre>func NewPluginContainer() PluginContainer {</pre></code></td></tr><tr class="miss"><td>16</td><td><code><pre>        return &amp;pluginContainer{}</pre></code></td></tr><tr><td>17</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_xClient.Auth">func xClient.Auth</div><div class="info"><a href="#s_fn_xClient.Auth">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/xclient.go</code>:</p></div><table class="listing">
<tr><td>184</td><td><code><pre>func (c *xClient) Auth(auth string) {</pre></code></td></tr><tr class="miss"><td>185</td><td><code><pre>        c.auth = auth</pre></code></td></tr><tr><td>186</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_inprocessClient.SendRaw">func inprocessClient.SendRaw</div><div class="info"><a href="#s_fn_inprocessClient.SendRaw">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_client.go</code>:</p></div><table class="listing">
<tr><td>131</td><td><code><pre>func (client *inprocessClient) SendRaw(ctx context.Context, r *protocol.Message) (map[string]string, []byte, error) {</pre></code></td></tr><tr class="miss"><td>132</td><td><code><pre>        return nil, nil, errors.New(&#34;SendRaw method is not supported by inprocessClient&#34;)</pre></code></td></tr><tr><td>133</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_inprocessClient.UnregisterServerMessageChan">func inprocessClient.UnregisterServerMessageChan</div><div class="info"><a href="#s_fn_inprocessClient.UnregisterServerMessageChan">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_client.go</code>:</p></div><table class="listing">
<tr><td>43</td><td><code><pre>func (client *inprocessClient) UnregisterServerMessageChan() {</pre></code></td></tr><tr class="miss"><td>44</td><td><code><pre>        client.ServerMessageChan = nil</pre></code></td></tr><tr><td>45</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_inprocessClient.RegisterServerMessageChan">func inprocessClient.RegisterServerMessageChan</div><div class="info"><a href="#s_fn_inprocessClient.RegisterServerMessageChan">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_client.go</code>:</p></div><table class="listing">
<tr><td>38</td><td><code><pre>func (client *inprocessClient) RegisterServerMessageChan(ch chan&lt;- *protocol.Message) {</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>        client.ServerMessageChan = ch</pre></code></td></tr><tr><td>40</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_inprocessClient.Connect">func inprocessClient.Connect</div><div class="info"><a href="#s_fn_inprocessClient.Connect">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_client.go</code>:</p></div><table class="listing">
<tr><td>34</td><td><code><pre>func (client *inprocessClient) Connect(network, address string) error {</pre></code></td></tr><tr class="miss"><td>35</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>36</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_toString">func toString</div><div class="info"><a href="#s_fn_toString">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/hash_utils.go</code>:</p></div><table class="listing">
<tr><td>53</td><td><code><pre>func toString(obj interface{}) string {</pre></code></td></tr><tr class="miss"><td>54</td><td><code><pre>        return fmt.Sprintf(&#34;%v&#34;, obj)</pre></code></td></tr><tr><td>55</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_JumpConsistentHash">func JumpConsistentHash</div><div class="info"><a href="#s_fn_JumpConsistentHash">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/hash_utils.go</code>:</p></div><table class="listing">
<tr><td>49</td><td><code><pre>func JumpConsistentHash(len int, options ...interface{}) int {</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>        return int(Hash(genKey(options...), int32(len)))</pre></code></td></tr><tr><td>51</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_ConsecCircuitBreaker.Fail">func ConsecCircuitBreaker.Fail</div><div class="info"><a href="#s_fn_ConsecCircuitBreaker.Fail">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/circuit_breaker.go</code>:</p></div><table class="listing">
<tr><td>87</td><td><code><pre>func (cb *ConsecCircuitBreaker) Fail() {</pre></code></td></tr><tr class="miss"><td>88</td><td><code><pre>        cb.fail()</pre></code></td></tr><tr><td>89</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_hsin">func hsin</div><div class="info"><a href="#s_fn_hsin">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/geo_utils.go</code>:</p></div><table class="listing">
<tr><td>60</td><td><code><pre>func hsin(theta float64) float64 {</pre></code></td></tr><tr class="miss"><td>61</td><td><code><pre>        return math.Pow(math.Sin(theta/2), 2)</pre></code></td></tr><tr><td>62</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_FailModeValues">func FailModeValues</div><div class="info"><a href="#s_fn_FailModeValues">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/failmode_enumer.go</code>:</p></div><table class="listing">
<tr><td>39</td><td><code><pre>func FailModeValues() []FailMode {</pre></code></td></tr><tr class="miss"><td>40</td><td><code><pre>        return _FailModeValues</pre></code></td></tr><tr><td>41</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_weightedICMPSelector.Select">func weightedICMPSelector.Select</div><div class="info"><a href="#s_fn_weightedICMPSelector.Select">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/ping_excluded.go</code>:</p></div><table class="listing">
<tr><td>14</td><td><code><pre>func (s weightedICMPSelector) Select(ctx context.Context, servicePath, serviceMethod string, args interface{}) string {</pre></code></td></tr><tr class="miss"><td>15</td><td><code><pre>        return &#34;&#34;</pre></code></td></tr><tr><td>16</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newWeightedICMPSelector">func newWeightedICMPSelector</div><div class="info"><a href="#s_fn_newWeightedICMPSelector">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/ping_excluded.go</code>:</p></div><table class="listing">
<tr><td>10</td><td><code><pre>func newWeightedICMPSelector(servers map[string]string) Selector {</pre></code></td></tr><tr class="miss"><td>11</td><td><code><pre>        panic(errors.New(&#34;this lib has not been with tag &#39;ping&#39; &#34;))</pre></code></td></tr><tr><td>12</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newDirectQuicConn">func newDirectQuicConn</div><div class="info"><a href="#s_fn_newDirectQuicConn">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/connection_nonquic.go</code>:</p></div><table class="listing">
<tr><td>10</td><td><code><pre>func newDirectQuicConn(c *Client, network, address string) (net.Conn, error) {</pre></code></td></tr><tr class="miss"><td>11</td><td><code><pre>        return nil, errors.New(&#34;quic unsupported&#34;)</pre></code></td></tr><tr><td>12</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_newDirectKCPConn">func newDirectKCPConn</div><div class="info"><a href="#s_fn_newDirectKCPConn">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/connection_nonkcp.go</code>:</p></div><table class="listing">
<tr><td>10</td><td><code><pre>func newDirectKCPConn(c *Client, network, address string) (net.Conn, error) {</pre></code></td></tr><tr class="miss"><td>11</td><td><code><pre>        return nil, errors.New(&#34;kcp unsupported&#34;)</pre></code></td></tr><tr><td>12</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_ConsecCircuitBreaker.Success">func ConsecCircuitBreaker.Success</div><div class="info"><a href="#s_fn_ConsecCircuitBreaker.Success">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/circuit_breaker.go</code>:</p></div><table class="listing">
<tr><td>84</td><td><code><pre>func (cb *ConsecCircuitBreaker) Success() {</pre></code></td></tr><tr class="miss"><td>85</td><td><code><pre>        cb.success()</pre></code></td></tr><tr><td>86</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.IsShutdown">func Client.IsShutdown</div><div class="info"><a href="#s_fn_Client.IsShutdown">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>197</td><td><code><pre>func (client *Client) IsShutdown() bool {</pre></code></td></tr><tr class="miss"><td>198</td><td><code><pre>        return client.shutdown</pre></code></td></tr><tr><td>199</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_inprocessClient.Close">func inprocessClient.Close</div><div class="info"><a href="#s_fn_inprocessClient.Close">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_client.go</code>:</p></div><table class="listing">
<tr><td>136</td><td><code><pre>func (client *inprocessClient) Close() error {</pre></code></td></tr><tr class="miss"><td>137</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>138</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Client.UnregisterServerMessageChan">func Client.UnregisterServerMessageChan</div><div class="info"><a href="#s_fn_Client.UnregisterServerMessageChan">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/client.go</code>:</p></div><table class="listing">
<tr><td>187</td><td><code><pre>func (client *Client) UnregisterServerMessageChan() {</pre></code></td></tr><tr class="miss"><td>188</td><td><code><pre>        client.ServerMessageChan = nil</pre></code></td></tr><tr><td>189</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MDNSDiscovery.GetServices">func MDNSDiscovery.GetServices</div><div class="info"><a href="#s_fn_MDNSDiscovery.GetServices">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/mdns_discovery.go</code>:</p></div><table class="listing">
<tr><td>67</td><td><code><pre>func (d MDNSDiscovery) GetServices() []*KVPair {</pre></code></td></tr><tr class="miss"><td>68</td><td><code><pre>        return d.pairs</pre></code></td></tr><tr><td>69</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_InprocessDiscovery.Close">func InprocessDiscovery.Close</div><div class="info"><a href="#s_fn_InprocessDiscovery.Close">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_discovery.go</code>:</p></div><table class="listing">
<tr><td>31</td><td><code><pre>func (d *InprocessDiscovery) Close() {</pre></code></td></tr><tr><td>32</td><td><code><pre></pre></code></td></tr><tr><td>33</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MultipleServersDiscovery.Close">func MultipleServersDiscovery.Close</div><div class="info"><a href="#s_fn_MultipleServersDiscovery.Close">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/multiple_servers_discovery.go</code>:</p></div><table class="listing">
<tr><td>77</td><td><code><pre>func (d *MultipleServersDiscovery) Close() {</pre></code></td></tr><tr><td>78</td><td><code><pre></pre></code></td></tr><tr><td>79</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_weightedICMPSelector.UpdateServer">func weightedICMPSelector.UpdateServer</div><div class="info"><a href="#s_fn_weightedICMPSelector.UpdateServer">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/ping_excluded.go</code>:</p></div><table class="listing">
<tr><td>18</td><td><code><pre>func (s *weightedICMPSelector) UpdateServer(servers map[string]string) {</pre></code></td></tr><tr><td>19</td><td><code><pre></pre></code></td></tr><tr><td>20</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Peer2PeerDiscovery.Close">func Peer2PeerDiscovery.Close</div><div class="info"><a href="#s_fn_Peer2PeerDiscovery.Close">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/peer2peer_discovery.go</code>:</p></div><table class="listing">
<tr><td>32</td><td><code><pre>func (d *Peer2PeerDiscovery) Close() {</pre></code></td></tr><tr><td>33</td><td><code><pre></pre></code></td></tr><tr><td>34</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Peer2PeerDiscovery.RemoveWatcher">func Peer2PeerDiscovery.RemoveWatcher</div><div class="info"><a href="#s_fn_Peer2PeerDiscovery.RemoveWatcher">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/peer2peer_discovery.go</code>:</p></div><table class="listing">
<tr><td>30</td><td><code><pre>func (d *Peer2PeerDiscovery) RemoveWatcher(ch chan []*KVPair) {}</pre></code></td></tr></table>

<div class="funcname" id="fn_InprocessDiscovery.RemoveWatcher">func InprocessDiscovery.RemoveWatcher</div><div class="info"><a href="#s_fn_InprocessDiscovery.RemoveWatcher">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/client/inprocess_discovery.go</code>:</p></div><table class="listing">
<tr><td>28</td><td><code><pre>func (d InprocessDiscovery) RemoveWatcher(ch chan []*KVPair) {</pre></code></td></tr><tr><td>29</td><td><code><pre>}</pre></code></td></tr></table>

<!-- Can be parsed by external script
PACKAGE:github.com/smallnest/rpcx/client DONE:19.50
-->

<div id="pkg_github.com/smallnest/rpcx/protocol" class="funcname">Package Overview: github.com/smallnest/rpcx/protocol <span class="packageTotal">54.72%</span></div><p>This is a coverage report created after analysis of the <code>github.com/smallnest/rpcx/protocol</code> package. It 
        has been generated with the following command:</p><pre class="cmd">gocov test github.com/smallnest/rpcx/protocol | gocov-html</pre>        <p>Here are the stats. Please select a function name to view its implementation and see what's left for testing.</p><table class="overview">
<tr id="s_fn_NewMessage"><td><code><a href="#fn_NewMessage">NewMessage(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>3/3</code></td></tr>
<tr id="s_fn_@30:7"><td><code><a href="#fn_@30:7">@30:7(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/pool.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>2/2</code></td></tr>
<tr id="s_fn_Header.CompressType"><td><code><a href="#fn_Header.CompressType">Header.CompressType(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Header.SetSeq"><td><code><a href="#fn_Header.SetSeq">Header.SetSeq(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Header.Seq"><td><code><a href="#fn_Header.Seq">Header.Seq(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Header.SetSerializeType"><td><code><a href="#fn_Header.SetSerializeType">Header.SetSerializeType(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Header.CheckMagicNumber"><td><code><a href="#fn_Header.CheckMagicNumber">Header.CheckMagicNumber(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Header.Version"><td><code><a href="#fn_Header.Version">Header.Version(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Header.SetVersion"><td><code><a href="#fn_Header.SetVersion">Header.SetVersion(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Header.SetCompressType"><td><code><a href="#fn_Header.SetCompressType">Header.SetCompressType(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Header.SetMessageType"><td><code><a href="#fn_Header.SetMessageType">Header.SetMessageType(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Header.SetMessageStatusType"><td><code><a href="#fn_Header.SetMessageStatusType">Header.SetMessageStatusType(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_encodeMetadata"><td><code><a href="#fn_encodeMetadata">encodeMetadata(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>91.67%</code></td><td class="linecount"><code>11/12</code></td></tr>
<tr id="s_fn_decodeMetadata"><td><code><a href="#fn_decodeMetadata">decodeMetadata(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>88.24%</code></td><td class="linecount"><code>15/17</code></td></tr>
<tr id="s_fn_Read"><td><code><a href="#fn_Read">Read(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>80.00%</code></td><td class="linecount"><code>4/5</code></td></tr>
<tr id="s_fn_Message.Decode"><td><code><a href="#fn_Message.Decode">Message.Decode(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>73.21%</code></td><td class="linecount"><code>41/56</code></td></tr>
<tr id="s_fn_Header.SetHeartbeat"><td><code><a href="#fn_Header.SetHeartbeat">Header.SetHeartbeat(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>66.67%</code></td><td class="linecount"><code>2/3</code></td></tr>
<tr id="s_fn_Header.SetOneway"><td><code><a href="#fn_Header.SetOneway">Header.SetOneway(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>66.67%</code></td><td class="linecount"><code>2/3</code></td></tr>
<tr id="s_fn_Message.WriteTo"><td><code><a href="#fn_Message.WriteTo">Message.WriteTo(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>63.41%</code></td><td class="linecount"><code>26/41</code></td></tr>
<tr id="s_fn_Message.Encode"><td><code><a href="#fn_Message.Encode">Message.Encode(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/29</code></td></tr>
<tr id="s_fn_Message.Clone"><td><code><a href="#fn_Message.Clone">Message.Clone(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/7</code></td></tr>
<tr id="s_fn_Message.Reset"><td><code><a href="#fn_Message.Reset">Message.Reset(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/6</code></td></tr>
<tr id="s_fn_FreeMsg"><td><code><a href="#fn_FreeMsg">FreeMsg(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/pool.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_@6:7"><td><code><a href="#fn_@6:7">@6:7(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/pool.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_RawDataCompressor.Unzip"><td><code><a href="#fn_RawDataCompressor.Unzip">RawDataCompressor.Unzip(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/compressor.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_MagicNumber"><td><code><a href="#fn_MagicNumber">MagicNumber(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_Header.MessageStatusType"><td><code><a href="#fn_Header.MessageStatusType">Header.MessageStatusType(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_Header.MessageType"><td><code><a href="#fn_Header.MessageType">Header.MessageType(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_Header.IsHeartbeat"><td><code><a href="#fn_Header.IsHeartbeat">Header.IsHeartbeat(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_Header.IsOneway"><td><code><a href="#fn_Header.IsOneway">Header.IsOneway(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_Header.SerializeType"><td><code><a href="#fn_Header.SerializeType">Header.SerializeType(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_resetHeader"><td><code><a href="#fn_resetHeader">resetHeader(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/message.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_GzipCompressor.Unzip"><td><code><a href="#fn_GzipCompressor.Unzip">GzipCompressor.Unzip(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/compressor.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_GetPooledMsg"><td><code><a href="#fn_GetPooledMsg">GetPooledMsg(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/pool.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_RawDataCompressor.Zip"><td><code><a href="#fn_RawDataCompressor.Zip">RawDataCompressor.Zip(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/compressor.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_GzipCompressor.Zip"><td><code><a href="#fn_GzipCompressor.Zip">GzipCompressor.Zip(...)</a></code></td><td><code>github.com/smallnest/rpcx/protocol/compressor.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr><td colspan="2"><code>github.com/smallnest/rpcx/protocol</code></td><td class="percent"><code>54.72%</code></td><td class="linecount"><code>116/212</code></td></tr>
</table>

<div class="funcname" id="fn_NewMessage">func NewMessage</div><div class="info"><a href="#s_fn_NewMessage">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>106</td><td><code><pre>func NewMessage() *Message {</pre></code></td></tr><tr><td>107</td><td><code><pre>        header := Header([12]byte{})</pre></code></td></tr><tr><td>108</td><td><code><pre>        header[0] = magicNumber</pre></code></td></tr><tr><td>109</td><td><code><pre></pre></code></td></tr><tr><td>110</td><td><code><pre>        return &amp;Message{</pre></code></td></tr><tr><td>111</td><td><code><pre>                Header: &amp;header,</pre></code></td></tr><tr><td>112</td><td><code><pre>        }</pre></code></td></tr><tr><td>113</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@30:7">func @30:7</div><div class="info"><a href="#s_fn_@30:7">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/pool.go</code>:</p></div><table class="listing">
<tr><td>30</td><td><code><pre>func() interface{} {</pre></code></td></tr><tr><td>31</td><td><code><pre>                data := make([]byte, 4)</pre></code></td></tr><tr><td>32</td><td><code><pre>                return &amp;data</pre></code></td></tr><tr><td>33</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.CompressType">func Header.CompressType</div><div class="info"><a href="#s_fn_Header.CompressType">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>175</td><td><code><pre>func (h Header) CompressType() CompressType {</pre></code></td></tr><tr><td>176</td><td><code><pre>        return CompressType((h[2] &amp; 0x1C) &gt;&gt; 2)</pre></code></td></tr><tr><td>177</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.SetSeq">func Header.SetSeq</div><div class="info"><a href="#s_fn_Header.SetSeq">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>210</td><td><code><pre>func (h *Header) SetSeq(seq uint64) {</pre></code></td></tr><tr><td>211</td><td><code><pre>        binary.BigEndian.PutUint64(h[4:], seq)</pre></code></td></tr><tr><td>212</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.Seq">func Header.Seq</div><div class="info"><a href="#s_fn_Header.Seq">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>205</td><td><code><pre>func (h Header) Seq() uint64 {</pre></code></td></tr><tr><td>206</td><td><code><pre>        return binary.BigEndian.Uint64(h[4:])</pre></code></td></tr><tr><td>207</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.SetSerializeType">func Header.SetSerializeType</div><div class="info"><a href="#s_fn_Header.SetSerializeType">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>200</td><td><code><pre>func (h *Header) SetSerializeType(st SerializeType) {</pre></code></td></tr><tr><td>201</td><td><code><pre>        h[3] = (h[3] &amp;^ 0xF0) | (byte(st) &lt;&lt; 4)</pre></code></td></tr><tr><td>202</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.CheckMagicNumber">func Header.CheckMagicNumber</div><div class="info"><a href="#s_fn_Header.CheckMagicNumber">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>121</td><td><code><pre>func (h Header) CheckMagicNumber() bool {</pre></code></td></tr><tr><td>122</td><td><code><pre>        return h[0] == magicNumber</pre></code></td></tr><tr><td>123</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.Version">func Header.Version</div><div class="info"><a href="#s_fn_Header.Version">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>126</td><td><code><pre>func (h Header) Version() byte {</pre></code></td></tr><tr><td>127</td><td><code><pre>        return h[1]</pre></code></td></tr><tr><td>128</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.SetVersion">func Header.SetVersion</div><div class="info"><a href="#s_fn_Header.SetVersion">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>131</td><td><code><pre>func (h *Header) SetVersion(v byte) {</pre></code></td></tr><tr><td>132</td><td><code><pre>        h[1] = v</pre></code></td></tr><tr><td>133</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.SetCompressType">func Header.SetCompressType</div><div class="info"><a href="#s_fn_Header.SetCompressType">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>180</td><td><code><pre>func (h *Header) SetCompressType(ct CompressType) {</pre></code></td></tr><tr><td>181</td><td><code><pre>        h[2] = (h[2] &amp;^ 0x1C) | ((byte(ct) &lt;&lt; 2) &amp; 0x1C)</pre></code></td></tr><tr><td>182</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.SetMessageType">func Header.SetMessageType</div><div class="info"><a href="#s_fn_Header.SetMessageType">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>141</td><td><code><pre>func (h *Header) SetMessageType(mt MessageType) {</pre></code></td></tr><tr><td>142</td><td><code><pre>        h[2] = h[2] | (byte(mt) &lt;&lt; 7)</pre></code></td></tr><tr><td>143</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.SetMessageStatusType">func Header.SetMessageStatusType</div><div class="info"><a href="#s_fn_Header.SetMessageStatusType">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>190</td><td><code><pre>func (h *Header) SetMessageStatusType(mt MessageStatusType) {</pre></code></td></tr><tr><td>191</td><td><code><pre>        h[2] = (h[2] &amp;^ 0x03) | (byte(mt) &amp; 0x03)</pre></code></td></tr><tr><td>192</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_encodeMetadata">func encodeMetadata</div><div class="info"><a href="#s_fn_encodeMetadata">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>345</td><td><code><pre>func encodeMetadata(m map[string]string) []byte {</pre></code></td></tr><tr><td>346</td><td><code><pre>        if len(m) == 0 {</pre></code></td></tr><tr class="miss"><td>347</td><td><code><pre>                return []byte{}</pre></code></td></tr><tr><td>348</td><td><code><pre>        }</pre></code></td></tr><tr><td>349</td><td><code><pre>        var buf bytes.Buffer</pre></code></td></tr><tr><td>350</td><td><code><pre>        var d = make([]byte, 4)</pre></code></td></tr><tr><td>351</td><td><code><pre>        for k, v := range m {</pre></code></td></tr><tr><td>352</td><td><code><pre>                binary.BigEndian.PutUint32(d, uint32(len(k)))</pre></code></td></tr><tr><td>353</td><td><code><pre>                buf.Write(d)</pre></code></td></tr><tr><td>354</td><td><code><pre>                buf.Write(util.StringToSliceByte(k))</pre></code></td></tr><tr><td>355</td><td><code><pre>                binary.BigEndian.PutUint32(d, uint32(len(v)))</pre></code></td></tr><tr><td>356</td><td><code><pre>                buf.Write(d)</pre></code></td></tr><tr><td>357</td><td><code><pre>                buf.Write(util.StringToSliceByte(v))</pre></code></td></tr><tr><td>358</td><td><code><pre>        }</pre></code></td></tr><tr><td>359</td><td><code><pre>        return buf.Bytes()</pre></code></td></tr><tr><td>360</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_decodeMetadata">func decodeMetadata</div><div class="info"><a href="#s_fn_decodeMetadata">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>362</td><td><code><pre>func decodeMetadata(l uint32, data []byte) (map[string]string, error) {</pre></code></td></tr><tr><td>363</td><td><code><pre>        m := make(map[string]string, 10)</pre></code></td></tr><tr><td>364</td><td><code><pre>        n := uint32(0)</pre></code></td></tr><tr><td>365</td><td><code><pre>        for n &lt; l {</pre></code></td></tr><tr><td>366</td><td><code><pre>                // parse one key and value</pre></code></td></tr><tr><td>367</td><td><code><pre>                // key</pre></code></td></tr><tr><td>368</td><td><code><pre>                sl := binary.BigEndian.Uint32(data[n : n+4])</pre></code></td></tr><tr><td>369</td><td><code><pre>                n = n + 4</pre></code></td></tr><tr><td>370</td><td><code><pre>                if n+sl &gt; l-4 {</pre></code></td></tr><tr class="miss"><td>371</td><td><code><pre>                        return m, ErrMetaKVMissing</pre></code></td></tr><tr><td>372</td><td><code><pre>                }</pre></code></td></tr><tr><td>373</td><td><code><pre>                k := string(data[n : n+sl])</pre></code></td></tr><tr><td>374</td><td><code><pre>                n = n + sl</pre></code></td></tr><tr><td>375</td><td><code><pre></pre></code></td></tr><tr><td>376</td><td><code><pre>                // value</pre></code></td></tr><tr><td>377</td><td><code><pre>                sl = binary.BigEndian.Uint32(data[n : n+4])</pre></code></td></tr><tr><td>378</td><td><code><pre>                n = n + 4</pre></code></td></tr><tr><td>379</td><td><code><pre>                if n+sl &gt; l {</pre></code></td></tr><tr class="miss"><td>380</td><td><code><pre>                        return m, ErrMetaKVMissing</pre></code></td></tr><tr><td>381</td><td><code><pre>                }</pre></code></td></tr><tr><td>382</td><td><code><pre>                v := string(data[n : n+sl])</pre></code></td></tr><tr><td>383</td><td><code><pre>                n = n + sl</pre></code></td></tr><tr><td>384</td><td><code><pre>                m[k] = v</pre></code></td></tr><tr><td>385</td><td><code><pre>        }</pre></code></td></tr><tr><td>386</td><td><code><pre></pre></code></td></tr><tr><td>387</td><td><code><pre>        return m, nil</pre></code></td></tr><tr><td>388</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Read">func Read</div><div class="info"><a href="#s_fn_Read">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>391</td><td><code><pre>func Read(r io.Reader) (*Message, error) {</pre></code></td></tr><tr><td>392</td><td><code><pre>        msg := NewMessage()</pre></code></td></tr><tr><td>393</td><td><code><pre>        err := msg.Decode(r)</pre></code></td></tr><tr><td>394</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>395</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>396</td><td><code><pre>        }</pre></code></td></tr><tr><td>397</td><td><code><pre>        return msg, nil</pre></code></td></tr><tr><td>398</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Message.Decode">func Message.Decode</div><div class="info"><a href="#s_fn_Message.Decode">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>401</td><td><code><pre>func (m *Message) Decode(r io.Reader) error {</pre></code></td></tr><tr><td>402</td><td><code><pre>        // validate rest length for each step?</pre></code></td></tr><tr><td>403</td><td><code><pre></pre></code></td></tr><tr><td>404</td><td><code><pre>        // parse header</pre></code></td></tr><tr><td>405</td><td><code><pre>        _, err := io.ReadFull(r, m.Header[:1])</pre></code></td></tr><tr><td>406</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>407</td><td><code><pre>                return err</pre></code></td></tr><tr><td>408</td><td><code><pre>        }</pre></code></td></tr><tr><td>409</td><td><code><pre>        if !m.Header.CheckMagicNumber() {</pre></code></td></tr><tr class="miss"><td>410</td><td><code><pre>                return fmt.Errorf(&#34;wrong magic number: %v&#34;, m.Header[0])</pre></code></td></tr><tr><td>411</td><td><code><pre>        }</pre></code></td></tr><tr><td>412</td><td><code><pre></pre></code></td></tr><tr><td>413</td><td><code><pre>        _, err = io.ReadFull(r, m.Header[1:])</pre></code></td></tr><tr><td>414</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>415</td><td><code><pre>                return err</pre></code></td></tr><tr><td>416</td><td><code><pre>        }</pre></code></td></tr><tr><td>417</td><td><code><pre></pre></code></td></tr><tr><td>418</td><td><code><pre>        //total</pre></code></td></tr><tr><td>419</td><td><code><pre>        lenData := poolUint32Data.Get().(*[]byte)</pre></code></td></tr><tr><td>420</td><td><code><pre>        _, err = io.ReadFull(r, *lenData)</pre></code></td></tr><tr><td>421</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>422</td><td><code><pre>                poolUint32Data.Put(lenData)</pre></code></td></tr><tr class="miss"><td>423</td><td><code><pre>                return err</pre></code></td></tr><tr><td>424</td><td><code><pre>        }</pre></code></td></tr><tr><td>425</td><td><code><pre>        l := binary.BigEndian.Uint32(*lenData)</pre></code></td></tr><tr><td>426</td><td><code><pre>        poolUint32Data.Put(lenData)</pre></code></td></tr><tr><td>427</td><td><code><pre></pre></code></td></tr><tr><td>428</td><td><code><pre>        if MaxMessageLength &gt; 0 &amp;&amp; int(l) &gt; MaxMessageLength {</pre></code></td></tr><tr class="miss"><td>429</td><td><code><pre>                return ErrMessageTooLong</pre></code></td></tr><tr><td>430</td><td><code><pre>        }</pre></code></td></tr><tr><td>431</td><td><code><pre></pre></code></td></tr><tr><td>432</td><td><code><pre>        totalL := int(l)</pre></code></td></tr><tr><td>433</td><td><code><pre>        if cap(m.data) &gt;= totalL { //reuse data</pre></code></td></tr><tr class="miss"><td>434</td><td><code><pre>                m.data = m.data[:totalL]</pre></code></td></tr><tr><td>435</td><td><code><pre>        } else {</pre></code></td></tr><tr><td>436</td><td><code><pre>                m.data = make([]byte, totalL)</pre></code></td></tr><tr><td>437</td><td><code><pre>        }</pre></code></td></tr><tr><td>438</td><td><code><pre>        data := m.data</pre></code></td></tr><tr><td>439</td><td><code><pre>        _, err = io.ReadFull(r, data)</pre></code></td></tr><tr><td>440</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>441</td><td><code><pre>                return err</pre></code></td></tr><tr><td>442</td><td><code><pre>        }</pre></code></td></tr><tr><td>443</td><td><code><pre></pre></code></td></tr><tr><td>444</td><td><code><pre>        n := 0</pre></code></td></tr><tr><td>445</td><td><code><pre>        // parse servicePath</pre></code></td></tr><tr><td>446</td><td><code><pre>        l = binary.BigEndian.Uint32(data[n:4])</pre></code></td></tr><tr><td>447</td><td><code><pre>        n = n + 4</pre></code></td></tr><tr><td>448</td><td><code><pre>        nEnd := n + int(l)</pre></code></td></tr><tr><td>449</td><td><code><pre>        m.ServicePath = util.SliceByteToString(data[n:nEnd])</pre></code></td></tr><tr><td>450</td><td><code><pre>        n = nEnd</pre></code></td></tr><tr><td>451</td><td><code><pre></pre></code></td></tr><tr><td>452</td><td><code><pre>        // parse serviceMethod</pre></code></td></tr><tr><td>453</td><td><code><pre>        l = binary.BigEndian.Uint32(data[n : n+4])</pre></code></td></tr><tr><td>454</td><td><code><pre>        n = n + 4</pre></code></td></tr><tr><td>455</td><td><code><pre>        nEnd = n + int(l)</pre></code></td></tr><tr><td>456</td><td><code><pre>        m.ServiceMethod = util.SliceByteToString(data[n:nEnd])</pre></code></td></tr><tr><td>457</td><td><code><pre>        n = nEnd</pre></code></td></tr><tr><td>458</td><td><code><pre></pre></code></td></tr><tr><td>459</td><td><code><pre>        // parse meta</pre></code></td></tr><tr><td>460</td><td><code><pre>        l = binary.BigEndian.Uint32(data[n : n+4])</pre></code></td></tr><tr><td>461</td><td><code><pre>        n = n + 4</pre></code></td></tr><tr><td>462</td><td><code><pre>        nEnd = n + int(l)</pre></code></td></tr><tr><td>463</td><td><code><pre></pre></code></td></tr><tr><td>464</td><td><code><pre>        if l &gt; 0 {</pre></code></td></tr><tr><td>465</td><td><code><pre>                m.Metadata, err = decodeMetadata(l, data[n:nEnd])</pre></code></td></tr><tr><td>466</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>467</td><td><code><pre>                        return err</pre></code></td></tr><tr><td>468</td><td><code><pre>                }</pre></code></td></tr><tr><td>469</td><td><code><pre>        }</pre></code></td></tr><tr><td>470</td><td><code><pre>        n = nEnd</pre></code></td></tr><tr><td>471</td><td><code><pre></pre></code></td></tr><tr><td>472</td><td><code><pre>        // parse payload</pre></code></td></tr><tr><td>473</td><td><code><pre>        l = binary.BigEndian.Uint32(data[n : n+4])</pre></code></td></tr><tr><td>474</td><td><code><pre>        _ = l</pre></code></td></tr><tr><td>475</td><td><code><pre>        n = n + 4</pre></code></td></tr><tr><td>476</td><td><code><pre>        m.Payload = data[n:]</pre></code></td></tr><tr><td>477</td><td><code><pre></pre></code></td></tr><tr><td>478</td><td><code><pre>        if m.CompressType() != None {</pre></code></td></tr><tr class="miss"><td>479</td><td><code><pre>                compressor := Compressors[m.CompressType()]</pre></code></td></tr><tr class="miss"><td>480</td><td><code><pre>                if compressor == nil {</pre></code></td></tr><tr class="miss"><td>481</td><td><code><pre>                        return ErrUnsupportedCompressor</pre></code></td></tr><tr><td>482</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>483</td><td><code><pre>                m.Payload, err = compressor.Unzip(m.Payload)</pre></code></td></tr><tr class="miss"><td>484</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>485</td><td><code><pre>                        return err</pre></code></td></tr><tr><td>486</td><td><code><pre>                }</pre></code></td></tr><tr><td>487</td><td><code><pre>        }</pre></code></td></tr><tr><td>488</td><td><code><pre></pre></code></td></tr><tr><td>489</td><td><code><pre>        return err</pre></code></td></tr><tr><td>490</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.SetHeartbeat">func Header.SetHeartbeat</div><div class="info"><a href="#s_fn_Header.SetHeartbeat">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>151</td><td><code><pre>func (h *Header) SetHeartbeat(hb bool) {</pre></code></td></tr><tr><td>152</td><td><code><pre>        if hb {</pre></code></td></tr><tr class="miss"><td>153</td><td><code><pre>                h[2] = h[2] | 0x40</pre></code></td></tr><tr><td>154</td><td><code><pre>        } else {</pre></code></td></tr><tr><td>155</td><td><code><pre>                h[2] = h[2] &amp;^ 0x40</pre></code></td></tr><tr><td>156</td><td><code><pre>        }</pre></code></td></tr><tr><td>157</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.SetOneway">func Header.SetOneway</div><div class="info"><a href="#s_fn_Header.SetOneway">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>166</td><td><code><pre>func (h *Header) SetOneway(oneway bool) {</pre></code></td></tr><tr><td>167</td><td><code><pre>        if oneway {</pre></code></td></tr><tr class="miss"><td>168</td><td><code><pre>                h[2] = h[2] | 0x20</pre></code></td></tr><tr><td>169</td><td><code><pre>        } else {</pre></code></td></tr><tr><td>170</td><td><code><pre>                h[2] = h[2] &amp;^ 0x20</pre></code></td></tr><tr><td>171</td><td><code><pre>        }</pre></code></td></tr><tr><td>172</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Message.WriteTo">func Message.WriteTo</div><div class="info"><a href="#s_fn_Message.WriteTo">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>277</td><td><code><pre>func (m Message) WriteTo(w io.Writer) error {</pre></code></td></tr><tr><td>278</td><td><code><pre>        _, err := w.Write(m.Header[:])</pre></code></td></tr><tr><td>279</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>280</td><td><code><pre>                return err</pre></code></td></tr><tr><td>281</td><td><code><pre>        }</pre></code></td></tr><tr><td>282</td><td><code><pre></pre></code></td></tr><tr><td>283</td><td><code><pre>        meta := encodeMetadata(m.Metadata)</pre></code></td></tr><tr><td>284</td><td><code><pre></pre></code></td></tr><tr><td>285</td><td><code><pre>        spL := len(m.ServicePath)</pre></code></td></tr><tr><td>286</td><td><code><pre>        smL := len(m.ServiceMethod)</pre></code></td></tr><tr><td>287</td><td><code><pre></pre></code></td></tr><tr><td>288</td><td><code><pre>        payload := m.Payload</pre></code></td></tr><tr><td>289</td><td><code><pre>        if m.CompressType() != None {</pre></code></td></tr><tr class="miss"><td>290</td><td><code><pre>                compressor := Compressors[m.CompressType()]</pre></code></td></tr><tr class="miss"><td>291</td><td><code><pre>                if compressor == nil {</pre></code></td></tr><tr class="miss"><td>292</td><td><code><pre>                        return ErrUnsupportedCompressor</pre></code></td></tr><tr><td>293</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>294</td><td><code><pre>                payload, err = compressor.Zip(m.Payload)</pre></code></td></tr><tr class="miss"><td>295</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>296</td><td><code><pre>                        return err</pre></code></td></tr><tr><td>297</td><td><code><pre>                }</pre></code></td></tr><tr><td>298</td><td><code><pre>        }</pre></code></td></tr><tr><td>299</td><td><code><pre></pre></code></td></tr><tr><td>300</td><td><code><pre>        totalL := (4 + spL) + (4 + smL) + (4 + len(meta)) + (4 + len(payload))</pre></code></td></tr><tr><td>301</td><td><code><pre>        err = binary.Write(w, binary.BigEndian, uint32(totalL))</pre></code></td></tr><tr><td>302</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>303</td><td><code><pre>                return err</pre></code></td></tr><tr><td>304</td><td><code><pre>        }</pre></code></td></tr><tr><td>305</td><td><code><pre></pre></code></td></tr><tr><td>306</td><td><code><pre>        //write servicePath and serviceMethod</pre></code></td></tr><tr><td>307</td><td><code><pre>        err = binary.Write(w, binary.BigEndian, uint32(len(m.ServicePath)))</pre></code></td></tr><tr><td>308</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>309</td><td><code><pre>                return err</pre></code></td></tr><tr><td>310</td><td><code><pre>        }</pre></code></td></tr><tr><td>311</td><td><code><pre>        _, err = w.Write(util.StringToSliceByte(m.ServicePath))</pre></code></td></tr><tr><td>312</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>313</td><td><code><pre>                return err</pre></code></td></tr><tr><td>314</td><td><code><pre>        }</pre></code></td></tr><tr><td>315</td><td><code><pre>        err = binary.Write(w, binary.BigEndian, uint32(len(m.ServiceMethod)))</pre></code></td></tr><tr><td>316</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>317</td><td><code><pre>                return err</pre></code></td></tr><tr><td>318</td><td><code><pre>        }</pre></code></td></tr><tr><td>319</td><td><code><pre>        _, err = w.Write(util.StringToSliceByte(m.ServiceMethod))</pre></code></td></tr><tr><td>320</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>321</td><td><code><pre>                return err</pre></code></td></tr><tr><td>322</td><td><code><pre>        }</pre></code></td></tr><tr><td>323</td><td><code><pre></pre></code></td></tr><tr><td>324</td><td><code><pre>        // write meta</pre></code></td></tr><tr><td>325</td><td><code><pre>        err = binary.Write(w, binary.BigEndian, uint32(len(meta)))</pre></code></td></tr><tr><td>326</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>327</td><td><code><pre>                return err</pre></code></td></tr><tr><td>328</td><td><code><pre>        }</pre></code></td></tr><tr><td>329</td><td><code><pre>        _, err = w.Write(meta)</pre></code></td></tr><tr><td>330</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>331</td><td><code><pre>                return err</pre></code></td></tr><tr><td>332</td><td><code><pre>        }</pre></code></td></tr><tr><td>333</td><td><code><pre></pre></code></td></tr><tr><td>334</td><td><code><pre>        //write payload</pre></code></td></tr><tr><td>335</td><td><code><pre>        err = binary.Write(w, binary.BigEndian, uint32(len(payload)))</pre></code></td></tr><tr><td>336</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>337</td><td><code><pre>                return err</pre></code></td></tr><tr><td>338</td><td><code><pre>        }</pre></code></td></tr><tr><td>339</td><td><code><pre></pre></code></td></tr><tr><td>340</td><td><code><pre>        _, err = w.Write(payload)</pre></code></td></tr><tr><td>341</td><td><code><pre>        return err</pre></code></td></tr><tr><td>342</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Message.Encode">func Message.Encode</div><div class="info"><a href="#s_fn_Message.Encode">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>226</td><td><code><pre>func (m Message) Encode() []byte {</pre></code></td></tr><tr class="miss"><td>227</td><td><code><pre>        meta := encodeMetadata(m.Metadata)</pre></code></td></tr><tr><td>228</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>229</td><td><code><pre>        spL := len(m.ServicePath)</pre></code></td></tr><tr class="miss"><td>230</td><td><code><pre>        smL := len(m.ServiceMethod)</pre></code></td></tr><tr><td>231</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>232</td><td><code><pre>        var err error</pre></code></td></tr><tr class="miss"><td>233</td><td><code><pre>        payload := m.Payload</pre></code></td></tr><tr class="miss"><td>234</td><td><code><pre>        if m.CompressType() != None {</pre></code></td></tr><tr class="miss"><td>235</td><td><code><pre>                compressor := Compressors[m.CompressType()]</pre></code></td></tr><tr class="miss"><td>236</td><td><code><pre>                if compressor == nil {</pre></code></td></tr><tr class="miss"><td>237</td><td><code><pre>                        m.SetCompressType(None)</pre></code></td></tr><tr><td>238</td><td><code><pre>                } else {</pre></code></td></tr><tr class="miss"><td>239</td><td><code><pre>                        payload, err = compressor.Zip(m.Payload)</pre></code></td></tr><tr class="miss"><td>240</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>241</td><td><code><pre>                                m.SetCompressType(None)</pre></code></td></tr><tr class="miss"><td>242</td><td><code><pre>                                payload = m.Payload</pre></code></td></tr><tr><td>243</td><td><code><pre>                        }</pre></code></td></tr><tr><td>244</td><td><code><pre>                }</pre></code></td></tr><tr><td>245</td><td><code><pre>        }</pre></code></td></tr><tr><td>246</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>247</td><td><code><pre>        totalL := (4 + spL) + (4 + smL) + (4 + len(meta)) + (4 + len(payload))</pre></code></td></tr><tr><td>248</td><td><code><pre></pre></code></td></tr><tr><td>249</td><td><code><pre>        // header + dataLen + spLen + sp + smLen + sm + metaL + meta + payloadLen + payload</pre></code></td></tr><tr class="miss"><td>250</td><td><code><pre>        metaStart := 12 + 4 + (4 + spL) + (4 + smL)</pre></code></td></tr><tr><td>251</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>252</td><td><code><pre>        payLoadStart := metaStart + (4 + len(meta))</pre></code></td></tr><tr class="miss"><td>253</td><td><code><pre>        l := 12 + 4 + totalL</pre></code></td></tr><tr><td>254</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>255</td><td><code><pre>        data := make([]byte, l)</pre></code></td></tr><tr class="miss"><td>256</td><td><code><pre>        copy(data, m.Header[:])</pre></code></td></tr><tr><td>257</td><td><code><pre></pre></code></td></tr><tr><td>258</td><td><code><pre>        //totalLen</pre></code></td></tr><tr class="miss"><td>259</td><td><code><pre>        binary.BigEndian.PutUint32(data[12:16], uint32(totalL))</pre></code></td></tr><tr><td>260</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>261</td><td><code><pre>        binary.BigEndian.PutUint32(data[16:20], uint32(spL))</pre></code></td></tr><tr class="miss"><td>262</td><td><code><pre>        copy(data[20:20+spL], util.StringToSliceByte(m.ServicePath))</pre></code></td></tr><tr><td>263</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>264</td><td><code><pre>        binary.BigEndian.PutUint32(data[20+spL:24+spL], uint32(smL))</pre></code></td></tr><tr class="miss"><td>265</td><td><code><pre>        copy(data[24+spL:metaStart], util.StringToSliceByte(m.ServiceMethod))</pre></code></td></tr><tr><td>266</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>267</td><td><code><pre>        binary.BigEndian.PutUint32(data[metaStart:metaStart+4], uint32(len(meta)))</pre></code></td></tr><tr class="miss"><td>268</td><td><code><pre>        copy(data[metaStart+4:], meta)</pre></code></td></tr><tr><td>269</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>270</td><td><code><pre>        binary.BigEndian.PutUint32(data[payLoadStart:payLoadStart+4], uint32(len(payload)))</pre></code></td></tr><tr class="miss"><td>271</td><td><code><pre>        copy(data[payLoadStart+4:], payload)</pre></code></td></tr><tr><td>272</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>273</td><td><code><pre>        return data</pre></code></td></tr><tr><td>274</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Message.Clone">func Message.Clone</div><div class="info"><a href="#s_fn_Message.Clone">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>215</td><td><code><pre>func (m Message) Clone() *Message {</pre></code></td></tr><tr class="miss"><td>216</td><td><code><pre>        header := *m.Header</pre></code></td></tr><tr class="miss"><td>217</td><td><code><pre>        c := GetPooledMsg()</pre></code></td></tr><tr class="miss"><td>218</td><td><code><pre>        header.SetCompressType(None)</pre></code></td></tr><tr class="miss"><td>219</td><td><code><pre>        c.Header = &amp;header</pre></code></td></tr><tr class="miss"><td>220</td><td><code><pre>        c.ServicePath = m.ServicePath</pre></code></td></tr><tr class="miss"><td>221</td><td><code><pre>        c.ServiceMethod = m.ServiceMethod</pre></code></td></tr><tr class="miss"><td>222</td><td><code><pre>        return c</pre></code></td></tr><tr><td>223</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Message.Reset">func Message.Reset</div><div class="info"><a href="#s_fn_Message.Reset">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>493</td><td><code><pre>func (m *Message) Reset() {</pre></code></td></tr><tr class="miss"><td>494</td><td><code><pre>        resetHeader(m.Header)</pre></code></td></tr><tr class="miss"><td>495</td><td><code><pre>        m.Metadata = nil</pre></code></td></tr><tr class="miss"><td>496</td><td><code><pre>        m.Payload = []byte{}</pre></code></td></tr><tr class="miss"><td>497</td><td><code><pre>        m.data = m.data[:0]</pre></code></td></tr><tr class="miss"><td>498</td><td><code><pre>        m.ServicePath = &#34;&#34;</pre></code></td></tr><tr class="miss"><td>499</td><td><code><pre>        m.ServiceMethod = &#34;&#34;</pre></code></td></tr><tr><td>500</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_FreeMsg">func FreeMsg</div><div class="info"><a href="#s_fn_FreeMsg">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/pool.go</code>:</p></div><table class="listing">
<tr><td>22</td><td><code><pre>func FreeMsg(msg *Message) {</pre></code></td></tr><tr class="miss"><td>23</td><td><code><pre>        if msg != nil {</pre></code></td></tr><tr class="miss"><td>24</td><td><code><pre>                msg.Reset()</pre></code></td></tr><tr class="miss"><td>25</td><td><code><pre>                msgPool.Put(msg)</pre></code></td></tr><tr><td>26</td><td><code><pre>        }</pre></code></td></tr><tr><td>27</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@6:7">func @6:7</div><div class="info"><a href="#s_fn_@6:7">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/pool.go</code>:</p></div><table class="listing">
<tr><td>6</td><td><code><pre>func() interface{} {</pre></code></td></tr><tr class="miss"><td>7</td><td><code><pre>                header := Header([12]byte{})</pre></code></td></tr><tr class="miss"><td>8</td><td><code><pre>                header[0] = magicNumber</pre></code></td></tr><tr><td>9</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>10</td><td><code><pre>                return &amp;Message{</pre></code></td></tr><tr><td>11</td><td><code><pre>                        Header: &amp;header,</pre></code></td></tr><tr><td>12</td><td><code><pre>                }</pre></code></td></tr><tr><td>13</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_RawDataCompressor.Unzip">func RawDataCompressor.Unzip</div><div class="info"><a href="#s_fn_RawDataCompressor.Unzip">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/compressor.go</code>:</p></div><table class="listing">
<tr><td>32</td><td><code><pre>func (c RawDataCompressor) Unzip(data []byte) ([]byte, error) {</pre></code></td></tr><tr class="miss"><td>33</td><td><code><pre>        return data, nil</pre></code></td></tr><tr><td>34</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MagicNumber">func MagicNumber</div><div class="info"><a href="#s_fn_MagicNumber">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>30</td><td><code><pre>func MagicNumber() byte {</pre></code></td></tr><tr class="miss"><td>31</td><td><code><pre>        return magicNumber</pre></code></td></tr><tr><td>32</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.MessageStatusType">func Header.MessageStatusType</div><div class="info"><a href="#s_fn_Header.MessageStatusType">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>185</td><td><code><pre>func (h Header) MessageStatusType() MessageStatusType {</pre></code></td></tr><tr class="miss"><td>186</td><td><code><pre>        return MessageStatusType(h[2] &amp; 0x03)</pre></code></td></tr><tr><td>187</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.MessageType">func Header.MessageType</div><div class="info"><a href="#s_fn_Header.MessageType">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>136</td><td><code><pre>func (h Header) MessageType() MessageType {</pre></code></td></tr><tr class="miss"><td>137</td><td><code><pre>        return MessageType(h[2]&amp;0x80) &gt;&gt; 7</pre></code></td></tr><tr><td>138</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.IsHeartbeat">func Header.IsHeartbeat</div><div class="info"><a href="#s_fn_Header.IsHeartbeat">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>146</td><td><code><pre>func (h Header) IsHeartbeat() bool {</pre></code></td></tr><tr class="miss"><td>147</td><td><code><pre>        return h[2]&amp;0x40 == 0x40</pre></code></td></tr><tr><td>148</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.IsOneway">func Header.IsOneway</div><div class="info"><a href="#s_fn_Header.IsOneway">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>161</td><td><code><pre>func (h Header) IsOneway() bool {</pre></code></td></tr><tr class="miss"><td>162</td><td><code><pre>        return h[2]&amp;0x20 == 0x20</pre></code></td></tr><tr><td>163</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Header.SerializeType">func Header.SerializeType</div><div class="info"><a href="#s_fn_Header.SerializeType">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>195</td><td><code><pre>func (h Header) SerializeType() SerializeType {</pre></code></td></tr><tr class="miss"><td>196</td><td><code><pre>        return SerializeType((h[3] &amp; 0xF0) &gt;&gt; 4)</pre></code></td></tr><tr><td>197</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_resetHeader">func resetHeader</div><div class="info"><a href="#s_fn_resetHeader">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/message.go</code>:</p></div><table class="listing">
<tr><td>505</td><td><code><pre>func resetHeader(h *Header) {</pre></code></td></tr><tr class="miss"><td>506</td><td><code><pre>        copy(h[1:], zeroHeader)</pre></code></td></tr><tr><td>507</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_GzipCompressor.Unzip">func GzipCompressor.Unzip</div><div class="info"><a href="#s_fn_GzipCompressor.Unzip">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/compressor.go</code>:</p></div><table class="listing">
<tr><td>21</td><td><code><pre>func (c GzipCompressor) Unzip(data []byte) ([]byte, error) {</pre></code></td></tr><tr class="miss"><td>22</td><td><code><pre>        return util.Unzip(data)</pre></code></td></tr><tr><td>23</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_GetPooledMsg">func GetPooledMsg</div><div class="info"><a href="#s_fn_GetPooledMsg">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/pool.go</code>:</p></div><table class="listing">
<tr><td>17</td><td><code><pre>func GetPooledMsg() *Message {</pre></code></td></tr><tr class="miss"><td>18</td><td><code><pre>        return msgPool.Get().(*Message)</pre></code></td></tr><tr><td>19</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_RawDataCompressor.Zip">func RawDataCompressor.Zip</div><div class="info"><a href="#s_fn_RawDataCompressor.Zip">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/compressor.go</code>:</p></div><table class="listing">
<tr><td>28</td><td><code><pre>func (c RawDataCompressor) Zip(data []byte) ([]byte, error) {</pre></code></td></tr><tr class="miss"><td>29</td><td><code><pre>        return data, nil</pre></code></td></tr><tr><td>30</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_GzipCompressor.Zip">func GzipCompressor.Zip</div><div class="info"><a href="#s_fn_GzipCompressor.Zip">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/protocol/compressor.go</code>:</p></div><table class="listing">
<tr><td>17</td><td><code><pre>func (c GzipCompressor) Zip(data []byte) ([]byte, error) {</pre></code></td></tr><tr class="miss"><td>18</td><td><code><pre>        return util.Zip(data)</pre></code></td></tr><tr><td>19</td><td><code><pre>}</pre></code></td></tr></table>

<!-- Can be parsed by external script
PACKAGE:github.com/smallnest/rpcx/protocol DONE:54.72
-->

<div id="pkg_github.com/smallnest/rpcx/server" class="funcname">Package Overview: github.com/smallnest/rpcx/server <span class="packageTotal">22.97%</span></div><p>This is a coverage report created after analysis of the <code>github.com/smallnest/rpcx/server</code> package. It 
        has been generated with the following command:</p><pre class="cmd">gocov test github.com/smallnest/rpcx/server | gocov-html</pre>        <p>Here are the stats. Please select a function name to view its implementation and see what's left for testing.</p><table class="overview">
<tr id="s_fn_Server.startHTTP1APIGateway"><td><code><a href="#fn_Server.startHTTP1APIGateway">Server.startHTTP1APIGateway(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/gateway.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>9/9</code></td></tr>
<tr id="s_fn_typePools.Init"><td><code><a href="#fn_typePools.Init">typePools.Init(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/pool.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>5/5</code></td></tr>
<tr id="s_fn_Server.RegisterName"><td><code><a href="#fn_Server.RegisterName">Server.RegisterName(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/service.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>5/5</code></td></tr>
<tr id="s_fn_init"><td><code><a href="#fn_init">init(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/listener.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>4/4</code></td></tr>
<tr id="s_fn_Server.getDoneChanLocked"><td><code><a href="#fn_Server.getDoneChanLocked">Server.getDoneChanLocked(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>3/3</code></td></tr>
<tr id="s_fn_Server.closeDoneChanLocked"><td><code><a href="#fn_Server.closeDoneChanLocked">Server.closeDoneChanLocked(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>3/3</code></td></tr>
<tr id="s_fn_Server.RegisterOnShutdown"><td><code><a href="#fn_Server.RegisterOnShutdown">Server.RegisterOnShutdown(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>3/3</code></td></tr>
<tr id="s_fn_isExportedOrBuiltinType"><td><code><a href="#fn_isExportedOrBuiltinType">isExportedOrBuiltinType(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/service.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>3/3</code></td></tr>
<tr id="s_fn_isExported"><td><code><a href="#fn_isExported">isExported(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/service.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>2/2</code></td></tr>
<tr id="s_fn_init"><td><code><a href="#fn_init">init(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/listener_unix.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>2/2</code></td></tr>
<tr id="s_fn_rpcxPrefixByteMatcher"><td><code><a href="#fn_rpcxPrefixByteMatcher">rpcxPrefixByteMatcher(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/gateway.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>2/2</code></td></tr>
<tr id="s_fn_Server.startShutdownListener"><td><code><a href="#fn_Server.startShutdownListener">Server.startShutdownListener(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_service.call"><td><code><a href="#fn_service.call">service.call(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/service.go</code></td><td class="percent"><code>85.71%</code></td><td class="linecount"><code>6/7</code></td></tr>
<tr id="s_fn_Server.startGateway"><td><code><a href="#fn_Server.startGateway">Server.startGateway(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/gateway.go</code></td><td class="percent"><code>81.82%</code></td><td class="linecount"><code>9/11</code></td></tr>
<tr id="s_fn_Server.Shutdown"><td><code><a href="#fn_Server.Shutdown">Server.Shutdown(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>81.25%</code></td><td class="linecount"><code>13/16</code></td></tr>
<tr id="s_fn_Server.closeHTTP1APIGateway"><td><code><a href="#fn_Server.closeHTTP1APIGateway">Server.closeHTTP1APIGateway(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/gateway.go</code></td><td class="percent"><code>80.00%</code></td><td class="linecount"><code>4/5</code></td></tr>
<tr id="s_fn_@17:7"><td><code><a href="#fn_@17:7">@17:7(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/pool.go</code></td><td class="percent"><code>80.00%</code></td><td class="linecount"><code>4/5</code></td></tr>
<tr id="s_fn_Server.checkProcessMsg"><td><code><a href="#fn_Server.checkProcessMsg">Server.checkProcessMsg(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>80.00%</code></td><td class="linecount"><code>4/5</code></td></tr>
<tr id="s_fn_Server.getDoneChan"><td><code><a href="#fn_Server.getDoneChan">Server.getDoneChan(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>80.00%</code></td><td class="linecount"><code>4/5</code></td></tr>
<tr id="s_fn_Server.makeListener"><td><code><a href="#fn_Server.makeListener">Server.makeListener(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/listener.go</code></td><td class="percent"><code>75.00%</code></td><td class="linecount"><code>3/4</code></td></tr>
<tr id="s_fn_NewServer"><td><code><a href="#fn_NewServer">NewServer(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>75.00%</code></td><td class="linecount"><code>3/4</code></td></tr>
<tr id="s_fn_tcpMakeListener"><td><code><a href="#fn_tcpMakeListener">tcpMakeListener(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/listener.go</code></td><td class="percent"><code>75.00%</code></td><td class="linecount"><code>3/4</code></td></tr>
<tr id="s_fn_Server.Close"><td><code><a href="#fn_Server.Close">Server.Close(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>72.73%</code></td><td class="linecount"><code>8/11</code></td></tr>
<tr id="s_fn_Server.Serve"><td><code><a href="#fn_Server.Serve">Server.Serve(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>70.00%</code></td><td class="linecount"><code>7/10</code></td></tr>
<tr id="s_fn_Server.handleRequest"><td><code><a href="#fn_Server.handleRequest">Server.handleRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>66.67%</code></td><td class="linecount"><code>26/39</code></td></tr>
<tr id="s_fn_Server.Register"><td><code><a href="#fn_Server.Register">Server.Register(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/service.go</code></td><td class="percent"><code>66.67%</code></td><td class="linecount"><code>4/6</code></td></tr>
<tr id="s_fn_@169:5"><td><code><a href="#fn_@169:5">@169:5(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>62.50%</code></td><td class="linecount"><code>5/8</code></td></tr>
<tr id="s_fn_Server.register"><td><code><a href="#fn_Server.register">Server.register(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/service.go</code></td><td class="percent"><code>56.67%</code></td><td class="linecount"><code>17/30</code></td></tr>
<tr id="s_fn_Server.startJSONRPC2"><td><code><a href="#fn_Server.startJSONRPC2">Server.startJSONRPC2(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/jsonrpc2.go</code></td><td class="percent"><code>50.00%</code></td><td class="linecount"><code>4/8</code></td></tr>
<tr id="s_fn_suitableMethods"><td><code><a href="#fn_suitableMethods">suitableMethods(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/service.go</code></td><td class="percent"><code>47.62%</code></td><td class="linecount"><code>20/42</code></td></tr>
<tr id="s_fn_pluginContainer.DoRegister"><td><code><a href="#fn_pluginContainer.DoRegister">pluginContainer.DoRegister(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/plugin.go</code></td><td class="percent"><code>44.44%</code></td><td class="linecount"><code>4/9</code></td></tr>
<tr id="s_fn_Server.serveListener"><td><code><a href="#fn_Server.serveListener">Server.serveListener(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>34.29%</code></td><td class="linecount"><code>12/35</code></td></tr>
<tr id="s_fn_typePools.Get"><td><code><a href="#fn_typePools.Get">typePools.Get(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/pool.go</code></td><td class="percent"><code>33.33%</code></td><td class="linecount"><code>2/6</code></td></tr>
<tr id="s_fn_@344:8"><td><code><a href="#fn_@344:8">@344:8(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/service.go</code></td><td class="percent"><code>33.33%</code></td><td class="linecount"><code>1/3</code></td></tr>
<tr id="s_fn_typePools.Put"><td><code><a href="#fn_typePools.Put">typePools.Put(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/pool.go</code></td><td class="percent"><code>25.00%</code></td><td class="linecount"><code>2/8</code></td></tr>
<tr id="s_fn_Server.handleGatewayRequest"><td><code><a href="#fn_Server.handleGatewayRequest">Server.handleGatewayRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/gateway.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/60</code></td></tr>
<tr id="s_fn_Server.serveConn"><td><code><a href="#fn_Server.serveConn">Server.serveConn(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/50</code></td></tr>
<tr id="s_fn_Server.registerFunction"><td><code><a href="#fn_Server.registerFunction">Server.registerFunction(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/service.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/48</code></td></tr>
<tr id="s_fn_HTTPRequest2RpcxRequest"><td><code><a href="#fn_HTTPRequest2RpcxRequest">HTTPRequest2RpcxRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/converter.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/47</code></td></tr>
<tr id="s_fn_Server.handleRequestForFunction"><td><code><a href="#fn_Server.handleRequestForFunction">Server.handleRequestForFunction(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/35</code></td></tr>
<tr id="s_fn_@391:6"><td><code><a href="#fn_@391:6">@391:6(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/28</code></td></tr>
<tr id="s_fn_Server.handleJSONRPCRequest"><td><code><a href="#fn_Server.handleJSONRPCRequest">Server.handleJSONRPCRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/jsonrpc2.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/23</code></td></tr>
<tr id="s_fn_Server.SendMessage"><td><code><a href="#fn_Server.SendMessage">Server.SendMessage(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/17</code></td></tr>
<tr id="s_fn_Server.jsonrpcHandler"><td><code><a href="#fn_Server.jsonrpcHandler">Server.jsonrpcHandler(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/jsonrpc2.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/16</code></td></tr>
<tr id="s_fn_@294:8"><td><code><a href="#fn_@294:8">@294:8(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/15</code></td></tr>
<tr id="s_fn_Server.ServeHTTP"><td><code><a href="#fn_Server.ServeHTTP">Server.ServeHTTP(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/14</code></td></tr>
<tr id="s_fn_Server.serveByHTTP"><td><code><a href="#fn_Server.serveByHTTP">Server.serveByHTTP(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/12</code></td></tr>
<tr id="s_fn_Server.readRequest"><td><code><a href="#fn_Server.readRequest">Server.readRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/11</code></td></tr>
<tr id="s_fn_Server.UnregisterAll"><td><code><a href="#fn_Server.UnregisterAll">Server.UnregisterAll(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/service.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/10</code></td></tr>
<tr id="s_fn_pluginContainer.DoUnregister"><td><code><a href="#fn_pluginContainer.DoUnregister">pluginContainer.DoUnregister(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/9</code></td></tr>
<tr id="s_fn_pluginContainer.DoRegisterFunction"><td><code><a href="#fn_pluginContainer.DoRegisterFunction">pluginContainer.DoRegisterFunction(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/9</code></td></tr>
<tr id="s_fn_pluginContainer.DoPostConnAccept"><td><code><a href="#fn_pluginContainer.DoPostConnAccept">pluginContainer.DoPostConnAccept(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/8</code></td></tr>
<tr id="s_fn_pluginContainer.Remove"><td><code><a href="#fn_pluginContainer.Remove">pluginContainer.Remove(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/7</code></td></tr>
<tr id="s_fn_pluginContainer.DoPostConnClose"><td><code><a href="#fn_pluginContainer.DoPostConnClose">pluginContainer.DoPostConnClose(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/7</code></td></tr>
<tr id="s_fn_pluginContainer.DoPreReadRequest"><td><code><a href="#fn_pluginContainer.DoPreReadRequest">pluginContainer.DoPreReadRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/6</code></td></tr>
<tr id="s_fn_pluginContainer.DoPostWriteRequest"><td><code><a href="#fn_pluginContainer.DoPostWriteRequest">pluginContainer.DoPostWriteRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/6</code></td></tr>
<tr id="s_fn_service.callForFunction"><td><code><a href="#fn_service.callForFunction">service.callForFunction(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/service.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/6</code></td></tr>
<tr id="s_fn_pluginContainer.DoPreWriteRequest"><td><code><a href="#fn_pluginContainer.DoPreWriteRequest">pluginContainer.DoPreWriteRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/6</code></td></tr>
<tr id="s_fn_pluginContainer.DoPostWriteResponse"><td><code><a href="#fn_pluginContainer.DoPostWriteResponse">pluginContainer.DoPostWriteResponse(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/6</code></td></tr>
<tr id="s_fn_pluginContainer.DoPreHandleRequest"><td><code><a href="#fn_pluginContainer.DoPreHandleRequest">pluginContainer.DoPreHandleRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/6</code></td></tr>
<tr id="s_fn_Server.RegisterFunction"><td><code><a href="#fn_Server.RegisterFunction">Server.RegisterFunction(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/service.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/6</code></td></tr>
<tr id="s_fn_VersionTag.UnmarshalJSON"><td><code><a href="#fn_VersionTag.UnmarshalJSON">VersionTag.UnmarshalJSON(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/jsonrpc2_wire.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/6</code></td></tr>
<tr id="s_fn_pluginContainer.DoPostReadRequest"><td><code><a href="#fn_pluginContainer.DoPostReadRequest">pluginContainer.DoPostReadRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/6</code></td></tr>
<tr id="s_fn_pluginContainer.DoPreWriteResponse"><td><code><a href="#fn_pluginContainer.DoPreWriteResponse">pluginContainer.DoPreWriteResponse(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/6</code></td></tr>
<tr id="s_fn_writeResponse"><td><code><a href="#fn_writeResponse">writeResponse(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/jsonrpc2.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/6</code></td></tr>
<tr id="s_fn_reuseportMakeListener"><td><code><a href="#fn_reuseportMakeListener">reuseportMakeListener(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/listener_unix.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_handleError"><td><code><a href="#fn_handleError">handleError(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_Server.Address"><td><code><a href="#fn_Server.Address">Server.Address(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_Server.RegisterFunctionName"><td><code><a href="#fn_Server.RegisterFunctionName">Server.RegisterFunctionName(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/service.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_ID.String"><td><code><a href="#fn_ID.String">ID.String(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/jsonrpc2_wire.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_Server.ActiveClientConn"><td><code><a href="#fn_Server.ActiveClientConn">Server.ActiveClientConn(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_closeChannel"><td><code><a href="#fn_closeChannel">closeChannel(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_tcp6MakeListener"><td><code><a href="#fn_tcp6MakeListener">tcp6MakeListener(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/listener.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_Server.auth"><td><code><a href="#fn_Server.auth">Server.auth(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_ID.UnmarshalJSON"><td><code><a href="#fn_ID.UnmarshalJSON">ID.UnmarshalJSON(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/jsonrpc2_wire.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_unixMakeListener"><td><code><a href="#fn_unixMakeListener">unixMakeListener(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/listener_unix.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_tcp4MakeListener"><td><code><a href="#fn_tcp4MakeListener">tcp4MakeListener(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/listener.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_validIP4"><td><code><a href="#fn_validIP4">validIP4(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_JSONRPCError.JSONRPCError"><td><code><a href="#fn_JSONRPCError.JSONRPCError">JSONRPCError.JSONRPCError(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/jsonrpc2_wire.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_@41:9"><td><code><a href="#fn_@41:9">@41:9(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/gateway.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_@366:8"><td><code><a href="#fn_@366:8">@366:8(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/service.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_ID.MarshalJSON"><td><code><a href="#fn_ID.MarshalJSON">ID.MarshalJSON(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/jsonrpc2_wire.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_@393:10"><td><code><a href="#fn_@393:10">@393:10(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_pluginContainer.All"><td><code><a href="#fn_pluginContainer.All">pluginContainer.All(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_AllowAllCORSOptions"><td><code><a href="#fn_AllowAllCORSOptions">AllowAllCORSOptions(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/jsonrpc2.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_VersionTag.MarshalJSON"><td><code><a href="#fn_VersionTag.MarshalJSON">VersionTag.MarshalJSON(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/jsonrpc2_wire.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_isShutdown"><td><code><a href="#fn_isShutdown">isShutdown(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_jsonrpcRequest.IsNotify"><td><code><a href="#fn_jsonrpcRequest.IsNotify">jsonrpcRequest.IsNotify(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/jsonrpc2_wire.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_Server.SetCORS"><td><code><a href="#fn_Server.SetCORS">Server.SetCORS(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/jsonrpc2.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_@22:9"><td><code><a href="#fn_@22:9">@22:9(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/option.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_WithReadTimeout"><td><code><a href="#fn_WithReadTimeout">WithReadTimeout(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/option.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_contextKey.String"><td><code><a href="#fn_contextKey.String">contextKey.String(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/server.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_@29:9"><td><code><a href="#fn_@29:9">@29:9(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/option.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_WithWriteTimeout"><td><code><a href="#fn_WithWriteTimeout">WithWriteTimeout(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/option.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_@38:11"><td><code><a href="#fn_@38:11">@38:11(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/pool.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_@36:9"><td><code><a href="#fn_@36:9">@36:9(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/option.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_RegisterMakeListener"><td><code><a href="#fn_RegisterMakeListener">RegisterMakeListener(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/listener.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_pluginContainer.Add"><td><code><a href="#fn_pluginContainer.Add">pluginContainer.Add(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/plugin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_WithTLSConfig"><td><code><a href="#fn_WithTLSConfig">WithTLSConfig(...)</a></code></td><td><code>github.com/smallnest/rpcx/server/option.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr><td colspan="2"><code>github.com/smallnest/rpcx/server</code></td><td class="percent"><code>22.97%</code></td><td class="linecount"><code>207/901</code></td></tr>
</table>

<div class="funcname" id="fn_Server.startHTTP1APIGateway">func Server.startHTTP1APIGateway</div><div class="info"><a href="#s_fn_Server.startHTTP1APIGateway">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/gateway.go</code>:</p></div><table class="listing">
<tr><td>48</td><td><code><pre>func (s *Server) startHTTP1APIGateway(ln net.Listener) {</pre></code></td></tr><tr><td>49</td><td><code><pre>        router := httprouter.New()</pre></code></td></tr><tr><td>50</td><td><code><pre>        router.POST(&#34;/*servicePath&#34;, s.handleGatewayRequest)</pre></code></td></tr><tr><td>51</td><td><code><pre>        router.GET(&#34;/*servicePath&#34;, s.handleGatewayRequest)</pre></code></td></tr><tr><td>52</td><td><code><pre>        router.PUT(&#34;/*servicePath&#34;, s.handleGatewayRequest)</pre></code></td></tr><tr><td>53</td><td><code><pre></pre></code></td></tr><tr><td>54</td><td><code><pre>        s.mu.Lock()</pre></code></td></tr><tr><td>55</td><td><code><pre>        s.gatewayHTTPServer = &amp;http.Server{Handler: router}</pre></code></td></tr><tr><td>56</td><td><code><pre>        s.mu.Unlock()</pre></code></td></tr><tr><td>57</td><td><code><pre>        if err := s.gatewayHTTPServer.Serve(ln); err != nil {</pre></code></td></tr><tr><td>58</td><td><code><pre>                log.Errorf(&#34;error in gateway Serve: %s&#34;, err)</pre></code></td></tr><tr><td>59</td><td><code><pre>        }</pre></code></td></tr><tr><td>60</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_typePools.Init">func typePools.Init</div><div class="info"><a href="#s_fn_typePools.Init">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/pool.go</code>:</p></div><table class="listing">
<tr><td>36</td><td><code><pre>func (p *typePools) Init(t reflect.Type) {</pre></code></td></tr><tr><td>37</td><td><code><pre>        tp := &amp;sync.Pool{}</pre></code></td></tr><tr><td>38</td><td><code><pre>        tp.New = func() interface{} {</pre></code></td></tr><tr><td>39</td><td><code><pre>                return p.New(t)</pre></code></td></tr><tr><td>40</td><td><code><pre>        }</pre></code></td></tr><tr><td>41</td><td><code><pre>        p.mu.Lock()</pre></code></td></tr><tr><td>42</td><td><code><pre>        defer p.mu.Unlock()</pre></code></td></tr><tr><td>43</td><td><code><pre>        p.pools[t] = tp</pre></code></td></tr><tr><td>44</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.RegisterName">func Server.RegisterName</div><div class="info"><a href="#s_fn_Server.RegisterName">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/service.go</code>:</p></div><table class="listing">
<tr><td>85</td><td><code><pre>func (s *Server) RegisterName(name string, rcvr interface{}, metadata string) error {</pre></code></td></tr><tr><td>86</td><td><code><pre>        if s.Plugins == nil {</pre></code></td></tr><tr><td>87</td><td><code><pre>                s.Plugins = &amp;pluginContainer{}</pre></code></td></tr><tr><td>88</td><td><code><pre>        }</pre></code></td></tr><tr><td>89</td><td><code><pre></pre></code></td></tr><tr><td>90</td><td><code><pre>        s.Plugins.DoRegister(name, rcvr, metadata)</pre></code></td></tr><tr><td>91</td><td><code><pre>        _, err := s.register(rcvr, name, true)</pre></code></td></tr><tr><td>92</td><td><code><pre>        return err</pre></code></td></tr><tr><td>93</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_init">func init</div><div class="info"><a href="#s_fn_init">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/listener.go</code>:</p></div><table class="listing">
<tr><td>11</td><td><code><pre>func init() {</pre></code></td></tr><tr><td>12</td><td><code><pre>        makeListeners[&#34;tcp&#34;] = tcpMakeListener</pre></code></td></tr><tr><td>13</td><td><code><pre>        makeListeners[&#34;tcp4&#34;] = tcp4MakeListener</pre></code></td></tr><tr><td>14</td><td><code><pre>        makeListeners[&#34;tcp6&#34;] = tcp6MakeListener</pre></code></td></tr><tr><td>15</td><td><code><pre>        makeListeners[&#34;http&#34;] = tcpMakeListener</pre></code></td></tr><tr><td>16</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.getDoneChanLocked">func Server.getDoneChanLocked</div><div class="info"><a href="#s_fn_Server.getDoneChanLocked">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>719</td><td><code><pre>func (s *Server) getDoneChanLocked() chan struct{} {</pre></code></td></tr><tr><td>720</td><td><code><pre>        if s.doneChan == nil {</pre></code></td></tr><tr><td>721</td><td><code><pre>                s.doneChan = make(chan struct{})</pre></code></td></tr><tr><td>722</td><td><code><pre>        }</pre></code></td></tr><tr><td>723</td><td><code><pre>        return s.doneChan</pre></code></td></tr><tr><td>724</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.closeDoneChanLocked">func Server.closeDoneChanLocked</div><div class="info"><a href="#s_fn_Server.closeDoneChanLocked">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>708</td><td><code><pre>func (s *Server) closeDoneChanLocked() {</pre></code></td></tr><tr><td>709</td><td><code><pre>        ch := s.getDoneChanLocked()</pre></code></td></tr><tr><td>710</td><td><code><pre>        select {</pre></code></td></tr><tr><td>711</td><td><code><pre>        case &lt;-ch:</pre></code></td></tr><tr><td>712</td><td><code><pre>                // Already closed. Don&#39;t close again.</pre></code></td></tr><tr><td>713</td><td><code><pre>        default:</pre></code></td></tr><tr><td>714</td><td><code><pre>                // Safe to close here. We&#39;re the only closer, guarded</pre></code></td></tr><tr><td>715</td><td><code><pre>                // by s.mu.</pre></code></td></tr><tr><td>716</td><td><code><pre>                close(ch)</pre></code></td></tr><tr><td>717</td><td><code><pre>        }</pre></code></td></tr><tr><td>718</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.RegisterOnShutdown">func Server.RegisterOnShutdown</div><div class="info"><a href="#s_fn_Server.RegisterOnShutdown">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>655</td><td><code><pre>func (s *Server) RegisterOnShutdown(f func(s *Server)) {</pre></code></td></tr><tr><td>656</td><td><code><pre>        s.mu.Lock()</pre></code></td></tr><tr><td>657</td><td><code><pre>        s.onShutdown = append(s.onShutdown, f)</pre></code></td></tr><tr><td>658</td><td><code><pre>        s.mu.Unlock()</pre></code></td></tr><tr><td>659</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_isExportedOrBuiltinType">func isExportedOrBuiltinType</div><div class="info"><a href="#s_fn_isExportedOrBuiltinType">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/service.go</code>:</p></div><table class="listing">
<tr><td>53</td><td><code><pre>func isExportedOrBuiltinType(t reflect.Type) bool {</pre></code></td></tr><tr><td>54</td><td><code><pre>        for t.Kind() == reflect.Ptr {</pre></code></td></tr><tr><td>55</td><td><code><pre>                t = t.Elem()</pre></code></td></tr><tr><td>56</td><td><code><pre>        }</pre></code></td></tr><tr><td>57</td><td><code><pre>        // PkgPath will be non-empty even for an exported type,</pre></code></td></tr><tr><td>58</td><td><code><pre>        // so we need to check the type name as well.</pre></code></td></tr><tr><td>59</td><td><code><pre>        return isExported(t.Name()) || t.PkgPath() == &#34;&#34;</pre></code></td></tr><tr><td>60</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_isExported">func isExported</div><div class="info"><a href="#s_fn_isExported">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/service.go</code>:</p></div><table class="listing">
<tr><td>48</td><td><code><pre>func isExported(name string) bool {</pre></code></td></tr><tr><td>49</td><td><code><pre>        rune, _ := utf8.DecodeRuneInString(name)</pre></code></td></tr><tr><td>50</td><td><code><pre>        return unicode.IsUpper(rune)</pre></code></td></tr><tr><td>51</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_init">func init</div><div class="info"><a href="#s_fn_init">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/listener_unix.go</code>:</p></div><table class="listing">
<tr><td>11</td><td><code><pre>func init() {</pre></code></td></tr><tr><td>12</td><td><code><pre>        makeListeners[&#34;reuseport&#34;] = reuseportMakeListener</pre></code></td></tr><tr><td>13</td><td><code><pre>        makeListeners[&#34;unix&#34;] = unixMakeListener</pre></code></td></tr><tr><td>14</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_rpcxPrefixByteMatcher">func rpcxPrefixByteMatcher</div><div class="info"><a href="#s_fn_rpcxPrefixByteMatcher">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/gateway.go</code>:</p></div><table class="listing">
<tr><td>39</td><td><code><pre>func rpcxPrefixByteMatcher() cmux.Matcher {</pre></code></td></tr><tr><td>40</td><td><code><pre>        magic := protocol.MagicNumber()</pre></code></td></tr><tr><td>41</td><td><code><pre>        return func(r io.Reader) bool {</pre></code></td></tr><tr><td>42</td><td><code><pre>                buf := make([]byte, 1)</pre></code></td></tr><tr><td>43</td><td><code><pre>                n, _ := r.Read(buf)</pre></code></td></tr><tr><td>44</td><td><code><pre>                return n == 1 &amp;&amp; buf[0] == magic</pre></code></td></tr><tr><td>45</td><td><code><pre>        }</pre></code></td></tr><tr><td>46</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.startShutdownListener">func Server.startShutdownListener</div><div class="info"><a href="#s_fn_Server.startShutdownListener">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>168</td><td><code><pre>func (s *Server) startShutdownListener() {</pre></code></td></tr><tr><td>169</td><td><code><pre>        go func(s *Server) {</pre></code></td></tr><tr><td>170</td><td><code><pre>                log.Info(&#34;server pid:&#34;, os.Getpid())</pre></code></td></tr><tr><td>171</td><td><code><pre>                c := make(chan os.Signal, 1)</pre></code></td></tr><tr><td>172</td><td><code><pre>                signal.Notify(c, syscall.SIGTERM)</pre></code></td></tr><tr><td>173</td><td><code><pre>                si := &lt;-c</pre></code></td></tr><tr><td>174</td><td><code><pre>                if si.String() == &#34;terminated&#34; {</pre></code></td></tr><tr><td>175</td><td><code><pre>                        if nil != s.onShutdown &amp;&amp; len(s.onShutdown) &gt; 0 {</pre></code></td></tr><tr><td>176</td><td><code><pre>                                for _, sd := range s.onShutdown {</pre></code></td></tr><tr><td>177</td><td><code><pre>                                        sd(s)</pre></code></td></tr><tr><td>178</td><td><code><pre>                                }</pre></code></td></tr><tr><td>179</td><td><code><pre>                        }</pre></code></td></tr><tr><td>180</td><td><code><pre>                }</pre></code></td></tr><tr><td>181</td><td><code><pre>        }(s)</pre></code></td></tr><tr><td>182</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_service.call">func service.call</div><div class="info"><a href="#s_fn_service.call">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/service.go</code>:</p></div><table class="listing">
<tr><td>343</td><td><code><pre>func (s *service) call(ctx context.Context, mtype *methodType, argv, replyv reflect.Value) (err error) {</pre></code></td></tr><tr><td>344</td><td><code><pre>        defer func() {</pre></code></td></tr><tr><td>345</td><td><code><pre>                if r := recover(); r != nil {</pre></code></td></tr><tr><td>346</td><td><code><pre>                        //log.Errorf(&#34;failed to invoke service: %v, stacks: %s&#34;, r, string(debug.Stack()))</pre></code></td></tr><tr><td>347</td><td><code><pre>                        err = fmt.Errorf(&#34;[service internal error]: %v, method: %s, argv: %+v&#34;,</pre></code></td></tr><tr><td>348</td><td><code><pre>                                r, mtype.method.Name, argv.Interface())</pre></code></td></tr><tr><td>349</td><td><code><pre>                        log.Handle(err)</pre></code></td></tr><tr><td>350</td><td><code><pre>                }</pre></code></td></tr><tr><td>351</td><td><code><pre>        }()</pre></code></td></tr><tr><td>352</td><td><code><pre></pre></code></td></tr><tr><td>353</td><td><code><pre>        function := mtype.method.Func</pre></code></td></tr><tr><td>354</td><td><code><pre>        // Invoke the method, providing a new value for the reply.</pre></code></td></tr><tr><td>355</td><td><code><pre>        returnValues := function.Call([]reflect.Value{s.rcvr, reflect.ValueOf(ctx), argv, replyv})</pre></code></td></tr><tr><td>356</td><td><code><pre>        // The return value for the method is an error.</pre></code></td></tr><tr><td>357</td><td><code><pre>        errInter := returnValues[0].Interface()</pre></code></td></tr><tr><td>358</td><td><code><pre>        if errInter != nil {</pre></code></td></tr><tr class="miss"><td>359</td><td><code><pre>                return errInter.(error)</pre></code></td></tr><tr><td>360</td><td><code><pre>        }</pre></code></td></tr><tr><td>361</td><td><code><pre></pre></code></td></tr><tr><td>362</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>363</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.startGateway">func Server.startGateway</div><div class="info"><a href="#s_fn_Server.startGateway">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/gateway.go</code>:</p></div><table class="listing">
<tr><td>20</td><td><code><pre>func (s *Server) startGateway(network string, ln net.Listener) net.Listener {</pre></code></td></tr><tr><td>21</td><td><code><pre>        if network != &#34;tcp&#34; &amp;&amp; network != &#34;tcp4&#34; &amp;&amp; network != &#34;tcp6&#34; {</pre></code></td></tr><tr class="miss"><td>22</td><td><code><pre>                log.Infof(&#34;network is not tcp/tcp4/tcp6 so can not start gateway&#34;)</pre></code></td></tr><tr class="miss"><td>23</td><td><code><pre>                return ln</pre></code></td></tr><tr><td>24</td><td><code><pre>        }</pre></code></td></tr><tr><td>25</td><td><code><pre></pre></code></td></tr><tr><td>26</td><td><code><pre>        m := cmux.New(ln)</pre></code></td></tr><tr><td>27</td><td><code><pre></pre></code></td></tr><tr><td>28</td><td><code><pre>        rpcxLn := m.Match(rpcxPrefixByteMatcher())</pre></code></td></tr><tr><td>29</td><td><code><pre>        jsonrpc2Ln := m.Match(cmux.HTTP1HeaderField(&#34;X-JSONRPC-2.0&#34;, &#34;true&#34;))</pre></code></td></tr><tr><td>30</td><td><code><pre>        httpLn := m.Match(cmux.HTTP1Fast())</pre></code></td></tr><tr><td>31</td><td><code><pre></pre></code></td></tr><tr><td>32</td><td><code><pre>        go s.startJSONRPC2(jsonrpc2Ln)</pre></code></td></tr><tr><td>33</td><td><code><pre>        go s.startHTTP1APIGateway(httpLn)</pre></code></td></tr><tr><td>34</td><td><code><pre>        go m.Serve()</pre></code></td></tr><tr><td>35</td><td><code><pre></pre></code></td></tr><tr><td>36</td><td><code><pre>        return rpcxLn</pre></code></td></tr><tr><td>37</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.Shutdown">func Server.Shutdown</div><div class="info"><a href="#s_fn_Server.Shutdown">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>670</td><td><code><pre>func (s *Server) Shutdown(ctx context.Context) error {</pre></code></td></tr><tr><td>671</td><td><code><pre>        if atomic.CompareAndSwapInt32(&amp;s.inShutdown, 0, 1) {</pre></code></td></tr><tr><td>672</td><td><code><pre>                log.Info(&#34;shutdown begin&#34;)</pre></code></td></tr><tr><td>673</td><td><code><pre>                ticker := time.NewTicker(shutdownPollInterval)</pre></code></td></tr><tr><td>674</td><td><code><pre>                defer ticker.Stop()</pre></code></td></tr><tr><td>675</td><td><code><pre>                for {</pre></code></td></tr><tr><td>676</td><td><code><pre>                        if s.checkProcessMsg() {</pre></code></td></tr><tr><td>677</td><td><code><pre>                                break</pre></code></td></tr><tr><td>678</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>679</td><td><code><pre>                        select {</pre></code></td></tr><tr><td>680</td><td><code><pre>                        case &lt;-ctx.Done():</pre></code></td></tr><tr class="miss"><td>681</td><td><code><pre>                                return ctx.Err()</pre></code></td></tr><tr><td>682</td><td><code><pre>                        case &lt;-ticker.C:</pre></code></td></tr><tr><td>683</td><td><code><pre>                        }</pre></code></td></tr><tr><td>684</td><td><code><pre>                }</pre></code></td></tr><tr><td>685</td><td><code><pre>                s.Close()</pre></code></td></tr><tr><td>686</td><td><code><pre></pre></code></td></tr><tr><td>687</td><td><code><pre>                if s.gatewayHTTPServer != nil {</pre></code></td></tr><tr><td>688</td><td><code><pre>                        if err := s.closeHTTP1APIGateway(ctx); err != nil {</pre></code></td></tr><tr class="miss"><td>689</td><td><code><pre>                                log.Warnf(&#34;failed to close gateway: %v&#34;, err)</pre></code></td></tr><tr><td>690</td><td><code><pre>                        } else {</pre></code></td></tr><tr><td>691</td><td><code><pre>                                log.Info(&#34;closed gateway&#34;)</pre></code></td></tr><tr><td>692</td><td><code><pre>                        }</pre></code></td></tr><tr><td>693</td><td><code><pre>                }</pre></code></td></tr><tr><td>694</td><td><code><pre>                log.Info(&#34;shutdown end&#34;)</pre></code></td></tr><tr><td>695</td><td><code><pre>        }</pre></code></td></tr><tr><td>696</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>697</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.closeHTTP1APIGateway">func Server.closeHTTP1APIGateway</div><div class="info"><a href="#s_fn_Server.closeHTTP1APIGateway">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/gateway.go</code>:</p></div><table class="listing">
<tr><td>62</td><td><code><pre>func (s *Server) closeHTTP1APIGateway(ctx context.Context) error {</pre></code></td></tr><tr><td>63</td><td><code><pre>        s.mu.Lock()</pre></code></td></tr><tr><td>64</td><td><code><pre>        defer s.mu.Unlock()</pre></code></td></tr><tr><td>65</td><td><code><pre>        if s.gatewayHTTPServer != nil {</pre></code></td></tr><tr><td>66</td><td><code><pre>                return s.gatewayHTTPServer.Shutdown(ctx)</pre></code></td></tr><tr><td>67</td><td><code><pre>        }</pre></code></td></tr><tr><td>68</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>69</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>70</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@17:7">func @17:7</div><div class="info"><a href="#s_fn_@17:7">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/pool.go</code>:</p></div><table class="listing">
<tr><td>17</td><td><code><pre>func(t reflect.Type) interface{} {</pre></code></td></tr><tr><td>18</td><td><code><pre>                var argv reflect.Value</pre></code></td></tr><tr><td>19</td><td><code><pre></pre></code></td></tr><tr><td>20</td><td><code><pre>                if t.Kind() == reflect.Ptr { // reply must be ptr</pre></code></td></tr><tr><td>21</td><td><code><pre>                        argv = reflect.New(t.Elem())</pre></code></td></tr><tr><td>22</td><td><code><pre>                } else {</pre></code></td></tr><tr class="miss"><td>23</td><td><code><pre>                        argv = reflect.New(t)</pre></code></td></tr><tr><td>24</td><td><code><pre>                }</pre></code></td></tr><tr><td>25</td><td><code><pre></pre></code></td></tr><tr><td>26</td><td><code><pre>                return argv.Interface()</pre></code></td></tr><tr><td>27</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.checkProcessMsg">func Server.checkProcessMsg</div><div class="info"><a href="#s_fn_Server.checkProcessMsg">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>699</td><td><code><pre>func (s *Server) checkProcessMsg() bool {</pre></code></td></tr><tr><td>700</td><td><code><pre>        size := s.handlerMsgNum</pre></code></td></tr><tr><td>701</td><td><code><pre>        log.Info(&#34;need handle msg size:&#34;, size)</pre></code></td></tr><tr><td>702</td><td><code><pre>        if size == 0 {</pre></code></td></tr><tr><td>703</td><td><code><pre>                return true</pre></code></td></tr><tr><td>704</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>705</td><td><code><pre>        return false</pre></code></td></tr><tr><td>706</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.getDoneChan">func Server.getDoneChan</div><div class="info"><a href="#s_fn_Server.getDoneChan">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>158</td><td><code><pre>func (s *Server) getDoneChan() &lt;-chan struct{} {</pre></code></td></tr><tr><td>159</td><td><code><pre>        s.mu.Lock()</pre></code></td></tr><tr><td>160</td><td><code><pre>        defer s.mu.Unlock()</pre></code></td></tr><tr><td>161</td><td><code><pre></pre></code></td></tr><tr><td>162</td><td><code><pre>        if s.doneChan == nil {</pre></code></td></tr><tr class="miss"><td>163</td><td><code><pre>                s.doneChan = make(chan struct{})</pre></code></td></tr><tr><td>164</td><td><code><pre>        }</pre></code></td></tr><tr><td>165</td><td><code><pre>        return s.doneChan</pre></code></td></tr><tr><td>166</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.makeListener">func Server.makeListener</div><div class="info"><a href="#s_fn_Server.makeListener">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/listener.go</code>:</p></div><table class="listing">
<tr><td>28</td><td><code><pre>func (s *Server) makeListener(network, address string) (ln net.Listener, err error) {</pre></code></td></tr><tr><td>29</td><td><code><pre>        ml := makeListeners[network]</pre></code></td></tr><tr><td>30</td><td><code><pre>        if ml == nil {</pre></code></td></tr><tr class="miss"><td>31</td><td><code><pre>                return nil, fmt.Errorf(&#34;can not make listener for %s&#34;, network)</pre></code></td></tr><tr><td>32</td><td><code><pre>        }</pre></code></td></tr><tr><td>33</td><td><code><pre>        return ml(s, address)</pre></code></td></tr><tr><td>34</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewServer">func NewServer</div><div class="info"><a href="#s_fn_NewServer">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>95</td><td><code><pre>func NewServer(options ...OptionFn) *Server {</pre></code></td></tr><tr><td>96</td><td><code><pre>        s := &amp;Server{</pre></code></td></tr><tr><td>97</td><td><code><pre>                Plugins: &amp;pluginContainer{},</pre></code></td></tr><tr><td>98</td><td><code><pre>                options: make(map[string]interface{}),</pre></code></td></tr><tr><td>99</td><td><code><pre>        }</pre></code></td></tr><tr><td>100</td><td><code><pre></pre></code></td></tr><tr><td>101</td><td><code><pre>        for _, op := range options {</pre></code></td></tr><tr class="miss"><td>102</td><td><code><pre>                op(s)</pre></code></td></tr><tr><td>103</td><td><code><pre>        }</pre></code></td></tr><tr><td>104</td><td><code><pre></pre></code></td></tr><tr><td>105</td><td><code><pre>        return s</pre></code></td></tr><tr><td>106</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_tcpMakeListener">func tcpMakeListener</div><div class="info"><a href="#s_fn_tcpMakeListener">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/listener.go</code>:</p></div><table class="listing">
<tr><td>36</td><td><code><pre>func tcpMakeListener(s *Server, address string) (ln net.Listener, err error) {</pre></code></td></tr><tr><td>37</td><td><code><pre>        if s.tlsConfig == nil {</pre></code></td></tr><tr><td>38</td><td><code><pre>                ln, err = net.Listen(&#34;tcp&#34;, address)</pre></code></td></tr><tr><td>39</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>40</td><td><code><pre>                ln, err = tls.Listen(&#34;tcp&#34;, address, s.tlsConfig)</pre></code></td></tr><tr><td>41</td><td><code><pre>        }</pre></code></td></tr><tr><td>42</td><td><code><pre></pre></code></td></tr><tr><td>43</td><td><code><pre>        return ln, err</pre></code></td></tr><tr><td>44</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.Close">func Server.Close</div><div class="info"><a href="#s_fn_Server.Close">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>636</td><td><code><pre>func (s *Server) Close() error {</pre></code></td></tr><tr><td>637</td><td><code><pre>        s.mu.Lock()</pre></code></td></tr><tr><td>638</td><td><code><pre>        defer s.mu.Unlock()</pre></code></td></tr><tr><td>639</td><td><code><pre>        s.closeDoneChanLocked()</pre></code></td></tr><tr><td>640</td><td><code><pre>        var err error</pre></code></td></tr><tr><td>641</td><td><code><pre>        if s.ln != nil {</pre></code></td></tr><tr><td>642</td><td><code><pre>                err = s.ln.Close()</pre></code></td></tr><tr><td>643</td><td><code><pre>        }</pre></code></td></tr><tr><td>644</td><td><code><pre></pre></code></td></tr><tr><td>645</td><td><code><pre>        for c := range s.activeConn {</pre></code></td></tr><tr class="miss"><td>646</td><td><code><pre>                c.Close()</pre></code></td></tr><tr class="miss"><td>647</td><td><code><pre>                delete(s.activeConn, c)</pre></code></td></tr><tr class="miss"><td>648</td><td><code><pre>                s.Plugins.DoPostConnClose(c)</pre></code></td></tr><tr><td>649</td><td><code><pre>        }</pre></code></td></tr><tr><td>650</td><td><code><pre>        return err</pre></code></td></tr><tr><td>651</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.Serve">func Server.Serve</div><div class="info"><a href="#s_fn_Server.Serve">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>186</td><td><code><pre>func (s *Server) Serve(network, address string) (err error) {</pre></code></td></tr><tr><td>187</td><td><code><pre>        s.startShutdownListener()</pre></code></td></tr><tr><td>188</td><td><code><pre>        var ln net.Listener</pre></code></td></tr><tr><td>189</td><td><code><pre>        ln, err = s.makeListener(network, address)</pre></code></td></tr><tr><td>190</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>191</td><td><code><pre>                return</pre></code></td></tr><tr><td>192</td><td><code><pre>        }</pre></code></td></tr><tr><td>193</td><td><code><pre></pre></code></td></tr><tr><td>194</td><td><code><pre>        if network == &#34;http&#34; {</pre></code></td></tr><tr class="miss"><td>195</td><td><code><pre>                s.serveByHTTP(ln, &#34;&#34;)</pre></code></td></tr><tr class="miss"><td>196</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>197</td><td><code><pre>        }</pre></code></td></tr><tr><td>198</td><td><code><pre></pre></code></td></tr><tr><td>199</td><td><code><pre>        // try to start gateway</pre></code></td></tr><tr><td>200</td><td><code><pre>        ln = s.startGateway(network, ln)</pre></code></td></tr><tr><td>201</td><td><code><pre></pre></code></td></tr><tr><td>202</td><td><code><pre>        return s.serveListener(ln)</pre></code></td></tr><tr><td>203</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.handleRequest">func Server.handleRequest</div><div class="info"><a href="#s_fn_Server.handleRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>481</td><td><code><pre>func (s *Server) handleRequest(ctx context.Context, req *protocol.Message) (res *protocol.Message, err error) {</pre></code></td></tr><tr><td>482</td><td><code><pre>        serviceName := req.ServicePath</pre></code></td></tr><tr><td>483</td><td><code><pre>        methodName := req.ServiceMethod</pre></code></td></tr><tr><td>484</td><td><code><pre></pre></code></td></tr><tr><td>485</td><td><code><pre>        res = req.Clone()</pre></code></td></tr><tr><td>486</td><td><code><pre></pre></code></td></tr><tr><td>487</td><td><code><pre>        res.SetMessageType(protocol.Response)</pre></code></td></tr><tr><td>488</td><td><code><pre>        s.serviceMapMu.RLock()</pre></code></td></tr><tr><td>489</td><td><code><pre>        service := s.serviceMap[serviceName]</pre></code></td></tr><tr><td>490</td><td><code><pre>        s.serviceMapMu.RUnlock()</pre></code></td></tr><tr><td>491</td><td><code><pre>        if service == nil {</pre></code></td></tr><tr class="miss"><td>492</td><td><code><pre>                err = errors.New(&#34;rpcx: can&#39;t find service &#34; + serviceName)</pre></code></td></tr><tr class="miss"><td>493</td><td><code><pre>                return handleError(res, err)</pre></code></td></tr><tr><td>494</td><td><code><pre>        }</pre></code></td></tr><tr><td>495</td><td><code><pre>        mtype := service.method[methodName]</pre></code></td></tr><tr><td>496</td><td><code><pre>        if mtype == nil {</pre></code></td></tr><tr class="miss"><td>497</td><td><code><pre>                if service.function[methodName] != nil { //check raw functions</pre></code></td></tr><tr class="miss"><td>498</td><td><code><pre>                        return s.handleRequestForFunction(ctx, req)</pre></code></td></tr><tr><td>499</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>500</td><td><code><pre>                err = errors.New(&#34;rpcx: can&#39;t find method &#34; + methodName)</pre></code></td></tr><tr class="miss"><td>501</td><td><code><pre>                return handleError(res, err)</pre></code></td></tr><tr><td>502</td><td><code><pre>        }</pre></code></td></tr><tr><td>503</td><td><code><pre></pre></code></td></tr><tr><td>504</td><td><code><pre>        var argv = argsReplyPools.Get(mtype.ArgType)</pre></code></td></tr><tr><td>505</td><td><code><pre></pre></code></td></tr><tr><td>506</td><td><code><pre>        codec := share.Codecs[req.SerializeType()]</pre></code></td></tr><tr><td>507</td><td><code><pre>        if codec == nil {</pre></code></td></tr><tr class="miss"><td>508</td><td><code><pre>                err = fmt.Errorf(&#34;can not find codec for %d&#34;, req.SerializeType())</pre></code></td></tr><tr class="miss"><td>509</td><td><code><pre>                return handleError(res, err)</pre></code></td></tr><tr><td>510</td><td><code><pre>        }</pre></code></td></tr><tr><td>511</td><td><code><pre></pre></code></td></tr><tr><td>512</td><td><code><pre>        err = codec.Decode(req.Payload, argv)</pre></code></td></tr><tr><td>513</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>514</td><td><code><pre>                return handleError(res, err)</pre></code></td></tr><tr><td>515</td><td><code><pre>        }</pre></code></td></tr><tr><td>516</td><td><code><pre></pre></code></td></tr><tr><td>517</td><td><code><pre>        replyv := argsReplyPools.Get(mtype.ReplyType)</pre></code></td></tr><tr><td>518</td><td><code><pre></pre></code></td></tr><tr><td>519</td><td><code><pre>        if mtype.ArgType.Kind() != reflect.Ptr {</pre></code></td></tr><tr class="miss"><td>520</td><td><code><pre>                err = service.call(ctx, mtype, reflect.ValueOf(argv).Elem(), reflect.ValueOf(replyv))</pre></code></td></tr><tr><td>521</td><td><code><pre>        } else {</pre></code></td></tr><tr><td>522</td><td><code><pre>                err = service.call(ctx, mtype, reflect.ValueOf(argv), reflect.ValueOf(replyv))</pre></code></td></tr><tr><td>523</td><td><code><pre>        }</pre></code></td></tr><tr><td>524</td><td><code><pre></pre></code></td></tr><tr><td>525</td><td><code><pre>        argsReplyPools.Put(mtype.ArgType, argv)</pre></code></td></tr><tr><td>526</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>527</td><td><code><pre>                argsReplyPools.Put(mtype.ReplyType, replyv)</pre></code></td></tr><tr class="miss"><td>528</td><td><code><pre>                return handleError(res, err)</pre></code></td></tr><tr><td>529</td><td><code><pre>        }</pre></code></td></tr><tr><td>530</td><td><code><pre></pre></code></td></tr><tr><td>531</td><td><code><pre>        if !req.IsOneway() {</pre></code></td></tr><tr><td>532</td><td><code><pre>                data, err := codec.Encode(replyv)</pre></code></td></tr><tr><td>533</td><td><code><pre>                argsReplyPools.Put(mtype.ReplyType, replyv)</pre></code></td></tr><tr><td>534</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>535</td><td><code><pre>                        return handleError(res, err)</pre></code></td></tr><tr><td>536</td><td><code><pre></pre></code></td></tr><tr><td>537</td><td><code><pre>                }</pre></code></td></tr><tr><td>538</td><td><code><pre>                res.Payload = data</pre></code></td></tr><tr><td>539</td><td><code><pre>        }</pre></code></td></tr><tr><td>540</td><td><code><pre></pre></code></td></tr><tr><td>541</td><td><code><pre>        return res, nil</pre></code></td></tr><tr><td>542</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.Register">func Server.Register</div><div class="info"><a href="#s_fn_Server.Register">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/service.go</code>:</p></div><table class="listing">
<tr><td>72</td><td><code><pre>func (s *Server) Register(rcvr interface{}, metadata string) error {</pre></code></td></tr><tr><td>73</td><td><code><pre>        sname, err := s.register(rcvr, &#34;&#34;, false)</pre></code></td></tr><tr><td>74</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>75</td><td><code><pre>                return err</pre></code></td></tr><tr><td>76</td><td><code><pre>        }</pre></code></td></tr><tr><td>77</td><td><code><pre>        if s.Plugins == nil {</pre></code></td></tr><tr class="miss"><td>78</td><td><code><pre>                s.Plugins = &amp;pluginContainer{}</pre></code></td></tr><tr><td>79</td><td><code><pre>        }</pre></code></td></tr><tr><td>80</td><td><code><pre>        return s.Plugins.DoRegister(sname, rcvr, metadata)</pre></code></td></tr><tr><td>81</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@169:5">func @169:5</div><div class="info"><a href="#s_fn_@169:5">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>169</td><td><code><pre>func(s *Server) {</pre></code></td></tr><tr><td>170</td><td><code><pre>                log.Info(&#34;server pid:&#34;, os.Getpid())</pre></code></td></tr><tr><td>171</td><td><code><pre>                c := make(chan os.Signal, 1)</pre></code></td></tr><tr><td>172</td><td><code><pre>                signal.Notify(c, syscall.SIGTERM)</pre></code></td></tr><tr><td>173</td><td><code><pre>                si := &lt;-c</pre></code></td></tr><tr><td>174</td><td><code><pre>                if si.String() == &#34;terminated&#34; {</pre></code></td></tr><tr class="miss"><td>175</td><td><code><pre>                        if nil != s.onShutdown &amp;&amp; len(s.onShutdown) &gt; 0 {</pre></code></td></tr><tr class="miss"><td>176</td><td><code><pre>                                for _, sd := range s.onShutdown {</pre></code></td></tr><tr class="miss"><td>177</td><td><code><pre>                                        sd(s)</pre></code></td></tr><tr><td>178</td><td><code><pre>                                }</pre></code></td></tr><tr><td>179</td><td><code><pre>                        }</pre></code></td></tr><tr><td>180</td><td><code><pre>                }</pre></code></td></tr><tr><td>181</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.register">func Server.register</div><div class="info"><a href="#s_fn_Server.register">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/service.go</code>:</p></div><table class="listing">
<tr><td>124</td><td><code><pre>func (s *Server) register(rcvr interface{}, name string, useName bool) (string, error) {</pre></code></td></tr><tr><td>125</td><td><code><pre>        s.serviceMapMu.Lock()</pre></code></td></tr><tr><td>126</td><td><code><pre>        defer s.serviceMapMu.Unlock()</pre></code></td></tr><tr><td>127</td><td><code><pre>        if s.serviceMap == nil {</pre></code></td></tr><tr><td>128</td><td><code><pre>                s.serviceMap = make(map[string]*service)</pre></code></td></tr><tr><td>129</td><td><code><pre>        }</pre></code></td></tr><tr><td>130</td><td><code><pre></pre></code></td></tr><tr><td>131</td><td><code><pre>        service := new(service)</pre></code></td></tr><tr><td>132</td><td><code><pre>        service.typ = reflect.TypeOf(rcvr)</pre></code></td></tr><tr><td>133</td><td><code><pre>        service.rcvr = reflect.ValueOf(rcvr)</pre></code></td></tr><tr><td>134</td><td><code><pre>        sname := reflect.Indirect(service.rcvr).Type().Name() // Type</pre></code></td></tr><tr><td>135</td><td><code><pre>        if useName {</pre></code></td></tr><tr><td>136</td><td><code><pre>                sname = name</pre></code></td></tr><tr><td>137</td><td><code><pre>        }</pre></code></td></tr><tr><td>138</td><td><code><pre>        if sname == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>139</td><td><code><pre>                errorStr := &#34;rpcx.Register: no service name for type &#34; + service.typ.String()</pre></code></td></tr><tr class="miss"><td>140</td><td><code><pre>                log.Error(errorStr)</pre></code></td></tr><tr class="miss"><td>141</td><td><code><pre>                return sname, errors.New(errorStr)</pre></code></td></tr><tr><td>142</td><td><code><pre>        }</pre></code></td></tr><tr><td>143</td><td><code><pre>        if !useName &amp;&amp; !isExported(sname) {</pre></code></td></tr><tr class="miss"><td>144</td><td><code><pre>                errorStr := &#34;rpcx.Register: type &#34; + sname + &#34; is not exported&#34;</pre></code></td></tr><tr class="miss"><td>145</td><td><code><pre>                log.Error(errorStr)</pre></code></td></tr><tr class="miss"><td>146</td><td><code><pre>                return sname, errors.New(errorStr)</pre></code></td></tr><tr><td>147</td><td><code><pre>        }</pre></code></td></tr><tr><td>148</td><td><code><pre>        service.name = sname</pre></code></td></tr><tr><td>149</td><td><code><pre></pre></code></td></tr><tr><td>150</td><td><code><pre>        // Install the methods</pre></code></td></tr><tr><td>151</td><td><code><pre>        service.method = suitableMethods(service.typ, true)</pre></code></td></tr><tr><td>152</td><td><code><pre></pre></code></td></tr><tr><td>153</td><td><code><pre>        if len(service.method) == 0 {</pre></code></td></tr><tr class="miss"><td>154</td><td><code><pre>                var errorStr string</pre></code></td></tr><tr><td>155</td><td><code><pre></pre></code></td></tr><tr><td>156</td><td><code><pre>                // To help the user, see if a pointer receiver would work.</pre></code></td></tr><tr class="miss"><td>157</td><td><code><pre>                method := suitableMethods(reflect.PtrTo(service.typ), false)</pre></code></td></tr><tr class="miss"><td>158</td><td><code><pre>                if len(method) != 0 {</pre></code></td></tr><tr class="miss"><td>159</td><td><code><pre>                        errorStr = &#34;rpcx.Register: type &#34; + sname + &#34; has no exported methods of suitable type (hint: pass a pointer to value of that type)&#34;</pre></code></td></tr><tr><td>160</td><td><code><pre>                } else {</pre></code></td></tr><tr class="miss"><td>161</td><td><code><pre>                        errorStr = &#34;rpcx.Register: type &#34; + sname + &#34; has no exported methods of suitable type&#34;</pre></code></td></tr><tr><td>162</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>163</td><td><code><pre>                log.Error(errorStr)</pre></code></td></tr><tr class="miss"><td>164</td><td><code><pre>                return sname, errors.New(errorStr)</pre></code></td></tr><tr><td>165</td><td><code><pre>        }</pre></code></td></tr><tr><td>166</td><td><code><pre>        s.serviceMap[service.name] = service</pre></code></td></tr><tr><td>167</td><td><code><pre>        return sname, nil</pre></code></td></tr><tr><td>168</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.startJSONRPC2">func Server.startJSONRPC2</div><div class="info"><a href="#s_fn_Server.startJSONRPC2">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/jsonrpc2.go</code>:</p></div><table class="listing">
<tr><td>170</td><td><code><pre>func (s *Server) startJSONRPC2(ln net.Listener) {</pre></code></td></tr><tr><td>171</td><td><code><pre>        newServer := http.NewServeMux()</pre></code></td></tr><tr><td>172</td><td><code><pre>        newServer.HandleFunc(&#34;/&#34;, s.jsonrpcHandler)</pre></code></td></tr><tr><td>173</td><td><code><pre></pre></code></td></tr><tr><td>174</td><td><code><pre>        if s.corsOptions != nil {</pre></code></td></tr><tr class="miss"><td>175</td><td><code><pre>                opt := cors.Options(*s.corsOptions)</pre></code></td></tr><tr class="miss"><td>176</td><td><code><pre>                c := cors.New(opt)</pre></code></td></tr><tr class="miss"><td>177</td><td><code><pre>                mux := c.Handler(newServer)</pre></code></td></tr><tr class="miss"><td>178</td><td><code><pre>                go http.Serve(ln, mux)</pre></code></td></tr><tr><td>179</td><td><code><pre>        } else {</pre></code></td></tr><tr><td>180</td><td><code><pre>                go http.Serve(ln, newServer)</pre></code></td></tr><tr><td>181</td><td><code><pre>        }</pre></code></td></tr><tr><td>182</td><td><code><pre></pre></code></td></tr><tr><td>183</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_suitableMethods">func suitableMethods</div><div class="info"><a href="#s_fn_suitableMethods">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/service.go</code>:</p></div><table class="listing">
<tr><td>251</td><td><code><pre>func suitableMethods(typ reflect.Type, reportErr bool) map[string]*methodType {</pre></code></td></tr><tr><td>252</td><td><code><pre>        methods := make(map[string]*methodType)</pre></code></td></tr><tr><td>253</td><td><code><pre>        for m := 0; m &lt; typ.NumMethod(); m++ {</pre></code></td></tr><tr><td>254</td><td><code><pre>                method := typ.Method(m)</pre></code></td></tr><tr><td>255</td><td><code><pre>                mtype := method.Type</pre></code></td></tr><tr><td>256</td><td><code><pre>                mname := method.Name</pre></code></td></tr><tr><td>257</td><td><code><pre>                // Method must be exported.</pre></code></td></tr><tr><td>258</td><td><code><pre>                if method.PkgPath != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>259</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>260</td><td><code><pre>                }</pre></code></td></tr><tr><td>261</td><td><code><pre>                // Method needs four ins: receiver, context.Context, *args, *reply.</pre></code></td></tr><tr><td>262</td><td><code><pre>                if mtype.NumIn() != 4 {</pre></code></td></tr><tr class="miss"><td>263</td><td><code><pre>                        if reportErr {</pre></code></td></tr><tr class="miss"><td>264</td><td><code><pre>                                log.Info(&#34;method&#34;, mname, &#34; has wrong number of ins:&#34;, mtype.NumIn())</pre></code></td></tr><tr><td>265</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>266</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>267</td><td><code><pre>                }</pre></code></td></tr><tr><td>268</td><td><code><pre>                // First arg must be context.Context</pre></code></td></tr><tr><td>269</td><td><code><pre>                ctxType := mtype.In(1)</pre></code></td></tr><tr><td>270</td><td><code><pre>                if !ctxType.Implements(typeOfContext) {</pre></code></td></tr><tr class="miss"><td>271</td><td><code><pre>                        if reportErr {</pre></code></td></tr><tr class="miss"><td>272</td><td><code><pre>                                log.Info(&#34;method&#34;, mname, &#34; must use context.Context as the first parameter&#34;)</pre></code></td></tr><tr><td>273</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>274</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>275</td><td><code><pre>                }</pre></code></td></tr><tr><td>276</td><td><code><pre></pre></code></td></tr><tr><td>277</td><td><code><pre>                // Second arg need not be a pointer.</pre></code></td></tr><tr><td>278</td><td><code><pre>                argType := mtype.In(2)</pre></code></td></tr><tr><td>279</td><td><code><pre>                if !isExportedOrBuiltinType(argType) {</pre></code></td></tr><tr class="miss"><td>280</td><td><code><pre>                        if reportErr {</pre></code></td></tr><tr class="miss"><td>281</td><td><code><pre>                                log.Info(mname, &#34; parameter type not exported: &#34;, argType)</pre></code></td></tr><tr><td>282</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>283</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>284</td><td><code><pre>                }</pre></code></td></tr><tr><td>285</td><td><code><pre>                // Third arg must be a pointer.</pre></code></td></tr><tr><td>286</td><td><code><pre>                replyType := mtype.In(3)</pre></code></td></tr><tr><td>287</td><td><code><pre>                if replyType.Kind() != reflect.Ptr {</pre></code></td></tr><tr class="miss"><td>288</td><td><code><pre>                        if reportErr {</pre></code></td></tr><tr class="miss"><td>289</td><td><code><pre>                                log.Info(&#34;method&#34;, mname, &#34; reply type not a pointer:&#34;, replyType)</pre></code></td></tr><tr><td>290</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>291</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>292</td><td><code><pre>                }</pre></code></td></tr><tr><td>293</td><td><code><pre>                // Reply type must be exported.</pre></code></td></tr><tr><td>294</td><td><code><pre>                if !isExportedOrBuiltinType(replyType) {</pre></code></td></tr><tr class="miss"><td>295</td><td><code><pre>                        if reportErr {</pre></code></td></tr><tr class="miss"><td>296</td><td><code><pre>                                log.Info(&#34;method&#34;, mname, &#34; reply type not exported:&#34;, replyType)</pre></code></td></tr><tr><td>297</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>298</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>299</td><td><code><pre>                }</pre></code></td></tr><tr><td>300</td><td><code><pre>                // Method needs one out.</pre></code></td></tr><tr><td>301</td><td><code><pre>                if mtype.NumOut() != 1 {</pre></code></td></tr><tr class="miss"><td>302</td><td><code><pre>                        if reportErr {</pre></code></td></tr><tr class="miss"><td>303</td><td><code><pre>                                log.Info(&#34;method&#34;, mname, &#34; has wrong number of outs:&#34;, mtype.NumOut())</pre></code></td></tr><tr><td>304</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>305</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>306</td><td><code><pre>                }</pre></code></td></tr><tr><td>307</td><td><code><pre>                // The return type of the method must be error.</pre></code></td></tr><tr><td>308</td><td><code><pre>                if returnType := mtype.Out(0); returnType != typeOfError {</pre></code></td></tr><tr class="miss"><td>309</td><td><code><pre>                        if reportErr {</pre></code></td></tr><tr class="miss"><td>310</td><td><code><pre>                                log.Info(&#34;method&#34;, mname, &#34; returns &#34;, returnType.String(), &#34; not error&#34;)</pre></code></td></tr><tr><td>311</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>312</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>313</td><td><code><pre>                }</pre></code></td></tr><tr><td>314</td><td><code><pre>                methods[mname] = &amp;methodType{method: method, ArgType: argType, ReplyType: replyType}</pre></code></td></tr><tr><td>315</td><td><code><pre></pre></code></td></tr><tr><td>316</td><td><code><pre>                argsReplyPools.Init(argType)</pre></code></td></tr><tr><td>317</td><td><code><pre>                argsReplyPools.Init(replyType)</pre></code></td></tr><tr><td>318</td><td><code><pre>        }</pre></code></td></tr><tr><td>319</td><td><code><pre>        return methods</pre></code></td></tr><tr><td>320</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoRegister">func pluginContainer.DoRegister</div><div class="info"><a href="#s_fn_pluginContainer.DoRegister">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/plugin.go</code>:</p></div><table class="listing">
<tr><td>132</td><td><code><pre>func (p *pluginContainer) DoRegister(name string, rcvr interface{}, metadata string) error {</pre></code></td></tr><tr><td>133</td><td><code><pre>        var es []error</pre></code></td></tr><tr><td>134</td><td><code><pre>        for _, rp := range p.plugins {</pre></code></td></tr><tr class="miss"><td>135</td><td><code><pre>                if plugin, ok := rp.(RegisterPlugin); ok {</pre></code></td></tr><tr class="miss"><td>136</td><td><code><pre>                        err := plugin.Register(name, rcvr, metadata)</pre></code></td></tr><tr class="miss"><td>137</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>138</td><td><code><pre>                                es = append(es, err)</pre></code></td></tr><tr><td>139</td><td><code><pre>                        }</pre></code></td></tr><tr><td>140</td><td><code><pre>                }</pre></code></td></tr><tr><td>141</td><td><code><pre>        }</pre></code></td></tr><tr><td>142</td><td><code><pre></pre></code></td></tr><tr><td>143</td><td><code><pre>        if len(es) &gt; 0 {</pre></code></td></tr><tr class="miss"><td>144</td><td><code><pre>                return errors.NewMultiError(es)</pre></code></td></tr><tr><td>145</td><td><code><pre>        }</pre></code></td></tr><tr><td>146</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>147</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.serveListener">func Server.serveListener</div><div class="info"><a href="#s_fn_Server.serveListener">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>208</td><td><code><pre>func (s *Server) serveListener(ln net.Listener) error {</pre></code></td></tr><tr><td>209</td><td><code><pre>        if s.Plugins == nil {</pre></code></td></tr><tr class="miss"><td>210</td><td><code><pre>                s.Plugins = &amp;pluginContainer{}</pre></code></td></tr><tr><td>211</td><td><code><pre>        }</pre></code></td></tr><tr><td>212</td><td><code><pre></pre></code></td></tr><tr><td>213</td><td><code><pre>        var tempDelay time.Duration</pre></code></td></tr><tr><td>214</td><td><code><pre></pre></code></td></tr><tr><td>215</td><td><code><pre>        s.mu.Lock()</pre></code></td></tr><tr><td>216</td><td><code><pre>        s.ln = ln</pre></code></td></tr><tr><td>217</td><td><code><pre>        if s.activeConn == nil {</pre></code></td></tr><tr><td>218</td><td><code><pre>                s.activeConn = make(map[net.Conn]struct{})</pre></code></td></tr><tr><td>219</td><td><code><pre>        }</pre></code></td></tr><tr><td>220</td><td><code><pre>        s.mu.Unlock()</pre></code></td></tr><tr><td>221</td><td><code><pre></pre></code></td></tr><tr><td>222</td><td><code><pre>        for {</pre></code></td></tr><tr><td>223</td><td><code><pre>                conn, e := ln.Accept()</pre></code></td></tr><tr><td>224</td><td><code><pre>                if e != nil {</pre></code></td></tr><tr><td>225</td><td><code><pre>                        select {</pre></code></td></tr><tr><td>226</td><td><code><pre>                        case &lt;-s.getDoneChan():</pre></code></td></tr><tr><td>227</td><td><code><pre>                                return ErrServerClosed</pre></code></td></tr><tr><td>228</td><td><code><pre>                        default:</pre></code></td></tr><tr><td>229</td><td><code><pre>                        }</pre></code></td></tr><tr><td>230</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>231</td><td><code><pre>                        if ne, ok := e.(net.Error); ok &amp;&amp; ne.Temporary() {</pre></code></td></tr><tr class="miss"><td>232</td><td><code><pre>                                if tempDelay == 0 {</pre></code></td></tr><tr class="miss"><td>233</td><td><code><pre>                                        tempDelay = 5 * time.Millisecond</pre></code></td></tr><tr><td>234</td><td><code><pre>                                } else {</pre></code></td></tr><tr class="miss"><td>235</td><td><code><pre>                                        tempDelay *= 2</pre></code></td></tr><tr><td>236</td><td><code><pre>                                }</pre></code></td></tr><tr><td>237</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>238</td><td><code><pre>                                if max := 1 * time.Second; tempDelay &gt; max {</pre></code></td></tr><tr class="miss"><td>239</td><td><code><pre>                                        tempDelay = max</pre></code></td></tr><tr><td>240</td><td><code><pre>                                }</pre></code></td></tr><tr><td>241</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>242</td><td><code><pre>                                log.Errorf(&#34;rpcx: Accept error: %v; retrying in %v&#34;, e, tempDelay)</pre></code></td></tr><tr class="miss"><td>243</td><td><code><pre>                                time.Sleep(tempDelay)</pre></code></td></tr><tr class="miss"><td>244</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>245</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>246</td><td><code><pre>                        return e</pre></code></td></tr><tr><td>247</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>248</td><td><code><pre>                tempDelay = 0</pre></code></td></tr><tr><td>249</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>250</td><td><code><pre>                if tc, ok := conn.(*net.TCPConn); ok {</pre></code></td></tr><tr class="miss"><td>251</td><td><code><pre>                        tc.SetKeepAlive(true)</pre></code></td></tr><tr class="miss"><td>252</td><td><code><pre>                        tc.SetKeepAlivePeriod(3 * time.Minute)</pre></code></td></tr><tr class="miss"><td>253</td><td><code><pre>                        tc.SetLinger(10)</pre></code></td></tr><tr><td>254</td><td><code><pre>                }</pre></code></td></tr><tr><td>255</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>256</td><td><code><pre>                s.mu.Lock()</pre></code></td></tr><tr class="miss"><td>257</td><td><code><pre>                s.activeConn[conn] = struct{}{}</pre></code></td></tr><tr class="miss"><td>258</td><td><code><pre>                s.mu.Unlock()</pre></code></td></tr><tr><td>259</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>260</td><td><code><pre>                conn, ok := s.Plugins.DoPostConnAccept(conn)</pre></code></td></tr><tr class="miss"><td>261</td><td><code><pre>                if !ok {</pre></code></td></tr><tr class="miss"><td>262</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>263</td><td><code><pre>                }</pre></code></td></tr><tr><td>264</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>265</td><td><code><pre>                go s.serveConn(conn)</pre></code></td></tr><tr><td>266</td><td><code><pre>        }</pre></code></td></tr><tr><td>267</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_typePools.Get">func typePools.Get</div><div class="info"><a href="#s_fn_typePools.Get">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/pool.go</code>:</p></div><table class="listing">
<tr><td>60</td><td><code><pre>func (p *typePools) Get(t reflect.Type) interface{} {</pre></code></td></tr><tr><td>61</td><td><code><pre>        if !UsePool {</pre></code></td></tr><tr><td>62</td><td><code><pre>                return p.New(t)</pre></code></td></tr><tr><td>63</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>64</td><td><code><pre>        p.mu.RLock()</pre></code></td></tr><tr class="miss"><td>65</td><td><code><pre>        pool := p.pools[t]</pre></code></td></tr><tr class="miss"><td>66</td><td><code><pre>        p.mu.RUnlock()</pre></code></td></tr><tr><td>67</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>68</td><td><code><pre>        return pool.Get()</pre></code></td></tr><tr><td>69</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@344:8">func @344:8</div><div class="info"><a href="#s_fn_@344:8">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/service.go</code>:</p></div><table class="listing">
<tr><td>344</td><td><code><pre>func() {</pre></code></td></tr><tr><td>345</td><td><code><pre>                if r := recover(); r != nil {</pre></code></td></tr><tr><td>346</td><td><code><pre>                        //log.Errorf(&#34;failed to invoke service: %v, stacks: %s&#34;, r, string(debug.Stack()))</pre></code></td></tr><tr class="miss"><td>347</td><td><code><pre>                        err = fmt.Errorf(&#34;[service internal error]: %v, method: %s, argv: %+v&#34;,</pre></code></td></tr><tr><td>348</td><td><code><pre>                                r, mtype.method.Name, argv.Interface())</pre></code></td></tr><tr class="miss"><td>349</td><td><code><pre>                        log.Handle(err)</pre></code></td></tr><tr><td>350</td><td><code><pre>                }</pre></code></td></tr><tr><td>351</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_typePools.Put">func typePools.Put</div><div class="info"><a href="#s_fn_typePools.Put">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/pool.go</code>:</p></div><table class="listing">
<tr><td>46</td><td><code><pre>func (p *typePools) Put(t reflect.Type, x interface{}) {</pre></code></td></tr><tr><td>47</td><td><code><pre>        if !UsePool {</pre></code></td></tr><tr><td>48</td><td><code><pre>                return</pre></code></td></tr><tr><td>49</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>        if o, ok := x.(Reset); ok {</pre></code></td></tr><tr class="miss"><td>51</td><td><code><pre>                o.Reset()</pre></code></td></tr><tr><td>52</td><td><code><pre>        }</pre></code></td></tr><tr><td>53</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>54</td><td><code><pre>        p.mu.RLock()</pre></code></td></tr><tr class="miss"><td>55</td><td><code><pre>        pool := p.pools[t]</pre></code></td></tr><tr class="miss"><td>56</td><td><code><pre>        p.mu.RUnlock()</pre></code></td></tr><tr class="miss"><td>57</td><td><code><pre>        pool.Put(x)</pre></code></td></tr><tr><td>58</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.handleGatewayRequest">func Server.handleGatewayRequest</div><div class="info"><a href="#s_fn_Server.handleGatewayRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/gateway.go</code>:</p></div><table class="listing">
<tr><td>72</td><td><code><pre>func (s *Server) handleGatewayRequest(w http.ResponseWriter, r *http.Request, params httprouter.Params) {</pre></code></td></tr><tr class="miss"><td>73</td><td><code><pre>        if r.Header.Get(XServicePath) == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>74</td><td><code><pre>                servicePath := params.ByName(&#34;servicePath&#34;)</pre></code></td></tr><tr class="miss"><td>75</td><td><code><pre>                if strings.HasPrefix(servicePath, &#34;/&#34;) {</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>                        servicePath = servicePath[1:]</pre></code></td></tr><tr><td>77</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>78</td><td><code><pre>                r.Header.Set(XServicePath, servicePath)</pre></code></td></tr><tr><td>79</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>80</td><td><code><pre>        servicePath := r.Header.Get(XServicePath)</pre></code></td></tr><tr class="miss"><td>81</td><td><code><pre>        wh := w.Header()</pre></code></td></tr><tr class="miss"><td>82</td><td><code><pre>        req, err := HTTPRequest2RpcxRequest(r)</pre></code></td></tr><tr class="miss"><td>83</td><td><code><pre>        defer protocol.FreeMsg(req)</pre></code></td></tr><tr><td>84</td><td><code><pre></pre></code></td></tr><tr><td>85</td><td><code><pre>        //set headers</pre></code></td></tr><tr class="miss"><td>86</td><td><code><pre>        wh.Set(XVersion, r.Header.Get(XVersion))</pre></code></td></tr><tr class="miss"><td>87</td><td><code><pre>        wh.Set(XMessageID, r.Header.Get(XMessageID))</pre></code></td></tr><tr><td>88</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>89</td><td><code><pre>        if err == nil &amp;&amp; servicePath == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>90</td><td><code><pre>                err = errors.New(&#34;empty servicepath&#34;)</pre></code></td></tr><tr><td>91</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>92</td><td><code><pre>                wh.Set(XServicePath, servicePath)</pre></code></td></tr><tr><td>93</td><td><code><pre>        }</pre></code></td></tr><tr><td>94</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>95</td><td><code><pre>        if err == nil &amp;&amp; r.Header.Get(XServiceMethod) == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>96</td><td><code><pre>                err = errors.New(&#34;empty servicemethod&#34;)</pre></code></td></tr><tr><td>97</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>98</td><td><code><pre>                wh.Set(XServiceMethod, r.Header.Get(XServiceMethod))</pre></code></td></tr><tr><td>99</td><td><code><pre>        }</pre></code></td></tr><tr><td>100</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>101</td><td><code><pre>        if err == nil &amp;&amp; r.Header.Get(XSerializeType) == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>102</td><td><code><pre>                err = errors.New(&#34;empty serialized type&#34;)</pre></code></td></tr><tr><td>103</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>104</td><td><code><pre>                wh.Set(XSerializeType, r.Header.Get(XSerializeType))</pre></code></td></tr><tr><td>105</td><td><code><pre>        }</pre></code></td></tr><tr><td>106</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>107</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>108</td><td><code><pre>                rh := r.Header</pre></code></td></tr><tr class="miss"><td>109</td><td><code><pre>                for k, v := range rh {</pre></code></td></tr><tr class="miss"><td>110</td><td><code><pre>                        if strings.HasPrefix(k, &#34;X-RPCX-&#34;) &amp;&amp; len(v) &gt; 0 {</pre></code></td></tr><tr class="miss"><td>111</td><td><code><pre>                                wh.Set(k, v[0])</pre></code></td></tr><tr><td>112</td><td><code><pre>                        }</pre></code></td></tr><tr><td>113</td><td><code><pre>                }</pre></code></td></tr><tr><td>114</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>115</td><td><code><pre>                wh.Set(XMessageStatusType, &#34;Error&#34;)</pre></code></td></tr><tr class="miss"><td>116</td><td><code><pre>                wh.Set(XErrorMessage, err.Error())</pre></code></td></tr><tr class="miss"><td>117</td><td><code><pre>                return</pre></code></td></tr><tr><td>118</td><td><code><pre>        }</pre></code></td></tr><tr><td>119</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>120</td><td><code><pre>        ctx := context.WithValue(context.Background(), StartRequestContextKey, time.Now().UnixNano())</pre></code></td></tr><tr class="miss"><td>121</td><td><code><pre>        err = s.auth(ctx, req)</pre></code></td></tr><tr class="miss"><td>122</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>123</td><td><code><pre>                s.Plugins.DoPreWriteResponse(ctx, req, nil)</pre></code></td></tr><tr class="miss"><td>124</td><td><code><pre>                wh.Set(XMessageStatusType, &#34;Error&#34;)</pre></code></td></tr><tr class="miss"><td>125</td><td><code><pre>                wh.Set(XErrorMessage, err.Error())</pre></code></td></tr><tr class="miss"><td>126</td><td><code><pre>                w.WriteHeader(401)</pre></code></td></tr><tr class="miss"><td>127</td><td><code><pre>                s.Plugins.DoPostWriteResponse(ctx, req, req.Clone(), err)</pre></code></td></tr><tr class="miss"><td>128</td><td><code><pre>                return</pre></code></td></tr><tr><td>129</td><td><code><pre>        }</pre></code></td></tr><tr><td>130</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>131</td><td><code><pre>        resMetadata := make(map[string]string)</pre></code></td></tr><tr class="miss"><td>132</td><td><code><pre>        newCtx := context.WithValue(context.WithValue(ctx, share.ReqMetaDataKey, req.Metadata),</pre></code></td></tr><tr><td>133</td><td><code><pre>                share.ResMetaDataKey, resMetadata)</pre></code></td></tr><tr><td>134</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>135</td><td><code><pre>        res, err := s.handleRequest(newCtx, req)</pre></code></td></tr><tr class="miss"><td>136</td><td><code><pre>        defer protocol.FreeMsg(res)</pre></code></td></tr><tr><td>137</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>138</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>139</td><td><code><pre>                log.Warnf(&#34;rpcx: failed to handle gateway request: %v&#34;, err)</pre></code></td></tr><tr class="miss"><td>140</td><td><code><pre>                wh.Set(XMessageStatusType, &#34;Error&#34;)</pre></code></td></tr><tr class="miss"><td>141</td><td><code><pre>                wh.Set(XErrorMessage, err.Error())</pre></code></td></tr><tr class="miss"><td>142</td><td><code><pre>                w.WriteHeader(500)</pre></code></td></tr><tr class="miss"><td>143</td><td><code><pre>                return</pre></code></td></tr><tr><td>144</td><td><code><pre>        }</pre></code></td></tr><tr><td>145</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>146</td><td><code><pre>        s.Plugins.DoPreWriteResponse(newCtx, req, nil)</pre></code></td></tr><tr class="miss"><td>147</td><td><code><pre>        if len(resMetadata) &gt; 0 { //copy meta in context to request</pre></code></td></tr><tr class="miss"><td>148</td><td><code><pre>                meta := res.Metadata</pre></code></td></tr><tr class="miss"><td>149</td><td><code><pre>                if meta == nil {</pre></code></td></tr><tr class="miss"><td>150</td><td><code><pre>                        res.Metadata = resMetadata</pre></code></td></tr><tr><td>151</td><td><code><pre>                } else {</pre></code></td></tr><tr class="miss"><td>152</td><td><code><pre>                        for k, v := range resMetadata {</pre></code></td></tr><tr class="miss"><td>153</td><td><code><pre>                                meta[k] = v</pre></code></td></tr><tr><td>154</td><td><code><pre>                        }</pre></code></td></tr><tr><td>155</td><td><code><pre>                }</pre></code></td></tr><tr><td>156</td><td><code><pre>        }</pre></code></td></tr><tr><td>157</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>158</td><td><code><pre>        meta := url.Values{}</pre></code></td></tr><tr class="miss"><td>159</td><td><code><pre>        for k, v := range res.Metadata {</pre></code></td></tr><tr class="miss"><td>160</td><td><code><pre>                meta.Add(k, v)</pre></code></td></tr><tr><td>161</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>162</td><td><code><pre>        wh.Set(XMeta, meta.Encode())</pre></code></td></tr><tr class="miss"><td>163</td><td><code><pre>        w.Write(res.Payload)</pre></code></td></tr><tr class="miss"><td>164</td><td><code><pre>        s.Plugins.DoPostWriteResponse(newCtx, req, res, err)</pre></code></td></tr><tr><td>165</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.serveConn">func Server.serveConn</div><div class="info"><a href="#s_fn_Server.serveConn">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>293</td><td><code><pre>func (s *Server) serveConn(conn net.Conn) {</pre></code></td></tr><tr class="miss"><td>294</td><td><code><pre>        defer func() {</pre></code></td></tr><tr><td>295</td><td><code><pre>                if err := recover(); err != nil {</pre></code></td></tr><tr><td>296</td><td><code><pre>                        const size = 64 &lt;&lt; 10</pre></code></td></tr><tr><td>297</td><td><code><pre>                        buf := make([]byte, size)</pre></code></td></tr><tr><td>298</td><td><code><pre>                        ss := runtime.Stack(buf, false)</pre></code></td></tr><tr><td>299</td><td><code><pre>                        if ss &gt; size {</pre></code></td></tr><tr><td>300</td><td><code><pre>                                ss = size</pre></code></td></tr><tr><td>301</td><td><code><pre>                        }</pre></code></td></tr><tr><td>302</td><td><code><pre>                        buf = buf[:ss]</pre></code></td></tr><tr><td>303</td><td><code><pre>                        log.Errorf(&#34;serving %s panic error: %s, stack:\n %s&#34;, conn.RemoteAddr(), err, buf)</pre></code></td></tr><tr><td>304</td><td><code><pre>                }</pre></code></td></tr><tr><td>305</td><td><code><pre>                s.mu.Lock()</pre></code></td></tr><tr><td>306</td><td><code><pre>                delete(s.activeConn, conn)</pre></code></td></tr><tr><td>307</td><td><code><pre>                s.mu.Unlock()</pre></code></td></tr><tr><td>308</td><td><code><pre>                conn.Close()</pre></code></td></tr><tr><td>309</td><td><code><pre></pre></code></td></tr><tr><td>310</td><td><code><pre>                if s.Plugins == nil {</pre></code></td></tr><tr><td>311</td><td><code><pre>                        s.Plugins = &amp;pluginContainer{}</pre></code></td></tr><tr><td>312</td><td><code><pre>                }</pre></code></td></tr><tr><td>313</td><td><code><pre></pre></code></td></tr><tr><td>314</td><td><code><pre>                s.Plugins.DoPostConnClose(conn)</pre></code></td></tr><tr><td>315</td><td><code><pre>        }()</pre></code></td></tr><tr><td>316</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>317</td><td><code><pre>        if isShutdown(s) {</pre></code></td></tr><tr class="miss"><td>318</td><td><code><pre>                closeChannel(s, conn)</pre></code></td></tr><tr class="miss"><td>319</td><td><code><pre>                return</pre></code></td></tr><tr><td>320</td><td><code><pre>        }</pre></code></td></tr><tr><td>321</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>322</td><td><code><pre>        if tlsConn, ok := conn.(*tls.Conn); ok {</pre></code></td></tr><tr class="miss"><td>323</td><td><code><pre>                if d := s.readTimeout; d != 0 {</pre></code></td></tr><tr class="miss"><td>324</td><td><code><pre>                        conn.SetReadDeadline(time.Now().Add(d))</pre></code></td></tr><tr><td>325</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>326</td><td><code><pre>                if d := s.writeTimeout; d != 0 {</pre></code></td></tr><tr class="miss"><td>327</td><td><code><pre>                        conn.SetWriteDeadline(time.Now().Add(d))</pre></code></td></tr><tr><td>328</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>329</td><td><code><pre>                if err := tlsConn.Handshake(); err != nil {</pre></code></td></tr><tr class="miss"><td>330</td><td><code><pre>                        log.Errorf(&#34;rpcx: TLS handshake error from %s: %v&#34;, conn.RemoteAddr(), err)</pre></code></td></tr><tr class="miss"><td>331</td><td><code><pre>                        return</pre></code></td></tr><tr><td>332</td><td><code><pre>                }</pre></code></td></tr><tr><td>333</td><td><code><pre>        }</pre></code></td></tr><tr><td>334</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>335</td><td><code><pre>        r := bufio.NewReaderSize(conn, ReaderBuffsize)</pre></code></td></tr><tr><td>336</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>337</td><td><code><pre>        for {</pre></code></td></tr><tr class="miss"><td>338</td><td><code><pre>                if isShutdown(s) {</pre></code></td></tr><tr class="miss"><td>339</td><td><code><pre>                        closeChannel(s, conn)</pre></code></td></tr><tr class="miss"><td>340</td><td><code><pre>                        return</pre></code></td></tr><tr><td>341</td><td><code><pre>                }</pre></code></td></tr><tr><td>342</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>343</td><td><code><pre>                t0 := time.Now()</pre></code></td></tr><tr class="miss"><td>344</td><td><code><pre>                if s.readTimeout != 0 {</pre></code></td></tr><tr class="miss"><td>345</td><td><code><pre>                        conn.SetReadDeadline(t0.Add(s.readTimeout))</pre></code></td></tr><tr><td>346</td><td><code><pre>                }</pre></code></td></tr><tr><td>347</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>348</td><td><code><pre>                ctx := share.WithValue(context.Background(), RemoteConnContextKey, conn)</pre></code></td></tr><tr><td>349</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>350</td><td><code><pre>                req, err := s.readRequest(ctx, r)</pre></code></td></tr><tr class="miss"><td>351</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>352</td><td><code><pre>                        if err == io.EOF {</pre></code></td></tr><tr class="miss"><td>353</td><td><code><pre>                                log.Infof(&#34;client has closed this connection: %s&#34;, conn.RemoteAddr().String())</pre></code></td></tr><tr class="miss"><td>354</td><td><code><pre>                        } else if strings.Contains(err.Error(), &#34;use of closed network connection&#34;) {</pre></code></td></tr><tr class="miss"><td>355</td><td><code><pre>                                log.Infof(&#34;rpcx: connection %s is closed&#34;, conn.RemoteAddr().String())</pre></code></td></tr><tr><td>356</td><td><code><pre>                        } else {</pre></code></td></tr><tr class="miss"><td>357</td><td><code><pre>                                log.Warnf(&#34;rpcx: failed to read request: %v&#34;, err)</pre></code></td></tr><tr><td>358</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>359</td><td><code><pre>                        return</pre></code></td></tr><tr><td>360</td><td><code><pre>                }</pre></code></td></tr><tr><td>361</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>362</td><td><code><pre>                if s.writeTimeout != 0 {</pre></code></td></tr><tr class="miss"><td>363</td><td><code><pre>                        conn.SetWriteDeadline(t0.Add(s.writeTimeout))</pre></code></td></tr><tr><td>364</td><td><code><pre>                }</pre></code></td></tr><tr><td>365</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>366</td><td><code><pre>                ctx = share.WithLocalValue(ctx, StartRequestContextKey, time.Now().UnixNano())</pre></code></td></tr><tr class="miss"><td>367</td><td><code><pre>                if !req.IsHeartbeat() {</pre></code></td></tr><tr class="miss"><td>368</td><td><code><pre>                        err = s.auth(ctx, req)</pre></code></td></tr><tr><td>369</td><td><code><pre>                }</pre></code></td></tr><tr><td>370</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>371</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>372</td><td><code><pre>                        if !req.IsOneway() {</pre></code></td></tr><tr class="miss"><td>373</td><td><code><pre>                                res := req.Clone()</pre></code></td></tr><tr class="miss"><td>374</td><td><code><pre>                                res.SetMessageType(protocol.Response)</pre></code></td></tr><tr class="miss"><td>375</td><td><code><pre>                                if len(res.Payload) &gt; 1024 &amp;&amp; req.CompressType() != protocol.None {</pre></code></td></tr><tr class="miss"><td>376</td><td><code><pre>                                        res.SetCompressType(req.CompressType())</pre></code></td></tr><tr><td>377</td><td><code><pre>                                }</pre></code></td></tr><tr class="miss"><td>378</td><td><code><pre>                                handleError(res, err)</pre></code></td></tr><tr class="miss"><td>379</td><td><code><pre>                                data := res.Encode()</pre></code></td></tr><tr><td>380</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>381</td><td><code><pre>                                s.Plugins.DoPreWriteResponse(ctx, req, res)</pre></code></td></tr><tr class="miss"><td>382</td><td><code><pre>                                conn.Write(data)</pre></code></td></tr><tr class="miss"><td>383</td><td><code><pre>                                s.Plugins.DoPostWriteResponse(ctx, req, res, err)</pre></code></td></tr><tr class="miss"><td>384</td><td><code><pre>                                protocol.FreeMsg(res)</pre></code></td></tr><tr><td>385</td><td><code><pre>                        } else {</pre></code></td></tr><tr class="miss"><td>386</td><td><code><pre>                                s.Plugins.DoPreWriteResponse(ctx, req, nil)</pre></code></td></tr><tr><td>387</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>388</td><td><code><pre>                        protocol.FreeMsg(req)</pre></code></td></tr><tr class="miss"><td>389</td><td><code><pre>                        continue</pre></code></td></tr><tr><td>390</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>391</td><td><code><pre>                go func() {</pre></code></td></tr><tr><td>392</td><td><code><pre>                        atomic.AddInt32(&amp;s.handlerMsgNum, 1)</pre></code></td></tr><tr><td>393</td><td><code><pre>                        defer func() {</pre></code></td></tr><tr><td>394</td><td><code><pre>                                atomic.AddInt32(&amp;s.handlerMsgNum, -1)</pre></code></td></tr><tr><td>395</td><td><code><pre>                        }()</pre></code></td></tr><tr><td>396</td><td><code><pre>                        if req.IsHeartbeat() {</pre></code></td></tr><tr><td>397</td><td><code><pre>                                req.SetMessageType(protocol.Response)</pre></code></td></tr><tr><td>398</td><td><code><pre>                                data := req.Encode()</pre></code></td></tr><tr><td>399</td><td><code><pre>                                conn.Write(data)</pre></code></td></tr><tr><td>400</td><td><code><pre>                                return</pre></code></td></tr><tr><td>401</td><td><code><pre>                        }</pre></code></td></tr><tr><td>402</td><td><code><pre></pre></code></td></tr><tr><td>403</td><td><code><pre>                        resMetadata := make(map[string]string)</pre></code></td></tr><tr><td>404</td><td><code><pre>                        newCtx := share.WithLocalValue(share.WithLocalValue(ctx, share.ReqMetaDataKey, req.Metadata),</pre></code></td></tr><tr><td>405</td><td><code><pre>                                share.ResMetaDataKey, resMetadata)</pre></code></td></tr><tr><td>406</td><td><code><pre></pre></code></td></tr><tr><td>407</td><td><code><pre>                        s.Plugins.DoPreHandleRequest(newCtx, req)</pre></code></td></tr><tr><td>408</td><td><code><pre></pre></code></td></tr><tr><td>409</td><td><code><pre>                        res, err := s.handleRequest(newCtx, req)</pre></code></td></tr><tr><td>410</td><td><code><pre></pre></code></td></tr><tr><td>411</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr><td>412</td><td><code><pre>                                log.Warnf(&#34;rpcx: failed to handle request: %v&#34;, err)</pre></code></td></tr><tr><td>413</td><td><code><pre>                        }</pre></code></td></tr><tr><td>414</td><td><code><pre></pre></code></td></tr><tr><td>415</td><td><code><pre>                        s.Plugins.DoPreWriteResponse(newCtx, req, res)</pre></code></td></tr><tr><td>416</td><td><code><pre>                        if !req.IsOneway() {</pre></code></td></tr><tr><td>417</td><td><code><pre>                                if len(resMetadata) &gt; 0 { //copy meta in context to request</pre></code></td></tr><tr><td>418</td><td><code><pre>                                        meta := res.Metadata</pre></code></td></tr><tr><td>419</td><td><code><pre>                                        if meta == nil {</pre></code></td></tr><tr><td>420</td><td><code><pre>                                                res.Metadata = resMetadata</pre></code></td></tr><tr><td>421</td><td><code><pre>                                        } else {</pre></code></td></tr><tr><td>422</td><td><code><pre>                                                for k, v := range resMetadata {</pre></code></td></tr><tr><td>423</td><td><code><pre>                                                        meta[k] = v</pre></code></td></tr><tr><td>424</td><td><code><pre>                                                }</pre></code></td></tr><tr><td>425</td><td><code><pre>                                        }</pre></code></td></tr><tr><td>426</td><td><code><pre>                                }</pre></code></td></tr><tr><td>427</td><td><code><pre></pre></code></td></tr><tr><td>428</td><td><code><pre>                                if len(res.Payload) &gt; 1024 &amp;&amp; req.CompressType() != protocol.None {</pre></code></td></tr><tr><td>429</td><td><code><pre>                                        res.SetCompressType(req.CompressType())</pre></code></td></tr><tr><td>430</td><td><code><pre>                                }</pre></code></td></tr><tr><td>431</td><td><code><pre>                                data := res.Encode()</pre></code></td></tr><tr><td>432</td><td><code><pre>                                conn.Write(data)</pre></code></td></tr><tr><td>433</td><td><code><pre>                                //res.WriteTo(conn)</pre></code></td></tr><tr><td>434</td><td><code><pre>                        }</pre></code></td></tr><tr><td>435</td><td><code><pre>                        s.Plugins.DoPostWriteResponse(newCtx, req, res, err)</pre></code></td></tr><tr><td>436</td><td><code><pre></pre></code></td></tr><tr><td>437</td><td><code><pre>                        protocol.FreeMsg(req)</pre></code></td></tr><tr><td>438</td><td><code><pre>                        protocol.FreeMsg(res)</pre></code></td></tr><tr><td>439</td><td><code><pre>                }()</pre></code></td></tr><tr><td>440</td><td><code><pre>        }</pre></code></td></tr><tr><td>441</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.registerFunction">func Server.registerFunction</div><div class="info"><a href="#s_fn_Server.registerFunction">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/service.go</code>:</p></div><table class="listing">
<tr><td>170</td><td><code><pre>func (s *Server) registerFunction(servicePath string, fn interface{}, name string, useName bool) (string, error) {</pre></code></td></tr><tr class="miss"><td>171</td><td><code><pre>        s.serviceMapMu.Lock()</pre></code></td></tr><tr class="miss"><td>172</td><td><code><pre>        defer s.serviceMapMu.Unlock()</pre></code></td></tr><tr class="miss"><td>173</td><td><code><pre>        if s.serviceMap == nil {</pre></code></td></tr><tr class="miss"><td>174</td><td><code><pre>                s.serviceMap = make(map[string]*service)</pre></code></td></tr><tr><td>175</td><td><code><pre>        }</pre></code></td></tr><tr><td>176</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>177</td><td><code><pre>        ss := s.serviceMap[servicePath]</pre></code></td></tr><tr class="miss"><td>178</td><td><code><pre>        if ss == nil {</pre></code></td></tr><tr class="miss"><td>179</td><td><code><pre>                ss = new(service)</pre></code></td></tr><tr class="miss"><td>180</td><td><code><pre>                ss.name = servicePath</pre></code></td></tr><tr class="miss"><td>181</td><td><code><pre>                ss.function = make(map[string]*functionType)</pre></code></td></tr><tr><td>182</td><td><code><pre>        }</pre></code></td></tr><tr><td>183</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>184</td><td><code><pre>        f, ok := fn.(reflect.Value)</pre></code></td></tr><tr class="miss"><td>185</td><td><code><pre>        if !ok {</pre></code></td></tr><tr class="miss"><td>186</td><td><code><pre>                f = reflect.ValueOf(fn)</pre></code></td></tr><tr><td>187</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>188</td><td><code><pre>        if f.Kind() != reflect.Func {</pre></code></td></tr><tr class="miss"><td>189</td><td><code><pre>                return &#34;&#34;, errors.New(&#34;function must be func or bound method&#34;)</pre></code></td></tr><tr><td>190</td><td><code><pre>        }</pre></code></td></tr><tr><td>191</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>192</td><td><code><pre>        fname := runtime.FuncForPC(reflect.Indirect(f).Pointer()).Name()</pre></code></td></tr><tr class="miss"><td>193</td><td><code><pre>        if fname != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>194</td><td><code><pre>                i := strings.LastIndex(fname, &#34;.&#34;)</pre></code></td></tr><tr class="miss"><td>195</td><td><code><pre>                if i &gt;= 0 {</pre></code></td></tr><tr class="miss"><td>196</td><td><code><pre>                        fname = fname[i+1:]</pre></code></td></tr><tr><td>197</td><td><code><pre>                }</pre></code></td></tr><tr><td>198</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>199</td><td><code><pre>        if useName {</pre></code></td></tr><tr class="miss"><td>200</td><td><code><pre>                fname = name</pre></code></td></tr><tr><td>201</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>202</td><td><code><pre>        if fname == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>203</td><td><code><pre>                errorStr := &#34;rpcx.registerFunction: no func name for type &#34; + f.Type().String()</pre></code></td></tr><tr class="miss"><td>204</td><td><code><pre>                log.Error(errorStr)</pre></code></td></tr><tr class="miss"><td>205</td><td><code><pre>                return fname, errors.New(errorStr)</pre></code></td></tr><tr><td>206</td><td><code><pre>        }</pre></code></td></tr><tr><td>207</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>208</td><td><code><pre>        t := f.Type()</pre></code></td></tr><tr class="miss"><td>209</td><td><code><pre>        if t.NumIn() != 3 {</pre></code></td></tr><tr class="miss"><td>210</td><td><code><pre>                return fname, fmt.Errorf(&#34;rpcx.registerFunction: has wrong number of ins: %s&#34;, f.Type().String())</pre></code></td></tr><tr><td>211</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>212</td><td><code><pre>        if t.NumOut() != 1 {</pre></code></td></tr><tr class="miss"><td>213</td><td><code><pre>                return fname, fmt.Errorf(&#34;rpcx.registerFunction: has wrong number of outs: %s&#34;, f.Type().String())</pre></code></td></tr><tr><td>214</td><td><code><pre>        }</pre></code></td></tr><tr><td>215</td><td><code><pre></pre></code></td></tr><tr><td>216</td><td><code><pre>        // First arg must be context.Context</pre></code></td></tr><tr class="miss"><td>217</td><td><code><pre>        ctxType := t.In(0)</pre></code></td></tr><tr class="miss"><td>218</td><td><code><pre>        if !ctxType.Implements(typeOfContext) {</pre></code></td></tr><tr class="miss"><td>219</td><td><code><pre>                return fname, fmt.Errorf(&#34;function %s must use context as  the first parameter&#34;, f.Type().String())</pre></code></td></tr><tr><td>220</td><td><code><pre>        }</pre></code></td></tr><tr><td>221</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>222</td><td><code><pre>        argType := t.In(1)</pre></code></td></tr><tr class="miss"><td>223</td><td><code><pre>        if !isExportedOrBuiltinType(argType) {</pre></code></td></tr><tr class="miss"><td>224</td><td><code><pre>                return fname, fmt.Errorf(&#34;function %s parameter type not exported: %v&#34;, f.Type().String(), argType)</pre></code></td></tr><tr><td>225</td><td><code><pre>        }</pre></code></td></tr><tr><td>226</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>227</td><td><code><pre>        replyType := t.In(2)</pre></code></td></tr><tr class="miss"><td>228</td><td><code><pre>        if replyType.Kind() != reflect.Ptr {</pre></code></td></tr><tr class="miss"><td>229</td><td><code><pre>                return fname, fmt.Errorf(&#34;function %s reply type not a pointer: %s&#34;, f.Type().String(), replyType)</pre></code></td></tr><tr><td>230</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>231</td><td><code><pre>        if !isExportedOrBuiltinType(replyType) {</pre></code></td></tr><tr class="miss"><td>232</td><td><code><pre>                return fname, fmt.Errorf(&#34;function %s reply type not exported: %v&#34;, f.Type().String(), replyType)</pre></code></td></tr><tr><td>233</td><td><code><pre>        }</pre></code></td></tr><tr><td>234</td><td><code><pre></pre></code></td></tr><tr><td>235</td><td><code><pre>        // The return type of the method must be error.</pre></code></td></tr><tr class="miss"><td>236</td><td><code><pre>        if returnType := t.Out(0); returnType != typeOfError {</pre></code></td></tr><tr class="miss"><td>237</td><td><code><pre>                return fname, fmt.Errorf(&#34;function %s returns %s, not error&#34;, f.Type().String(), returnType.String())</pre></code></td></tr><tr><td>238</td><td><code><pre>        }</pre></code></td></tr><tr><td>239</td><td><code><pre></pre></code></td></tr><tr><td>240</td><td><code><pre>        // Install the methods</pre></code></td></tr><tr class="miss"><td>241</td><td><code><pre>        ss.function[fname] = &amp;functionType{fn: f, ArgType: argType, ReplyType: replyType}</pre></code></td></tr><tr class="miss"><td>242</td><td><code><pre>        s.serviceMap[servicePath] = ss</pre></code></td></tr><tr><td>243</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>244</td><td><code><pre>        argsReplyPools.Init(argType)</pre></code></td></tr><tr class="miss"><td>245</td><td><code><pre>        argsReplyPools.Init(replyType)</pre></code></td></tr><tr class="miss"><td>246</td><td><code><pre>        return fname, nil</pre></code></td></tr><tr><td>247</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_HTTPRequest2RpcxRequest">func HTTPRequest2RpcxRequest</div><div class="info"><a href="#s_fn_HTTPRequest2RpcxRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/converter.go</code>:</p></div><table class="listing">
<tr><td>28</td><td><code><pre>func HTTPRequest2RpcxRequest(r *http.Request) (*protocol.Message, error) {</pre></code></td></tr><tr class="miss"><td>29</td><td><code><pre>        req := protocol.GetPooledMsg()</pre></code></td></tr><tr class="miss"><td>30</td><td><code><pre>        req.SetMessageType(protocol.Request)</pre></code></td></tr><tr><td>31</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>32</td><td><code><pre>        h := r.Header</pre></code></td></tr><tr class="miss"><td>33</td><td><code><pre>        seq := h.Get(XMessageID)</pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>        if seq != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>35</td><td><code><pre>                id, err := strconv.ParseUint(seq, 10, 64)</pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>                        return nil, err</pre></code></td></tr><tr><td>38</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>                req.SetSeq(id)</pre></code></td></tr><tr><td>40</td><td><code><pre>        }</pre></code></td></tr><tr><td>41</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>        heartbeat := h.Get(XHeartbeat)</pre></code></td></tr><tr class="miss"><td>43</td><td><code><pre>        if heartbeat != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>44</td><td><code><pre>                req.SetHeartbeat(true)</pre></code></td></tr><tr><td>45</td><td><code><pre>        }</pre></code></td></tr><tr><td>46</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>47</td><td><code><pre>        oneway := h.Get(XOneway)</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>        if oneway != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>49</td><td><code><pre>                req.SetOneway(true)</pre></code></td></tr><tr><td>50</td><td><code><pre>        }</pre></code></td></tr><tr><td>51</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>52</td><td><code><pre>        st := h.Get(XSerializeType)</pre></code></td></tr><tr class="miss"><td>53</td><td><code><pre>        if st != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>54</td><td><code><pre>                rst, err := strconv.Atoi(st)</pre></code></td></tr><tr class="miss"><td>55</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>56</td><td><code><pre>                        return nil, err</pre></code></td></tr><tr><td>57</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>                req.SetSerializeType(protocol.SerializeType(rst))</pre></code></td></tr><tr><td>59</td><td><code><pre>        }</pre></code></td></tr><tr><td>60</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>61</td><td><code><pre>        meta := h.Get(XMeta)</pre></code></td></tr><tr class="miss"><td>62</td><td><code><pre>        if meta != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>63</td><td><code><pre>                metadata, err := url.ParseQuery(meta)</pre></code></td></tr><tr class="miss"><td>64</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>65</td><td><code><pre>                        return nil, err</pre></code></td></tr><tr><td>66</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>67</td><td><code><pre>                mm := make(map[string]string)</pre></code></td></tr><tr class="miss"><td>68</td><td><code><pre>                for k, v := range metadata {</pre></code></td></tr><tr class="miss"><td>69</td><td><code><pre>                        if len(v) &gt; 0 {</pre></code></td></tr><tr class="miss"><td>70</td><td><code><pre>                                mm[k] = v[0]</pre></code></td></tr><tr><td>71</td><td><code><pre>                        }</pre></code></td></tr><tr><td>72</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>73</td><td><code><pre>                req.Metadata = mm</pre></code></td></tr><tr><td>74</td><td><code><pre>        }</pre></code></td></tr><tr><td>75</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>        auth := h.Get(&#34;Authorization&#34;)</pre></code></td></tr><tr class="miss"><td>77</td><td><code><pre>        if auth != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>78</td><td><code><pre>                if req.Metadata == nil {</pre></code></td></tr><tr class="miss"><td>79</td><td><code><pre>                        req.Metadata = make(map[string]string)</pre></code></td></tr><tr><td>80</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>81</td><td><code><pre>                req.Metadata[share.AuthKey] = auth</pre></code></td></tr><tr><td>82</td><td><code><pre>        }</pre></code></td></tr><tr><td>83</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>84</td><td><code><pre>        sp := h.Get(XServicePath)</pre></code></td></tr><tr class="miss"><td>85</td><td><code><pre>        if sp != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>86</td><td><code><pre>                req.ServicePath = sp</pre></code></td></tr><tr><td>87</td><td><code><pre>        }</pre></code></td></tr><tr><td>88</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>89</td><td><code><pre>        sm := h.Get(XServiceMethod)</pre></code></td></tr><tr class="miss"><td>90</td><td><code><pre>        if sm != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>91</td><td><code><pre>                req.ServiceMethod = sm</pre></code></td></tr><tr><td>92</td><td><code><pre>        }</pre></code></td></tr><tr><td>93</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>94</td><td><code><pre>        payload, err := ioutil.ReadAll(r.Body)</pre></code></td></tr><tr class="miss"><td>95</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>96</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>97</td><td><code><pre>        }</pre></code></td></tr><tr><td>98</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>99</td><td><code><pre>        req.Payload = payload</pre></code></td></tr><tr><td>100</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>101</td><td><code><pre>        return req, nil</pre></code></td></tr><tr><td>102</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.handleRequestForFunction">func Server.handleRequestForFunction</div><div class="info"><a href="#s_fn_Server.handleRequestForFunction">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>544</td><td><code><pre>func (s *Server) handleRequestForFunction(ctx context.Context, req *protocol.Message) (res *protocol.Message, err error) {</pre></code></td></tr><tr class="miss"><td>545</td><td><code><pre>        res = req.Clone()</pre></code></td></tr><tr><td>546</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>547</td><td><code><pre>        res.SetMessageType(protocol.Response)</pre></code></td></tr><tr><td>548</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>549</td><td><code><pre>        serviceName := req.ServicePath</pre></code></td></tr><tr class="miss"><td>550</td><td><code><pre>        methodName := req.ServiceMethod</pre></code></td></tr><tr class="miss"><td>551</td><td><code><pre>        s.serviceMapMu.RLock()</pre></code></td></tr><tr class="miss"><td>552</td><td><code><pre>        service := s.serviceMap[serviceName]</pre></code></td></tr><tr class="miss"><td>553</td><td><code><pre>        s.serviceMapMu.RUnlock()</pre></code></td></tr><tr class="miss"><td>554</td><td><code><pre>        if service == nil {</pre></code></td></tr><tr class="miss"><td>555</td><td><code><pre>                err = errors.New(&#34;rpcx: can&#39;t find service  for func raw function&#34;)</pre></code></td></tr><tr class="miss"><td>556</td><td><code><pre>                return handleError(res, err)</pre></code></td></tr><tr><td>557</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>558</td><td><code><pre>        mtype := service.function[methodName]</pre></code></td></tr><tr class="miss"><td>559</td><td><code><pre>        if mtype == nil {</pre></code></td></tr><tr class="miss"><td>560</td><td><code><pre>                err = errors.New(&#34;rpcx: can&#39;t find method &#34; + methodName)</pre></code></td></tr><tr class="miss"><td>561</td><td><code><pre>                return handleError(res, err)</pre></code></td></tr><tr><td>562</td><td><code><pre>        }</pre></code></td></tr><tr><td>563</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>564</td><td><code><pre>        var argv = argsReplyPools.Get(mtype.ArgType)</pre></code></td></tr><tr><td>565</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>566</td><td><code><pre>        codec := share.Codecs[req.SerializeType()]</pre></code></td></tr><tr class="miss"><td>567</td><td><code><pre>        if codec == nil {</pre></code></td></tr><tr class="miss"><td>568</td><td><code><pre>                err = fmt.Errorf(&#34;can not find codec for %d&#34;, req.SerializeType())</pre></code></td></tr><tr class="miss"><td>569</td><td><code><pre>                return handleError(res, err)</pre></code></td></tr><tr><td>570</td><td><code><pre>        }</pre></code></td></tr><tr><td>571</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>572</td><td><code><pre>        err = codec.Decode(req.Payload, argv)</pre></code></td></tr><tr class="miss"><td>573</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>574</td><td><code><pre>                return handleError(res, err)</pre></code></td></tr><tr><td>575</td><td><code><pre>        }</pre></code></td></tr><tr><td>576</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>577</td><td><code><pre>        replyv := argsReplyPools.Get(mtype.ReplyType)</pre></code></td></tr><tr><td>578</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>579</td><td><code><pre>        err = service.callForFunction(ctx, mtype, reflect.ValueOf(argv), reflect.ValueOf(replyv))</pre></code></td></tr><tr><td>580</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>581</td><td><code><pre>        argsReplyPools.Put(mtype.ArgType, argv)</pre></code></td></tr><tr><td>582</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>583</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>584</td><td><code><pre>                argsReplyPools.Put(mtype.ReplyType, replyv)</pre></code></td></tr><tr class="miss"><td>585</td><td><code><pre>                return handleError(res, err)</pre></code></td></tr><tr><td>586</td><td><code><pre>        }</pre></code></td></tr><tr><td>587</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>588</td><td><code><pre>        if !req.IsOneway() {</pre></code></td></tr><tr class="miss"><td>589</td><td><code><pre>                data, err := codec.Encode(replyv)</pre></code></td></tr><tr class="miss"><td>590</td><td><code><pre>                argsReplyPools.Put(mtype.ReplyType, replyv)</pre></code></td></tr><tr class="miss"><td>591</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>592</td><td><code><pre>                        return handleError(res, err)</pre></code></td></tr><tr><td>593</td><td><code><pre></pre></code></td></tr><tr><td>594</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>595</td><td><code><pre>                res.Payload = data</pre></code></td></tr><tr><td>596</td><td><code><pre>        }</pre></code></td></tr><tr><td>597</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>598</td><td><code><pre>        return res, nil</pre></code></td></tr><tr><td>599</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@391:6">func @391:6</div><div class="info"><a href="#s_fn_@391:6">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>391</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>392</td><td><code><pre>                        atomic.AddInt32(&amp;s.handlerMsgNum, 1)</pre></code></td></tr><tr class="miss"><td>393</td><td><code><pre>                        defer func() {</pre></code></td></tr><tr><td>394</td><td><code><pre>                                atomic.AddInt32(&amp;s.handlerMsgNum, -1)</pre></code></td></tr><tr><td>395</td><td><code><pre>                        }()</pre></code></td></tr><tr class="miss"><td>396</td><td><code><pre>                        if req.IsHeartbeat() {</pre></code></td></tr><tr class="miss"><td>397</td><td><code><pre>                                req.SetMessageType(protocol.Response)</pre></code></td></tr><tr class="miss"><td>398</td><td><code><pre>                                data := req.Encode()</pre></code></td></tr><tr class="miss"><td>399</td><td><code><pre>                                conn.Write(data)</pre></code></td></tr><tr class="miss"><td>400</td><td><code><pre>                                return</pre></code></td></tr><tr><td>401</td><td><code><pre>                        }</pre></code></td></tr><tr><td>402</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>403</td><td><code><pre>                        resMetadata := make(map[string]string)</pre></code></td></tr><tr class="miss"><td>404</td><td><code><pre>                        newCtx := share.WithLocalValue(share.WithLocalValue(ctx, share.ReqMetaDataKey, req.Metadata),</pre></code></td></tr><tr><td>405</td><td><code><pre>                                share.ResMetaDataKey, resMetadata)</pre></code></td></tr><tr><td>406</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>407</td><td><code><pre>                        s.Plugins.DoPreHandleRequest(newCtx, req)</pre></code></td></tr><tr><td>408</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>409</td><td><code><pre>                        res, err := s.handleRequest(newCtx, req)</pre></code></td></tr><tr><td>410</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>411</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>412</td><td><code><pre>                                log.Warnf(&#34;rpcx: failed to handle request: %v&#34;, err)</pre></code></td></tr><tr><td>413</td><td><code><pre>                        }</pre></code></td></tr><tr><td>414</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>415</td><td><code><pre>                        s.Plugins.DoPreWriteResponse(newCtx, req, res)</pre></code></td></tr><tr class="miss"><td>416</td><td><code><pre>                        if !req.IsOneway() {</pre></code></td></tr><tr class="miss"><td>417</td><td><code><pre>                                if len(resMetadata) &gt; 0 { //copy meta in context to request</pre></code></td></tr><tr class="miss"><td>418</td><td><code><pre>                                        meta := res.Metadata</pre></code></td></tr><tr class="miss"><td>419</td><td><code><pre>                                        if meta == nil {</pre></code></td></tr><tr class="miss"><td>420</td><td><code><pre>                                                res.Metadata = resMetadata</pre></code></td></tr><tr><td>421</td><td><code><pre>                                        } else {</pre></code></td></tr><tr class="miss"><td>422</td><td><code><pre>                                                for k, v := range resMetadata {</pre></code></td></tr><tr class="miss"><td>423</td><td><code><pre>                                                        meta[k] = v</pre></code></td></tr><tr><td>424</td><td><code><pre>                                                }</pre></code></td></tr><tr><td>425</td><td><code><pre>                                        }</pre></code></td></tr><tr><td>426</td><td><code><pre>                                }</pre></code></td></tr><tr><td>427</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>428</td><td><code><pre>                                if len(res.Payload) &gt; 1024 &amp;&amp; req.CompressType() != protocol.None {</pre></code></td></tr><tr class="miss"><td>429</td><td><code><pre>                                        res.SetCompressType(req.CompressType())</pre></code></td></tr><tr><td>430</td><td><code><pre>                                }</pre></code></td></tr><tr class="miss"><td>431</td><td><code><pre>                                data := res.Encode()</pre></code></td></tr><tr class="miss"><td>432</td><td><code><pre>                                conn.Write(data)</pre></code></td></tr><tr><td>433</td><td><code><pre>                                //res.WriteTo(conn)</pre></code></td></tr><tr><td>434</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>435</td><td><code><pre>                        s.Plugins.DoPostWriteResponse(newCtx, req, res, err)</pre></code></td></tr><tr><td>436</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>437</td><td><code><pre>                        protocol.FreeMsg(req)</pre></code></td></tr><tr class="miss"><td>438</td><td><code><pre>                        protocol.FreeMsg(res)</pre></code></td></tr><tr><td>439</td><td><code><pre>                }</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.handleJSONRPCRequest">func Server.handleJSONRPCRequest</div><div class="info"><a href="#s_fn_Server.handleJSONRPCRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/jsonrpc2.go</code>:</p></div><table class="listing">
<tr><td>46</td><td><code><pre>func (s *Server) handleJSONRPCRequest(r *jsonrpcRequest) *jsonrpcRespone {</pre></code></td></tr><tr class="miss"><td>47</td><td><code><pre>        var res = &amp;jsonrpcRespone{}</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>        res.ID = r.ID</pre></code></td></tr><tr><td>49</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>        req := protocol.GetPooledMsg()</pre></code></td></tr><tr><td>51</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>52</td><td><code><pre>        if r.ID == nil {</pre></code></td></tr><tr class="miss"><td>53</td><td><code><pre>                req.SetOneway(true)</pre></code></td></tr><tr><td>54</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>55</td><td><code><pre>        req.SetMessageType(protocol.Request)</pre></code></td></tr><tr class="miss"><td>56</td><td><code><pre>        req.SetSerializeType(protocol.JSON)</pre></code></td></tr><tr><td>57</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>        pathAndMethod := strings.SplitN(r.Method, &#34;.&#34;, 2)</pre></code></td></tr><tr class="miss"><td>59</td><td><code><pre>        if len(pathAndMethod) != 2 {</pre></code></td></tr><tr class="miss"><td>60</td><td><code><pre>                res.Error = &amp;JSONRPCError{</pre></code></td></tr><tr><td>61</td><td><code><pre>                        Code:    CodeMethodNotFound,</pre></code></td></tr><tr><td>62</td><td><code><pre>                        Message: &#34;must contains servicepath and method&#34;,</pre></code></td></tr><tr><td>63</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>64</td><td><code><pre>                return res</pre></code></td></tr><tr><td>65</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>66</td><td><code><pre>        req.ServicePath = pathAndMethod[0]</pre></code></td></tr><tr class="miss"><td>67</td><td><code><pre>        req.ServiceMethod = pathAndMethod[1]</pre></code></td></tr><tr class="miss"><td>68</td><td><code><pre>        req.Payload = *r.Params</pre></code></td></tr><tr><td>69</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>70</td><td><code><pre>        resp, err := s.handleRequest(context.Background(), req)</pre></code></td></tr><tr class="miss"><td>71</td><td><code><pre>        if r.ID == nil {</pre></code></td></tr><tr class="miss"><td>72</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>73</td><td><code><pre>        }</pre></code></td></tr><tr><td>74</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>75</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>                res.Error = &amp;JSONRPCError{</pre></code></td></tr><tr><td>77</td><td><code><pre>                        Code:    CodeInternalJSONRPCError,</pre></code></td></tr><tr><td>78</td><td><code><pre>                        Message: err.Error(),</pre></code></td></tr><tr><td>79</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>80</td><td><code><pre>                return res</pre></code></td></tr><tr><td>81</td><td><code><pre>        }</pre></code></td></tr><tr><td>82</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>83</td><td><code><pre>        result := json.RawMessage(resp.Payload)</pre></code></td></tr><tr class="miss"><td>84</td><td><code><pre>        res.Result = &amp;result</pre></code></td></tr><tr><td>85</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>86</td><td><code><pre>        return res</pre></code></td></tr><tr><td>87</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.SendMessage">func Server.SendMessage</div><div class="info"><a href="#s_fn_Server.SendMessage">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>135</td><td><code><pre>func (s *Server) SendMessage(conn net.Conn, servicePath, serviceMethod string, metadata map[string]string, data []byte) error {</pre></code></td></tr><tr class="miss"><td>136</td><td><code><pre>        ctx := share.WithValue(context.Background(), StartSendRequestContextKey, time.Now().UnixNano())</pre></code></td></tr><tr class="miss"><td>137</td><td><code><pre>        s.Plugins.DoPreWriteRequest(ctx)</pre></code></td></tr><tr><td>138</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>139</td><td><code><pre>        req := protocol.GetPooledMsg()</pre></code></td></tr><tr class="miss"><td>140</td><td><code><pre>        req.SetMessageType(protocol.Request)</pre></code></td></tr><tr><td>141</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>142</td><td><code><pre>        seq := atomic.AddUint64(&amp;s.seq, 1)</pre></code></td></tr><tr class="miss"><td>143</td><td><code><pre>        req.SetSeq(seq)</pre></code></td></tr><tr class="miss"><td>144</td><td><code><pre>        req.SetOneway(true)</pre></code></td></tr><tr class="miss"><td>145</td><td><code><pre>        req.SetSerializeType(protocol.SerializeNone)</pre></code></td></tr><tr class="miss"><td>146</td><td><code><pre>        req.ServicePath = servicePath</pre></code></td></tr><tr class="miss"><td>147</td><td><code><pre>        req.ServiceMethod = serviceMethod</pre></code></td></tr><tr class="miss"><td>148</td><td><code><pre>        req.Metadata = metadata</pre></code></td></tr><tr class="miss"><td>149</td><td><code><pre>        req.Payload = data</pre></code></td></tr><tr><td>150</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>151</td><td><code><pre>        reqData := req.Encode()</pre></code></td></tr><tr class="miss"><td>152</td><td><code><pre>        _, err := conn.Write(reqData)</pre></code></td></tr><tr class="miss"><td>153</td><td><code><pre>        s.Plugins.DoPostWriteRequest(ctx, req, err)</pre></code></td></tr><tr class="miss"><td>154</td><td><code><pre>        protocol.FreeMsg(req)</pre></code></td></tr><tr class="miss"><td>155</td><td><code><pre>        return err</pre></code></td></tr><tr><td>156</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.jsonrpcHandler">func Server.jsonrpcHandler</div><div class="info"><a href="#s_fn_Server.jsonrpcHandler">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/jsonrpc2.go</code>:</p></div><table class="listing">
<tr><td>15</td><td><code><pre>func (s *Server) jsonrpcHandler(w http.ResponseWriter, r *http.Request) {</pre></code></td></tr><tr class="miss"><td>16</td><td><code><pre>        data, err := ioutil.ReadAll(r.Body)</pre></code></td></tr><tr class="miss"><td>17</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>18</td><td><code><pre>                http.Error(w, err.Error(), http.StatusInternalServerError)</pre></code></td></tr><tr class="miss"><td>19</td><td><code><pre>                return</pre></code></td></tr><tr><td>20</td><td><code><pre>        }</pre></code></td></tr><tr><td>21</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>22</td><td><code><pre>        var req = &amp;jsonrpcRequest{}</pre></code></td></tr><tr><td>23</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>24</td><td><code><pre>        err = json.Unmarshal(data, req)</pre></code></td></tr><tr class="miss"><td>25</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>26</td><td><code><pre>                var res = &amp;jsonrpcRespone{}</pre></code></td></tr><tr class="miss"><td>27</td><td><code><pre>                res.Error = &amp;JSONRPCError{</pre></code></td></tr><tr><td>28</td><td><code><pre>                        Code:    CodeParseJSONRPCError,</pre></code></td></tr><tr><td>29</td><td><code><pre>                        Message: err.Error(),</pre></code></td></tr><tr><td>30</td><td><code><pre>                }</pre></code></td></tr><tr><td>31</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>32</td><td><code><pre>                writeResponse(w, res)</pre></code></td></tr><tr class="miss"><td>33</td><td><code><pre>                return</pre></code></td></tr><tr><td>34</td><td><code><pre>        }</pre></code></td></tr><tr><td>35</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>        if req.ID != nil {</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>                res := s.handleJSONRPCRequest(req)</pre></code></td></tr><tr class="miss"><td>38</td><td><code><pre>                writeResponse(w, res)</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>                return</pre></code></td></tr><tr><td>40</td><td><code><pre>        }</pre></code></td></tr><tr><td>41</td><td><code><pre></pre></code></td></tr><tr><td>42</td><td><code><pre>        // notification</pre></code></td></tr><tr class="miss"><td>43</td><td><code><pre>        go s.handleJSONRPCRequest(req)</pre></code></td></tr><tr><td>44</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@294:8">func @294:8</div><div class="info"><a href="#s_fn_@294:8">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>294</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>295</td><td><code><pre>                if err := recover(); err != nil {</pre></code></td></tr><tr class="miss"><td>296</td><td><code><pre>                        const size = 64 &lt;&lt; 10</pre></code></td></tr><tr class="miss"><td>297</td><td><code><pre>                        buf := make([]byte, size)</pre></code></td></tr><tr class="miss"><td>298</td><td><code><pre>                        ss := runtime.Stack(buf, false)</pre></code></td></tr><tr class="miss"><td>299</td><td><code><pre>                        if ss &gt; size {</pre></code></td></tr><tr class="miss"><td>300</td><td><code><pre>                                ss = size</pre></code></td></tr><tr><td>301</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>302</td><td><code><pre>                        buf = buf[:ss]</pre></code></td></tr><tr class="miss"><td>303</td><td><code><pre>                        log.Errorf(&#34;serving %s panic error: %s, stack:\n %s&#34;, conn.RemoteAddr(), err, buf)</pre></code></td></tr><tr><td>304</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>305</td><td><code><pre>                s.mu.Lock()</pre></code></td></tr><tr class="miss"><td>306</td><td><code><pre>                delete(s.activeConn, conn)</pre></code></td></tr><tr class="miss"><td>307</td><td><code><pre>                s.mu.Unlock()</pre></code></td></tr><tr class="miss"><td>308</td><td><code><pre>                conn.Close()</pre></code></td></tr><tr><td>309</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>310</td><td><code><pre>                if s.Plugins == nil {</pre></code></td></tr><tr class="miss"><td>311</td><td><code><pre>                        s.Plugins = &amp;pluginContainer{}</pre></code></td></tr><tr><td>312</td><td><code><pre>                }</pre></code></td></tr><tr><td>313</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>314</td><td><code><pre>                s.Plugins.DoPostConnClose(conn)</pre></code></td></tr><tr><td>315</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.ServeHTTP">func Server.ServeHTTP</div><div class="info"><a href="#s_fn_Server.ServeHTTP">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>614</td><td><code><pre>func (s *Server) ServeHTTP(w http.ResponseWriter, req *http.Request) {</pre></code></td></tr><tr class="miss"><td>615</td><td><code><pre>        if req.Method != &#34;CONNECT&#34; {</pre></code></td></tr><tr class="miss"><td>616</td><td><code><pre>                w.Header().Set(&#34;Content-Type&#34;, &#34;text/plain; charset=utf-8&#34;)</pre></code></td></tr><tr class="miss"><td>617</td><td><code><pre>                w.WriteHeader(http.StatusMethodNotAllowed)</pre></code></td></tr><tr class="miss"><td>618</td><td><code><pre>                io.WriteString(w, &#34;405 must CONNECT\n&#34;)</pre></code></td></tr><tr class="miss"><td>619</td><td><code><pre>                return</pre></code></td></tr><tr><td>620</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>621</td><td><code><pre>        conn, _, err := w.(http.Hijacker).Hijack()</pre></code></td></tr><tr class="miss"><td>622</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>623</td><td><code><pre>                log.Info(&#34;rpc hijacking &#34;, req.RemoteAddr, &#34;: &#34;, err.Error())</pre></code></td></tr><tr class="miss"><td>624</td><td><code><pre>                return</pre></code></td></tr><tr><td>625</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>626</td><td><code><pre>        io.WriteString(conn, &#34;HTTP/1.0 &#34;+connected+&#34;\n\n&#34;)</pre></code></td></tr><tr><td>627</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>628</td><td><code><pre>        s.mu.Lock()</pre></code></td></tr><tr class="miss"><td>629</td><td><code><pre>        s.activeConn[conn] = struct{}{}</pre></code></td></tr><tr class="miss"><td>630</td><td><code><pre>        s.mu.Unlock()</pre></code></td></tr><tr><td>631</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>632</td><td><code><pre>        s.serveConn(conn)</pre></code></td></tr><tr><td>633</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.serveByHTTP">func Server.serveByHTTP</div><div class="info"><a href="#s_fn_Server.serveByHTTP">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>271</td><td><code><pre>func (s *Server) serveByHTTP(ln net.Listener, rpcPath string) {</pre></code></td></tr><tr class="miss"><td>272</td><td><code><pre>        s.ln = ln</pre></code></td></tr><tr><td>273</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>274</td><td><code><pre>        if s.Plugins == nil {</pre></code></td></tr><tr class="miss"><td>275</td><td><code><pre>                s.Plugins = &amp;pluginContainer{}</pre></code></td></tr><tr><td>276</td><td><code><pre>        }</pre></code></td></tr><tr><td>277</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>278</td><td><code><pre>        if rpcPath == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>279</td><td><code><pre>                rpcPath = share.DefaultRPCPath</pre></code></td></tr><tr><td>280</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>281</td><td><code><pre>        http.Handle(rpcPath, s)</pre></code></td></tr><tr class="miss"><td>282</td><td><code><pre>        srv := &amp;http.Server{Handler: nil}</pre></code></td></tr><tr><td>283</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>284</td><td><code><pre>        s.mu.Lock()</pre></code></td></tr><tr class="miss"><td>285</td><td><code><pre>        if s.activeConn == nil {</pre></code></td></tr><tr class="miss"><td>286</td><td><code><pre>                s.activeConn = make(map[net.Conn]struct{})</pre></code></td></tr><tr><td>287</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>288</td><td><code><pre>        s.mu.Unlock()</pre></code></td></tr><tr><td>289</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>290</td><td><code><pre>        srv.Serve(ln)</pre></code></td></tr><tr><td>291</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.readRequest">func Server.readRequest</div><div class="info"><a href="#s_fn_Server.readRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>454</td><td><code><pre>func (s *Server) readRequest(ctx context.Context, r io.Reader) (req *protocol.Message, err error) {</pre></code></td></tr><tr class="miss"><td>455</td><td><code><pre>        err = s.Plugins.DoPreReadRequest(ctx)</pre></code></td></tr><tr class="miss"><td>456</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>457</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>458</td><td><code><pre>        }</pre></code></td></tr><tr><td>459</td><td><code><pre>        // pool req?</pre></code></td></tr><tr class="miss"><td>460</td><td><code><pre>        req = protocol.GetPooledMsg()</pre></code></td></tr><tr class="miss"><td>461</td><td><code><pre>        err = req.Decode(r)</pre></code></td></tr><tr class="miss"><td>462</td><td><code><pre>        if err == io.EOF {</pre></code></td></tr><tr class="miss"><td>463</td><td><code><pre>                return req, err</pre></code></td></tr><tr><td>464</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>465</td><td><code><pre>        perr := s.Plugins.DoPostReadRequest(ctx, req, err)</pre></code></td></tr><tr class="miss"><td>466</td><td><code><pre>        if err == nil {</pre></code></td></tr><tr class="miss"><td>467</td><td><code><pre>                err = perr</pre></code></td></tr><tr><td>468</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>469</td><td><code><pre>        return req, err</pre></code></td></tr><tr><td>470</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.UnregisterAll">func Server.UnregisterAll</div><div class="info"><a href="#s_fn_Server.UnregisterAll">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/service.go</code>:</p></div><table class="listing">
<tr><td>324</td><td><code><pre>func (s *Server) UnregisterAll() error {</pre></code></td></tr><tr class="miss"><td>325</td><td><code><pre>        if s.Plugins == nil {</pre></code></td></tr><tr class="miss"><td>326</td><td><code><pre>                s.Plugins = &amp;pluginContainer{}</pre></code></td></tr><tr><td>327</td><td><code><pre>        }</pre></code></td></tr><tr><td>328</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>329</td><td><code><pre>        var es []error</pre></code></td></tr><tr class="miss"><td>330</td><td><code><pre>        for k := range s.serviceMap {</pre></code></td></tr><tr class="miss"><td>331</td><td><code><pre>                err := s.Plugins.DoUnregister(k)</pre></code></td></tr><tr class="miss"><td>332</td><td><code><pre>                if err != nil {</pre></code></td></tr><tr class="miss"><td>333</td><td><code><pre>                        es = append(es, err)</pre></code></td></tr><tr><td>334</td><td><code><pre>                }</pre></code></td></tr><tr><td>335</td><td><code><pre>        }</pre></code></td></tr><tr><td>336</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>337</td><td><code><pre>        if len(es) &gt; 0 {</pre></code></td></tr><tr class="miss"><td>338</td><td><code><pre>                return rerrors.NewMultiError(es)</pre></code></td></tr><tr><td>339</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>340</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>341</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoUnregister">func pluginContainer.DoUnregister</div><div class="info"><a href="#s_fn_pluginContainer.DoUnregister">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/plugin.go</code>:</p></div><table class="listing">
<tr><td>168</td><td><code><pre>func (p *pluginContainer) DoUnregister(name string) error {</pre></code></td></tr><tr class="miss"><td>169</td><td><code><pre>        var es []error</pre></code></td></tr><tr class="miss"><td>170</td><td><code><pre>        for _, rp := range p.plugins {</pre></code></td></tr><tr class="miss"><td>171</td><td><code><pre>                if plugin, ok := rp.(RegisterPlugin); ok {</pre></code></td></tr><tr class="miss"><td>172</td><td><code><pre>                        err := plugin.Unregister(name)</pre></code></td></tr><tr class="miss"><td>173</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>174</td><td><code><pre>                                es = append(es, err)</pre></code></td></tr><tr><td>175</td><td><code><pre>                        }</pre></code></td></tr><tr><td>176</td><td><code><pre>                }</pre></code></td></tr><tr><td>177</td><td><code><pre>        }</pre></code></td></tr><tr><td>178</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>179</td><td><code><pre>        if len(es) &gt; 0 {</pre></code></td></tr><tr class="miss"><td>180</td><td><code><pre>                return errors.NewMultiError(es)</pre></code></td></tr><tr><td>181</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>182</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>183</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoRegisterFunction">func pluginContainer.DoRegisterFunction</div><div class="info"><a href="#s_fn_pluginContainer.DoRegisterFunction">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/plugin.go</code>:</p></div><table class="listing">
<tr><td>150</td><td><code><pre>func (p *pluginContainer) DoRegisterFunction(name string, fn interface{}, metadata string) error {</pre></code></td></tr><tr class="miss"><td>151</td><td><code><pre>        var es []error</pre></code></td></tr><tr class="miss"><td>152</td><td><code><pre>        for _, rp := range p.plugins {</pre></code></td></tr><tr class="miss"><td>153</td><td><code><pre>                if plugin, ok := rp.(RegisterFunctionPlugin); ok {</pre></code></td></tr><tr class="miss"><td>154</td><td><code><pre>                        err := plugin.RegisterFunction(name, fn, metadata)</pre></code></td></tr><tr class="miss"><td>155</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>156</td><td><code><pre>                                es = append(es, err)</pre></code></td></tr><tr><td>157</td><td><code><pre>                        }</pre></code></td></tr><tr><td>158</td><td><code><pre>                }</pre></code></td></tr><tr><td>159</td><td><code><pre>        }</pre></code></td></tr><tr><td>160</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>161</td><td><code><pre>        if len(es) &gt; 0 {</pre></code></td></tr><tr class="miss"><td>162</td><td><code><pre>                return errors.NewMultiError(es)</pre></code></td></tr><tr><td>163</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>164</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>165</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoPostConnAccept">func pluginContainer.DoPostConnAccept</div><div class="info"><a href="#s_fn_pluginContainer.DoPostConnAccept">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/plugin.go</code>:</p></div><table class="listing">
<tr><td>186</td><td><code><pre>func (p *pluginContainer) DoPostConnAccept(conn net.Conn) (net.Conn, bool) {</pre></code></td></tr><tr class="miss"><td>187</td><td><code><pre>        var flag bool</pre></code></td></tr><tr class="miss"><td>188</td><td><code><pre>        for i := range p.plugins {</pre></code></td></tr><tr class="miss"><td>189</td><td><code><pre>                if plugin, ok := p.plugins[i].(PostConnAcceptPlugin); ok {</pre></code></td></tr><tr class="miss"><td>190</td><td><code><pre>                        conn, flag = plugin.HandleConnAccept(conn)</pre></code></td></tr><tr class="miss"><td>191</td><td><code><pre>                        if !flag { //interrupt</pre></code></td></tr><tr class="miss"><td>192</td><td><code><pre>                                conn.Close()</pre></code></td></tr><tr class="miss"><td>193</td><td><code><pre>                                return conn, false</pre></code></td></tr><tr><td>194</td><td><code><pre>                        }</pre></code></td></tr><tr><td>195</td><td><code><pre>                }</pre></code></td></tr><tr><td>196</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>197</td><td><code><pre>        return conn, true</pre></code></td></tr><tr><td>198</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.Remove">func pluginContainer.Remove</div><div class="info"><a href="#s_fn_pluginContainer.Remove">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/plugin.go</code>:</p></div><table class="listing">
<tr><td>112</td><td><code><pre>func (p *pluginContainer) Remove(plugin Plugin) {</pre></code></td></tr><tr class="miss"><td>113</td><td><code><pre>        if p.plugins == nil {</pre></code></td></tr><tr class="miss"><td>114</td><td><code><pre>                return</pre></code></td></tr><tr><td>115</td><td><code><pre>        }</pre></code></td></tr><tr><td>116</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>117</td><td><code><pre>        var plugins []Plugin</pre></code></td></tr><tr class="miss"><td>118</td><td><code><pre>        for _, p := range p.plugins {</pre></code></td></tr><tr class="miss"><td>119</td><td><code><pre>                if p != plugin {</pre></code></td></tr><tr class="miss"><td>120</td><td><code><pre>                        plugins = append(plugins, p)</pre></code></td></tr><tr><td>121</td><td><code><pre>                }</pre></code></td></tr><tr><td>122</td><td><code><pre>        }</pre></code></td></tr><tr><td>123</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>124</td><td><code><pre>        p.plugins = plugins</pre></code></td></tr><tr><td>125</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoPostConnClose">func pluginContainer.DoPostConnClose</div><div class="info"><a href="#s_fn_pluginContainer.DoPostConnClose">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/plugin.go</code>:</p></div><table class="listing">
<tr><td>201</td><td><code><pre>func (p *pluginContainer) DoPostConnClose(conn net.Conn) bool {</pre></code></td></tr><tr class="miss"><td>202</td><td><code><pre>        var flag bool</pre></code></td></tr><tr class="miss"><td>203</td><td><code><pre>        for i := range p.plugins {</pre></code></td></tr><tr class="miss"><td>204</td><td><code><pre>                if plugin, ok := p.plugins[i].(PostConnClosePlugin); ok {</pre></code></td></tr><tr class="miss"><td>205</td><td><code><pre>                        flag = plugin.HandleConnClose(conn)</pre></code></td></tr><tr class="miss"><td>206</td><td><code><pre>                        if !flag {</pre></code></td></tr><tr class="miss"><td>207</td><td><code><pre>                                return false</pre></code></td></tr><tr><td>208</td><td><code><pre>                        }</pre></code></td></tr><tr><td>209</td><td><code><pre>                }</pre></code></td></tr><tr><td>210</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>211</td><td><code><pre>        return true</pre></code></td></tr><tr><td>212</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoPreReadRequest">func pluginContainer.DoPreReadRequest</div><div class="info"><a href="#s_fn_pluginContainer.DoPreReadRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/plugin.go</code>:</p></div><table class="listing">
<tr><td>215</td><td><code><pre>func (p *pluginContainer) DoPreReadRequest(ctx context.Context) error {</pre></code></td></tr><tr class="miss"><td>216</td><td><code><pre>        for i := range p.plugins {</pre></code></td></tr><tr class="miss"><td>217</td><td><code><pre>                if plugin, ok := p.plugins[i].(PreReadRequestPlugin); ok {</pre></code></td></tr><tr class="miss"><td>218</td><td><code><pre>                        err := plugin.PreReadRequest(ctx)</pre></code></td></tr><tr class="miss"><td>219</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>220</td><td><code><pre>                                return err</pre></code></td></tr><tr><td>221</td><td><code><pre>                        }</pre></code></td></tr><tr><td>222</td><td><code><pre>                }</pre></code></td></tr><tr><td>223</td><td><code><pre>        }</pre></code></td></tr><tr><td>224</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>225</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>226</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoPostWriteRequest">func pluginContainer.DoPostWriteRequest</div><div class="info"><a href="#s_fn_pluginContainer.DoPostWriteRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/plugin.go</code>:</p></div><table class="listing">
<tr><td>299</td><td><code><pre>func (p *pluginContainer) DoPostWriteRequest(ctx context.Context, r *protocol.Message, e error) error {</pre></code></td></tr><tr class="miss"><td>300</td><td><code><pre>        for i := range p.plugins {</pre></code></td></tr><tr class="miss"><td>301</td><td><code><pre>                if plugin, ok := p.plugins[i].(PostWriteRequestPlugin); ok {</pre></code></td></tr><tr class="miss"><td>302</td><td><code><pre>                        err := plugin.PostWriteRequest(ctx, r, e)</pre></code></td></tr><tr class="miss"><td>303</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>304</td><td><code><pre>                                return err</pre></code></td></tr><tr><td>305</td><td><code><pre>                        }</pre></code></td></tr><tr><td>306</td><td><code><pre>                }</pre></code></td></tr><tr><td>307</td><td><code><pre>        }</pre></code></td></tr><tr><td>308</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>309</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>310</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_service.callForFunction">func service.callForFunction</div><div class="info"><a href="#s_fn_service.callForFunction">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/service.go</code>:</p></div><table class="listing">
<tr><td>365</td><td><code><pre>func (s *service) callForFunction(ctx context.Context, ft *functionType, argv, replyv reflect.Value) (err error) {</pre></code></td></tr><tr class="miss"><td>366</td><td><code><pre>        defer func() {</pre></code></td></tr><tr><td>367</td><td><code><pre>                if r := recover(); r != nil {</pre></code></td></tr><tr><td>368</td><td><code><pre>                        //log.Errorf(&#34;failed to invoke service: %v, stacks: %s&#34;, r, string(debug.Stack()))</pre></code></td></tr><tr><td>369</td><td><code><pre>                        err = fmt.Errorf(&#34;[service internal error]: %v, function: %s, argv: %+v&#34;,</pre></code></td></tr><tr><td>370</td><td><code><pre>                                r, runtime.FuncForPC(ft.fn.Pointer()), argv.Interface())</pre></code></td></tr><tr><td>371</td><td><code><pre>                        log.Handle(err)</pre></code></td></tr><tr><td>372</td><td><code><pre>                }</pre></code></td></tr><tr><td>373</td><td><code><pre>        }()</pre></code></td></tr><tr><td>374</td><td><code><pre></pre></code></td></tr><tr><td>375</td><td><code><pre>        // Invoke the function, providing a new value for the reply.</pre></code></td></tr><tr class="miss"><td>376</td><td><code><pre>        returnValues := ft.fn.Call([]reflect.Value{reflect.ValueOf(ctx), argv, replyv})</pre></code></td></tr><tr><td>377</td><td><code><pre>        // The return value for the method is an error.</pre></code></td></tr><tr class="miss"><td>378</td><td><code><pre>        errInter := returnValues[0].Interface()</pre></code></td></tr><tr class="miss"><td>379</td><td><code><pre>        if errInter != nil {</pre></code></td></tr><tr class="miss"><td>380</td><td><code><pre>                return errInter.(error)</pre></code></td></tr><tr><td>381</td><td><code><pre>        }</pre></code></td></tr><tr><td>382</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>383</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>384</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoPreWriteRequest">func pluginContainer.DoPreWriteRequest</div><div class="info"><a href="#s_fn_pluginContainer.DoPreWriteRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/plugin.go</code>:</p></div><table class="listing">
<tr><td>285</td><td><code><pre>func (p *pluginContainer) DoPreWriteRequest(ctx context.Context) error {</pre></code></td></tr><tr class="miss"><td>286</td><td><code><pre>        for i := range p.plugins {</pre></code></td></tr><tr class="miss"><td>287</td><td><code><pre>                if plugin, ok := p.plugins[i].(PreWriteRequestPlugin); ok {</pre></code></td></tr><tr class="miss"><td>288</td><td><code><pre>                        err := plugin.PreWriteRequest(ctx)</pre></code></td></tr><tr class="miss"><td>289</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>290</td><td><code><pre>                                return err</pre></code></td></tr><tr><td>291</td><td><code><pre>                        }</pre></code></td></tr><tr><td>292</td><td><code><pre>                }</pre></code></td></tr><tr><td>293</td><td><code><pre>        }</pre></code></td></tr><tr><td>294</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>295</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>296</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoPostWriteResponse">func pluginContainer.DoPostWriteResponse</div><div class="info"><a href="#s_fn_pluginContainer.DoPostWriteResponse">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/plugin.go</code>:</p></div><table class="listing">
<tr><td>271</td><td><code><pre>func (p *pluginContainer) DoPostWriteResponse(ctx context.Context, req *protocol.Message, resp *protocol.Message, e error) error {</pre></code></td></tr><tr class="miss"><td>272</td><td><code><pre>        for i := range p.plugins {</pre></code></td></tr><tr class="miss"><td>273</td><td><code><pre>                if plugin, ok := p.plugins[i].(PostWriteResponsePlugin); ok {</pre></code></td></tr><tr class="miss"><td>274</td><td><code><pre>                        err := plugin.PostWriteResponse(ctx, req, resp, e)</pre></code></td></tr><tr class="miss"><td>275</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>276</td><td><code><pre>                                return err</pre></code></td></tr><tr><td>277</td><td><code><pre>                        }</pre></code></td></tr><tr><td>278</td><td><code><pre>                }</pre></code></td></tr><tr><td>279</td><td><code><pre>        }</pre></code></td></tr><tr><td>280</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>281</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>282</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoPreHandleRequest">func pluginContainer.DoPreHandleRequest</div><div class="info"><a href="#s_fn_pluginContainer.DoPreHandleRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/plugin.go</code>:</p></div><table class="listing">
<tr><td>243</td><td><code><pre>func (p *pluginContainer) DoPreHandleRequest(ctx context.Context, r *protocol.Message) error {</pre></code></td></tr><tr class="miss"><td>244</td><td><code><pre>        for i := range p.plugins {</pre></code></td></tr><tr class="miss"><td>245</td><td><code><pre>                if plugin, ok := p.plugins[i].(PreHandleRequestPlugin); ok {</pre></code></td></tr><tr class="miss"><td>246</td><td><code><pre>                        err := plugin.PreHandleRequest(ctx, r)</pre></code></td></tr><tr class="miss"><td>247</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>248</td><td><code><pre>                                return err</pre></code></td></tr><tr><td>249</td><td><code><pre>                        }</pre></code></td></tr><tr><td>250</td><td><code><pre>                }</pre></code></td></tr><tr><td>251</td><td><code><pre>        }</pre></code></td></tr><tr><td>252</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>253</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>254</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.RegisterFunction">func Server.RegisterFunction</div><div class="info"><a href="#s_fn_Server.RegisterFunction">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/service.go</code>:</p></div><table class="listing">
<tr><td>100</td><td><code><pre>func (s *Server) RegisterFunction(servicePath string, fn interface{}, metadata string) error {</pre></code></td></tr><tr class="miss"><td>101</td><td><code><pre>        fname, err := s.registerFunction(servicePath, fn, &#34;&#34;, false)</pre></code></td></tr><tr class="miss"><td>102</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>103</td><td><code><pre>                return err</pre></code></td></tr><tr><td>104</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>105</td><td><code><pre>        if s.Plugins == nil {</pre></code></td></tr><tr class="miss"><td>106</td><td><code><pre>                s.Plugins = &amp;pluginContainer{}</pre></code></td></tr><tr><td>107</td><td><code><pre>        }</pre></code></td></tr><tr><td>108</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>109</td><td><code><pre>        return s.Plugins.DoRegisterFunction(fname, fn, metadata)</pre></code></td></tr><tr><td>110</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_VersionTag.UnmarshalJSON">func VersionTag.UnmarshalJSON</div><div class="info"><a href="#s_fn_VersionTag.UnmarshalJSON">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/jsonrpc2_wire.go</code>:</p></div><table class="listing">
<tr><td>102</td><td><code><pre>func (VersionTag) UnmarshalJSON(data []byte) error {</pre></code></td></tr><tr class="miss"><td>103</td><td><code><pre>        version := &#34;&#34;</pre></code></td></tr><tr class="miss"><td>104</td><td><code><pre>        if err := json.Unmarshal(data, &amp;version); err != nil {</pre></code></td></tr><tr class="miss"><td>105</td><td><code><pre>                return err</pre></code></td></tr><tr><td>106</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>107</td><td><code><pre>        if version != &#34;2.0&#34; {</pre></code></td></tr><tr class="miss"><td>108</td><td><code><pre>                return fmt.Errorf(&#34;Invalid RPC version %v&#34;, version)</pre></code></td></tr><tr><td>109</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>110</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>111</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoPostReadRequest">func pluginContainer.DoPostReadRequest</div><div class="info"><a href="#s_fn_pluginContainer.DoPostReadRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/plugin.go</code>:</p></div><table class="listing">
<tr><td>229</td><td><code><pre>func (p *pluginContainer) DoPostReadRequest(ctx context.Context, r *protocol.Message, e error) error {</pre></code></td></tr><tr class="miss"><td>230</td><td><code><pre>        for i := range p.plugins {</pre></code></td></tr><tr class="miss"><td>231</td><td><code><pre>                if plugin, ok := p.plugins[i].(PostReadRequestPlugin); ok {</pre></code></td></tr><tr class="miss"><td>232</td><td><code><pre>                        err := plugin.PostReadRequest(ctx, r, e)</pre></code></td></tr><tr class="miss"><td>233</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>234</td><td><code><pre>                                return err</pre></code></td></tr><tr><td>235</td><td><code><pre>                        }</pre></code></td></tr><tr><td>236</td><td><code><pre>                }</pre></code></td></tr><tr><td>237</td><td><code><pre>        }</pre></code></td></tr><tr><td>238</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>239</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>240</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.DoPreWriteResponse">func pluginContainer.DoPreWriteResponse</div><div class="info"><a href="#s_fn_pluginContainer.DoPreWriteResponse">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/plugin.go</code>:</p></div><table class="listing">
<tr><td>257</td><td><code><pre>func (p *pluginContainer) DoPreWriteResponse(ctx context.Context, req *protocol.Message, res *protocol.Message) error {</pre></code></td></tr><tr class="miss"><td>258</td><td><code><pre>        for i := range p.plugins {</pre></code></td></tr><tr class="miss"><td>259</td><td><code><pre>                if plugin, ok := p.plugins[i].(PreWriteResponsePlugin); ok {</pre></code></td></tr><tr class="miss"><td>260</td><td><code><pre>                        err := plugin.PreWriteResponse(ctx, req, res)</pre></code></td></tr><tr class="miss"><td>261</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>262</td><td><code><pre>                                return err</pre></code></td></tr><tr><td>263</td><td><code><pre>                        }</pre></code></td></tr><tr><td>264</td><td><code><pre>                }</pre></code></td></tr><tr><td>265</td><td><code><pre>        }</pre></code></td></tr><tr><td>266</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>267</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>268</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_writeResponse">func writeResponse</div><div class="info"><a href="#s_fn_writeResponse">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/jsonrpc2.go</code>:</p></div><table class="listing">
<tr><td>89</td><td><code><pre>func writeResponse(w http.ResponseWriter, res *jsonrpcRespone) {</pre></code></td></tr><tr class="miss"><td>90</td><td><code><pre>        data, err := json.Marshal(res)</pre></code></td></tr><tr class="miss"><td>91</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>92</td><td><code><pre>                http.Error(w, err.Error(), http.StatusInternalServerError)</pre></code></td></tr><tr class="miss"><td>93</td><td><code><pre>                return</pre></code></td></tr><tr><td>94</td><td><code><pre>        }</pre></code></td></tr><tr><td>95</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>96</td><td><code><pre>        w.Header().Set(&#34;Context-Type&#34;, &#34;application/json&#34;)</pre></code></td></tr><tr class="miss"><td>97</td><td><code><pre>        w.Write(data)</pre></code></td></tr><tr><td>98</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_reuseportMakeListener">func reuseportMakeListener</div><div class="info"><a href="#s_fn_reuseportMakeListener">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/listener_unix.go</code>:</p></div><table class="listing">
<tr><td>16</td><td><code><pre>func reuseportMakeListener(s *Server, address string) (ln net.Listener, err error) {</pre></code></td></tr><tr class="miss"><td>17</td><td><code><pre>        var network string</pre></code></td></tr><tr class="miss"><td>18</td><td><code><pre>        if validIP4(address) {</pre></code></td></tr><tr class="miss"><td>19</td><td><code><pre>                network = &#34;tcp4&#34;</pre></code></td></tr><tr><td>20</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>21</td><td><code><pre>                network = &#34;tcp6&#34;</pre></code></td></tr><tr><td>22</td><td><code><pre>        }</pre></code></td></tr><tr><td>23</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>24</td><td><code><pre>        return reuseport.NewReusablePortListener(network, address)</pre></code></td></tr><tr><td>25</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_handleError">func handleError</div><div class="info"><a href="#s_fn_handleError">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>601</td><td><code><pre>func handleError(res *protocol.Message, err error) (*protocol.Message, error) {</pre></code></td></tr><tr class="miss"><td>602</td><td><code><pre>        res.SetMessageStatusType(protocol.Error)</pre></code></td></tr><tr class="miss"><td>603</td><td><code><pre>        if res.Metadata == nil {</pre></code></td></tr><tr class="miss"><td>604</td><td><code><pre>                res.Metadata = make(map[string]string)</pre></code></td></tr><tr><td>605</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>606</td><td><code><pre>        res.Metadata[protocol.ServiceError] = err.Error()</pre></code></td></tr><tr class="miss"><td>607</td><td><code><pre>        return res, err</pre></code></td></tr><tr><td>608</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.Address">func Server.Address</div><div class="info"><a href="#s_fn_Server.Address">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>109</td><td><code><pre>func (s *Server) Address() net.Addr {</pre></code></td></tr><tr class="miss"><td>110</td><td><code><pre>        s.mu.RLock()</pre></code></td></tr><tr class="miss"><td>111</td><td><code><pre>        defer s.mu.RUnlock()</pre></code></td></tr><tr class="miss"><td>112</td><td><code><pre>        if s.ln == nil {</pre></code></td></tr><tr class="miss"><td>113</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>114</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>115</td><td><code><pre>        return s.ln.Addr()</pre></code></td></tr><tr><td>116</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.RegisterFunctionName">func Server.RegisterFunctionName</div><div class="info"><a href="#s_fn_Server.RegisterFunctionName">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/service.go</code>:</p></div><table class="listing">
<tr><td>114</td><td><code><pre>func (s *Server) RegisterFunctionName(servicePath string, name string, fn interface{}, metadata string) error {</pre></code></td></tr><tr class="miss"><td>115</td><td><code><pre>        if s.Plugins == nil {</pre></code></td></tr><tr class="miss"><td>116</td><td><code><pre>                s.Plugins = &amp;pluginContainer{}</pre></code></td></tr><tr><td>117</td><td><code><pre>        }</pre></code></td></tr><tr><td>118</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>119</td><td><code><pre>        s.Plugins.DoRegisterFunction(name, fn, metadata)</pre></code></td></tr><tr class="miss"><td>120</td><td><code><pre>        _, err := s.registerFunction(servicePath, fn, name, true)</pre></code></td></tr><tr class="miss"><td>121</td><td><code><pre>        return err</pre></code></td></tr><tr><td>122</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_ID.String">func ID.String</div><div class="info"><a href="#s_fn_ID.String">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/jsonrpc2_wire.go</code>:</p></div><table class="listing">
<tr><td>116</td><td><code><pre>func (id *ID) String() string {</pre></code></td></tr><tr class="miss"><td>117</td><td><code><pre>        if id == nil {</pre></code></td></tr><tr class="miss"><td>118</td><td><code><pre>                return &#34;&#34;</pre></code></td></tr><tr><td>119</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>120</td><td><code><pre>        if id.Name != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>121</td><td><code><pre>                return strconv.Quote(id.Name)</pre></code></td></tr><tr><td>122</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>123</td><td><code><pre>        return &#34;#&#34; + strconv.FormatInt(id.Number, 10)</pre></code></td></tr><tr><td>124</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.ActiveClientConn">func Server.ActiveClientConn</div><div class="info"><a href="#s_fn_Server.ActiveClientConn">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>119</td><td><code><pre>func (s *Server) ActiveClientConn() []net.Conn {</pre></code></td></tr><tr class="miss"><td>120</td><td><code><pre>        var result []net.Conn</pre></code></td></tr><tr><td>121</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>122</td><td><code><pre>        for clientConn := range s.activeConn {</pre></code></td></tr><tr class="miss"><td>123</td><td><code><pre>                result = append(result, clientConn)</pre></code></td></tr><tr><td>124</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>125</td><td><code><pre>        return result</pre></code></td></tr><tr><td>126</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_closeChannel">func closeChannel</div><div class="info"><a href="#s_fn_closeChannel">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>447</td><td><code><pre>func closeChannel(s *Server, conn net.Conn) {</pre></code></td></tr><tr class="miss"><td>448</td><td><code><pre>        s.mu.Lock()</pre></code></td></tr><tr class="miss"><td>449</td><td><code><pre>        delete(s.activeConn, conn)</pre></code></td></tr><tr class="miss"><td>450</td><td><code><pre>        s.mu.Unlock()</pre></code></td></tr><tr class="miss"><td>451</td><td><code><pre>        conn.Close()</pre></code></td></tr><tr><td>452</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_tcp6MakeListener">func tcp6MakeListener</div><div class="info"><a href="#s_fn_tcp6MakeListener">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/listener.go</code>:</p></div><table class="listing">
<tr><td>56</td><td><code><pre>func tcp6MakeListener(s *Server, address string) (ln net.Listener, err error) {</pre></code></td></tr><tr class="miss"><td>57</td><td><code><pre>        if s.tlsConfig == nil {</pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>                ln, err = net.Listen(&#34;tcp6&#34;, address)</pre></code></td></tr><tr><td>59</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>60</td><td><code><pre>                ln, err = tls.Listen(&#34;tcp6&#34;, address, s.tlsConfig)</pre></code></td></tr><tr><td>61</td><td><code><pre>        }</pre></code></td></tr><tr><td>62</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>63</td><td><code><pre>        return ln, err</pre></code></td></tr><tr><td>64</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.auth">func Server.auth</div><div class="info"><a href="#s_fn_Server.auth">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>472</td><td><code><pre>func (s *Server) auth(ctx context.Context, req *protocol.Message) error {</pre></code></td></tr><tr class="miss"><td>473</td><td><code><pre>        if s.AuthFunc != nil {</pre></code></td></tr><tr class="miss"><td>474</td><td><code><pre>                token := req.Metadata[share.AuthKey]</pre></code></td></tr><tr class="miss"><td>475</td><td><code><pre>                return s.AuthFunc(ctx, req, token)</pre></code></td></tr><tr><td>476</td><td><code><pre>        }</pre></code></td></tr><tr><td>477</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>478</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>479</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_ID.UnmarshalJSON">func ID.UnmarshalJSON</div><div class="info"><a href="#s_fn_ID.UnmarshalJSON">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/jsonrpc2_wire.go</code>:</p></div><table class="listing">
<tr><td>133</td><td><code><pre>func (id *ID) UnmarshalJSON(data []byte) error {</pre></code></td></tr><tr class="miss"><td>134</td><td><code><pre>        *id = ID{}</pre></code></td></tr><tr class="miss"><td>135</td><td><code><pre>        if err := json.Unmarshal(data, &amp;id.Number); err == nil {</pre></code></td></tr><tr class="miss"><td>136</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>137</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>138</td><td><code><pre>        return json.Unmarshal(data, &amp;id.Name)</pre></code></td></tr><tr><td>139</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_unixMakeListener">func unixMakeListener</div><div class="info"><a href="#s_fn_unixMakeListener">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/listener_unix.go</code>:</p></div><table class="listing">
<tr><td>27</td><td><code><pre>func unixMakeListener(s *Server, address string) (ln net.Listener, err error) {</pre></code></td></tr><tr class="miss"><td>28</td><td><code><pre>        laddr, err := net.ResolveUnixAddr(&#34;unix&#34;, address)</pre></code></td></tr><tr class="miss"><td>29</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>30</td><td><code><pre>                return nil, err</pre></code></td></tr><tr><td>31</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>32</td><td><code><pre>        return net.ListenUnix(&#34;unix&#34;, laddr)</pre></code></td></tr><tr><td>33</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_tcp4MakeListener">func tcp4MakeListener</div><div class="info"><a href="#s_fn_tcp4MakeListener">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/listener.go</code>:</p></div><table class="listing">
<tr><td>46</td><td><code><pre>func tcp4MakeListener(s *Server, address string) (ln net.Listener, err error) {</pre></code></td></tr><tr class="miss"><td>47</td><td><code><pre>        if s.tlsConfig == nil {</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>                ln, err = net.Listen(&#34;tcp4&#34;, address)</pre></code></td></tr><tr><td>49</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>                ln, err = tls.Listen(&#34;tcp4&#34;, address, s.tlsConfig)</pre></code></td></tr><tr><td>51</td><td><code><pre>        }</pre></code></td></tr><tr><td>52</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>53</td><td><code><pre>        return ln, err</pre></code></td></tr><tr><td>54</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_validIP4">func validIP4</div><div class="info"><a href="#s_fn_validIP4">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>728</td><td><code><pre>func validIP4(ipAddress string) bool {</pre></code></td></tr><tr class="miss"><td>729</td><td><code><pre>        ipAddress = strings.Trim(ipAddress, &#34; &#34;)</pre></code></td></tr><tr class="miss"><td>730</td><td><code><pre>        i := strings.LastIndex(ipAddress, &#34;:&#34;)</pre></code></td></tr><tr class="miss"><td>731</td><td><code><pre>        ipAddress = ipAddress[:i] //remove port</pre></code></td></tr><tr><td>732</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>733</td><td><code><pre>        return ip4Reg.MatchString(ipAddress)</pre></code></td></tr><tr><td>734</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_JSONRPCError.JSONRPCError">func JSONRPCError.JSONRPCError</div><div class="info"><a href="#s_fn_JSONRPCError.JSONRPCError">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/jsonrpc2_wire.go</code>:</p></div><table class="listing">
<tr><td>91</td><td><code><pre>func (err *JSONRPCError) JSONRPCError() string {</pre></code></td></tr><tr class="miss"><td>92</td><td><code><pre>        if err == nil {</pre></code></td></tr><tr class="miss"><td>93</td><td><code><pre>                return &#34;&#34;</pre></code></td></tr><tr><td>94</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>95</td><td><code><pre>        return err.Message</pre></code></td></tr><tr><td>96</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@41:9">func @41:9</div><div class="info"><a href="#s_fn_@41:9">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/gateway.go</code>:</p></div><table class="listing">
<tr><td>41</td><td><code><pre>func(r io.Reader) bool {</pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>                buf := make([]byte, 1)</pre></code></td></tr><tr class="miss"><td>43</td><td><code><pre>                n, _ := r.Read(buf)</pre></code></td></tr><tr class="miss"><td>44</td><td><code><pre>                return n == 1 &amp;&amp; buf[0] == magic</pre></code></td></tr><tr><td>45</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_@366:8">func @366:8</div><div class="info"><a href="#s_fn_@366:8">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/service.go</code>:</p></div><table class="listing">
<tr><td>366</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>367</td><td><code><pre>                if r := recover(); r != nil {</pre></code></td></tr><tr><td>368</td><td><code><pre>                        //log.Errorf(&#34;failed to invoke service: %v, stacks: %s&#34;, r, string(debug.Stack()))</pre></code></td></tr><tr class="miss"><td>369</td><td><code><pre>                        err = fmt.Errorf(&#34;[service internal error]: %v, function: %s, argv: %+v&#34;,</pre></code></td></tr><tr><td>370</td><td><code><pre>                                r, runtime.FuncForPC(ft.fn.Pointer()), argv.Interface())</pre></code></td></tr><tr class="miss"><td>371</td><td><code><pre>                        log.Handle(err)</pre></code></td></tr><tr><td>372</td><td><code><pre>                }</pre></code></td></tr><tr><td>373</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_ID.MarshalJSON">func ID.MarshalJSON</div><div class="info"><a href="#s_fn_ID.MarshalJSON">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/jsonrpc2_wire.go</code>:</p></div><table class="listing">
<tr><td>126</td><td><code><pre>func (id *ID) MarshalJSON() ([]byte, error) {</pre></code></td></tr><tr class="miss"><td>127</td><td><code><pre>        if id.Name != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>128</td><td><code><pre>                return json.Marshal(id.Name)</pre></code></td></tr><tr><td>129</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>130</td><td><code><pre>        return json.Marshal(id.Number)</pre></code></td></tr><tr><td>131</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@393:10">func @393:10</div><div class="info"><a href="#s_fn_@393:10">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>393</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>394</td><td><code><pre>                                atomic.AddInt32(&amp;s.handlerMsgNum, -1)</pre></code></td></tr><tr><td>395</td><td><code><pre>                        }</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.All">func pluginContainer.All</div><div class="info"><a href="#s_fn_pluginContainer.All">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/plugin.go</code>:</p></div><table class="listing">
<tr><td>127</td><td><code><pre>func (p *pluginContainer) All() []Plugin {</pre></code></td></tr><tr class="miss"><td>128</td><td><code><pre>        return p.plugins</pre></code></td></tr><tr><td>129</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_AllowAllCORSOptions">func AllowAllCORSOptions</div><div class="info"><a href="#s_fn_AllowAllCORSOptions">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/jsonrpc2.go</code>:</p></div><table class="listing">
<tr><td>141</td><td><code><pre>func AllowAllCORSOptions() *CORSOptions {</pre></code></td></tr><tr class="miss"><td>142</td><td><code><pre>        return &amp;CORSOptions{</pre></code></td></tr><tr><td>143</td><td><code><pre>                AllowedOrigins: []string{&#34;*&#34;},</pre></code></td></tr><tr><td>144</td><td><code><pre>                AllowedMethods: []string{</pre></code></td></tr><tr><td>145</td><td><code><pre>                        http.MethodHead,</pre></code></td></tr><tr><td>146</td><td><code><pre>                        http.MethodGet,</pre></code></td></tr><tr><td>147</td><td><code><pre>                        http.MethodPost,</pre></code></td></tr><tr><td>148</td><td><code><pre>                        http.MethodPut,</pre></code></td></tr><tr><td>149</td><td><code><pre>                        http.MethodPatch,</pre></code></td></tr><tr><td>150</td><td><code><pre>                        http.MethodDelete,</pre></code></td></tr><tr><td>151</td><td><code><pre>                },</pre></code></td></tr><tr><td>152</td><td><code><pre>                AllowedHeaders:   []string{&#34;*&#34;},</pre></code></td></tr><tr><td>153</td><td><code><pre>                AllowCredentials: false,</pre></code></td></tr><tr><td>154</td><td><code><pre>        }</pre></code></td></tr><tr><td>155</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_VersionTag.MarshalJSON">func VersionTag.MarshalJSON</div><div class="info"><a href="#s_fn_VersionTag.MarshalJSON">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/jsonrpc2_wire.go</code>:</p></div><table class="listing">
<tr><td>98</td><td><code><pre>func (VersionTag) MarshalJSON() ([]byte, error) {</pre></code></td></tr><tr class="miss"><td>99</td><td><code><pre>        return json.Marshal(&#34;2.0&#34;)</pre></code></td></tr><tr><td>100</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_isShutdown">func isShutdown</div><div class="info"><a href="#s_fn_isShutdown">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr><td>443</td><td><code><pre>func isShutdown(s *Server) bool {</pre></code></td></tr><tr class="miss"><td>444</td><td><code><pre>        return atomic.LoadInt32(&amp;s.inShutdown) == 1</pre></code></td></tr><tr><td>445</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_jsonrpcRequest.IsNotify">func jsonrpcRequest.IsNotify</div><div class="info"><a href="#s_fn_jsonrpcRequest.IsNotify">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/jsonrpc2_wire.go</code>:</p></div><table class="listing">
<tr><td>87</td><td><code><pre>func (r *jsonrpcRequest) IsNotify() bool {</pre></code></td></tr><tr class="miss"><td>88</td><td><code><pre>        return r.ID == nil</pre></code></td></tr><tr><td>89</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Server.SetCORS">func Server.SetCORS</div><div class="info"><a href="#s_fn_Server.SetCORS">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/jsonrpc2.go</code>:</p></div><table class="listing">
<tr><td>166</td><td><code><pre>func (s *Server) SetCORS(options *CORSOptions) {</pre></code></td></tr><tr class="miss"><td>167</td><td><code><pre>        s.corsOptions = options</pre></code></td></tr><tr><td>168</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@22:9">func @22:9</div><div class="info"><a href="#s_fn_@22:9">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/option.go</code>:</p></div><table class="listing">
<tr><td>22</td><td><code><pre>func(s *Server) {</pre></code></td></tr><tr class="miss"><td>23</td><td><code><pre>                s.tlsConfig = cfg</pre></code></td></tr><tr><td>24</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_WithReadTimeout">func WithReadTimeout</div><div class="info"><a href="#s_fn_WithReadTimeout">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/option.go</code>:</p></div><table class="listing">
<tr><td>28</td><td><code><pre>func WithReadTimeout(readTimeout time.Duration) OptionFn {</pre></code></td></tr><tr class="miss"><td>29</td><td><code><pre>        return func(s *Server) {</pre></code></td></tr><tr><td>30</td><td><code><pre>                s.readTimeout = readTimeout</pre></code></td></tr><tr><td>31</td><td><code><pre>        }</pre></code></td></tr><tr><td>32</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_contextKey.String">func contextKey.String</div><div class="info"><a href="#s_fn_contextKey.String">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/server.go</code>:</p></div><table class="listing">
<tr class="miss"><td>45</td><td><code><pre>func (k *contextKey) String() string { return &#34;rpcx context value &#34; + k.name }</pre></code></td></tr></table>

<div class="funcname" id="fn_@29:9">func @29:9</div><div class="info"><a href="#s_fn_@29:9">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/option.go</code>:</p></div><table class="listing">
<tr><td>29</td><td><code><pre>func(s *Server) {</pre></code></td></tr><tr class="miss"><td>30</td><td><code><pre>                s.readTimeout = readTimeout</pre></code></td></tr><tr><td>31</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_WithWriteTimeout">func WithWriteTimeout</div><div class="info"><a href="#s_fn_WithWriteTimeout">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/option.go</code>:</p></div><table class="listing">
<tr><td>35</td><td><code><pre>func WithWriteTimeout(writeTimeout time.Duration) OptionFn {</pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>        return func(s *Server) {</pre></code></td></tr><tr><td>37</td><td><code><pre>                s.writeTimeout = writeTimeout</pre></code></td></tr><tr><td>38</td><td><code><pre>        }</pre></code></td></tr><tr><td>39</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@38:11">func @38:11</div><div class="info"><a href="#s_fn_@38:11">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/pool.go</code>:</p></div><table class="listing">
<tr><td>38</td><td><code><pre>func() interface{} {</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>                return p.New(t)</pre></code></td></tr><tr><td>40</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_@36:9">func @36:9</div><div class="info"><a href="#s_fn_@36:9">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/option.go</code>:</p></div><table class="listing">
<tr><td>36</td><td><code><pre>func(s *Server) {</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>                s.writeTimeout = writeTimeout</pre></code></td></tr><tr><td>38</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_RegisterMakeListener">func RegisterMakeListener</div><div class="info"><a href="#s_fn_RegisterMakeListener">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/listener.go</code>:</p></div><table class="listing">
<tr><td>19</td><td><code><pre>func RegisterMakeListener(network string, ml MakeListener) {</pre></code></td></tr><tr class="miss"><td>20</td><td><code><pre>        makeListeners[network] = ml</pre></code></td></tr><tr><td>21</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_pluginContainer.Add">func pluginContainer.Add</div><div class="info"><a href="#s_fn_pluginContainer.Add">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/plugin.go</code>:</p></div><table class="listing">
<tr><td>107</td><td><code><pre>func (p *pluginContainer) Add(plugin Plugin) {</pre></code></td></tr><tr class="miss"><td>108</td><td><code><pre>        p.plugins = append(p.plugins, plugin)</pre></code></td></tr><tr><td>109</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_WithTLSConfig">func WithTLSConfig</div><div class="info"><a href="#s_fn_WithTLSConfig">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/server/option.go</code>:</p></div><table class="listing">
<tr><td>21</td><td><code><pre>func WithTLSConfig(cfg *tls.Config) OptionFn {</pre></code></td></tr><tr class="miss"><td>22</td><td><code><pre>        return func(s *Server) {</pre></code></td></tr><tr><td>23</td><td><code><pre>                s.tlsConfig = cfg</pre></code></td></tr><tr><td>24</td><td><code><pre>        }</pre></code></td></tr><tr><td>25</td><td><code><pre>}</pre></code></td></tr></table>

<!-- Can be parsed by external script
PACKAGE:github.com/smallnest/rpcx/server DONE:22.97
-->

<div id="pkg_github.com/smallnest/rpcx/serverplugin" class="funcname">Package Overview: github.com/smallnest/rpcx/serverplugin <span class="packageTotal">0.00%</span></div><p>This is a coverage report created after analysis of the <code>github.com/smallnest/rpcx/serverplugin</code> package. It 
        has been generated with the following command:</p><pre class="cmd">gocov test github.com/smallnest/rpcx/serverplugin | gocov-html</pre>        <p>Here are the stats. Please select a function name to view its implementation and see what's left for testing.</p><table class="overview">
<tr id="s_fn_FileTransfer.start"><td><code><a href="#fn_FileTransfer.start">FileTransfer.start(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/file_transfer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/47</code></td></tr>
<tr id="s_fn_@66:6"><td><code><a href="#fn_@66:6">@66:6(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/mdns.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/18</code></td></tr>
<tr id="s_fn_MDNSRegisterPlugin.initMDNS"><td><code><a href="#fn_MDNSRegisterPlugin.initMDNS">MDNSRegisterPlugin.initMDNS(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/mdns.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/17</code></td></tr>
<tr id="s_fn_@92:13"><td><code><a href="#fn_@92:13">@92:13(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/influxdb.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/16</code></td></tr>
<tr id="s_fn_AliasPlugin.PreWriteResponse"><td><code><a href="#fn_AliasPlugin.PreWriteResponse">AliasPlugin.PreWriteResponse(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/alias.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/14</code></td></tr>
<tr id="s_fn_MetricsPlugin.PostWriteResponse"><td><code><a href="#fn_MetricsPlugin.PostWriteResponse">MetricsPlugin.PostWriteResponse(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/metrics.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/13</code></td></tr>
<tr id="s_fn_MDNSRegisterPlugin.Register"><td><code><a href="#fn_MDNSRegisterPlugin.Register">MDNSRegisterPlugin.Register(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/mdns.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/12</code></td></tr>
<tr id="s_fn_MDNSRegisterPlugin.Unregister"><td><code><a href="#fn_MDNSRegisterPlugin.Unregister">MDNSRegisterPlugin.Unregister(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/mdns.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/12</code></td></tr>
<tr id="s_fn_reporter.run"><td><code><a href="#fn_reporter.run">reporter.run(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/influxdb.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/11</code></td></tr>
<tr id="s_fn_AliasPlugin.PostReadRequest"><td><code><a href="#fn_AliasPlugin.PostReadRequest">AliasPlugin.PostReadRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/alias.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/11</code></td></tr>
<tr id="s_fn_InfluxDBWithTags"><td><code><a href="#fn_InfluxDBWithTags">InfluxDBWithTags(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/influxdb.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/9</code></td></tr>
<tr id="s_fn_OpenTracingPlugin.PreHandleRequest"><td><code><a href="#fn_OpenTracingPlugin.PreHandleRequest">OpenTracingPlugin.PreHandleRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/opentracing.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/9</code></td></tr>
<tr id="s_fn_OpenCensusPlugin.PreHandleRequest"><td><code><a href="#fn_OpenCensusPlugin.PreHandleRequest">OpenCensusPlugin.PreHandleRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/opencensus.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/9</code></td></tr>
<tr id="s_fn_TracePlugin.PostWriteResponse"><td><code><a href="#fn_TracePlugin.PostWriteResponse">TracePlugin.PostWriteResponse(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/trace.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/7</code></td></tr>
<tr id="s_fn_MetricsPlugin.PostReadRequest"><td><code><a href="#fn_MetricsPlugin.PostReadRequest">MetricsPlugin.PostReadRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/metrics.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/7</code></td></tr>
<tr id="s_fn_FileTransferService.DownloadFile"><td><code><a href="#fn_FileTransferService.DownloadFile">FileTransferService.DownloadFile(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/file_transfer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/7</code></td></tr>
<tr id="s_fn_FileTransferService.TransferFile"><td><code><a href="#fn_FileTransferService.TransferFile">FileTransferService.TransferFile(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/file_transfer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/7</code></td></tr>
<tr id="s_fn_MDNSRegisterPlugin.Start"><td><code><a href="#fn_MDNSRegisterPlugin.Start">MDNSRegisterPlugin.Start(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/mdns.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/6</code></td></tr>
<tr id="s_fn_OpenCensusPlugin.PostWriteResponse"><td><code><a href="#fn_OpenCensusPlugin.PostWriteResponse">OpenCensusPlugin.PostWriteResponse(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/opencensus.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_reporter.send"><td><code><a href="#fn_reporter.send">reporter.send(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/influxdb.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_OpenTracingPlugin.PostWriteResponse"><td><code><a href="#fn_OpenTracingPlugin.PostWriteResponse">OpenTracingPlugin.PostWriteResponse(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/opentracing.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/5</code></td></tr>
<tr id="s_fn_OpenCensusPlugin.RegisterFunction"><td><code><a href="#fn_OpenCensusPlugin.RegisterFunction">OpenCensusPlugin.RegisterFunction(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/opencensus.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_MDNSRegisterPlugin.Stop"><td><code><a href="#fn_MDNSRegisterPlugin.Stop">MDNSRegisterPlugin.Stop(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/mdns.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_MDNSRegisterPlugin.HandleConnAccept"><td><code><a href="#fn_MDNSRegisterPlugin.HandleConnAccept">MDNSRegisterPlugin.HandleConnAccept(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/mdns.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_OpenCensusPlugin.Register"><td><code><a href="#fn_OpenCensusPlugin.Register">OpenCensusPlugin.Register(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/opencensus.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_TracePlugin.Register"><td><code><a href="#fn_TracePlugin.Register">TracePlugin.Register(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/trace.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_OpenTracingPlugin.PostConnAccept"><td><code><a href="#fn_OpenTracingPlugin.PostConnAccept">OpenTracingPlugin.PostConnAccept(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/opentracing.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_OpenTracingPlugin.RegisterFunction"><td><code><a href="#fn_OpenTracingPlugin.RegisterFunction">OpenTracingPlugin.RegisterFunction(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/opentracing.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_TracePlugin.RegisterFunction"><td><code><a href="#fn_TracePlugin.RegisterFunction">TracePlugin.RegisterFunction(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/trace.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_OpenCensusPlugin.PostConnAccept"><td><code><a href="#fn_OpenCensusPlugin.PostConnAccept">OpenCensusPlugin.PostConnAccept(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/opencensus.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_OpenTracingPlugin.Register"><td><code><a href="#fn_OpenTracingPlugin.Register">OpenTracingPlugin.Register(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/opentracing.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_TracePlugin.PostConnAccept"><td><code><a href="#fn_TracePlugin.PostConnAccept">TracePlugin.PostConnAccept(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/trace.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_NewFileTransfer"><td><code><a href="#fn_NewFileTransfer">NewFileTransfer(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/file_transfer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_TracePlugin.PostReadRequest"><td><code><a href="#fn_TracePlugin.PostReadRequest">TracePlugin.PostReadRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/trace.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_MetricsPlugin.HandleConnAccept"><td><code><a href="#fn_MetricsPlugin.HandleConnAccept">MetricsPlugin.HandleConnAccept(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/metrics.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_NewMDNSRegisterPlugin"><td><code><a href="#fn_NewMDNSRegisterPlugin">NewMDNSRegisterPlugin(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/mdns.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_MetricsPlugin.Register"><td><code><a href="#fn_MetricsPlugin.Register">MetricsPlugin.Register(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/metrics.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/3</code></td></tr>
<tr id="s_fn_reporter.makeClient"><td><code><a href="#fn_reporter.makeClient">reporter.makeClient(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/influxdb.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/2</code></td></tr>
<tr id="s_fn_RegisterFileTransfer"><td><code><a href="#fn_RegisterFileTransfer">RegisterFileTransfer(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/file_transfer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/2</code></td></tr>
<tr id="s_fn_FileTransfer.Start"><td><code><a href="#fn_FileTransfer.Start">FileTransfer.Start(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/file_transfer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/2</code></td></tr>
<tr id="s_fn_FileTransfer.Stop"><td><code><a href="#fn_FileTransfer.Stop">FileTransfer.Stop(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/file_transfer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/2</code></td></tr>
<tr id="s_fn_NewRateLimitingPlugin"><td><code><a href="#fn_NewRateLimitingPlugin">NewRateLimitingPlugin(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/rate_limiting.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/2</code></td></tr>
<tr id="s_fn_AliasPlugin.Alias"><td><code><a href="#fn_AliasPlugin.Alias">AliasPlugin.Alias(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/alias.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/2</code></td></tr>
<tr id="s_fn_MetricsPlugin.PreReadRequest"><td><code><a href="#fn_MetricsPlugin.PreReadRequest">MetricsPlugin.PreReadRequest(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/metrics.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_MetricsPlugin.withPrefix"><td><code><a href="#fn_MetricsPlugin.withPrefix">MetricsPlugin.withPrefix(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/metrics.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_NewMetricsPlugin"><td><code><a href="#fn_NewMetricsPlugin">NewMetricsPlugin(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/metrics.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_MetricsPlugin.Log"><td><code><a href="#fn_MetricsPlugin.Log">MetricsPlugin.Log(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/metrics.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_InfluxDB"><td><code><a href="#fn_InfluxDB">InfluxDB(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/influxdb.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_MetricsPlugin.Graphite"><td><code><a href="#fn_MetricsPlugin.Graphite">MetricsPlugin.Graphite(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/metrics.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_RateLimitingPlugin.HandleConnAccept"><td><code><a href="#fn_RateLimitingPlugin.HandleConnAccept">RateLimitingPlugin.HandleConnAccept(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/rate_limiting.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_@131:17"><td><code><a href="#fn_@131:17">@131:17(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/file_transfer.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_MetricsPlugin.InfluxDB"><td><code><a href="#fn_MetricsPlugin.InfluxDB">MetricsPlugin.InfluxDB(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/metrics.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_GetFunctionName"><td><code><a href="#fn_GetFunctionName">GetFunctionName(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/trace.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_MetricsPlugin.InfluxDBWithTags"><td><code><a href="#fn_MetricsPlugin.InfluxDBWithTags">MetricsPlugin.InfluxDBWithTags(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/metrics.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_NewAliasPlugin"><td><code><a href="#fn_NewAliasPlugin">NewAliasPlugin(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/alias.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_MetricsPlugin.Exp"><td><code><a href="#fn_MetricsPlugin.Exp">MetricsPlugin.Exp(...)</a></code></td><td><code>github.com/smallnest/rpcx/serverplugin/metrics.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr><td colspan="2"><code>github.com/smallnest/rpcx/serverplugin</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/333</code></td></tr>
</table>

<div class="funcname" id="fn_FileTransfer.start">func FileTransfer.start</div><div class="info"><a href="#s_fn_FileTransfer.start">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/file_transfer.go</code>:</p></div><table class="listing">
<tr><td>138</td><td><code><pre>func (s *FileTransfer) start() error {</pre></code></td></tr><tr class="miss"><td>139</td><td><code><pre>        ln, err := net.Listen(&#34;tcp&#34;, s.Addr)</pre></code></td></tr><tr class="miss"><td>140</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>141</td><td><code><pre>                return err</pre></code></td></tr><tr><td>142</td><td><code><pre>        }</pre></code></td></tr><tr><td>143</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>144</td><td><code><pre>        var tempDelay time.Duration</pre></code></td></tr><tr><td>145</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>146</td><td><code><pre>        for {</pre></code></td></tr><tr class="miss"><td>147</td><td><code><pre>                select {</pre></code></td></tr><tr><td>148</td><td><code><pre>                case &lt;-s.done:</pre></code></td></tr><tr class="miss"><td>149</td><td><code><pre>                        return nil</pre></code></td></tr><tr><td>150</td><td><code><pre>                default:</pre></code></td></tr><tr class="miss"><td>151</td><td><code><pre>                        conn, e := ln.Accept()</pre></code></td></tr><tr class="miss"><td>152</td><td><code><pre>                        if e != nil {</pre></code></td></tr><tr class="miss"><td>153</td><td><code><pre>                                if ne, ok := e.(net.Error); ok &amp;&amp; ne.Temporary() {</pre></code></td></tr><tr class="miss"><td>154</td><td><code><pre>                                        if tempDelay == 0 {</pre></code></td></tr><tr class="miss"><td>155</td><td><code><pre>                                                tempDelay = 5 * time.Millisecond</pre></code></td></tr><tr><td>156</td><td><code><pre>                                        } else {</pre></code></td></tr><tr class="miss"><td>157</td><td><code><pre>                                                tempDelay *= 2</pre></code></td></tr><tr><td>158</td><td><code><pre>                                        }</pre></code></td></tr><tr><td>159</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>160</td><td><code><pre>                                        if max := 1 * time.Second; tempDelay &gt; max {</pre></code></td></tr><tr class="miss"><td>161</td><td><code><pre>                                                tempDelay = max</pre></code></td></tr><tr><td>162</td><td><code><pre>                                        }</pre></code></td></tr><tr><td>163</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>164</td><td><code><pre>                                        log.Errorf(&#34;filetransfer: accept error: %v; retrying in %v&#34;, e, tempDelay)</pre></code></td></tr><tr class="miss"><td>165</td><td><code><pre>                                        time.Sleep(tempDelay)</pre></code></td></tr><tr class="miss"><td>166</td><td><code><pre>                                        continue</pre></code></td></tr><tr><td>167</td><td><code><pre>                                }</pre></code></td></tr><tr class="miss"><td>168</td><td><code><pre>                                return e</pre></code></td></tr><tr><td>169</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>170</td><td><code><pre>                        tempDelay = 0</pre></code></td></tr><tr><td>171</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>172</td><td><code><pre>                        if tc, ok := conn.(*net.TCPConn); ok {</pre></code></td></tr><tr class="miss"><td>173</td><td><code><pre>                                tc.SetKeepAlive(true)</pre></code></td></tr><tr class="miss"><td>174</td><td><code><pre>                                tc.SetKeepAlivePeriod(3 * time.Minute)</pre></code></td></tr><tr class="miss"><td>175</td><td><code><pre>                                tc.SetLinger(10)</pre></code></td></tr><tr><td>176</td><td><code><pre>                        }</pre></code></td></tr><tr><td>177</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>178</td><td><code><pre>                        token := make([]byte, 32)</pre></code></td></tr><tr class="miss"><td>179</td><td><code><pre>                        _, err := io.ReadFull(conn, token)</pre></code></td></tr><tr class="miss"><td>180</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>181</td><td><code><pre>                                conn.Close()</pre></code></td></tr><tr class="miss"><td>182</td><td><code><pre>                                log.Errorf(&#34;failed to read token from %s&#34;, conn.RemoteAddr().String())</pre></code></td></tr><tr class="miss"><td>183</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>184</td><td><code><pre>                        }</pre></code></td></tr><tr><td>185</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>186</td><td><code><pre>                        tokenStr := string(token)</pre></code></td></tr><tr class="miss"><td>187</td><td><code><pre>                        info, ok := s.cachedTokens.Get(tokenStr)</pre></code></td></tr><tr class="miss"><td>188</td><td><code><pre>                        if !ok {</pre></code></td></tr><tr class="miss"><td>189</td><td><code><pre>                                conn.Close()</pre></code></td></tr><tr class="miss"><td>190</td><td><code><pre>                                log.Errorf(&#34;failed to read token from %s&#34;, conn.RemoteAddr().String())</pre></code></td></tr><tr class="miss"><td>191</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>192</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>193</td><td><code><pre>                        s.cachedTokens.Remove(tokenStr)</pre></code></td></tr><tr><td>194</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>195</td><td><code><pre>                        switch ti := info.(type) {</pre></code></td></tr><tr><td>196</td><td><code><pre>                        case *tokenInfo:</pre></code></td></tr><tr class="miss"><td>197</td><td><code><pre>                                if s.handler == nil {</pre></code></td></tr><tr class="miss"><td>198</td><td><code><pre>                                        conn.Close()</pre></code></td></tr><tr class="miss"><td>199</td><td><code><pre>                                        continue</pre></code></td></tr><tr><td>200</td><td><code><pre>                                }</pre></code></td></tr><tr class="miss"><td>201</td><td><code><pre>                                go s.handler(conn, ti.args)</pre></code></td></tr><tr><td>202</td><td><code><pre>                        case *downloadTokenInfo:</pre></code></td></tr><tr class="miss"><td>203</td><td><code><pre>                                if s.downloadFileHandler == nil {</pre></code></td></tr><tr class="miss"><td>204</td><td><code><pre>                                        conn.Close()</pre></code></td></tr><tr class="miss"><td>205</td><td><code><pre>                                        continue</pre></code></td></tr><tr><td>206</td><td><code><pre>                                }</pre></code></td></tr><tr class="miss"><td>207</td><td><code><pre>                                go s.downloadFileHandler(conn, ti.args)</pre></code></td></tr><tr><td>208</td><td><code><pre>                        default:</pre></code></td></tr><tr class="miss"><td>209</td><td><code><pre>                                conn.Close()</pre></code></td></tr><tr><td>210</td><td><code><pre>                        }</pre></code></td></tr><tr><td>211</td><td><code><pre></pre></code></td></tr><tr><td>212</td><td><code><pre>                }</pre></code></td></tr><tr><td>213</td><td><code><pre></pre></code></td></tr><tr><td>214</td><td><code><pre>        }</pre></code></td></tr><tr><td>215</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@66:6">func @66:6</div><div class="info"><a href="#s_fn_@66:6">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/mdns.go</code>:</p></div><table class="listing">
<tr><td>66</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>67</td><td><code><pre>                        defer p.server.Shutdown()</pre></code></td></tr><tr><td>68</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>69</td><td><code><pre>                        for {</pre></code></td></tr><tr><td>70</td><td><code><pre>                                // refresh service TTL</pre></code></td></tr><tr class="miss"><td>71</td><td><code><pre>                                select {</pre></code></td></tr><tr><td>72</td><td><code><pre>                                case &lt;-p.dying:</pre></code></td></tr><tr class="miss"><td>73</td><td><code><pre>                                        close(p.done)</pre></code></td></tr><tr class="miss"><td>74</td><td><code><pre>                                        return</pre></code></td></tr><tr><td>75</td><td><code><pre>                                case &lt;-ticker.C:</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>                                        if p.server == nil &amp;&amp; len(p.Services) == 0 {</pre></code></td></tr><tr class="miss"><td>77</td><td><code><pre>                                                break</pre></code></td></tr><tr><td>78</td><td><code><pre>                                        }</pre></code></td></tr><tr><td>79</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>80</td><td><code><pre>                                        var data []byte</pre></code></td></tr><tr class="miss"><td>81</td><td><code><pre>                                        if p.Metrics != nil {</pre></code></td></tr><tr class="miss"><td>82</td><td><code><pre>                                                clientMeter := metrics.GetOrRegisterMeter(&#34;clientMeter&#34;, p.Metrics)</pre></code></td></tr><tr class="miss"><td>83</td><td><code><pre>                                                data = []byte(strconv.FormatInt(clientMeter.Count()/60, 10))</pre></code></td></tr><tr><td>84</td><td><code><pre>                                        }</pre></code></td></tr><tr><td>85</td><td><code><pre></pre></code></td></tr><tr><td>86</td><td><code><pre>                                        //set this same metrics for all services at this server</pre></code></td></tr><tr class="miss"><td>87</td><td><code><pre>                                        for _, sm := range p.Services {</pre></code></td></tr><tr class="miss"><td>88</td><td><code><pre>                                                v, _ := url.ParseQuery(string(sm.Meta))</pre></code></td></tr><tr class="miss"><td>89</td><td><code><pre>                                                v.Set(&#34;tps&#34;, string(data))</pre></code></td></tr><tr class="miss"><td>90</td><td><code><pre>                                                sm.Meta = v.Encode()</pre></code></td></tr><tr><td>91</td><td><code><pre>                                        }</pre></code></td></tr><tr class="miss"><td>92</td><td><code><pre>                                        ss, _ := json.Marshal(p.Services)</pre></code></td></tr><tr class="miss"><td>93</td><td><code><pre>                                        s := url.QueryEscape(string(ss))</pre></code></td></tr><tr class="miss"><td>94</td><td><code><pre>                                        p.server.SetText([]string{s})</pre></code></td></tr><tr><td>95</td><td><code><pre>                                }</pre></code></td></tr><tr><td>96</td><td><code><pre>                        }</pre></code></td></tr><tr><td>97</td><td><code><pre>                }</pre></code></td></tr></table>

<div class="funcname" id="fn_MDNSRegisterPlugin.initMDNS">func MDNSRegisterPlugin.initMDNS</div><div class="info"><a href="#s_fn_MDNSRegisterPlugin.initMDNS">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/mdns.go</code>:</p></div><table class="listing">
<tr><td>111</td><td><code><pre>func (p *MDNSRegisterPlugin) initMDNS() {</pre></code></td></tr><tr class="miss"><td>112</td><td><code><pre>        data, _ := json.Marshal(p.Services)</pre></code></td></tr><tr class="miss"><td>113</td><td><code><pre>        s := url.QueryEscape(string(data))</pre></code></td></tr><tr class="miss"><td>114</td><td><code><pre>        host, _ := os.Hostname()</pre></code></td></tr><tr><td>115</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>116</td><td><code><pre>        addr := p.ServiceAddress</pre></code></td></tr><tr class="miss"><td>117</td><td><code><pre>        i := strings.Index(addr, &#34;@&#34;)</pre></code></td></tr><tr class="miss"><td>118</td><td><code><pre>        if i &gt; 0 {</pre></code></td></tr><tr class="miss"><td>119</td><td><code><pre>                addr = addr[i+1:]</pre></code></td></tr><tr><td>120</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>121</td><td><code><pre>        _, portStr, err := net.SplitHostPort(addr)</pre></code></td></tr><tr class="miss"><td>122</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>123</td><td><code><pre>                panic(err)</pre></code></td></tr><tr><td>124</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>125</td><td><code><pre>        p.port, err = strconv.Atoi(portStr)</pre></code></td></tr><tr class="miss"><td>126</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>127</td><td><code><pre>                panic(err)</pre></code></td></tr><tr><td>128</td><td><code><pre>        }</pre></code></td></tr><tr><td>129</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>130</td><td><code><pre>        server, err := zeroconf.Register(host, &#34;_rpcxservices&#34;, p.domain, p.port, []string{s}, nil)</pre></code></td></tr><tr class="miss"><td>131</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>132</td><td><code><pre>                panic(err)</pre></code></td></tr><tr><td>133</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>134</td><td><code><pre>        p.server = server</pre></code></td></tr><tr><td>135</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@92:13">func @92:13</div><div class="info"><a href="#s_fn_@92:13">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/influxdb.go</code>:</p></div><table class="listing">
<tr><td>92</td><td><code><pre>func(name string, i interface{}) {</pre></code></td></tr><tr class="miss"><td>93</td><td><code><pre>                now := time.Now()</pre></code></td></tr><tr><td>94</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>95</td><td><code><pre>                switch metric := i.(type) {</pre></code></td></tr><tr><td>96</td><td><code><pre>                case metrics.Counter:</pre></code></td></tr><tr class="miss"><td>97</td><td><code><pre>                        ms := metric.Snapshot()</pre></code></td></tr><tr class="miss"><td>98</td><td><code><pre>                        pts = append(pts, client.Point{</pre></code></td></tr><tr><td>99</td><td><code><pre>                                Measurement: fmt.Sprintf(&#34;%s.count&#34;, name),</pre></code></td></tr><tr><td>100</td><td><code><pre>                                Tags:        r.tags,</pre></code></td></tr><tr><td>101</td><td><code><pre>                                Fields: map[string]interface{}{</pre></code></td></tr><tr><td>102</td><td><code><pre>                                        &#34;value&#34;: ms.Count(),</pre></code></td></tr><tr><td>103</td><td><code><pre>                                },</pre></code></td></tr><tr><td>104</td><td><code><pre>                                Time: now,</pre></code></td></tr><tr><td>105</td><td><code><pre>                        })</pre></code></td></tr><tr><td>106</td><td><code><pre>                case metrics.Gauge:</pre></code></td></tr><tr class="miss"><td>107</td><td><code><pre>                        ms := metric.Snapshot()</pre></code></td></tr><tr class="miss"><td>108</td><td><code><pre>                        pts = append(pts, client.Point{</pre></code></td></tr><tr><td>109</td><td><code><pre>                                Measurement: fmt.Sprintf(&#34;%s.gauge&#34;, name),</pre></code></td></tr><tr><td>110</td><td><code><pre>                                Tags:        r.tags,</pre></code></td></tr><tr><td>111</td><td><code><pre>                                Fields: map[string]interface{}{</pre></code></td></tr><tr><td>112</td><td><code><pre>                                        &#34;value&#34;: ms.Value(),</pre></code></td></tr><tr><td>113</td><td><code><pre>                                },</pre></code></td></tr><tr><td>114</td><td><code><pre>                                Time: now,</pre></code></td></tr><tr><td>115</td><td><code><pre>                        })</pre></code></td></tr><tr><td>116</td><td><code><pre>                case metrics.GaugeFloat64:</pre></code></td></tr><tr class="miss"><td>117</td><td><code><pre>                        ms := metric.Snapshot()</pre></code></td></tr><tr class="miss"><td>118</td><td><code><pre>                        pts = append(pts, client.Point{</pre></code></td></tr><tr><td>119</td><td><code><pre>                                Measurement: fmt.Sprintf(&#34;%s.gauge&#34;, name),</pre></code></td></tr><tr><td>120</td><td><code><pre>                                Tags:        r.tags,</pre></code></td></tr><tr><td>121</td><td><code><pre>                                Fields: map[string]interface{}{</pre></code></td></tr><tr><td>122</td><td><code><pre>                                        &#34;value&#34;: ms.Value(),</pre></code></td></tr><tr><td>123</td><td><code><pre>                                },</pre></code></td></tr><tr><td>124</td><td><code><pre>                                Time: now,</pre></code></td></tr><tr><td>125</td><td><code><pre>                        })</pre></code></td></tr><tr><td>126</td><td><code><pre>                case metrics.Histogram:</pre></code></td></tr><tr class="miss"><td>127</td><td><code><pre>                        ms := metric.Snapshot()</pre></code></td></tr><tr class="miss"><td>128</td><td><code><pre>                        ps := ms.Percentiles([]float64{0.5, 0.75, 0.95, 0.99, 0.999, 0.9999})</pre></code></td></tr><tr class="miss"><td>129</td><td><code><pre>                        pts = append(pts, client.Point{</pre></code></td></tr><tr><td>130</td><td><code><pre>                                Measurement: fmt.Sprintf(&#34;%s.histogram&#34;, name),</pre></code></td></tr><tr><td>131</td><td><code><pre>                                Tags:        r.tags,</pre></code></td></tr><tr><td>132</td><td><code><pre>                                Fields: map[string]interface{}{</pre></code></td></tr><tr><td>133</td><td><code><pre>                                        &#34;count&#34;:    ms.Count(),</pre></code></td></tr><tr><td>134</td><td><code><pre>                                        &#34;max&#34;:      ms.Max(),</pre></code></td></tr><tr><td>135</td><td><code><pre>                                        &#34;mean&#34;:     ms.Mean(),</pre></code></td></tr><tr><td>136</td><td><code><pre>                                        &#34;min&#34;:      ms.Min(),</pre></code></td></tr><tr><td>137</td><td><code><pre>                                        &#34;stddev&#34;:   ms.StdDev(),</pre></code></td></tr><tr><td>138</td><td><code><pre>                                        &#34;variance&#34;: ms.Variance(),</pre></code></td></tr><tr><td>139</td><td><code><pre>                                        &#34;p50&#34;:      ps[0],</pre></code></td></tr><tr><td>140</td><td><code><pre>                                        &#34;p75&#34;:      ps[1],</pre></code></td></tr><tr><td>141</td><td><code><pre>                                        &#34;p95&#34;:      ps[2],</pre></code></td></tr><tr><td>142</td><td><code><pre>                                        &#34;p99&#34;:      ps[3],</pre></code></td></tr><tr><td>143</td><td><code><pre>                                        &#34;p999&#34;:     ps[4],</pre></code></td></tr><tr><td>144</td><td><code><pre>                                        &#34;p9999&#34;:    ps[5],</pre></code></td></tr><tr><td>145</td><td><code><pre>                                },</pre></code></td></tr><tr><td>146</td><td><code><pre>                                Time: now,</pre></code></td></tr><tr><td>147</td><td><code><pre>                        })</pre></code></td></tr><tr><td>148</td><td><code><pre>                case metrics.Meter:</pre></code></td></tr><tr class="miss"><td>149</td><td><code><pre>                        ms := metric.Snapshot()</pre></code></td></tr><tr class="miss"><td>150</td><td><code><pre>                        pts = append(pts, client.Point{</pre></code></td></tr><tr><td>151</td><td><code><pre>                                Measurement: fmt.Sprintf(&#34;%s.meter&#34;, name),</pre></code></td></tr><tr><td>152</td><td><code><pre>                                Tags:        r.tags,</pre></code></td></tr><tr><td>153</td><td><code><pre>                                Fields: map[string]interface{}{</pre></code></td></tr><tr><td>154</td><td><code><pre>                                        &#34;count&#34;: ms.Count(),</pre></code></td></tr><tr><td>155</td><td><code><pre>                                        &#34;m1&#34;:    ms.Rate1(),</pre></code></td></tr><tr><td>156</td><td><code><pre>                                        &#34;m5&#34;:    ms.Rate5(),</pre></code></td></tr><tr><td>157</td><td><code><pre>                                        &#34;m15&#34;:   ms.Rate15(),</pre></code></td></tr><tr><td>158</td><td><code><pre>                                        &#34;mean&#34;:  ms.RateMean(),</pre></code></td></tr><tr><td>159</td><td><code><pre>                                },</pre></code></td></tr><tr><td>160</td><td><code><pre>                                Time: now,</pre></code></td></tr><tr><td>161</td><td><code><pre>                        })</pre></code></td></tr><tr><td>162</td><td><code><pre>                case metrics.Timer:</pre></code></td></tr><tr class="miss"><td>163</td><td><code><pre>                        ms := metric.Snapshot()</pre></code></td></tr><tr class="miss"><td>164</td><td><code><pre>                        ps := ms.Percentiles([]float64{0.5, 0.75, 0.95, 0.99, 0.999, 0.9999})</pre></code></td></tr><tr class="miss"><td>165</td><td><code><pre>                        pts = append(pts, client.Point{</pre></code></td></tr><tr><td>166</td><td><code><pre>                                Measurement: fmt.Sprintf(&#34;%s.timer&#34;, name),</pre></code></td></tr><tr><td>167</td><td><code><pre>                                Tags:        r.tags,</pre></code></td></tr><tr><td>168</td><td><code><pre>                                Fields: map[string]interface{}{</pre></code></td></tr><tr><td>169</td><td><code><pre>                                        &#34;count&#34;:    ms.Count(),</pre></code></td></tr><tr><td>170</td><td><code><pre>                                        &#34;max&#34;:      ms.Max(),</pre></code></td></tr><tr><td>171</td><td><code><pre>                                        &#34;mean&#34;:     ms.Mean(),</pre></code></td></tr><tr><td>172</td><td><code><pre>                                        &#34;min&#34;:      ms.Min(),</pre></code></td></tr><tr><td>173</td><td><code><pre>                                        &#34;stddev&#34;:   ms.StdDev(),</pre></code></td></tr><tr><td>174</td><td><code><pre>                                        &#34;variance&#34;: ms.Variance(),</pre></code></td></tr><tr><td>175</td><td><code><pre>                                        &#34;p50&#34;:      ps[0],</pre></code></td></tr><tr><td>176</td><td><code><pre>                                        &#34;p75&#34;:      ps[1],</pre></code></td></tr><tr><td>177</td><td><code><pre>                                        &#34;p95&#34;:      ps[2],</pre></code></td></tr><tr><td>178</td><td><code><pre>                                        &#34;p99&#34;:      ps[3],</pre></code></td></tr><tr><td>179</td><td><code><pre>                                        &#34;p999&#34;:     ps[4],</pre></code></td></tr><tr><td>180</td><td><code><pre>                                        &#34;p9999&#34;:    ps[5],</pre></code></td></tr><tr><td>181</td><td><code><pre>                                        &#34;m1&#34;:       ms.Rate1(),</pre></code></td></tr><tr><td>182</td><td><code><pre>                                        &#34;m5&#34;:       ms.Rate5(),</pre></code></td></tr><tr><td>183</td><td><code><pre>                                        &#34;m15&#34;:      ms.Rate15(),</pre></code></td></tr><tr><td>184</td><td><code><pre>                                        &#34;meanrate&#34;: ms.RateMean(),</pre></code></td></tr><tr><td>185</td><td><code><pre>                                },</pre></code></td></tr><tr><td>186</td><td><code><pre>                                Time: now,</pre></code></td></tr><tr><td>187</td><td><code><pre>                        })</pre></code></td></tr><tr><td>188</td><td><code><pre>                }</pre></code></td></tr><tr><td>189</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_AliasPlugin.PreWriteResponse">func AliasPlugin.PreWriteResponse</div><div class="info"><a href="#s_fn_AliasPlugin.PreWriteResponse">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/alias.go</code>:</p></div><table class="listing">
<tr><td>62</td><td><code><pre>func (p *AliasPlugin) PreWriteResponse(ctx context.Context, r *protocol.Message, res *protocol.Message) error {</pre></code></td></tr><tr class="miss"><td>63</td><td><code><pre>        if r.Metadata[aliasAppliedKey] != &#34;true&#34; {</pre></code></td></tr><tr class="miss"><td>64</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>65</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>66</td><td><code><pre>        var sp = r.ServicePath</pre></code></td></tr><tr class="miss"><td>67</td><td><code><pre>        var sm = r.ServiceMethod</pre></code></td></tr><tr><td>68</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>69</td><td><code><pre>        k := sp + &#34;.&#34; + sm</pre></code></td></tr><tr class="miss"><td>70</td><td><code><pre>        if p.ReseverseAliases != nil {</pre></code></td></tr><tr class="miss"><td>71</td><td><code><pre>                if pm := p.ReseverseAliases[k]; pm != nil {</pre></code></td></tr><tr class="miss"><td>72</td><td><code><pre>                        r.ServicePath = pm.servicePath</pre></code></td></tr><tr class="miss"><td>73</td><td><code><pre>                        r.ServiceMethod = pm.serviceMethod</pre></code></td></tr><tr class="miss"><td>74</td><td><code><pre>                        delete(r.Metadata, aliasAppliedKey)</pre></code></td></tr><tr class="miss"><td>75</td><td><code><pre>                        if res != nil {</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>                                res.ServicePath = pm.servicePath</pre></code></td></tr><tr class="miss"><td>77</td><td><code><pre>                                res.ServiceMethod = pm.serviceMethod</pre></code></td></tr><tr><td>78</td><td><code><pre>                        }</pre></code></td></tr><tr><td>79</td><td><code><pre>                }</pre></code></td></tr><tr><td>80</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>81</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>82</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MetricsPlugin.PostWriteResponse">func MetricsPlugin.PostWriteResponse</div><div class="info"><a href="#s_fn_MetricsPlugin.PostWriteResponse">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/metrics.go</code>:</p></div><table class="listing">
<tr><td>66</td><td><code><pre>func (p *MetricsPlugin) PostWriteResponse(ctx context.Context, req *protocol.Message, res *protocol.Message, e error) error {</pre></code></td></tr><tr class="miss"><td>67</td><td><code><pre>        sp := res.ServicePath</pre></code></td></tr><tr class="miss"><td>68</td><td><code><pre>        sm := res.ServiceMethod</pre></code></td></tr><tr><td>69</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>70</td><td><code><pre>        if sp == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>71</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>72</td><td><code><pre>        }</pre></code></td></tr><tr><td>73</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>74</td><td><code><pre>        m := metrics.GetOrRegisterMeter(p.withPrefix(&#34;service.&#34;+sp+&#34;.&#34;+sm+&#34;.Write_Qps&#34;), p.Registry)</pre></code></td></tr><tr class="miss"><td>75</td><td><code><pre>        m.Mark(1)</pre></code></td></tr><tr><td>76</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>77</td><td><code><pre>        t := ctx.Value(server.StartRequestContextKey).(int64)</pre></code></td></tr><tr><td>78</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>79</td><td><code><pre>        if t &gt; 0 {</pre></code></td></tr><tr class="miss"><td>80</td><td><code><pre>                t = time.Now().UnixNano() - t</pre></code></td></tr><tr class="miss"><td>81</td><td><code><pre>                if t &lt; 30*time.Minute.Nanoseconds() { //it is impossible that calltime exceeds 30 minute</pre></code></td></tr><tr><td>82</td><td><code><pre>                        //Historgram</pre></code></td></tr><tr class="miss"><td>83</td><td><code><pre>                        h := metrics.GetOrRegisterHistogram(p.withPrefix(&#34;service.&#34;+sp+&#34;.&#34;+sm+&#34;.CallTime&#34;), p.Registry,</pre></code></td></tr><tr><td>84</td><td><code><pre>                                metrics.NewExpDecaySample(1028, 0.015))</pre></code></td></tr><tr class="miss"><td>85</td><td><code><pre>                        h.Update(t)</pre></code></td></tr><tr><td>86</td><td><code><pre>                }</pre></code></td></tr><tr><td>87</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>88</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>89</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MDNSRegisterPlugin.Register">func MDNSRegisterPlugin.Register</div><div class="info"><a href="#s_fn_MDNSRegisterPlugin.Register">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/mdns.go</code>:</p></div><table class="listing">
<tr><td>148</td><td><code><pre>func (p *MDNSRegisterPlugin) Register(name string, rcvr interface{}, metadata string) (err error) {</pre></code></td></tr><tr class="miss"><td>149</td><td><code><pre>        if &#34;&#34; == strings.TrimSpace(name) {</pre></code></td></tr><tr class="miss"><td>150</td><td><code><pre>                err = errors.New(&#34;Register service `name` can&#39;t be empty&#34;)</pre></code></td></tr><tr class="miss"><td>151</td><td><code><pre>                return</pre></code></td></tr><tr><td>152</td><td><code><pre>        }</pre></code></td></tr><tr><td>153</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>154</td><td><code><pre>        sm := &amp;serviceMeta{</pre></code></td></tr><tr><td>155</td><td><code><pre>                Service:        name,</pre></code></td></tr><tr><td>156</td><td><code><pre>                Meta:           metadata,</pre></code></td></tr><tr><td>157</td><td><code><pre>                ServiceAddress: p.ServiceAddress,</pre></code></td></tr><tr><td>158</td><td><code><pre>        }</pre></code></td></tr><tr><td>159</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>160</td><td><code><pre>        p.Services = append(p.Services, sm)</pre></code></td></tr><tr><td>161</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>162</td><td><code><pre>        if p.server == nil {</pre></code></td></tr><tr class="miss"><td>163</td><td><code><pre>                p.initMDNS()</pre></code></td></tr><tr class="miss"><td>164</td><td><code><pre>                return</pre></code></td></tr><tr><td>165</td><td><code><pre>        }</pre></code></td></tr><tr><td>166</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>167</td><td><code><pre>        ss, _ := json.Marshal(p.Services)</pre></code></td></tr><tr class="miss"><td>168</td><td><code><pre>        s := url.QueryEscape(string(ss))</pre></code></td></tr><tr class="miss"><td>169</td><td><code><pre>        p.server.SetText([]string{s})</pre></code></td></tr><tr class="miss"><td>170</td><td><code><pre>        return</pre></code></td></tr><tr><td>171</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MDNSRegisterPlugin.Unregister">func MDNSRegisterPlugin.Unregister</div><div class="info"><a href="#s_fn_MDNSRegisterPlugin.Unregister">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/mdns.go</code>:</p></div><table class="listing">
<tr><td>173</td><td><code><pre>func (p *MDNSRegisterPlugin) Unregister(name string) (err error) {</pre></code></td></tr><tr class="miss"><td>174</td><td><code><pre>        if &#34;&#34; == strings.TrimSpace(name) {</pre></code></td></tr><tr class="miss"><td>175</td><td><code><pre>                err = errors.New(&#34;Register service `name` can&#39;t be empty&#34;)</pre></code></td></tr><tr class="miss"><td>176</td><td><code><pre>                return</pre></code></td></tr><tr><td>177</td><td><code><pre>        }</pre></code></td></tr><tr><td>178</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>179</td><td><code><pre>        var services = make([]*serviceMeta, 0, len(p.Services)-1)</pre></code></td></tr><tr class="miss"><td>180</td><td><code><pre>        for _, meta := range p.Services {</pre></code></td></tr><tr class="miss"><td>181</td><td><code><pre>                if meta.Service != name {</pre></code></td></tr><tr class="miss"><td>182</td><td><code><pre>                        services = append(services, meta)</pre></code></td></tr><tr><td>183</td><td><code><pre>                }</pre></code></td></tr><tr><td>184</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>185</td><td><code><pre>        p.Services = services</pre></code></td></tr><tr><td>186</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>187</td><td><code><pre>        ss, _ := json.Marshal(p.Services)</pre></code></td></tr><tr class="miss"><td>188</td><td><code><pre>        s := url.QueryEscape(string(ss))</pre></code></td></tr><tr class="miss"><td>189</td><td><code><pre>        p.server.SetText([]string{s})</pre></code></td></tr><tr><td>190</td><td><code><pre></pre></code></td></tr><tr><td>191</td><td><code><pre>        // if p.server != nil {</pre></code></td></tr><tr><td>192</td><td><code><pre>        //         p.server.Shutdown()</pre></code></td></tr><tr><td>193</td><td><code><pre>        //         return</pre></code></td></tr><tr><td>194</td><td><code><pre>        // }</pre></code></td></tr><tr><td>195</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>196</td><td><code><pre>        return</pre></code></td></tr><tr><td>197</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_reporter.run">func reporter.run</div><div class="info"><a href="#s_fn_reporter.run">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/influxdb.go</code>:</p></div><table class="listing">
<tr><td>66</td><td><code><pre>func (r *reporter) run() {</pre></code></td></tr><tr class="miss"><td>67</td><td><code><pre>        intervalTicker := time.Tick(r.interval)</pre></code></td></tr><tr class="miss"><td>68</td><td><code><pre>        pingTicker := time.Tick(time.Second * 5)</pre></code></td></tr><tr><td>69</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>70</td><td><code><pre>        for {</pre></code></td></tr><tr class="miss"><td>71</td><td><code><pre>                select {</pre></code></td></tr><tr><td>72</td><td><code><pre>                case &lt;-intervalTicker:</pre></code></td></tr><tr class="miss"><td>73</td><td><code><pre>                        if err := r.send(); err != nil {</pre></code></td></tr><tr class="miss"><td>74</td><td><code><pre>                                log.Printf(&#34;unable to send metrics to InfluxDB. err=%v&#34;, err)</pre></code></td></tr><tr><td>75</td><td><code><pre>                        }</pre></code></td></tr><tr><td>76</td><td><code><pre>                case &lt;-pingTicker:</pre></code></td></tr><tr class="miss"><td>77</td><td><code><pre>                        _, _, err := r.client.Ping()</pre></code></td></tr><tr class="miss"><td>78</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>79</td><td><code><pre>                                log.Printf(&#34;got error while sending a ping to InfluxDB, trying to recreate client. err=%v&#34;, err)</pre></code></td></tr><tr><td>80</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>81</td><td><code><pre>                                if err = r.makeClient(); err != nil {</pre></code></td></tr><tr class="miss"><td>82</td><td><code><pre>                                        log.Printf(&#34;unable to make InfluxDB client. err=%v&#34;, err)</pre></code></td></tr><tr><td>83</td><td><code><pre>                                }</pre></code></td></tr><tr><td>84</td><td><code><pre>                        }</pre></code></td></tr><tr><td>85</td><td><code><pre>                }</pre></code></td></tr><tr><td>86</td><td><code><pre>        }</pre></code></td></tr><tr><td>87</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_AliasPlugin.PostReadRequest">func AliasPlugin.PostReadRequest</div><div class="info"><a href="#s_fn_AliasPlugin.PostReadRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/alias.go</code>:</p></div><table class="listing">
<tr><td>43</td><td><code><pre>func (p *AliasPlugin) PostReadRequest(ctx context.Context, r *protocol.Message, e error) error {</pre></code></td></tr><tr class="miss"><td>44</td><td><code><pre>        var sp = r.ServicePath</pre></code></td></tr><tr class="miss"><td>45</td><td><code><pre>        var sm = r.ServiceMethod</pre></code></td></tr><tr><td>46</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>47</td><td><code><pre>        k := sp + &#34;.&#34; + sm</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>        if p.Aliases != nil {</pre></code></td></tr><tr class="miss"><td>49</td><td><code><pre>                if pm := p.Aliases[k]; pm != nil {</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>                        r.ServicePath = pm.servicePath</pre></code></td></tr><tr class="miss"><td>51</td><td><code><pre>                        r.ServiceMethod = pm.serviceMethod</pre></code></td></tr><tr class="miss"><td>52</td><td><code><pre>                        if r.Metadata == nil {</pre></code></td></tr><tr class="miss"><td>53</td><td><code><pre>                                r.Metadata = make(map[string]string)</pre></code></td></tr><tr><td>54</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>55</td><td><code><pre>                        r.Metadata[aliasAppliedKey] = &#34;true&#34;</pre></code></td></tr><tr><td>56</td><td><code><pre>                }</pre></code></td></tr><tr><td>57</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>59</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_InfluxDBWithTags">func InfluxDBWithTags</div><div class="info"><a href="#s_fn_InfluxDBWithTags">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/influxdb.go</code>:</p></div><table class="listing">
<tr><td>32</td><td><code><pre>func InfluxDBWithTags(r metrics.Registry, d time.Duration, url, database, username, password string, tags map[string]string) {</pre></code></td></tr><tr class="miss"><td>33</td><td><code><pre>        u, err := uurl.Parse(url)</pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>35</td><td><code><pre>                log.Printf(&#34;unable to parse InfluxDB url %s. err=%v&#34;, url, err)</pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>                return</pre></code></td></tr><tr><td>37</td><td><code><pre>        }</pre></code></td></tr><tr><td>38</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>        rep := &amp;reporter{</pre></code></td></tr><tr><td>40</td><td><code><pre>                reg:      r,</pre></code></td></tr><tr><td>41</td><td><code><pre>                interval: d,</pre></code></td></tr><tr><td>42</td><td><code><pre>                url:      *u,</pre></code></td></tr><tr><td>43</td><td><code><pre>                database: database,</pre></code></td></tr><tr><td>44</td><td><code><pre>                username: username,</pre></code></td></tr><tr><td>45</td><td><code><pre>                password: password,</pre></code></td></tr><tr><td>46</td><td><code><pre>                tags:     tags,</pre></code></td></tr><tr><td>47</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>        if err := rep.makeClient(); err != nil {</pre></code></td></tr><tr class="miss"><td>49</td><td><code><pre>                log.Printf(&#34;unable to make InfluxDB client. err=%v&#34;, err)</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>                return</pre></code></td></tr><tr><td>51</td><td><code><pre>        }</pre></code></td></tr><tr><td>52</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>53</td><td><code><pre>        rep.run()</pre></code></td></tr><tr><td>54</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OpenTracingPlugin.PreHandleRequest">func OpenTracingPlugin.PreHandleRequest</div><div class="info"><a href="#s_fn_OpenTracingPlugin.PreHandleRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/opentracing.go</code>:</p></div><table class="listing">
<tr><td>45</td><td><code><pre>func (p OpenTracingPlugin) PreHandleRequest(ctx context.Context, r *protocol.Message) error {</pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>        wireContext, err := share.GetSpanContextFromContext(ctx)</pre></code></td></tr><tr class="miss"><td>47</td><td><code><pre>        if err != nil || wireContext == nil {</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>                return err</pre></code></td></tr><tr><td>49</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>        span1 := opentracing.StartSpan(</pre></code></td></tr><tr><td>51</td><td><code><pre>                &#34;rpcx.service.&#34;+r.ServicePath+&#34;.&#34;+r.ServiceMethod,</pre></code></td></tr><tr><td>52</td><td><code><pre>                ext.RPCServerOption(wireContext))</pre></code></td></tr><tr><td>53</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>54</td><td><code><pre>        clientConn := ctx.Value(server.RemoteConnContextKey).(net.Conn)</pre></code></td></tr><tr class="miss"><td>55</td><td><code><pre>        span1.LogFields(log.String(&#34;remote_addr&#34;, clientConn.RemoteAddr().Network()))</pre></code></td></tr><tr><td>56</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>57</td><td><code><pre>        if rpcxContext, ok := ctx.(*share.Context); ok {</pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>                rpcxContext.SetValue(share.OpentracingSpanServerKey, span1)</pre></code></td></tr><tr><td>59</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>60</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>61</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OpenCensusPlugin.PreHandleRequest">func OpenCensusPlugin.PreHandleRequest</div><div class="info"><a href="#s_fn_OpenCensusPlugin.PreHandleRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/opencensus.go</code>:</p></div><table class="listing">
<tr><td>40</td><td><code><pre>func (p OpenCensusPlugin) PreHandleRequest(ctx context.Context, r *protocol.Message) error {</pre></code></td></tr><tr class="miss"><td>41</td><td><code><pre>        parentContext, err := share.GetOpencensusSpanContextFromContext(ctx)</pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>        if err != nil || parentContext == nil {</pre></code></td></tr><tr class="miss"><td>43</td><td><code><pre>                return err</pre></code></td></tr><tr><td>44</td><td><code><pre>        }</pre></code></td></tr><tr><td>45</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>        _, span1 := trace.StartSpanWithRemoteParent(ctx, &#34;rpcx.service.&#34;+r.ServicePath+&#34;.&#34;+r.ServiceMethod, *parentContext)</pre></code></td></tr><tr class="miss"><td>47</td><td><code><pre>        clientConn := ctx.Value(server.RemoteConnContextKey).(net.Conn)</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>        span1.AddAttributes(trace.StringAttribute(&#34;remote_addr&#34;, clientConn.RemoteAddr().String()))</pre></code></td></tr><tr><td>49</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>        if rpcxContext, ok := ctx.(*share.Context); ok {</pre></code></td></tr><tr class="miss"><td>51</td><td><code><pre>                rpcxContext.SetValue(share.OpencensusSpanServerKey, span1)</pre></code></td></tr><tr><td>52</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>53</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>54</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_TracePlugin.PostWriteResponse">func TracePlugin.PostWriteResponse</div><div class="info"><a href="#s_fn_TracePlugin.PostWriteResponse">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/trace.go</code>:</p></div><table class="listing">
<tr><td>48</td><td><code><pre>func (p *TracePlugin) PostWriteResponse(ctx context.Context, req *protocol.Message, res *protocol.Message, err error) error {</pre></code></td></tr><tr class="miss"><td>49</td><td><code><pre>        tr := trace.New(&#34;rpcx.Server&#34;, &#34;WriteResponse&#34;)</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>        defer tr.Finish()</pre></code></td></tr><tr class="miss"><td>51</td><td><code><pre>        if err == nil {</pre></code></td></tr><tr class="miss"><td>52</td><td><code><pre>                tr.LazyPrintf(&#34;succeed to call %s.%s, seq: %d&#34;, req.ServicePath, req.ServiceMethod, req.Seq())</pre></code></td></tr><tr><td>53</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>54</td><td><code><pre>                tr.LazyPrintf(&#34;failed to call %s.%s, seq: %d : %v&#34;, req.Seq, req.ServicePath, req.ServiceMethod, req.Seq(), err)</pre></code></td></tr><tr class="miss"><td>55</td><td><code><pre>                tr.SetError()</pre></code></td></tr><tr><td>56</td><td><code><pre>        }</pre></code></td></tr><tr><td>57</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>59</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MetricsPlugin.PostReadRequest">func MetricsPlugin.PostReadRequest</div><div class="info"><a href="#s_fn_MetricsPlugin.PostReadRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/metrics.go</code>:</p></div><table class="listing">
<tr><td>53</td><td><code><pre>func (p *MetricsPlugin) PostReadRequest(ctx context.Context, r *protocol.Message, e error) error {</pre></code></td></tr><tr class="miss"><td>54</td><td><code><pre>        sp := r.ServicePath</pre></code></td></tr><tr class="miss"><td>55</td><td><code><pre>        sm := r.ServiceMethod</pre></code></td></tr><tr><td>56</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>57</td><td><code><pre>        if sp == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>                return nil</pre></code></td></tr><tr><td>59</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>60</td><td><code><pre>        m := metrics.GetOrRegisterMeter(p.withPrefix(&#34;service.&#34;+sp+&#34;.&#34;+sm+&#34;.Read_Qps&#34;), p.Registry)</pre></code></td></tr><tr class="miss"><td>61</td><td><code><pre>        m.Mark(1)</pre></code></td></tr><tr class="miss"><td>62</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>63</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_FileTransferService.DownloadFile">func FileTransferService.DownloadFile</div><div class="info"><a href="#s_fn_FileTransferService.DownloadFile">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/file_transfer.go</code>:</p></div><table class="listing">
<tr><td>114</td><td><code><pre>func (s *FileTransferService) DownloadFile(ctx context.Context, args *DownloadFileArgs, reply *FileTransferReply) error {</pre></code></td></tr><tr class="miss"><td>115</td><td><code><pre>        token := make([]byte, 32)</pre></code></td></tr><tr class="miss"><td>116</td><td><code><pre>        _, err := rand.Read(token)</pre></code></td></tr><tr class="miss"><td>117</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>118</td><td><code><pre>                return err</pre></code></td></tr><tr><td>119</td><td><code><pre>        }</pre></code></td></tr><tr><td>120</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>121</td><td><code><pre>        *reply = FileTransferReply{</pre></code></td></tr><tr><td>122</td><td><code><pre>                Token: token,</pre></code></td></tr><tr><td>123</td><td><code><pre>                Addr:  s.FileTransfer.Addr,</pre></code></td></tr><tr><td>124</td><td><code><pre>        }</pre></code></td></tr><tr><td>125</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>126</td><td><code><pre>        s.FileTransfer.cachedTokens.Add(string(token), &amp;downloadTokenInfo{token, args})</pre></code></td></tr><tr class="miss"><td>127</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>128</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_FileTransferService.TransferFile">func FileTransferService.TransferFile</div><div class="info"><a href="#s_fn_FileTransferService.TransferFile">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/file_transfer.go</code>:</p></div><table class="listing">
<tr><td>98</td><td><code><pre>func (s *FileTransferService) TransferFile(ctx context.Context, args *FileTransferArgs, reply *FileTransferReply) error {</pre></code></td></tr><tr class="miss"><td>99</td><td><code><pre>        token := make([]byte, 32)</pre></code></td></tr><tr class="miss"><td>100</td><td><code><pre>        _, err := rand.Read(token)</pre></code></td></tr><tr class="miss"><td>101</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>102</td><td><code><pre>                return err</pre></code></td></tr><tr><td>103</td><td><code><pre>        }</pre></code></td></tr><tr><td>104</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>105</td><td><code><pre>        *reply = FileTransferReply{</pre></code></td></tr><tr><td>106</td><td><code><pre>                Token: token,</pre></code></td></tr><tr><td>107</td><td><code><pre>                Addr:  s.FileTransfer.Addr,</pre></code></td></tr><tr><td>108</td><td><code><pre>        }</pre></code></td></tr><tr><td>109</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>110</td><td><code><pre>        s.FileTransfer.cachedTokens.Add(string(token), &amp;tokenInfo{token, args})</pre></code></td></tr><tr class="miss"><td>111</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>112</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MDNSRegisterPlugin.Start">func MDNSRegisterPlugin.Start</div><div class="info"><a href="#s_fn_MDNSRegisterPlugin.Start">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/mdns.go</code>:</p></div><table class="listing">
<tr><td>58</td><td><code><pre>func (p *MDNSRegisterPlugin) Start() error {</pre></code></td></tr><tr><td>59</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>60</td><td><code><pre>        if p.server == nil &amp;&amp; len(p.Services) != 0 {</pre></code></td></tr><tr class="miss"><td>61</td><td><code><pre>                p.initMDNS()</pre></code></td></tr><tr><td>62</td><td><code><pre>        }</pre></code></td></tr><tr><td>63</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>64</td><td><code><pre>        if p.UpdateInterval &gt; 0 {</pre></code></td></tr><tr class="miss"><td>65</td><td><code><pre>                ticker := time.NewTicker(p.UpdateInterval)</pre></code></td></tr><tr class="miss"><td>66</td><td><code><pre>                go func() {</pre></code></td></tr><tr><td>67</td><td><code><pre>                        defer p.server.Shutdown()</pre></code></td></tr><tr><td>68</td><td><code><pre></pre></code></td></tr><tr><td>69</td><td><code><pre>                        for {</pre></code></td></tr><tr><td>70</td><td><code><pre>                                // refresh service TTL</pre></code></td></tr><tr><td>71</td><td><code><pre>                                select {</pre></code></td></tr><tr><td>72</td><td><code><pre>                                case &lt;-p.dying:</pre></code></td></tr><tr><td>73</td><td><code><pre>                                        close(p.done)</pre></code></td></tr><tr><td>74</td><td><code><pre>                                        return</pre></code></td></tr><tr><td>75</td><td><code><pre>                                case &lt;-ticker.C:</pre></code></td></tr><tr><td>76</td><td><code><pre>                                        if p.server == nil &amp;&amp; len(p.Services) == 0 {</pre></code></td></tr><tr><td>77</td><td><code><pre>                                                break</pre></code></td></tr><tr><td>78</td><td><code><pre>                                        }</pre></code></td></tr><tr><td>79</td><td><code><pre></pre></code></td></tr><tr><td>80</td><td><code><pre>                                        var data []byte</pre></code></td></tr><tr><td>81</td><td><code><pre>                                        if p.Metrics != nil {</pre></code></td></tr><tr><td>82</td><td><code><pre>                                                clientMeter := metrics.GetOrRegisterMeter(&#34;clientMeter&#34;, p.Metrics)</pre></code></td></tr><tr><td>83</td><td><code><pre>                                                data = []byte(strconv.FormatInt(clientMeter.Count()/60, 10))</pre></code></td></tr><tr><td>84</td><td><code><pre>                                        }</pre></code></td></tr><tr><td>85</td><td><code><pre></pre></code></td></tr><tr><td>86</td><td><code><pre>                                        //set this same metrics for all services at this server</pre></code></td></tr><tr><td>87</td><td><code><pre>                                        for _, sm := range p.Services {</pre></code></td></tr><tr><td>88</td><td><code><pre>                                                v, _ := url.ParseQuery(string(sm.Meta))</pre></code></td></tr><tr><td>89</td><td><code><pre>                                                v.Set(&#34;tps&#34;, string(data))</pre></code></td></tr><tr><td>90</td><td><code><pre>                                                sm.Meta = v.Encode()</pre></code></td></tr><tr><td>91</td><td><code><pre>                                        }</pre></code></td></tr><tr><td>92</td><td><code><pre>                                        ss, _ := json.Marshal(p.Services)</pre></code></td></tr><tr><td>93</td><td><code><pre>                                        s := url.QueryEscape(string(ss))</pre></code></td></tr><tr><td>94</td><td><code><pre>                                        p.server.SetText([]string{s})</pre></code></td></tr><tr><td>95</td><td><code><pre>                                }</pre></code></td></tr><tr><td>96</td><td><code><pre>                        }</pre></code></td></tr><tr><td>97</td><td><code><pre>                }()</pre></code></td></tr><tr><td>98</td><td><code><pre>        }</pre></code></td></tr><tr><td>99</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>100</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>101</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OpenCensusPlugin.PostWriteResponse">func OpenCensusPlugin.PostWriteResponse</div><div class="info"><a href="#s_fn_OpenCensusPlugin.PostWriteResponse">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/opencensus.go</code>:</p></div><table class="listing">
<tr><td>56</td><td><code><pre>func (p OpenCensusPlugin) PostWriteResponse(ctx context.Context, req *protocol.Message, res *protocol.Message, err error) error {</pre></code></td></tr><tr class="miss"><td>57</td><td><code><pre>        if rpcxContext, ok := ctx.(*share.Context); ok {</pre></code></td></tr><tr class="miss"><td>58</td><td><code><pre>                span1 := rpcxContext.Value(share.OpencensusSpanServerKey)</pre></code></td></tr><tr class="miss"><td>59</td><td><code><pre>                if span1 != nil {</pre></code></td></tr><tr class="miss"><td>60</td><td><code><pre>                        span1.(*trace.Span).End()</pre></code></td></tr><tr><td>61</td><td><code><pre>                }</pre></code></td></tr><tr><td>62</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>63</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>64</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_reporter.send">func reporter.send</div><div class="info"><a href="#s_fn_reporter.send">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/influxdb.go</code>:</p></div><table class="listing">
<tr><td>89</td><td><code><pre>func (r *reporter) send() error {</pre></code></td></tr><tr class="miss"><td>90</td><td><code><pre>        var pts []client.Point</pre></code></td></tr><tr><td>91</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>92</td><td><code><pre>        r.reg.Each(func(name string, i interface{}) {</pre></code></td></tr><tr><td>93</td><td><code><pre>                now := time.Now()</pre></code></td></tr><tr><td>94</td><td><code><pre></pre></code></td></tr><tr><td>95</td><td><code><pre>                switch metric := i.(type) {</pre></code></td></tr><tr><td>96</td><td><code><pre>                case metrics.Counter:</pre></code></td></tr><tr><td>97</td><td><code><pre>                        ms := metric.Snapshot()</pre></code></td></tr><tr><td>98</td><td><code><pre>                        pts = append(pts, client.Point{</pre></code></td></tr><tr><td>99</td><td><code><pre>                                Measurement: fmt.Sprintf(&#34;%s.count&#34;, name),</pre></code></td></tr><tr><td>100</td><td><code><pre>                                Tags:        r.tags,</pre></code></td></tr><tr><td>101</td><td><code><pre>                                Fields: map[string]interface{}{</pre></code></td></tr><tr><td>102</td><td><code><pre>                                        &#34;value&#34;: ms.Count(),</pre></code></td></tr><tr><td>103</td><td><code><pre>                                },</pre></code></td></tr><tr><td>104</td><td><code><pre>                                Time: now,</pre></code></td></tr><tr><td>105</td><td><code><pre>                        })</pre></code></td></tr><tr><td>106</td><td><code><pre>                case metrics.Gauge:</pre></code></td></tr><tr><td>107</td><td><code><pre>                        ms := metric.Snapshot()</pre></code></td></tr><tr><td>108</td><td><code><pre>                        pts = append(pts, client.Point{</pre></code></td></tr><tr><td>109</td><td><code><pre>                                Measurement: fmt.Sprintf(&#34;%s.gauge&#34;, name),</pre></code></td></tr><tr><td>110</td><td><code><pre>                                Tags:        r.tags,</pre></code></td></tr><tr><td>111</td><td><code><pre>                                Fields: map[string]interface{}{</pre></code></td></tr><tr><td>112</td><td><code><pre>                                        &#34;value&#34;: ms.Value(),</pre></code></td></tr><tr><td>113</td><td><code><pre>                                },</pre></code></td></tr><tr><td>114</td><td><code><pre>                                Time: now,</pre></code></td></tr><tr><td>115</td><td><code><pre>                        })</pre></code></td></tr><tr><td>116</td><td><code><pre>                case metrics.GaugeFloat64:</pre></code></td></tr><tr><td>117</td><td><code><pre>                        ms := metric.Snapshot()</pre></code></td></tr><tr><td>118</td><td><code><pre>                        pts = append(pts, client.Point{</pre></code></td></tr><tr><td>119</td><td><code><pre>                                Measurement: fmt.Sprintf(&#34;%s.gauge&#34;, name),</pre></code></td></tr><tr><td>120</td><td><code><pre>                                Tags:        r.tags,</pre></code></td></tr><tr><td>121</td><td><code><pre>                                Fields: map[string]interface{}{</pre></code></td></tr><tr><td>122</td><td><code><pre>                                        &#34;value&#34;: ms.Value(),</pre></code></td></tr><tr><td>123</td><td><code><pre>                                },</pre></code></td></tr><tr><td>124</td><td><code><pre>                                Time: now,</pre></code></td></tr><tr><td>125</td><td><code><pre>                        })</pre></code></td></tr><tr><td>126</td><td><code><pre>                case metrics.Histogram:</pre></code></td></tr><tr><td>127</td><td><code><pre>                        ms := metric.Snapshot()</pre></code></td></tr><tr><td>128</td><td><code><pre>                        ps := ms.Percentiles([]float64{0.5, 0.75, 0.95, 0.99, 0.999, 0.9999})</pre></code></td></tr><tr><td>129</td><td><code><pre>                        pts = append(pts, client.Point{</pre></code></td></tr><tr><td>130</td><td><code><pre>                                Measurement: fmt.Sprintf(&#34;%s.histogram&#34;, name),</pre></code></td></tr><tr><td>131</td><td><code><pre>                                Tags:        r.tags,</pre></code></td></tr><tr><td>132</td><td><code><pre>                                Fields: map[string]interface{}{</pre></code></td></tr><tr><td>133</td><td><code><pre>                                        &#34;count&#34;:    ms.Count(),</pre></code></td></tr><tr><td>134</td><td><code><pre>                                        &#34;max&#34;:      ms.Max(),</pre></code></td></tr><tr><td>135</td><td><code><pre>                                        &#34;mean&#34;:     ms.Mean(),</pre></code></td></tr><tr><td>136</td><td><code><pre>                                        &#34;min&#34;:      ms.Min(),</pre></code></td></tr><tr><td>137</td><td><code><pre>                                        &#34;stddev&#34;:   ms.StdDev(),</pre></code></td></tr><tr><td>138</td><td><code><pre>                                        &#34;variance&#34;: ms.Variance(),</pre></code></td></tr><tr><td>139</td><td><code><pre>                                        &#34;p50&#34;:      ps[0],</pre></code></td></tr><tr><td>140</td><td><code><pre>                                        &#34;p75&#34;:      ps[1],</pre></code></td></tr><tr><td>141</td><td><code><pre>                                        &#34;p95&#34;:      ps[2],</pre></code></td></tr><tr><td>142</td><td><code><pre>                                        &#34;p99&#34;:      ps[3],</pre></code></td></tr><tr><td>143</td><td><code><pre>                                        &#34;p999&#34;:     ps[4],</pre></code></td></tr><tr><td>144</td><td><code><pre>                                        &#34;p9999&#34;:    ps[5],</pre></code></td></tr><tr><td>145</td><td><code><pre>                                },</pre></code></td></tr><tr><td>146</td><td><code><pre>                                Time: now,</pre></code></td></tr><tr><td>147</td><td><code><pre>                        })</pre></code></td></tr><tr><td>148</td><td><code><pre>                case metrics.Meter:</pre></code></td></tr><tr><td>149</td><td><code><pre>                        ms := metric.Snapshot()</pre></code></td></tr><tr><td>150</td><td><code><pre>                        pts = append(pts, client.Point{</pre></code></td></tr><tr><td>151</td><td><code><pre>                                Measurement: fmt.Sprintf(&#34;%s.meter&#34;, name),</pre></code></td></tr><tr><td>152</td><td><code><pre>                                Tags:        r.tags,</pre></code></td></tr><tr><td>153</td><td><code><pre>                                Fields: map[string]interface{}{</pre></code></td></tr><tr><td>154</td><td><code><pre>                                        &#34;count&#34;: ms.Count(),</pre></code></td></tr><tr><td>155</td><td><code><pre>                                        &#34;m1&#34;:    ms.Rate1(),</pre></code></td></tr><tr><td>156</td><td><code><pre>                                        &#34;m5&#34;:    ms.Rate5(),</pre></code></td></tr><tr><td>157</td><td><code><pre>                                        &#34;m15&#34;:   ms.Rate15(),</pre></code></td></tr><tr><td>158</td><td><code><pre>                                        &#34;mean&#34;:  ms.RateMean(),</pre></code></td></tr><tr><td>159</td><td><code><pre>                                },</pre></code></td></tr><tr><td>160</td><td><code><pre>                                Time: now,</pre></code></td></tr><tr><td>161</td><td><code><pre>                        })</pre></code></td></tr><tr><td>162</td><td><code><pre>                case metrics.Timer:</pre></code></td></tr><tr><td>163</td><td><code><pre>                        ms := metric.Snapshot()</pre></code></td></tr><tr><td>164</td><td><code><pre>                        ps := ms.Percentiles([]float64{0.5, 0.75, 0.95, 0.99, 0.999, 0.9999})</pre></code></td></tr><tr><td>165</td><td><code><pre>                        pts = append(pts, client.Point{</pre></code></td></tr><tr><td>166</td><td><code><pre>                                Measurement: fmt.Sprintf(&#34;%s.timer&#34;, name),</pre></code></td></tr><tr><td>167</td><td><code><pre>                                Tags:        r.tags,</pre></code></td></tr><tr><td>168</td><td><code><pre>                                Fields: map[string]interface{}{</pre></code></td></tr><tr><td>169</td><td><code><pre>                                        &#34;count&#34;:    ms.Count(),</pre></code></td></tr><tr><td>170</td><td><code><pre>                                        &#34;max&#34;:      ms.Max(),</pre></code></td></tr><tr><td>171</td><td><code><pre>                                        &#34;mean&#34;:     ms.Mean(),</pre></code></td></tr><tr><td>172</td><td><code><pre>                                        &#34;min&#34;:      ms.Min(),</pre></code></td></tr><tr><td>173</td><td><code><pre>                                        &#34;stddev&#34;:   ms.StdDev(),</pre></code></td></tr><tr><td>174</td><td><code><pre>                                        &#34;variance&#34;: ms.Variance(),</pre></code></td></tr><tr><td>175</td><td><code><pre>                                        &#34;p50&#34;:      ps[0],</pre></code></td></tr><tr><td>176</td><td><code><pre>                                        &#34;p75&#34;:      ps[1],</pre></code></td></tr><tr><td>177</td><td><code><pre>                                        &#34;p95&#34;:      ps[2],</pre></code></td></tr><tr><td>178</td><td><code><pre>                                        &#34;p99&#34;:      ps[3],</pre></code></td></tr><tr><td>179</td><td><code><pre>                                        &#34;p999&#34;:     ps[4],</pre></code></td></tr><tr><td>180</td><td><code><pre>                                        &#34;p9999&#34;:    ps[5],</pre></code></td></tr><tr><td>181</td><td><code><pre>                                        &#34;m1&#34;:       ms.Rate1(),</pre></code></td></tr><tr><td>182</td><td><code><pre>                                        &#34;m5&#34;:       ms.Rate5(),</pre></code></td></tr><tr><td>183</td><td><code><pre>                                        &#34;m15&#34;:      ms.Rate15(),</pre></code></td></tr><tr><td>184</td><td><code><pre>                                        &#34;meanrate&#34;: ms.RateMean(),</pre></code></td></tr><tr><td>185</td><td><code><pre>                                },</pre></code></td></tr><tr><td>186</td><td><code><pre>                                Time: now,</pre></code></td></tr><tr><td>187</td><td><code><pre>                        })</pre></code></td></tr><tr><td>188</td><td><code><pre>                }</pre></code></td></tr><tr><td>189</td><td><code><pre>        })</pre></code></td></tr><tr><td>190</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>191</td><td><code><pre>        bps := client.BatchPoints{</pre></code></td></tr><tr><td>192</td><td><code><pre>                Points:   pts,</pre></code></td></tr><tr><td>193</td><td><code><pre>                Database: r.database,</pre></code></td></tr><tr><td>194</td><td><code><pre>        }</pre></code></td></tr><tr><td>195</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>196</td><td><code><pre>        _, err := r.client.Write(bps)</pre></code></td></tr><tr class="miss"><td>197</td><td><code><pre>        return err</pre></code></td></tr><tr><td>198</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OpenTracingPlugin.PostWriteResponse">func OpenTracingPlugin.PostWriteResponse</div><div class="info"><a href="#s_fn_OpenTracingPlugin.PostWriteResponse">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/opentracing.go</code>:</p></div><table class="listing">
<tr><td>63</td><td><code><pre>func (p OpenTracingPlugin) PostWriteResponse(ctx context.Context, req *protocol.Message, res *protocol.Message, err error) error {</pre></code></td></tr><tr class="miss"><td>64</td><td><code><pre>        if rpcxContext, ok := ctx.(*share.Context); ok {</pre></code></td></tr><tr class="miss"><td>65</td><td><code><pre>                span1 := rpcxContext.Value(share.OpentracingSpanServerKey)</pre></code></td></tr><tr class="miss"><td>66</td><td><code><pre>                if span1 != nil {</pre></code></td></tr><tr class="miss"><td>67</td><td><code><pre>                        span1.(opentracing.Span).Finish()</pre></code></td></tr><tr><td>68</td><td><code><pre>                }</pre></code></td></tr><tr><td>69</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>70</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>71</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OpenCensusPlugin.RegisterFunction">func OpenCensusPlugin.RegisterFunction</div><div class="info"><a href="#s_fn_OpenCensusPlugin.RegisterFunction">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/opencensus.go</code>:</p></div><table class="listing">
<tr><td>24</td><td><code><pre>func (p OpenCensusPlugin) RegisterFunction(name string, fn interface{}, metadata string) error {</pre></code></td></tr><tr class="miss"><td>25</td><td><code><pre>        _, span := trace.StartSpan(context.Background(), &#34;rpcx.RegisterFunction&#34;)</pre></code></td></tr><tr class="miss"><td>26</td><td><code><pre>        defer span.End()</pre></code></td></tr><tr><td>27</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>28</td><td><code><pre>        span.AddAttributes(trace.StringAttribute(&#34;register_function&#34;, name))</pre></code></td></tr><tr class="miss"><td>29</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>30</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MDNSRegisterPlugin.Stop">func MDNSRegisterPlugin.Stop</div><div class="info"><a href="#s_fn_MDNSRegisterPlugin.Stop">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/mdns.go</code>:</p></div><table class="listing">
<tr><td>104</td><td><code><pre>func (p *MDNSRegisterPlugin) Stop() error {</pre></code></td></tr><tr class="miss"><td>105</td><td><code><pre>        close(p.dying)</pre></code></td></tr><tr class="miss"><td>106</td><td><code><pre>        &lt;-p.done</pre></code></td></tr><tr><td>107</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>108</td><td><code><pre>        p.server.Shutdown()</pre></code></td></tr><tr class="miss"><td>109</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>110</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MDNSRegisterPlugin.HandleConnAccept">func MDNSRegisterPlugin.HandleConnAccept</div><div class="info"><a href="#s_fn_MDNSRegisterPlugin.HandleConnAccept">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/mdns.go</code>:</p></div><table class="listing">
<tr><td>138</td><td><code><pre>func (p *MDNSRegisterPlugin) HandleConnAccept(conn net.Conn) (net.Conn, bool) {</pre></code></td></tr><tr class="miss"><td>139</td><td><code><pre>        if p.Metrics != nil {</pre></code></td></tr><tr class="miss"><td>140</td><td><code><pre>                clientMeter := metrics.GetOrRegisterMeter(&#34;clientMeter&#34;, p.Metrics)</pre></code></td></tr><tr class="miss"><td>141</td><td><code><pre>                clientMeter.Mark(1)</pre></code></td></tr><tr><td>142</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>143</td><td><code><pre>        return conn, true</pre></code></td></tr><tr><td>144</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OpenCensusPlugin.Register">func OpenCensusPlugin.Register</div><div class="info"><a href="#s_fn_OpenCensusPlugin.Register">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/opencensus.go</code>:</p></div><table class="listing">
<tr><td>15</td><td><code><pre>func (p OpenCensusPlugin) Register(name string, rcvr interface{}, metadata string) error {</pre></code></td></tr><tr class="miss"><td>16</td><td><code><pre>        _, span := trace.StartSpan(context.Background(), &#34;rpcx.Register&#34;)</pre></code></td></tr><tr class="miss"><td>17</td><td><code><pre>        defer span.End()</pre></code></td></tr><tr><td>18</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>19</td><td><code><pre>        span.AddAttributes(trace.StringAttribute(&#34;register_service&#34;, name))</pre></code></td></tr><tr><td>20</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>21</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>22</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_TracePlugin.Register">func TracePlugin.Register</div><div class="info"><a href="#s_fn_TracePlugin.Register">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/trace.go</code>:</p></div><table class="listing">
<tr><td>16</td><td><code><pre>func (p *TracePlugin) Register(name string, rcvr interface{}, metadata string) error {</pre></code></td></tr><tr class="miss"><td>17</td><td><code><pre>        tr := trace.New(&#34;rpcx.Server&#34;, &#34;Register&#34;)</pre></code></td></tr><tr class="miss"><td>18</td><td><code><pre>        defer tr.Finish()</pre></code></td></tr><tr class="miss"><td>19</td><td><code><pre>        tr.LazyPrintf(&#34;register %s: %T&#34;, name, rcvr)</pre></code></td></tr><tr class="miss"><td>20</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>21</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OpenTracingPlugin.PostConnAccept">func OpenTracingPlugin.PostConnAccept</div><div class="info"><a href="#s_fn_OpenTracingPlugin.PostConnAccept">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/opentracing.go</code>:</p></div><table class="listing">
<tr><td>36</td><td><code><pre>func (p OpenTracingPlugin) PostConnAccept(conn net.Conn) (net.Conn, bool) {</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>        span1 := opentracing.StartSpan(</pre></code></td></tr><tr><td>38</td><td><code><pre>                &#34;rpcx.AcceptConn&#34;)</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>        defer span1.Finish()</pre></code></td></tr><tr><td>40</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>41</td><td><code><pre>        span1.LogFields(log.String(&#34;remote_addr&#34;, conn.RemoteAddr().String()))</pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>        return conn, true</pre></code></td></tr><tr><td>43</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OpenTracingPlugin.RegisterFunction">func OpenTracingPlugin.RegisterFunction</div><div class="info"><a href="#s_fn_OpenTracingPlugin.RegisterFunction">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/opentracing.go</code>:</p></div><table class="listing">
<tr><td>27</td><td><code><pre>func (p OpenTracingPlugin) RegisterFunction(name string, fn interface{}, metadata string) error {</pre></code></td></tr><tr class="miss"><td>28</td><td><code><pre>        span1 := opentracing.StartSpan(</pre></code></td></tr><tr><td>29</td><td><code><pre>                &#34;rpcx.RegisterFunction&#34;)</pre></code></td></tr><tr class="miss"><td>30</td><td><code><pre>        defer span1.Finish()</pre></code></td></tr><tr><td>31</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>32</td><td><code><pre>        span1.LogFields(log.String(&#34;register_function&#34;, name))</pre></code></td></tr><tr class="miss"><td>33</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>34</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_TracePlugin.RegisterFunction">func TracePlugin.RegisterFunction</div><div class="info"><a href="#s_fn_TracePlugin.RegisterFunction">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/trace.go</code>:</p></div><table class="listing">
<tr><td>23</td><td><code><pre>func (p *TracePlugin) RegisterFunction(name string, fn interface{}, metadata string) error {</pre></code></td></tr><tr class="miss"><td>24</td><td><code><pre>        tr := trace.New(&#34;rpcx.Server&#34;, &#34;RegisterFunction&#34;)</pre></code></td></tr><tr class="miss"><td>25</td><td><code><pre>        defer tr.Finish()</pre></code></td></tr><tr class="miss"><td>26</td><td><code><pre>        tr.LazyPrintf(&#34;register %s: %T&#34;, name, GetFunctionName(fn))</pre></code></td></tr><tr class="miss"><td>27</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>28</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OpenCensusPlugin.PostConnAccept">func OpenCensusPlugin.PostConnAccept</div><div class="info"><a href="#s_fn_OpenCensusPlugin.PostConnAccept">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/opencensus.go</code>:</p></div><table class="listing">
<tr><td>32</td><td><code><pre>func (p OpenCensusPlugin) PostConnAccept(conn net.Conn) (net.Conn, bool) {</pre></code></td></tr><tr class="miss"><td>33</td><td><code><pre>        _, span := trace.StartSpan(context.Background(), &#34;rpcx.AcceptConn&#34;)</pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>        defer span.End()</pre></code></td></tr><tr><td>35</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>        span.AddAttributes(trace.StringAttribute(&#34;remote_addr&#34;, conn.RemoteAddr().String()))</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>        return conn, true</pre></code></td></tr><tr><td>38</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_OpenTracingPlugin.Register">func OpenTracingPlugin.Register</div><div class="info"><a href="#s_fn_OpenTracingPlugin.Register">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/opentracing.go</code>:</p></div><table class="listing">
<tr><td>17</td><td><code><pre>func (p OpenTracingPlugin) Register(name string, rcvr interface{}, metadata string) error {</pre></code></td></tr><tr class="miss"><td>18</td><td><code><pre>        span1 := opentracing.StartSpan(</pre></code></td></tr><tr><td>19</td><td><code><pre>                &#34;rpcx.Register&#34;)</pre></code></td></tr><tr class="miss"><td>20</td><td><code><pre>        defer span1.Finish()</pre></code></td></tr><tr><td>21</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>22</td><td><code><pre>        span1.LogFields(log.String(&#34;register_service&#34;, name))</pre></code></td></tr><tr><td>23</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>24</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>25</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_TracePlugin.PostConnAccept">func TracePlugin.PostConnAccept</div><div class="info"><a href="#s_fn_TracePlugin.PostConnAccept">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/trace.go</code>:</p></div><table class="listing">
<tr><td>34</td><td><code><pre>func (p *TracePlugin) PostConnAccept(conn net.Conn) (net.Conn, bool) {</pre></code></td></tr><tr class="miss"><td>35</td><td><code><pre>        tr := trace.New(&#34;rpcx.Server&#34;, &#34;Accept&#34;)</pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>        defer tr.Finish()</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>        tr.LazyPrintf(&#34;accept conn %s&#34;, conn.RemoteAddr().String())</pre></code></td></tr><tr class="miss"><td>38</td><td><code><pre>        return conn, true</pre></code></td></tr><tr><td>39</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewFileTransfer">func NewFileTransfer</div><div class="info"><a href="#s_fn_NewFileTransfer">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/file_transfer.go</code>:</p></div><table class="listing">
<tr><td>74</td><td><code><pre>func NewFileTransfer(addr string, handler FileTransferHandler, downloadFileHandler DownloadFileHandler, waitNum int) *FileTransfer {</pre></code></td></tr><tr><td>75</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>        cachedTokens, _ := lru.New(waitNum)</pre></code></td></tr><tr><td>77</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>78</td><td><code><pre>        fi := &amp;FileTransfer{</pre></code></td></tr><tr><td>79</td><td><code><pre>                Addr:                addr,</pre></code></td></tr><tr><td>80</td><td><code><pre>                handler:             handler,</pre></code></td></tr><tr><td>81</td><td><code><pre>                downloadFileHandler: downloadFileHandler,</pre></code></td></tr><tr><td>82</td><td><code><pre>                cachedTokens:        cachedTokens,</pre></code></td></tr><tr><td>83</td><td><code><pre>        }</pre></code></td></tr><tr><td>84</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>85</td><td><code><pre>        fi.service = &amp;FileTransferService{</pre></code></td></tr><tr><td>86</td><td><code><pre>                FileTransfer: fi,</pre></code></td></tr><tr><td>87</td><td><code><pre>        }</pre></code></td></tr><tr><td>88</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>89</td><td><code><pre>        return fi</pre></code></td></tr><tr><td>90</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_TracePlugin.PostReadRequest">func TracePlugin.PostReadRequest</div><div class="info"><a href="#s_fn_TracePlugin.PostReadRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/trace.go</code>:</p></div><table class="listing">
<tr><td>41</td><td><code><pre>func (p *TracePlugin) PostReadRequest(ctx context.Context, r *protocol.Message, e error) error {</pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>        tr := trace.New(&#34;rpcx.Server&#34;, &#34;ReadRequest&#34;)</pre></code></td></tr><tr class="miss"><td>43</td><td><code><pre>        defer tr.Finish()</pre></code></td></tr><tr class="miss"><td>44</td><td><code><pre>        tr.LazyPrintf(&#34;read request %s.%s, seq: %d&#34;, r.ServicePath, r.ServiceMethod, r.Seq())</pre></code></td></tr><tr class="miss"><td>45</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>46</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MetricsPlugin.HandleConnAccept">func MetricsPlugin.HandleConnAccept</div><div class="info"><a href="#s_fn_MetricsPlugin.HandleConnAccept">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/metrics.go</code>:</p></div><table class="listing">
<tr><td>41</td><td><code><pre>func (p *MetricsPlugin) HandleConnAccept(conn net.Conn) (net.Conn, bool) {</pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>        clientMeter := metrics.GetOrRegisterMeter(p.withPrefix(&#34;clientMeter&#34;), p.Registry)</pre></code></td></tr><tr class="miss"><td>43</td><td><code><pre>        clientMeter.Mark(1)</pre></code></td></tr><tr class="miss"><td>44</td><td><code><pre>        return conn, true</pre></code></td></tr><tr><td>45</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewMDNSRegisterPlugin">func NewMDNSRegisterPlugin</div><div class="info"><a href="#s_fn_NewMDNSRegisterPlugin">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/mdns.go</code>:</p></div><table class="listing">
<tr><td>42</td><td><code><pre>func NewMDNSRegisterPlugin(serviceAddress string, port int, m metrics.Registry, updateInterval time.Duration, domain string) *MDNSRegisterPlugin {</pre></code></td></tr><tr class="miss"><td>43</td><td><code><pre>        if domain == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>44</td><td><code><pre>                domain = &#34;local.&#34;</pre></code></td></tr><tr><td>45</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>        return &amp;MDNSRegisterPlugin{</pre></code></td></tr><tr><td>47</td><td><code><pre>                ServiceAddress: serviceAddress,</pre></code></td></tr><tr><td>48</td><td><code><pre>                port:           port,</pre></code></td></tr><tr><td>49</td><td><code><pre>                Metrics:        m,</pre></code></td></tr><tr><td>50</td><td><code><pre>                UpdateInterval: updateInterval,</pre></code></td></tr><tr><td>51</td><td><code><pre>                domain:         domain,</pre></code></td></tr><tr><td>52</td><td><code><pre>                dying:          make(chan struct{}),</pre></code></td></tr><tr><td>53</td><td><code><pre>                done:           make(chan struct{}),</pre></code></td></tr><tr><td>54</td><td><code><pre>        }</pre></code></td></tr><tr><td>55</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MetricsPlugin.Register">func MetricsPlugin.Register</div><div class="info"><a href="#s_fn_MetricsPlugin.Register">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/metrics.go</code>:</p></div><table class="listing">
<tr><td>34</td><td><code><pre>func (p *MetricsPlugin) Register(name string, rcvr interface{}, metadata string) error {</pre></code></td></tr><tr class="miss"><td>35</td><td><code><pre>        serviceCounter := metrics.GetOrRegisterCounter(p.withPrefix(&#34;serviceCounter&#34;), p.Registry)</pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>        serviceCounter.Inc(1)</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>38</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_reporter.makeClient">func reporter.makeClient</div><div class="info"><a href="#s_fn_reporter.makeClient">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/influxdb.go</code>:</p></div><table class="listing">
<tr><td>56</td><td><code><pre>func (r *reporter) makeClient() (err error) {</pre></code></td></tr><tr class="miss"><td>57</td><td><code><pre>        r.client, err = client.NewClient(client.Config{</pre></code></td></tr><tr><td>58</td><td><code><pre>                URL:      r.url,</pre></code></td></tr><tr><td>59</td><td><code><pre>                Username: r.username,</pre></code></td></tr><tr><td>60</td><td><code><pre>                Password: r.password,</pre></code></td></tr><tr><td>61</td><td><code><pre>        })</pre></code></td></tr><tr><td>62</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>63</td><td><code><pre>        return</pre></code></td></tr><tr><td>64</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_RegisterFileTransfer">func RegisterFileTransfer</div><div class="info"><a href="#s_fn_RegisterFileTransfer">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/file_transfer.go</code>:</p></div><table class="listing">
<tr><td>93</td><td><code><pre>func RegisterFileTransfer(s *server.Server, fileTransfer *FileTransfer) {</pre></code></td></tr><tr class="miss"><td>94</td><td><code><pre>        fileTransfer.Start()</pre></code></td></tr><tr class="miss"><td>95</td><td><code><pre>        s.RegisterName(SendFileServiceName, fileTransfer.service, &#34;&#34;)</pre></code></td></tr><tr><td>96</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_FileTransfer.Start">func FileTransfer.Start</div><div class="info"><a href="#s_fn_FileTransfer.Start">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/file_transfer.go</code>:</p></div><table class="listing">
<tr><td>130</td><td><code><pre>func (s *FileTransfer) Start() error {</pre></code></td></tr><tr class="miss"><td>131</td><td><code><pre>        s.startOnce.Do(func() {</pre></code></td></tr><tr><td>132</td><td><code><pre>                go s.start()</pre></code></td></tr><tr><td>133</td><td><code><pre>        })</pre></code></td></tr><tr><td>134</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>135</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>136</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_FileTransfer.Stop">func FileTransfer.Stop</div><div class="info"><a href="#s_fn_FileTransfer.Stop">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/file_transfer.go</code>:</p></div><table class="listing">
<tr><td>217</td><td><code><pre>func (s *FileTransfer) Stop() error {</pre></code></td></tr><tr class="miss"><td>218</td><td><code><pre>        close(s.done)</pre></code></td></tr><tr><td>219</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>220</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>221</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewRateLimitingPlugin">func NewRateLimitingPlugin</div><div class="info"><a href="#s_fn_NewRateLimitingPlugin">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/rate_limiting.go</code>:</p></div><table class="listing">
<tr><td>18</td><td><code><pre>func NewRateLimitingPlugin(fillInterval time.Duration, capacity int64) *RateLimitingPlugin {</pre></code></td></tr><tr class="miss"><td>19</td><td><code><pre>        tb := ratelimit.NewBucket(fillInterval, capacity)</pre></code></td></tr><tr><td>20</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>21</td><td><code><pre>        return &amp;RateLimitingPlugin{</pre></code></td></tr><tr><td>22</td><td><code><pre>                FillInterval: fillInterval,</pre></code></td></tr><tr><td>23</td><td><code><pre>                Capacity:     capacity,</pre></code></td></tr><tr><td>24</td><td><code><pre>                bucket:       tb}</pre></code></td></tr><tr><td>25</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_AliasPlugin.Alias">func AliasPlugin.Alias</div><div class="info"><a href="#s_fn_AliasPlugin.Alias">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/alias.go</code>:</p></div><table class="listing">
<tr><td>23</td><td><code><pre>func (p *AliasPlugin) Alias(aliasServicePath, aliasServiceMethod string, servicePath, serviceMethod string) {</pre></code></td></tr><tr class="miss"><td>24</td><td><code><pre>        p.Aliases[aliasServicePath+&#34;.&#34;+aliasServiceMethod] = &amp;aliasPair{</pre></code></td></tr><tr><td>25</td><td><code><pre>                servicePath:   servicePath,</pre></code></td></tr><tr><td>26</td><td><code><pre>                serviceMethod: serviceMethod,</pre></code></td></tr><tr><td>27</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>28</td><td><code><pre>        p.ReseverseAliases[servicePath+&#34;.&#34;+serviceMethod] = &amp;aliasPair{</pre></code></td></tr><tr><td>29</td><td><code><pre>                servicePath:   aliasServicePath,</pre></code></td></tr><tr><td>30</td><td><code><pre>                serviceMethod: aliasServiceMethod,</pre></code></td></tr><tr><td>31</td><td><code><pre>        }</pre></code></td></tr><tr><td>32</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MetricsPlugin.PreReadRequest">func MetricsPlugin.PreReadRequest</div><div class="info"><a href="#s_fn_MetricsPlugin.PreReadRequest">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/metrics.go</code>:</p></div><table class="listing">
<tr><td>48</td><td><code><pre>func (p *MetricsPlugin) PreReadRequest(ctx context.Context) error {</pre></code></td></tr><tr class="miss"><td>49</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>50</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MetricsPlugin.withPrefix">func MetricsPlugin.withPrefix</div><div class="info"><a href="#s_fn_MetricsPlugin.withPrefix">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/metrics.go</code>:</p></div><table class="listing">
<tr><td>29</td><td><code><pre>func (p *MetricsPlugin) withPrefix(m string) string {</pre></code></td></tr><tr class="miss"><td>30</td><td><code><pre>        return p.Prefix + m</pre></code></td></tr><tr><td>31</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewMetricsPlugin">func NewMetricsPlugin</div><div class="info"><a href="#s_fn_NewMetricsPlugin">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/metrics.go</code>:</p></div><table class="listing">
<tr><td>25</td><td><code><pre>func NewMetricsPlugin(registry metrics.Registry) *MetricsPlugin {</pre></code></td></tr><tr class="miss"><td>26</td><td><code><pre>        return &amp;MetricsPlugin{Registry: registry}</pre></code></td></tr><tr><td>27</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MetricsPlugin.Log">func MetricsPlugin.Log</div><div class="info"><a href="#s_fn_MetricsPlugin.Log">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/metrics.go</code>:</p></div><table class="listing">
<tr><td>95</td><td><code><pre>func (p *MetricsPlugin) Log(freq time.Duration, l metrics.Logger) {</pre></code></td></tr><tr class="miss"><td>96</td><td><code><pre>        go metrics.Log(p.Registry, freq, l)</pre></code></td></tr><tr><td>97</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_InfluxDB">func InfluxDB</div><div class="info"><a href="#s_fn_InfluxDB">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/influxdb.go</code>:</p></div><table class="listing">
<tr><td>27</td><td><code><pre>func InfluxDB(r metrics.Registry, d time.Duration, url, database, username, password string) {</pre></code></td></tr><tr class="miss"><td>28</td><td><code><pre>        InfluxDBWithTags(r, d, url, database, username, password, nil)</pre></code></td></tr><tr><td>29</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MetricsPlugin.Graphite">func MetricsPlugin.Graphite</div><div class="info"><a href="#s_fn_MetricsPlugin.Graphite">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/metrics.go</code>:</p></div><table class="listing">
<tr><td>104</td><td><code><pre>func (p *MetricsPlugin) Graphite(freq time.Duration, prefix string, addr *net.TCPAddr) {</pre></code></td></tr><tr class="miss"><td>105</td><td><code><pre>        go metrics.Graphite(p.Registry, freq, prefix, addr)</pre></code></td></tr><tr><td>106</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_RateLimitingPlugin.HandleConnAccept">func RateLimitingPlugin.HandleConnAccept</div><div class="info"><a href="#s_fn_RateLimitingPlugin.HandleConnAccept">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/rate_limiting.go</code>:</p></div><table class="listing">
<tr><td>28</td><td><code><pre>func (plugin *RateLimitingPlugin) HandleConnAccept(conn net.Conn) (net.Conn, bool) {</pre></code></td></tr><tr class="miss"><td>29</td><td><code><pre>        return conn, plugin.bucket.TakeAvailable(1) &gt; 0</pre></code></td></tr><tr><td>30</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@131:17">func @131:17</div><div class="info"><a href="#s_fn_@131:17">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/file_transfer.go</code>:</p></div><table class="listing">
<tr><td>131</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>132</td><td><code><pre>                go s.start()</pre></code></td></tr><tr><td>133</td><td><code><pre>        }</pre></code></td></tr></table>

<div class="funcname" id="fn_MetricsPlugin.InfluxDB">func MetricsPlugin.InfluxDB</div><div class="info"><a href="#s_fn_MetricsPlugin.InfluxDB">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/metrics.go</code>:</p></div><table class="listing">
<tr><td>112</td><td><code><pre>func (p *MetricsPlugin) InfluxDB(freq time.Duration, url, database, username, password string) {</pre></code></td></tr><tr class="miss"><td>113</td><td><code><pre>        go InfluxDB(p.Registry, freq, url, database, username, password)</pre></code></td></tr><tr><td>114</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_GetFunctionName">func GetFunctionName</div><div class="info"><a href="#s_fn_GetFunctionName">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/trace.go</code>:</p></div><table class="listing">
<tr><td>30</td><td><code><pre>func GetFunctionName(i interface{}) string {</pre></code></td></tr><tr class="miss"><td>31</td><td><code><pre>        return runtime.FuncForPC(reflect.ValueOf(i).Pointer()).Name()</pre></code></td></tr><tr><td>32</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MetricsPlugin.InfluxDBWithTags">func MetricsPlugin.InfluxDBWithTags</div><div class="info"><a href="#s_fn_MetricsPlugin.InfluxDBWithTags">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/metrics.go</code>:</p></div><table class="listing">
<tr><td>121</td><td><code><pre>func (p *MetricsPlugin) InfluxDBWithTags(freq time.Duration, url, database, username, password string, tags map[string]string) {</pre></code></td></tr><tr class="miss"><td>122</td><td><code><pre>        go InfluxDBWithTags(p.Registry, freq, url, database, username, password, tags)</pre></code></td></tr><tr><td>123</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_NewAliasPlugin">func NewAliasPlugin</div><div class="info"><a href="#s_fn_NewAliasPlugin">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/alias.go</code>:</p></div><table class="listing">
<tr><td>35</td><td><code><pre>func NewAliasPlugin() *AliasPlugin {</pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>        return &amp;AliasPlugin{</pre></code></td></tr><tr><td>37</td><td><code><pre>                Aliases:          make(map[string]*aliasPair),</pre></code></td></tr><tr><td>38</td><td><code><pre>                ReseverseAliases: make(map[string]*aliasPair),</pre></code></td></tr><tr><td>39</td><td><code><pre>        }</pre></code></td></tr><tr><td>40</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_MetricsPlugin.Exp">func MetricsPlugin.Exp</div><div class="info"><a href="#s_fn_MetricsPlugin.Exp">Back</a><p>In <code>/Users/yuepan/go/src/github.com/smallnest/rpcx/serverplugin/metrics.go</code>:</p></div><table class="listing">
<tr><td>127</td><td><code><pre>func (p *MetricsPlugin) Exp() {</pre></code></td></tr><tr class="miss"><td>128</td><td><code><pre>        exp.Exp(metrics.DefaultRegistry)</pre></code></td></tr><tr><td>129</td><td><code><pre>}</pre></code></td></tr></table>

<!-- Can be parsed by external script
PACKAGE:github.com/smallnest/rpcx/serverplugin DONE:0.00
-->

<div id="summaryWrapper"><div class="package">Report Total</div>
<div id="totalcov">20.89%</div>
</div>
    </body>
